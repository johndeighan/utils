"use strict";
// compile.lib.test.civet

import {
	getCmdArgs, setDirTree, DBG, withExt,
	isHash, execCmd, o, civet2jsFile,
	defined, isFunction, TPathInfo,

	TTesterFunc, TCompileStatus, TCompilerFunc, TPostProcessor,
	TCompilerConfig, isCompilerConfig,
	TCompilerInfo, isCompilerInfo,
	TCompileResult, TUnitTestResult,
	getCompilerConfig, getCompilerInfo, getPostProcessor,
	compileFile, getCompilerGlobPattern, allCompilableFiles,
	runUnitTestsFor, runAllUnitTests, userConfigPath,
	installCmd, uninstallCmd,
	} from '../src/lib/utils.lib.ts'
import {
	equal, like, succeeds, fails, truthy, falsy,
	matches, isType, notType, objListLike, strListLike,
	} from '../src/lib/unit-test.lib.ts'

getCmdArgs()

// ---------------------------------------------------------------------------

const setup = (): void => {

	setDirTree('test/compile', `test1.cielo
	# test1.cielo

	LOG := (str) => console.log str
	LOG "Hello, World!"

test2.civet
	# test2.civet

	LOG := (str) => console.log str
	LOG "Hello, World!"

test3.coffee
	# test3.coffee

	LOG = (str) => console.log str
	LOG "Hello, World!"

graph.dot
	EE -> EO | OE | OO
	EO -> EE
	OE -> EE
	OO -> EE
hello.ts
	console.log("Hello, World!");
comp.config.civet
	import {withExt} from '../../src/lib/fs.lib.ts'
	export default new Object {
		hCompilers: {
			'.test': {
				getOutPaths: (path: string) => [withExt(path, '.out')],
				tester: () => true,
				compiler: (path: string) => undefined
				}
			},
		hPostProcessors: {}
		}`, o`clear`)
	return
}

setup()

// ---------------------------------------------------------------------------

DBG("type TTesterFunc")

isType('TTesterFunc', () => {
	console.log("Hello, World!")
	return true
})

DBG("type TCompileStatus")

isType('TCompileStatus', 'temp')
isType('TCompileStatus', 'exists')
isType('TCompileStatus', 'compiled')
notType('TCompileStatus', 'dummy')

DBG("type TCompilerFunc")

isType('TCompilerFunc', (path: string) => {
	console.log(path)
	return 'compiled'
})

DBG("type TPostProcessor");

(() => {
	const logit = (hInfo: TPathInfo) => {
		console.log("done")
		return
	}
	isType('TPostProcessor', logit)
}
	)()

DBG("type TCompilerInfo")

isType('TCompilerInfo', {
	tester: () => true,
	compiler: (path: string) => { return 'compiled' },
	getOutPaths: (path: string) => { return ['temp.ts'] }
	})

DBG("type TCompilerConfig", "isCompilerConfig()")

isType('TCompilerConfig', {
	hCompilers: {},
	hPostProcessors: {}
	})

DBG("type TCompileResult")

isType('TCompileResult', {
	status: 'compiled',
	path: 'temp.civet'
	})

DBG("type TUnitTestResult")

isType('TUnitTestResult', {
	stub: 'temp',
	success: true
	})

DBG("getCompilerConfig(path)");

(() => {
	const civetPath = 'test/compile/comp.config.civet'
	civet2jsFile(civetPath)
	const jsPath = withExt(civetPath, '.js')
	const hConfig = getCompilerConfig(jsPath)
	isType('TCompilerConfig', hConfig, isCompilerConfig)
}
	)()

DBG("getCompilerInfo()")

isType('TCompilerInfo', getCompilerInfo('.dot'), isCompilerInfo)

DBG("getPostProcessor()");

(() => {
	const pp = getPostProcessor('test')
	truthy(defined(pp))
	truthy(isFunction(pp))
}
	)();

(() => {
	const pp = getPostProcessor('lib')
	truthy(defined(pp))
	truthy(isFunction(pp))
}
	)();

(() => {
	const pp = getPostProcessor('cmd')
	truthy(defined(pp))
	truthy(isFunction(pp))
}
	)()

DBG("compileFile()")

fails(() => compileFile('nosuchfile.civet'));

(() => {
	const hResult = compileFile('test/compile/test1.cielo', o`nopp`)
}
	// truthy isFile('test/compile/test1.civet')
	)()

DBG("getCompilerGlobPattern()")

equal(getCompilerGlobPattern(), "**/*{.svelte,.dot,.cielo,.civet}")

DBG("allCompilableFiles()");

(() => {
	const lInfo = Array.from(allCompilableFiles(o`root=test/compile`))
	const lFiles = lInfo.map((h) => h.fileName)
	strListLike(lFiles, [
		'graph.dot',
		'test1.cielo',
		'test2.civet',
		'comp.config.civet'
		])
}
	)()

DBG("runUnitTestsFor(stub)");

(() => {
	const lResults = Array.from(runUnitTestsFor('llutils.lib'))
	objListLike(lResults, [
		{stub: 'llutils.lib', success: true}
		])
}
	)()

DBG("runAllUnitTests()")

succeeds(() => {
	runAllUnitTests()
	return
})

DBG("const userConfigPath");

(() => {
	matches(userConfigPath, /compiler\.config\.ts/)
	const dir = Deno.cwd().replaceAll('\\','/')
	equal(userConfigPath, `${dir}/compiler.config.ts`)
}
	)()

DBG("installCmd()", "uninstallCmd()")

await installCmd('test/compile/hello.ts', 'hello')
const hResult = await execCmd('hello', [], o`collect`)
const str = hResult.stdout
equal(str, "Hello, World!\n")
await uninstallCmd('hello')

DBG("getCompilerConfig()")

truthy(isHash(getCompilerConfig()))

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC9jb21waWxlLmxpYi50ZXN0LmNpdmV0LnRzeCIsInNvdXJjZXMiOlsidGVzdC9jb21waWxlLmxpYi50ZXN0LmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEseUJBQXdCO0FBQ3hCLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7QUFDdEMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDbEMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTLENBQUM7QUFDaEM7QUFDQSxDQUFDLFdBQVcsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLGNBQWMsQ0FBQztBQUM1RCxDQUFDLGVBQWUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDO0FBQ25DLENBQUMsYUFBYSxDQUFDLENBQUMsY0FBYyxDQUFDO0FBQy9CLENBQUMsY0FBYyxDQUFDLENBQUMsZUFBZSxDQUFDO0FBQ2pDLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQztBQUN0RCxDQUFDLFdBQVcsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsa0JBQWtCLENBQUM7QUFDekQsQ0FBQyxlQUFlLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxjQUFjLENBQUM7QUFDbEQsQ0FBQyxVQUFVLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDMUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHlCQUF5QjtBQUNqQyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQztBQUM3QyxDQUFDLE9BQU8sQ0FB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QUFDSixBQUFBO0FBQ0EsQUFBQSxBQUFBLEdBQUcsQ0FBQSxBQUFDLGNBQWMsQ0FBQyxDQUFDLGdCQUFnQixDQUFBO0FBQ3BDLEFBQUE7QUFDQSxBQUFBLEFBQUEsS0FBSyxDQUFDLFVBQVUsQ0FBQSxBQUFDLHVCQUF1QixDQUFDLENBQUMsT0FBTyxDQUFBO0FBQ2pELEFBQUEsQUFBTyxNQUFQLE9BQU8sQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQSxBQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQyxTQUFVLENBQUE7QUFDaEQsQUFBQSxBQUFHLE1BQUgsR0FBRyxDQUFDLENBQUUsQ0FBQyxPQUFPLENBQUMsTUFBTTtBQUNyQixBQUFBLEFBQUEsS0FBSyxDQUFBLEFBQUMsR0FBRyxDQUFDLENBQUMsaUJBQWlCLENBQUE7QUFDNUIsQUFBQSxBQUFBLEtBQUssQ0FBQyxZQUFZLENBQUEsQUFBQyxPQUFPLENBQUE7QUFDMUIsQUFBQTtBQUNBLEFBQUEsQUFBQSxHQUFHLENBQUEsQUFBQyxxQkFBcUIsQ0FBQTtBQUN6QixBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBQSxBQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNsQyIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyBjb21waWxlLmxpYi50ZXN0LmNpdmV0XG5cbmltcG9ydCB7XG5cdGdldENtZEFyZ3MsIHNldERpclRyZWUsIERCRywgd2l0aEV4dCxcblx0aXNIYXNoLCBleGVjQ21kLCBvLCBjaXZldDJqc0ZpbGUsXG5cdGRlZmluZWQsIGlzRnVuY3Rpb24sIFRQYXRoSW5mbyxcblxuXHRUVGVzdGVyRnVuYywgVENvbXBpbGVTdGF0dXMsIFRDb21waWxlckZ1bmMsIFRQb3N0UHJvY2Vzc29yLFxuXHRUQ29tcGlsZXJDb25maWcsIGlzQ29tcGlsZXJDb25maWcsXG5cdFRDb21waWxlckluZm8sIGlzQ29tcGlsZXJJbmZvLFxuXHRUQ29tcGlsZVJlc3VsdCwgVFVuaXRUZXN0UmVzdWx0LFxuXHRnZXRDb21waWxlckNvbmZpZywgZ2V0Q29tcGlsZXJJbmZvLCBnZXRQb3N0UHJvY2Vzc29yLFxuXHRjb21waWxlRmlsZSwgZ2V0Q29tcGlsZXJHbG9iUGF0dGVybiwgYWxsQ29tcGlsYWJsZUZpbGVzLFxuXHRydW5Vbml0VGVzdHNGb3IsIHJ1bkFsbFVuaXRUZXN0cywgdXNlckNvbmZpZ1BhdGgsXG5cdGluc3RhbGxDbWQsIHVuaW5zdGFsbENtZCxcblx0fSBmcm9tICcuLi9zcmMvbGliL3V0aWxzLmxpYi50cydcbmltcG9ydCB7XG5cdGVxdWFsLCBsaWtlLCBzdWNjZWVkcywgZmFpbHMsIHRydXRoeSwgZmFsc3ksXG5cdG1hdGNoZXMsIGlzVHlwZSwgbm90VHlwZSwgb2JqTGlzdExpa2UsIHN0ckxpc3RMaWtlLFxuXHR9IGZyb20gJy4uL3NyYy9saWIvdW5pdC10ZXN0LmxpYi50cydcblxuZ2V0Q21kQXJncygpXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbnNldHVwIDo9ICgpOiB2b2lkID0+XG5cblx0c2V0RGlyVHJlZSgndGVzdC9jb21waWxlJywgXCJcIlwiXG5cdFx0dGVzdDEuY2llbG9cblx0XHRcdCMgdGVzdDEuY2llbG9cblxuXHRcdFx0TE9HIDo9IChzdHIpID0+IGNvbnNvbGUubG9nIHN0clxuXHRcdFx0TE9HIFwiSGVsbG8sIFdvcmxkIVwiXG5cblx0XHR0ZXN0Mi5jaXZldFxuXHRcdFx0IyB0ZXN0Mi5jaXZldFxuXG5cdFx0XHRMT0cgOj0gKHN0cikgPT4gY29uc29sZS5sb2cgc3RyXG5cdFx0XHRMT0cgXCJIZWxsbywgV29ybGQhXCJcblxuXHRcdHRlc3QzLmNvZmZlZVxuXHRcdFx0IyB0ZXN0My5jb2ZmZWVcblxuXHRcdFx0TE9HID0gKHN0cikgPT4gY29uc29sZS5sb2cgc3RyXG5cdFx0XHRMT0cgXCJIZWxsbywgV29ybGQhXCJcblxuXHRcdGdyYXBoLmRvdFxuXHRcdFx0RUUgLT4gRU8gfCBPRSB8IE9PXG5cdFx0XHRFTyAtPiBFRVxuXHRcdFx0T0UgLT4gRUVcblx0XHRcdE9PIC0+IEVFXG5cdFx0aGVsbG8udHNcblx0XHRcdGNvbnNvbGUubG9nKFwiSGVsbG8sIFdvcmxkIVwiKTtcblx0XHRjb21wLmNvbmZpZy5jaXZldFxuXHRcdFx0aW1wb3J0IHt3aXRoRXh0fSBmcm9tICcuLi8uLi9zcmMvbGliL2ZzLmxpYi50cydcblx0XHRcdGV4cG9ydCBkZWZhdWx0IG5ldyBPYmplY3Qge1xuXHRcdFx0XHRoQ29tcGlsZXJzOiB7XG5cdFx0XHRcdFx0Jy50ZXN0Jzoge1xuXHRcdFx0XHRcdFx0Z2V0T3V0UGF0aHM6IChwYXRoOiBzdHJpbmcpID0+IFt3aXRoRXh0KHBhdGgsICcub3V0JyldLFxuXHRcdFx0XHRcdFx0dGVzdGVyOiAoKSA9PiB0cnVlLFxuXHRcdFx0XHRcdFx0Y29tcGlsZXI6IChwYXRoOiBzdHJpbmcpID0+IHVuZGVmaW5lZFxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdGhQb3N0UHJvY2Vzc29yczoge31cblx0XHRcdFx0fVxuXHRcdFwiXCJcIiwgbydjbGVhcicpXG5cdHJldHVyblxuXG5zZXR1cCgpXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkRCRyBcInR5cGUgVFRlc3RlckZ1bmNcIlxuXG5pc1R5cGUgJ1RUZXN0ZXJGdW5jJywgKCkgPT5cblx0Y29uc29sZS5sb2cgXCJIZWxsbywgV29ybGQhXCJcblx0cmV0dXJuIHRydWVcblxuREJHIFwidHlwZSBUQ29tcGlsZVN0YXR1c1wiXG5cbmlzVHlwZSAnVENvbXBpbGVTdGF0dXMnLCAndGVtcCdcbmlzVHlwZSAnVENvbXBpbGVTdGF0dXMnLCAnZXhpc3RzJ1xuaXNUeXBlICdUQ29tcGlsZVN0YXR1cycsICdjb21waWxlZCdcbm5vdFR5cGUgJ1RDb21waWxlU3RhdHVzJywgJ2R1bW15J1xuXG5EQkcgXCJ0eXBlIFRDb21waWxlckZ1bmNcIlxuXG5pc1R5cGUgJ1RDb21waWxlckZ1bmMnLCAocGF0aDogc3RyaW5nKSA9PlxuXHRjb25zb2xlLmxvZyBwYXRoXG5cdHJldHVybiAnY29tcGlsZWQnXG5cbkRCRyBcInR5cGUgVFBvc3RQcm9jZXNzb3JcIlxuXG4oKCkgPT5cblx0bG9naXQgOj0gKGhJbmZvOiBUUGF0aEluZm8pID0+XG5cdFx0Y29uc29sZS5sb2cgXCJkb25lXCJcblx0XHRyZXR1cm5cblx0aXNUeXBlICdUUG9zdFByb2Nlc3NvcicsIGxvZ2l0XG5cdCkoKVxuXG5EQkcgXCJ0eXBlIFRDb21waWxlckluZm9cIlxuXG5pc1R5cGUgJ1RDb21waWxlckluZm8nLCB7XG5cdHRlc3RlcjogKCkgPT4gdHJ1ZSxcblx0Y29tcGlsZXI6IChwYXRoOiBzdHJpbmcpID0+IHJldHVybiAnY29tcGlsZWQnLFxuXHRnZXRPdXRQYXRoczogKHBhdGg6IHN0cmluZykgPT4gcmV0dXJuIFsndGVtcC50cyddXG5cdH1cblxuREJHIFwidHlwZSBUQ29tcGlsZXJDb25maWdcIiwgXCJpc0NvbXBpbGVyQ29uZmlnKClcIlxuXG5pc1R5cGUgJ1RDb21waWxlckNvbmZpZycsIHtcblx0aENvbXBpbGVyczoge31cblx0aFBvc3RQcm9jZXNzb3JzOiB7fVxuXHR9XG5cbkRCRyBcInR5cGUgVENvbXBpbGVSZXN1bHRcIlxuXG5pc1R5cGUgJ1RDb21waWxlUmVzdWx0Jywge1xuXHRzdGF0dXM6ICdjb21waWxlZCdcblx0cGF0aDogJ3RlbXAuY2l2ZXQnXG5cdH1cblxuREJHIFwidHlwZSBUVW5pdFRlc3RSZXN1bHRcIlxuXG5pc1R5cGUgJ1RVbml0VGVzdFJlc3VsdCcsIHtcblx0c3R1YjogJ3RlbXAnXG5cdHN1Y2Nlc3M6IHRydWVcblx0fVxuXG5EQkcgXCJnZXRDb21waWxlckNvbmZpZyhwYXRoKVwiXG5cbigoKSA9PlxuXHRjaXZldFBhdGggOj0gJ3Rlc3QvY29tcGlsZS9jb21wLmNvbmZpZy5jaXZldCdcblx0Y2l2ZXQyanNGaWxlIGNpdmV0UGF0aFxuXHRqc1BhdGggOj0gd2l0aEV4dChjaXZldFBhdGgsICcuanMnKVxuXHRoQ29uZmlnIDo9IGdldENvbXBpbGVyQ29uZmlnKGpzUGF0aClcblx0aXNUeXBlICdUQ29tcGlsZXJDb25maWcnLCBoQ29uZmlnLCBpc0NvbXBpbGVyQ29uZmlnXG5cdCkoKVxuXG5EQkcgXCJnZXRDb21waWxlckluZm8oKVwiXG5cbmlzVHlwZSAnVENvbXBpbGVySW5mbycsIGdldENvbXBpbGVySW5mbygnLmRvdCcpLCBpc0NvbXBpbGVySW5mb1xuXG5EQkcgXCJnZXRQb3N0UHJvY2Vzc29yKClcIlxuXG4oKCkgPT5cblx0cHAgOj0gZ2V0UG9zdFByb2Nlc3NvcigndGVzdCcpXG5cdHRydXRoeSBkZWZpbmVkKHBwKVxuXHR0cnV0aHkgaXNGdW5jdGlvbihwcClcblx0KSgpXG5cbigoKSA9PlxuXHRwcCA6PSBnZXRQb3N0UHJvY2Vzc29yKCdsaWInKVxuXHR0cnV0aHkgZGVmaW5lZChwcClcblx0dHJ1dGh5IGlzRnVuY3Rpb24ocHApXG5cdCkoKVxuXG4oKCkgPT5cblx0cHAgOj0gZ2V0UG9zdFByb2Nlc3NvcignY21kJylcblx0dHJ1dGh5IGRlZmluZWQocHApXG5cdHRydXRoeSBpc0Z1bmN0aW9uKHBwKVxuXHQpKClcblxuREJHIFwiY29tcGlsZUZpbGUoKVwiXG5cbmZhaWxzICgpID0+IGNvbXBpbGVGaWxlICdub3N1Y2hmaWxlLmNpdmV0J1xuXG4oKCkgPT5cblx0aFJlc3VsdCA6PSBjb21waWxlRmlsZSgndGVzdC9jb21waWxlL3Rlc3QxLmNpZWxvJywgbydub3BwJylcblx0IyB0cnV0aHkgaXNGaWxlKCd0ZXN0L2NvbXBpbGUvdGVzdDEuY2l2ZXQnKVxuXHQpKClcblxuREJHIFwiZ2V0Q29tcGlsZXJHbG9iUGF0dGVybigpXCJcblxuZXF1YWwgZ2V0Q29tcGlsZXJHbG9iUGF0dGVybigpLCBcIioqLyp7LnN2ZWx0ZSwuZG90LC5jaWVsbywuY2l2ZXR9XCJcblxuREJHIFwiYWxsQ29tcGlsYWJsZUZpbGVzKClcIlxuXG4oKCkgPT5cblx0bEluZm8gOj0gQXJyYXkuZnJvbShhbGxDb21waWxhYmxlRmlsZXMobydyb290PXRlc3QvY29tcGlsZScpKVxuXHRsRmlsZXMgOj0gbEluZm8ubWFwKChoKSA9PiBoLmZpbGVOYW1lKVxuXHRzdHJMaXN0TGlrZSBsRmlsZXMsIFtcblx0XHQnZ3JhcGguZG90J1xuXHRcdCd0ZXN0MS5jaWVsbydcblx0XHQndGVzdDIuY2l2ZXQnXG5cdFx0J2NvbXAuY29uZmlnLmNpdmV0J1xuXHRcdF1cblx0KSgpXG5cbkRCRyBcInJ1blVuaXRUZXN0c0ZvcihzdHViKVwiXG5cbigoKSA9PlxuXHRsUmVzdWx0cyA6PSBBcnJheS5mcm9tKHJ1blVuaXRUZXN0c0ZvcignbGx1dGlscy5saWInKSlcblx0b2JqTGlzdExpa2UgbFJlc3VsdHMsIFtcblx0XHR7c3R1YjogJ2xsdXRpbHMubGliJywgc3VjY2VzczogdHJ1ZX1cblx0XHRdXG5cdCkoKVxuXG5EQkcgXCJydW5BbGxVbml0VGVzdHMoKVwiXG5cbnN1Y2NlZWRzICgpID0+XG5cdHJ1bkFsbFVuaXRUZXN0cygpXG5cdHJldHVyblxuXG5EQkcgXCJjb25zdCB1c2VyQ29uZmlnUGF0aFwiXG5cbigoKSA9PlxuXHRtYXRjaGVzIHVzZXJDb25maWdQYXRoLCAvY29tcGlsZXJcXC5jb25maWdcXC50cy9cblx0ZGlyIDo9IERlbm8uY3dkKCkucmVwbGFjZUFsbCgnXFxcXCcsJy8nKVxuXHRlcXVhbCB1c2VyQ29uZmlnUGF0aCwgXCIje2Rpcn0vY29tcGlsZXIuY29uZmlnLnRzXCJcblx0KSgpXG5cbkRCRyBcImluc3RhbGxDbWQoKVwiLCBcInVuaW5zdGFsbENtZCgpXCJcblxuYXdhaXQgaW5zdGFsbENtZCAndGVzdC9jb21waWxlL2hlbGxvLnRzJywgJ2hlbGxvJ1xuaFJlc3VsdCA6PSBhd2FpdCBleGVjQ21kICdoZWxsbycsIFtdLCBvJ2NvbGxlY3QnXG5zdHIgOj0gaFJlc3VsdC5zdGRvdXRcbmVxdWFsIHN0ciwgXCJIZWxsbywgV29ybGQhXFxuXCJcbmF3YWl0IHVuaW5zdGFsbENtZCAnaGVsbG8nXG5cbkRCRyBcImdldENvbXBpbGVyQ29uZmlnKClcIlxuXG50cnV0aHkgaXNIYXNoKGdldENvbXBpbGVyQ29uZmlnKCkpXG4iXX0=