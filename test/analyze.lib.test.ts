"use strict";
// analyze.lib.test.civet

import {
	undef, getCmdArgs, DBG, setDirTree, o,
	} from '../src/lib/utils.lib.ts'
import {
	symbolKind, isSymbolKind, symbolDesc, testDesc,
	isSymbolDesc, parseExportLine,
	allExportsIn, allUnitTestsIn,
	mergeAnalyses, dumpSymbols,
	} from '../src/lib/analyze.lib.ts'
import {
	equal, like, succeeds, fails, truthy, falsy, listLike,
	isType, notType,
	} from '../src/lib/unit-test.lib.ts'

const hArgs = getCmdArgs()

// ---------------------------------------------------------------------------

const setup = (): void => {

	DBG("setDirTree()")

	setDirTree('test/analyze', `exports.civet
	export type {symbolDesc}
	export {parseExportLine, allExportsIn}
	x := 23
	export type symbolDesc = 'abc' | 'def'
	export isSymbolDesc := (x: any): x is symbolDesc =>
	export parseExportLine := (line: string): symbolDesc? =>
	export getExportsIn := (path: string): symbolDesc[] =>
	export hExt1 := {'.txt': 3, '.ext': 5}
	export let hExt2 := {'.txt': 3, '.ext': 5}
	export var hExt3 := {'.txt': 3, '.ext': 5}
	export function indented(
	export interface hashof<T> {
	export enum LogCmd {
	export class FileEventHandler
	export assert: AssertFunc := (
	export isArrayOfStrings := (x: any): x is string[] =>
	export getV8Stack = (): stackFrame[] =>

good.test.civet
	DBG "type hash", "isHash()"

	truthy isHash({a:1, b:2})
	falsy  isHash(42)

	DBG "type voidFunc"

	dump: voidFunc := () =>
		console.log "Hello, World!"
		return

	DBG "type char", "function isChar"

	truthy isChar('a')
	falsy  isChar(undef)

	DBG "type nonEmptyString", "isNonEmptyString()"

	str: nonEmptyString := 'abc'
	truthy isNonEmptyString('a')
	falsy  isNonEmptyString('')

bad.test.civet
	DBG "type hash", "isHash()"

	truthy isHash({a:1, b:2})
	falsy  isHash(42)

	DBG "type voidFunc"

	dump: voidFunc := () =>
		console.log "Hello, World!"
		return

	DBG "type char isChar"

	truthy isChar('a')
	falsy  isChar(undef)

	DBG "type nonEmptyString", "isNonEmptyString()"

	str: nonEmptyString := 'abc'
	truthy isNonEmptyString('a')
	falsy  isNonEmptyString('')
`, o`clear`)
	return
}

setup()

// ---------------------------------------------------------------------------

DBG("type symbolKind", "isSymbolKind()")

isType('symbolKind', 'var')
isType('symbolKind', 'function')
notType('symbolKind', 'dummy')

truthy(isSymbolKind('const'))
falsy( isSymbolKind('dummy'))

// ---------------------------------------------------------------------------

DBG("type symbolDesc", "isSymbolDesc()")

truthy(isSymbolDesc({kind: 'function', name: 'f', numTests: 0}))
falsy( isSymbolDesc({kind: 'function', name: 'f', numTests: -1}))

// ---------------------------------------------------------------------------

DBG("type testDesc")

isType('testDesc', {kind: 'function', name: 'f', numTests: 0})

// ---------------------------------------------------------------------------

DBG("parseExportLine()")

// --- re-exports aren't included
equal(parseExportLine("export type {bigstring}"), undef)

equal(parseExportLine("export const label = 'abc'"),
	{
		kind: 'const',
		name: 'label'
		})
equal(parseExportLine("export label: string := 'abc'"),
	{
		kind: 'const',
		name: 'label'
		})
equal(parseExportLine("export let once: string? = undef"),
	{
		kind: 'var',
		name: 'once'
		})
equal(parseExportLine("export f := (str: string?=undef): void =>"),
	{
		kind: 'function',
		name: 'f'
		})
equal(parseExportLine("export type TFileOp = {"),
	{
		kind: 'type',
		name: 'TFileOp'
		})

// ---------------------------------------------------------------------------

DBG("allExportsIn()")

equal(await Array.fromAsync(allExportsIn('test/analyze/exports.civet')), [
	{kind: 'type',     name: 'symbolDesc'},
	{kind: 'function', name: 'isSymbolDesc', guardFor: 'symbolDesc'},
	{kind: 'function', name: 'parseExportLine'},
	{kind: 'function', name: 'getExportsIn'},
	{kind: 'const', name: 'hExt1'},
	{kind: 'var', name: 'hExt2'},
	{kind: 'var', name: 'hExt3'},
	{kind: 'function', name: 'indented'},
	{kind: 'interface', name: 'hashof<T>'},
	{kind: 'enum', name: 'LogCmd'},
	{kind: 'class', name: 'FileEventHandler'},
	{kind: 'function', name: 'assert'},
	{kind: 'function', name: 'isArrayOfStrings', guardFor: 'string[]'},
	{kind: 'function', name: 'getV8Stack'}
	])

DBG("allUnitTestsIn()")

succeeds(() => allUnitTestsIn('test/analyze/good.test.civet'))
fails(() => allUnitTestsIn('test/analyze/bad.test.civet'))

DBG("mergeAnalyses(lExports, lTestlabels)");

(() => {
	const lExports: symbolDesc[] = []
	const lTestLabels: testDesc[] = []
	equal(mergeAnalyses(lExports, lTestLabels), [])
	listLike(mergeAnalyses(
		[
			{
				name: 'func',
				kind: 'function'
				},
			{
				name: 'func2',
				kind: 'function'
				}
			],
		[
			{
				name: 'func2',
				kind: 'function',
				numTests: 3
				}
			]
		), [
			{
				name: 'func',
				kind: 'function',
				numTests: 0,
				status: 'missing'
				},
			{
				name: 'func2',
				kind: 'function',
				numTests: 3,
				status: 'ok'
				}
		])
}

	)()

DBG("dumpSymbols()")

equal(dumpSymbols('label', [{kind: 'var', name: 'x', numTests: 0}]), 1)

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC9hbmFseXplLmxpYi50ZXN0LmNpdmV0LnRzeCIsInNvdXJjZXMiOlsidGVzdC9hbmFseXplLmxpYi50ZXN0LmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEseUJBQXdCO0FBQ3hCLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdkMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHlCQUF5QjtBQUNqQyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLFVBQVUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFFBQVEsQ0FBQztBQUNoRCxDQUFDLFlBQVksQ0FBQyxDQUFDLGVBQWUsQ0FBQztBQUMvQixDQUFDLFlBQVksQ0FBQyxDQUFDLGNBQWMsQ0FBQztBQUM5QixDQUFDLGFBQWEsQ0FBQyxDQUFDLFdBQVcsQ0FBQztBQUM1QixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsMkJBQTJCO0FBQ25DLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxDQUFDO0FBQ3ZELENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQ2pCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyw2QkFBNkI7QUFDckMsQUFBQTtBQUNBLEFBQUEsQUFBSyxNQUFMLEtBQUssQ0FBQyxDQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDckIsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUssTUFBTCxLQUFLLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFB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QUFDLGdCQUFnQixDQUFBO0FBQ3BCLEFBQUE7QUFDQSxBQUFBLEFBQUEsS0FBSyxDQUFBLEFBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLDRCQUE0QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDMUUsQUFBQSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUE7QUFDdkMsQUFBQSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUE7QUFDakUsQUFBQSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtBQUM1QyxBQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQTtBQUN6QyxBQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUMvQixBQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUM3QixBQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtBQUM3QixBQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtBQUNyQyxBQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQTtBQUN2QyxBQUFB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LEFBQUEsSUFBSSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUE7QUFDakIsQUFBQSxJQUFJLElBQUksQ0FBQyxDQUFDLFVBQVUsQ0FBQTtBQUNwQixBQUFBLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ2YsQUFBQSxJQUFJLE1BQU0sQ0FBQyxDQUFDLElBQUk7QUFDaEIsSUFBSSxDQUFDO0FBQ0wsRUFBRSxDQUFDLEM7QUFBQSxDQUFBO0FBQ0g7QUFDQSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ0osQUFBQTtBQUNBLEFBQUEsQUFBQSxHQUFHLENBQUEsQUFBQyxlQUFlLENBQUE7QUFDbkIsQUFBQTtBQUNBLEFBQUEsQUFBQSxLQUFLLENBQUEsQUFBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUN0RSIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyBhbmFseXplLmxpYi50ZXN0LmNpdmV0XG5cbmltcG9ydCB7XG5cdHVuZGVmLCBnZXRDbWRBcmdzLCBEQkcsIHNldERpclRyZWUsIG8sXG5cdH0gZnJvbSAnLi4vc3JjL2xpYi91dGlscy5saWIudHMnXG5pbXBvcnQge1xuXHRzeW1ib2xLaW5kLCBpc1N5bWJvbEtpbmQsIHN5bWJvbERlc2MsIHRlc3REZXNjLFxuXHRpc1N5bWJvbERlc2MsIHBhcnNlRXhwb3J0TGluZSxcblx0YWxsRXhwb3J0c0luLCBhbGxVbml0VGVzdHNJbixcblx0bWVyZ2VBbmFseXNlcywgZHVtcFN5bWJvbHMsXG5cdH0gZnJvbSAnLi4vc3JjL2xpYi9hbmFseXplLmxpYi50cydcbmltcG9ydCB7XG5cdGVxdWFsLCBsaWtlLCBzdWNjZWVkcywgZmFpbHMsIHRydXRoeSwgZmFsc3ksIGxpc3RMaWtlLFxuXHRpc1R5cGUsIG5vdFR5cGUsXG5cdH0gZnJvbSAnLi4vc3JjL2xpYi91bml0LXRlc3QubGliLnRzJ1xuXG5oQXJncyA6PSBnZXRDbWRBcmdzKClcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuc2V0dXAgOj0gKCk6IHZvaWQgPT5cblxuXHREQkcgXCJzZXREaXJUcmVlKClcIlxuXG5cdHNldERpclRyZWUgJ3Rlc3QvYW5hbHl6ZScsIFwiXCJcIlxuXHRcdFx0ZXhwb3J0cy5jaXZldFxuXHRcdFx0XHRleHBvcnQgdHlwZSB7c3ltYm9sRGVzY31cblx0XHRcdFx0ZXhwb3J0IHtwYXJzZUV4cG9ydExpbmUsIGFsbEV4cG9ydHNJbn1cblx0XHRcdFx0eCA6PSAyM1xuXHRcdFx0XHRleHBvcnQgdHlwZSBzeW1ib2xEZXNjID0gJ2FiYycgfCAnZGVmJ1xuXHRcdFx0XHRleHBvcnQgaXNTeW1ib2xEZXNjIDo9ICh4OiBhbnkpOiB4IGlzIHN5bWJvbERlc2MgPT5cblx0XHRcdFx0ZXhwb3J0IHBhcnNlRXhwb3J0TGluZSA6PSAobGluZTogc3RyaW5nKTogc3ltYm9sRGVzYz8gPT5cblx0XHRcdFx0ZXhwb3J0IGdldEV4cG9ydHNJbiA6PSAocGF0aDogc3RyaW5nKTogc3ltYm9sRGVzY1tdID0+XG5cdFx0XHRcdGV4cG9ydCBoRXh0MSA6PSB7Jy50eHQnOiAzLCAnLmV4dCc6IDV9XG5cdFx0XHRcdGV4cG9ydCBsZXQgaEV4dDIgOj0geycudHh0JzogMywgJy5leHQnOiA1fVxuXHRcdFx0XHRleHBvcnQgdmFyIGhFeHQzIDo9IHsnLnR4dCc6IDMsICcuZXh0JzogNX1cblx0XHRcdFx0ZXhwb3J0IGZ1bmN0aW9uIGluZGVudGVkKFxuXHRcdFx0XHRleHBvcnQgaW50ZXJmYWNlIGhhc2hvZjxUPiB7XG5cdFx0XHRcdGV4cG9ydCBlbnVtIExvZ0NtZCB7XG5cdFx0XHRcdGV4cG9ydCBjbGFzcyBGaWxlRXZlbnRIYW5kbGVyXG5cdFx0XHRcdGV4cG9ydCBhc3NlcnQ6IEFzc2VydEZ1bmMgOj0gKFxuXHRcdFx0XHRleHBvcnQgaXNBcnJheU9mU3RyaW5ncyA6PSAoeDogYW55KTogeCBpcyBzdHJpbmdbXSA9PlxuXHRcdFx0XHRleHBvcnQgZ2V0VjhTdGFjayA9ICgpOiBzdGFja0ZyYW1lW10gPT5cblxuXHRcdFx0Z29vZC50ZXN0LmNpdmV0XG5cdFx0XHRcdERCRyBcInR5cGUgaGFzaFwiLCBcImlzSGFzaCgpXCJcblxuXHRcdFx0XHR0cnV0aHkgaXNIYXNoKHthOjEsIGI6Mn0pXG5cdFx0XHRcdGZhbHN5ICBpc0hhc2goNDIpXG5cblx0XHRcdFx0REJHIFwidHlwZSB2b2lkRnVuY1wiXG5cblx0XHRcdFx0ZHVtcDogdm9pZEZ1bmMgOj0gKCkgPT5cblx0XHRcdFx0XHRjb25zb2xlLmxvZyBcIkhlbGxvLCBXb3JsZCFcIlxuXHRcdFx0XHRcdHJldHVyblxuXG5cdFx0XHRcdERCRyBcInR5cGUgY2hhclwiLCBcImZ1bmN0aW9uIGlzQ2hhclwiXG5cblx0XHRcdFx0dHJ1dGh5IGlzQ2hhcignYScpXG5cdFx0XHRcdGZhbHN5ICBpc0NoYXIodW5kZWYpXG5cblx0XHRcdFx0REJHIFwidHlwZSBub25FbXB0eVN0cmluZ1wiLCBcImlzTm9uRW1wdHlTdHJpbmcoKVwiXG5cblx0XHRcdFx0c3RyOiBub25FbXB0eVN0cmluZyA6PSAnYWJjJ1xuXHRcdFx0XHR0cnV0aHkgaXNOb25FbXB0eVN0cmluZygnYScpXG5cdFx0XHRcdGZhbHN5ICBpc05vbkVtcHR5U3RyaW5nKCcnKVxuXG5cdFx0XHRiYWQudGVzdC5jaXZldFxuXHRcdFx0XHREQkcgXCJ0eXBlIGhhc2hcIiwgXCJpc0hhc2goKVwiXG5cblx0XHRcdFx0dHJ1dGh5IGlzSGFzaCh7YToxLCBiOjJ9KVxuXHRcdFx0XHRmYWxzeSAgaXNIYXNoKDQyKVxuXG5cdFx0XHRcdERCRyBcInR5cGUgdm9pZEZ1bmNcIlxuXG5cdFx0XHRcdGR1bXA6IHZvaWRGdW5jIDo9ICgpID0+XG5cdFx0XHRcdFx0Y29uc29sZS5sb2cgXCJIZWxsbywgV29ybGQhXCJcblx0XHRcdFx0XHRyZXR1cm5cblxuXHRcdFx0XHREQkcgXCJ0eXBlIGNoYXIgaXNDaGFyXCJcblxuXHRcdFx0XHR0cnV0aHkgaXNDaGFyKCdhJylcblx0XHRcdFx0ZmFsc3kgIGlzQ2hhcih1bmRlZilcblxuXHRcdFx0XHREQkcgXCJ0eXBlIG5vbkVtcHR5U3RyaW5nXCIsIFwiaXNOb25FbXB0eVN0cmluZygpXCJcblxuXHRcdFx0XHRzdHI6IG5vbkVtcHR5U3RyaW5nIDo9ICdhYmMnXG5cdFx0XHRcdHRydXRoeSBpc05vbkVtcHR5U3RyaW5nKCdhJylcblx0XHRcdFx0ZmFsc3kgIGlzTm9uRW1wdHlTdHJpbmcoJycpXG5cblx0XHRcIlwiXCIsIG8nY2xlYXInXG5cdHJldHVyblxuXG5zZXR1cCgpXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbkRCRyBcInR5cGUgc3ltYm9sS2luZFwiLCBcImlzU3ltYm9sS2luZCgpXCJcblxuaXNUeXBlICdzeW1ib2xLaW5kJywgJ3ZhcidcbmlzVHlwZSAnc3ltYm9sS2luZCcsICdmdW5jdGlvbidcbm5vdFR5cGUgJ3N5bWJvbEtpbmQnLCAnZHVtbXknXG5cbnRydXRoeSBpc1N5bWJvbEtpbmQoJ2NvbnN0JylcbmZhbHN5ICBpc1N5bWJvbEtpbmQoJ2R1bW15JylcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuREJHIFwidHlwZSBzeW1ib2xEZXNjXCIsIFwiaXNTeW1ib2xEZXNjKClcIlxuXG50cnV0aHkgaXNTeW1ib2xEZXNjKHtraW5kOiAnZnVuY3Rpb24nLCBuYW1lOiAnZicsIG51bVRlc3RzOiAwfSlcbmZhbHN5ICBpc1N5bWJvbERlc2Moe2tpbmQ6ICdmdW5jdGlvbicsIG5hbWU6ICdmJywgbnVtVGVzdHM6IC0xfSlcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuREJHIFwidHlwZSB0ZXN0RGVzY1wiXG5cbmlzVHlwZSAndGVzdERlc2MnLCB7a2luZDogJ2Z1bmN0aW9uJywgbmFtZTogJ2YnLCBudW1UZXN0czogMH1cblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuREJHIFwicGFyc2VFeHBvcnRMaW5lKClcIlxuXG4jIC0tLSByZS1leHBvcnRzIGFyZW4ndCBpbmNsdWRlZFxuZXF1YWwgcGFyc2VFeHBvcnRMaW5lKFwiZXhwb3J0IHR5cGUge2JpZ3N0cmluZ31cIiksIHVuZGVmXG5cbmVxdWFsIHBhcnNlRXhwb3J0TGluZShcImV4cG9ydCBjb25zdCBsYWJlbCA9ICdhYmMnXCIpLFxuXHR7XG5cdFx0a2luZDogJ2NvbnN0J1xuXHRcdG5hbWU6ICdsYWJlbCdcblx0XHR9XG5lcXVhbCBwYXJzZUV4cG9ydExpbmUoXCJleHBvcnQgbGFiZWw6IHN0cmluZyA6PSAnYWJjJ1wiKSxcblx0e1xuXHRcdGtpbmQ6ICdjb25zdCdcblx0XHRuYW1lOiAnbGFiZWwnXG5cdFx0fVxuZXF1YWwgcGFyc2VFeHBvcnRMaW5lKFwiZXhwb3J0IGxldCBvbmNlOiBzdHJpbmc/ID0gdW5kZWZcIiksXG5cdHtcblx0XHRraW5kOiAndmFyJ1xuXHRcdG5hbWU6ICdvbmNlJ1xuXHRcdH1cbmVxdWFsIHBhcnNlRXhwb3J0TGluZShcImV4cG9ydCBmIDo9IChzdHI6IHN0cmluZz89dW5kZWYpOiB2b2lkID0+XCIpLFxuXHR7XG5cdFx0a2luZDogJ2Z1bmN0aW9uJ1xuXHRcdG5hbWU6ICdmJ1xuXHRcdH1cbmVxdWFsIHBhcnNlRXhwb3J0TGluZShcImV4cG9ydCB0eXBlIFRGaWxlT3AgPSB7XCIpLFxuXHR7XG5cdFx0a2luZDogJ3R5cGUnXG5cdFx0bmFtZTogJ1RGaWxlT3AnXG5cdFx0fVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5EQkcgXCJhbGxFeHBvcnRzSW4oKVwiXG5cbmVxdWFsIGF3YWl0IEFycmF5LmZyb21Bc3luYyhhbGxFeHBvcnRzSW4oJ3Rlc3QvYW5hbHl6ZS9leHBvcnRzLmNpdmV0JykpLCBbXG5cdHtraW5kOiAndHlwZScsICAgICBuYW1lOiAnc3ltYm9sRGVzYyd9XG5cdHtraW5kOiAnZnVuY3Rpb24nLCBuYW1lOiAnaXNTeW1ib2xEZXNjJywgZ3VhcmRGb3I6ICdzeW1ib2xEZXNjJ31cblx0e2tpbmQ6ICdmdW5jdGlvbicsIG5hbWU6ICdwYXJzZUV4cG9ydExpbmUnfVxuXHR7a2luZDogJ2Z1bmN0aW9uJywgbmFtZTogJ2dldEV4cG9ydHNJbid9XG5cdHtraW5kOiAnY29uc3QnLCBuYW1lOiAnaEV4dDEnfVxuXHR7a2luZDogJ3ZhcicsIG5hbWU6ICdoRXh0Mid9XG5cdHtraW5kOiAndmFyJywgbmFtZTogJ2hFeHQzJ31cblx0e2tpbmQ6ICdmdW5jdGlvbicsIG5hbWU6ICdpbmRlbnRlZCd9XG5cdHtraW5kOiAnaW50ZXJmYWNlJywgbmFtZTogJ2hhc2hvZjxUPid9XG5cdHtraW5kOiAnZW51bScsIG5hbWU6ICdMb2dDbWQnfVxuXHR7a2luZDogJ2NsYXNzJywgbmFtZTogJ0ZpbGVFdmVudEhhbmRsZXInfVxuXHR7a2luZDogJ2Z1bmN0aW9uJywgbmFtZTogJ2Fzc2VydCd9XG5cdHtraW5kOiAnZnVuY3Rpb24nLCBuYW1lOiAnaXNBcnJheU9mU3RyaW5ncycsIGd1YXJkRm9yOiAnc3RyaW5nW10nfVxuXHR7a2luZDogJ2Z1bmN0aW9uJywgbmFtZTogJ2dldFY4U3RhY2snfVxuXHRdXG5cbkRCRyBcImFsbFVuaXRUZXN0c0luKClcIlxuXG5zdWNjZWVkcyAoKSA9PiBhbGxVbml0VGVzdHNJbigndGVzdC9hbmFseXplL2dvb2QudGVzdC5jaXZldCcpXG5mYWlscyAoKSA9PiBhbGxVbml0VGVzdHNJbigndGVzdC9hbmFseXplL2JhZC50ZXN0LmNpdmV0JylcblxuREJHIFwibWVyZ2VBbmFseXNlcyhsRXhwb3J0cywgbFRlc3RsYWJlbHMpXCJcblxuKCgpID0+XG5cdGxFeHBvcnRzOiBzeW1ib2xEZXNjW10gOj0gW11cblx0bFRlc3RMYWJlbHM6IHRlc3REZXNjW10gOj0gW11cblx0ZXF1YWwgbWVyZ2VBbmFseXNlcyhsRXhwb3J0cywgbFRlc3RMYWJlbHMpLCBbXVxuXHRsaXN0TGlrZSBtZXJnZUFuYWx5c2VzKFxuXHRcdFtcblx0XHRcdHtcblx0XHRcdFx0bmFtZTogJ2Z1bmMnXG5cdFx0XHRcdGtpbmQ6ICdmdW5jdGlvbidcblx0XHRcdFx0fVxuXHRcdFx0e1xuXHRcdFx0XHRuYW1lOiAnZnVuYzInXG5cdFx0XHRcdGtpbmQ6ICdmdW5jdGlvbidcblx0XHRcdFx0fVxuXHRcdFx0XVxuXHRcdFtcblx0XHRcdHtcblx0XHRcdFx0bmFtZTogJ2Z1bmMyJ1xuXHRcdFx0XHRraW5kOiAnZnVuY3Rpb24nXG5cdFx0XHRcdG51bVRlc3RzOiAzXG5cdFx0XHRcdH1cblx0XHRcdF1cblx0XHQpLCBbXG5cdFx0XHR7XG5cdFx0XHRcdG5hbWU6ICdmdW5jJ1xuXHRcdFx0XHRraW5kOiAnZnVuY3Rpb24nXG5cdFx0XHRcdG51bVRlc3RzOiAwXG5cdFx0XHRcdHN0YXR1czogJ21pc3NpbmcnXG5cdFx0XHRcdH1cblx0XHRcdHtcblx0XHRcdFx0bmFtZTogJ2Z1bmMyJ1xuXHRcdFx0XHRraW5kOiAnZnVuY3Rpb24nXG5cdFx0XHRcdG51bVRlc3RzOiAzXG5cdFx0XHRcdHN0YXR1czogJ29rJ1xuXHRcdFx0XHR9XG5cdFx0XVxuXG5cdCkoKVxuXG5EQkcgXCJkdW1wU3ltYm9scygpXCJcblxuZXF1YWwgZHVtcFN5bWJvbHMoJ2xhYmVsJywgW3traW5kOiAndmFyJywgbmFtZTogJ3gnLCBudW1UZXN0czogMH1dKSwgMVxuIl19