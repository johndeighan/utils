"use strict";
// keppel.grammar.civet

import {
	undef, hash, assert,
	} from '../../src/lib/datatypes.lib.ts'
import {
	TRule, TState,
	Ignore, All, Any, Plus, Optional, Node,
	} from '../../src/lib/parser.lib.ts'

// ---------------------------------------------------------------------------

const reIdent: RegExp = /^([a-zA-Z][a-zA-Z0-9_-]*)/

const QString: TRule = Any([
	/^'([^']*)'/,
	/^"([^"]*)"/
	])

const Attr = Node<hash>(
	All('Attr', [
		reIdent,
		'=',
		QString
		]),
	($, $next) => {
		const [name, value] = $next.lMatches
		return {name, value}
	}
	)

const Attributes = Node<hash>(
	All('Attributes', [
		'(',
		Attr,
		Optional(Plus(All('MoreAttr', [',', Attr]))),
		')'
		]),
	($, $next) => {
		return {attributes: $next.lMatches}
	}
	)

const Id = Node<hash>(
	All('Id', [
		'#',
		reIdent
		]),
	($, $next) => {
		return {[0]: $next.lMatches[0]}
	}
	)

const Classes = Node<hash>(
	Plus(All([
		'.',
		reIdent
		])),
	($, $next) => {
		return {classes: $next.lMatches}
	}
	)

const Header = Node<hash>(
	All('Header', [
		reIdent,
		Optional(Attributes),
		Optional(Id),
		Optional(Classes)
		]),
	($, $next) => {
		const [name, ...lOthers] = $next.lMatches
		return Object.assign({tag: name}, ...lOthers)
	}
	)

const ThisGrammar = ($: TState) => Keppel($)

const Body = Node<hash>(
	All('Body', [
		'[',
		ThisGrammar,
		']'
		]),
	($, $next) => {
		return {[0]: $next.lMatches[0]}
	}
	)

const Element: TRule = Node<hash>(
	All('Element', [
		Header,
		Optional(Body)
		]),
	($, $next) => {
		const [header, body] = $next.stack || []
		if (typeof header === 'object') {
			return Object.assign({type: 'element', ...header}, body || {})
		}
		else {
			return undef
		}
	}
	)

const FreeText = Node<hash>(
	QString,
	($, $next) => {
		console.log("Free Text:")
		console.log($next.lMatches)
		console.log("-----")
		return {
			type: 'free text',
			value: $next.lMatches[0]
			}
	}
	);

const Keppel = Node<hash>(
	Plus(Any([Element, FreeText])),
	($, $next) => {
		console.log("STACK:")
		console.log($next.stack)
		console.log('------')
		return $next.stack[0] || {}
	}
	)

// --- Ignore line comments and all whitespace
const reIgnore: RegExp = /^\s+|^\/\/[^\r\n]*\n/

export const KeppelGrammar = Ignore(reIgnore, ThisGrammar)

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC9wYXJzZXIva2VwcGVsLmdyYW1tYXIuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJ0ZXN0L3BhcnNlci9rZXBwZWwuZ3JhbW1hci5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLHVCQUFzQjtBQUN0QixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDO0FBQ3JCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0M7QUFDeEMsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFDZixDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQztBQUN4QyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsNkJBQTZCO0FBQ3JDLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQSxBQUFlLE1BQWYsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUUsQ0FBQywyQkFBMkI7QUFDOUMsQUFBQTtBQUNBLEFBQUEsQUFBYyxNQUFkLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFFLENBQUMsR0FBRyxDQUFBLEFBQUMsQ0FBQztBQUN2QixBQUFBLENBQUMsWUFBWSxDQUFBO0FBQ2IsQUFBQSxDQUFDLFlBQVk7QUFDYixBQUFBLENBQUMsQ0FBQyxDQUFBO0FBQ0YsQUFBQTtBQUNBLEFBQUEsQUFBSSxNQUFKLElBQUksQ0FBQyxDQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ25CLEFBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUNkLEFBQUEsRUFBRSxPQUFPLENBQUM7QUFDVixBQUFBLEVBQUUsR0FBRyxDQUFDO0FBQ04sQUFBQSxFQUFFLE9B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b3J0IHtcblx0dW5kZWYsIGhhc2gsIGFzc2VydCxcblx0fSBmcm9tICcuLi8uLi9zcmMvbGliL2RhdGF0eXBlcy5saWIudHMnXG5pbXBvcnQge1xuXHRUUnVsZSwgVFN0YXRlLFxuXHRJZ25vcmUsIEFsbCwgQW55LCBQbHVzLCBPcHRpb25hbCwgTm9kZSxcblx0fSBmcm9tICcuLi8uLi9zcmMvbGliL3BhcnNlci5saWIudHMnXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbnJlSWRlbnQ6IFJlZ0V4cCA6PSAvXihbYS16QS1aXVthLXpBLVowLTlfLV0qKS9cblxuUVN0cmluZzogVFJ1bGUgOj0gQW55IFtcblx0L14nKFteJ10qKScvXG5cdC9eXCIoW15cIl0qKVwiL1xuXHRdXG5cbkF0dHIgOj0gTm9kZTxoYXNoPihcblx0QWxsKCdBdHRyJywgW1xuXHRcdHJlSWRlbnQsXG5cdFx0Jz0nLFxuXHRcdFFTdHJpbmdcblx0XHRdKSxcblx0KCQsICRuZXh0KSA9PlxuXHRcdFtuYW1lLCB2YWx1ZV0gOj0gJG5leHQubE1hdGNoZXNcblx0XHRyZXR1cm4ge25hbWUsIHZhbHVlfVxuXHQpXG5cbkF0dHJpYnV0ZXMgOj0gTm9kZTxoYXNoPihcblx0QWxsKCdBdHRyaWJ1dGVzJywgW1xuXHRcdCcoJyxcblx0XHRBdHRyLFxuXHRcdE9wdGlvbmFsKFBsdXMoQWxsKCdNb3JlQXR0cicsIFsnLCcsIEF0dHJdKSkpLFxuXHRcdCcpJ1xuXHRcdF0pLFxuXHQoJCwgJG5leHQpID0+XG5cdFx0cmV0dXJuIHthdHRyaWJ1dGVzOiAkbmV4dC5sTWF0Y2hlc31cblx0KVxuXG5JZCA6PSBOb2RlPGhhc2g+KFxuXHRBbGwoJ0lkJywgW1xuXHRcdCcjJyxcblx0XHRyZUlkZW50XG5cdFx0XSksXG5cdCgkLCAkbmV4dCkgPT5cblx0XHRyZXR1cm4geyRuZXh0LmxNYXRjaGVzWzBdfVxuXHQpXG5cbkNsYXNzZXMgOj0gTm9kZTxoYXNoPihcblx0UGx1cyhBbGwoW1xuXHRcdCcuJyxcblx0XHRyZUlkZW50XG5cdFx0XSkpLFxuXHQoJCwgJG5leHQpID0+XG5cdFx0cmV0dXJuIHtjbGFzc2VzOiAkbmV4dC5sTWF0Y2hlc31cblx0KVxuXG5IZWFkZXIgOj0gTm9kZTxoYXNoPihcblx0QWxsKCdIZWFkZXInLCBbXG5cdFx0cmVJZGVudCxcblx0XHRPcHRpb25hbChBdHRyaWJ1dGVzKSxcblx0XHRPcHRpb25hbChJZCksXG5cdFx0T3B0aW9uYWwoQ2xhc3Nlcylcblx0XHRdKSxcblx0KCQsICRuZXh0KSA9PlxuXHRcdFtuYW1lLCAuLi5sT3RoZXJzXSA6PSAkbmV4dC5sTWF0Y2hlc1xuXHRcdHJldHVybiBPYmplY3QuYXNzaWduIHt0YWc6IG5hbWV9LCBsT3RoZXJzLi4uXG5cdClcblxuVGhpc0dyYW1tYXIgOj0gKCQ6IFRTdGF0ZSkgPT4gS2VwcGVsKCQpXG5cbkJvZHkgOj0gTm9kZTxoYXNoPihcblx0QWxsKCdCb2R5JywgW1xuXHRcdCdbJyxcblx0XHRUaGlzR3JhbW1hcixcblx0XHQnXSdcblx0XHRdKSxcblx0KCQsICRuZXh0KSA9PlxuXHRcdHJldHVybiB7JG5leHQubE1hdGNoZXNbMF19XG5cdClcblxuRWxlbWVudDogVFJ1bGUgOj0gTm9kZTxoYXNoPihcblx0QWxsKCdFbGVtZW50JywgW1xuXHRcdEhlYWRlcixcblx0XHRPcHRpb25hbChCb2R5KVxuXHRcdF0pLFxuXHQoJCwgJG5leHQpID0+XG5cdFx0W2hlYWRlciwgYm9keV0gOj0gJG5leHQuc3RhY2sgfHwgW11cblx0XHRpZiAodHlwZW9mIGhlYWRlciA9PSAnb2JqZWN0Jylcblx0XHRcdHJldHVybiBPYmplY3QuYXNzaWduKHt0eXBlOiAnZWxlbWVudCcsIC4uLmhlYWRlcn0sIGJvZHkgfHwge30pXG5cdFx0ZWxzZVxuXHRcdFx0cmV0dXJuIHVuZGVmXG5cdClcblxuRnJlZVRleHQgOj0gTm9kZTxoYXNoPihcblx0UVN0cmluZyxcblx0KCQsICRuZXh0KSA9PlxuXHRcdGNvbnNvbGUubG9nIFwiRnJlZSBUZXh0OlwiXG5cdFx0Y29uc29sZS5sb2cgJG5leHQubE1hdGNoZXNcblx0XHRjb25zb2xlLmxvZyBcIi0tLS0tXCJcblx0XHRyZXR1cm4ge1xuXHRcdFx0dHlwZTogJ2ZyZWUgdGV4dCcsXG5cdFx0XHR2YWx1ZTogJG5leHQubE1hdGNoZXNbMF1cblx0XHRcdH1cblx0KTtcblxuS2VwcGVsIDo9IE5vZGU8aGFzaD4oXG5cdFBsdXMoQW55KFtFbGVtZW50LCBGcmVlVGV4dF0pKSxcblx0KCQsICRuZXh0KSA9PlxuXHRcdGNvbnNvbGUubG9nIFwiU1RBQ0s6XCJcblx0XHRjb25zb2xlLmxvZyAkbmV4dC5zdGFja1xuXHRcdGNvbnNvbGUubG9nICctLS0tLS0nXG5cdFx0cmV0dXJuICRuZXh0LnN0YWNrWzBdIHx8IHt9XG5cdClcblxuIyAtLS0gSWdub3JlIGxpbmUgY29tbWVudHMgYW5kIGFsbCB3aGl0ZXNwYWNlXG5yZUlnbm9yZTogUmVnRXhwIDo9IC9eXFxzK3xeXFwvXFwvW15cXHJcXG5dKlxcbi9cblxuZXhwb3J0IEtlcHBlbEdyYW1tYXIgOj0gSWdub3JlKHJlSWdub3JlLCBUaGlzR3JhbW1hcilcbiJdfQ==