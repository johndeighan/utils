"use strict";
// log-formatter.lib.test.civet

import {LogRecord} from "@std/log/logger"
import {LogLevels} from "@std/log/levels"

import {DBG} from 'logger'
import {getCmdArgs} from 'cmd-args'
import {
	getConsoleLog, clearConsoleLog,
	getFormatter, indentLog, undentLog,
	} from 'log-formatter'
import {
	equal, truthy, falsy, succeeds, fails, matches,
	} from 'unit-test'

getCmdArgs()

// ---------------------------------------------------------------------------
// --- Create 3 log records for use in testing

const rec1 = new LogRecord({
	msg: "Hello",
	args: [],
	level: LogLevels.INFO,
	loggerName: "example",
	})

const rec2 = new LogRecord({
	msg: "something went wrong",
	args: [],
	level: LogLevels.WARN,
	loggerName: "example",
	})

const rec3 = new LogRecord({
	msg: "h not a hash",
	args: [],
	level: LogLevels.ERROR,
	loggerName: "example",
	});

// ---------------------------------------------------------------------------
// --- possible interpolation strings:
//        $ts - milliseconds since process start
//        $tt - milliseconds since last log
//        $ll - log level as a single char
//        $msg - the message

(() => {
	const format = getFormatter('$msg', 'console')
	equal(format(rec1), "Hello")
	equal(format(rec2), "something went wrong")
	equal(format(rec3), "h not a hash")
	equal(getConsoleLog(), `Hello
something went wrong
h not a hash`)
}
	)();

(() => {
	const format = getFormatter('NOTICE: <$msg>', 'console')
	equal(format(rec1), "NOTICE: <Hello>")
	equal(format(rec2), "NOTICE: <something went wrong>")
	equal(format(rec3), "NOTICE: <h not a hash>")
	equal(getConsoleLog(), `Hello
something went wrong
h not a hash
NOTICE: <Hello>
NOTICE: <something went wrong>
NOTICE: <h not a hash>`)
}
	)();

(() => {
	const format = getFormatter('$ll $msg', 'console')
	clearConsoleLog()
	equal(format(rec1), "I Hello")
	equal(format(rec2), "W something went wrong")
	equal(format(rec3), "E h not a hash")
	equal(getConsoleLog(), `I Hello
W something went wrong
E h not a hash`)
}
	)();

(() => {
	const format = getFormatter('[$tt] $ll $msg', 'console')
	matches(format(rec1), /^\[\s*\d+\]\s+I\s+Hello$/)
}
	)()
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxqb2huZFxcdXRpbHNcXHNyY1xcdGVzdFxcbG9nLWZvcm1hdHRlci5saWIudGVzdC5jaXZldC50c3giLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcam9obmRcXHV0aWxzXFxzcmNcXHRlc3RcXGxvZy1mb3JtYXR0ZXIubGliLnRlc3QuY2l2ZXQiXSwibWFwcGluZ3MiOiI7QUFBQSwrQkFBOEI7QUFDOUIsQUFBQTtBQUNBLEFBQUEsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQjtBQUN6QyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQjtBQUN6QyxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRO0FBQzFCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVTtBQUNuQyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLGFBQWEsQ0FBQyxDQUFDLGVBQWUsQ0FBQztBQUNoQyxDQUFDLFlBQVksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUNwQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZTtBQUN2QixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUNoRCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVztBQUNuQixBQUFBO0FBQ0EsQUFBQSxBQUFBLFVBQVUsQ0FBQyxDQUFDO0FBQ1osQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUEsOENBQTZDO0FBQzdDLEFBQUE7QUFDQSxBQUFBLEFBQUksTUFBSixJQUFJLENBQUMs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QSxDQUFBO0FBQ04sQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgbG9nLWZvcm1hdHRlci5saWIudGVzdC5jaXZldFxyXG5cclxuaW1wb3J0IHtMb2dSZWNvcmR9IGZyb20gXCJAc3RkL2xvZy9sb2dnZXJcIlxyXG5pbXBvcnQge0xvZ0xldmVsc30gZnJvbSBcIkBzdGQvbG9nL2xldmVsc1wiXHJcblxyXG5pbXBvcnQge0RCR30gZnJvbSAnbG9nZ2VyJ1xyXG5pbXBvcnQge2dldENtZEFyZ3N9IGZyb20gJ2NtZC1hcmdzJ1xyXG5pbXBvcnQge1xyXG5cdGdldENvbnNvbGVMb2csIGNsZWFyQ29uc29sZUxvZyxcclxuXHRnZXRGb3JtYXR0ZXIsIGluZGVudExvZywgdW5kZW50TG9nLFxyXG5cdH0gZnJvbSAnbG9nLWZvcm1hdHRlcidcclxuaW1wb3J0IHtcclxuXHRlcXVhbCwgdHJ1dGh5LCBmYWxzeSwgc3VjY2VlZHMsIGZhaWxzLCBtYXRjaGVzLFxyXG5cdH0gZnJvbSAndW5pdC10ZXN0J1xyXG5cclxuZ2V0Q21kQXJncygpXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4jIC0tLSBDcmVhdGUgMyBsb2cgcmVjb3JkcyBmb3IgdXNlIGluIHRlc3RpbmdcclxuXHJcbnJlYzEgOj0gbmV3IExvZ1JlY29yZCh7XHJcblx0bXNnOiBcIkhlbGxvXCIsXHJcblx0YXJnczogW10sXHJcblx0bGV2ZWw6IExvZ0xldmVscy5JTkZPLFxyXG5cdGxvZ2dlck5hbWU6IFwiZXhhbXBsZVwiLFxyXG5cdH0pXHJcblxyXG5yZWMyIDo9IG5ldyBMb2dSZWNvcmQoe1xyXG5cdG1zZzogXCJzb21ldGhpbmcgd2VudCB3cm9uZ1wiLFxyXG5cdGFyZ3M6IFtdLFxyXG5cdGxldmVsOiBMb2dMZXZlbHMuV0FSTixcclxuXHRsb2dnZXJOYW1lOiBcImV4YW1wbGVcIixcclxuXHR9KVxyXG5cclxucmVjMyA6PSBuZXcgTG9nUmVjb3JkKHtcclxuXHRtc2c6IFwiaCBub3QgYSBoYXNoXCIsXHJcblx0YXJnczogW10sXHJcblx0bGV2ZWw6IExvZ0xldmVscy5FUlJPUixcclxuXHRsb2dnZXJOYW1lOiBcImV4YW1wbGVcIixcclxuXHR9KVxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuIyAtLS0gcG9zc2libGUgaW50ZXJwb2xhdGlvbiBzdHJpbmdzOlxyXG4jICAgICAgICAkdHMgLSBtaWxsaXNlY29uZHMgc2luY2UgcHJvY2VzcyBzdGFydFxyXG4jICAgICAgICAkdHQgLSBtaWxsaXNlY29uZHMgc2luY2UgbGFzdCBsb2dcclxuIyAgICAgICAgJGxsIC0gbG9nIGxldmVsIGFzIGEgc2luZ2xlIGNoYXJcclxuIyAgICAgICAgJG1zZyAtIHRoZSBtZXNzYWdlXHJcblxyXG4oKCkgPT5cclxuXHRmb3JtYXQgOj0gZ2V0Rm9ybWF0dGVyKCckbXNnJywgJ2NvbnNvbGUnKVxyXG5cdGVxdWFsIGZvcm1hdChyZWMxKSwgXCJIZWxsb1wiXHJcblx0ZXF1YWwgZm9ybWF0KHJlYzIpLCBcInNvbWV0aGluZyB3ZW50IHdyb25nXCJcclxuXHRlcXVhbCBmb3JtYXQocmVjMyksIFwiaCBub3QgYSBoYXNoXCJcclxuXHRlcXVhbCBnZXRDb25zb2xlTG9nKCksIFwiXCJcIlxyXG5cdFx0SGVsbG9cclxuXHRcdHNvbWV0aGluZyB3ZW50IHdyb25nXHJcblx0XHRoIG5vdCBhIGhhc2hcclxuXHRcdFwiXCJcIlxyXG5cdCkoKVxyXG5cclxuKCgpID0+XHJcblx0Zm9ybWF0IDo9IGdldEZvcm1hdHRlcignTk9USUNFOiA8JG1zZz4nLCAnY29uc29sZScpXHJcblx0ZXF1YWwgZm9ybWF0KHJlYzEpLCBcIk5PVElDRTogPEhlbGxvPlwiXHJcblx0ZXF1YWwgZm9ybWF0KHJlYzIpLCBcIk5PVElDRTogPHNvbWV0aGluZyB3ZW50IHdyb25nPlwiXHJcblx0ZXF1YWwgZm9ybWF0KHJlYzMpLCBcIk5PVElDRTogPGggbm90IGEgaGFzaD5cIlxyXG5cdGVxdWFsIGdldENvbnNvbGVMb2coKSwgXCJcIlwiXHJcblx0XHRIZWxsb1xyXG5cdFx0c29tZXRoaW5nIHdlbnQgd3JvbmdcclxuXHRcdGggbm90IGEgaGFzaFxyXG5cdFx0Tk9USUNFOiA8SGVsbG8+XHJcblx0XHROT1RJQ0U6IDxzb21ldGhpbmcgd2VudCB3cm9uZz5cclxuXHRcdE5PVElDRTogPGggbm90IGEgaGFzaD5cclxuXHRcdFwiXCJcIlxyXG5cdCkoKVxyXG5cclxuKCgpID0+XHJcblx0Zm9ybWF0IDo9IGdldEZvcm1hdHRlcignJGxsICRtc2cnLCAnY29uc29sZScpXHJcblx0Y2xlYXJDb25zb2xlTG9nKClcclxuXHRlcXVhbCBmb3JtYXQocmVjMSksIFwiSSBIZWxsb1wiXHJcblx0ZXF1YWwgZm9ybWF0KHJlYzIpLCBcIlcgc29tZXRoaW5nIHdlbnQgd3JvbmdcIlxyXG5cdGVxdWFsIGZvcm1hdChyZWMzKSwgXCJFIGggbm90IGEgaGFzaFwiXHJcblx0ZXF1YWwgZ2V0Q29uc29sZUxvZygpLCBcIlwiXCJcclxuXHRcdEkgSGVsbG9cclxuXHRcdFcgc29tZXRoaW5nIHdlbnQgd3JvbmdcclxuXHRcdEUgaCBub3QgYSBoYXNoXHJcblx0XHRcIlwiXCJcclxuXHQpKClcclxuXHJcbigoKSA9PlxyXG5cdGZvcm1hdCA6PSBnZXRGb3JtYXR0ZXIoJ1skdHRdICRsbCAkbXNnJywgJ2NvbnNvbGUnKVxyXG5cdG1hdGNoZXMgZm9ybWF0KHJlYzEpLCAvLy9eXHJcblx0XHRcXFtcclxuXHRcdFxccypcclxuXHRcdFxcZCtcclxuXHRcdFxcXVxyXG5cdFx0XFxzK1xyXG5cdFx0SVxyXG5cdFx0XFxzK1xyXG5cdFx0SGVsbG9cclxuXHRcdCQvLy9cclxuXHQpKCkiXX0=