"use strict";
// parser.lib.civet

import {sprintf} from "@std/fmt/printf"
import {
	undef, defined, notdefined, hash,
	} from './datatypes.lib.ts'
import {
	getOptions, escapeStr, spaces,
	} from './llutils.lib.ts'
import {logIndent} from './log-formatter.lib.ts'
import {
	getLogLevel, setLogLevel,
	pushLogLevel, popLogLevel, DBG, INDENT, UNDENT,
	} from './logger.lib.ts'

// ---------------------------------------------------------------------------

export type TState = {
	text: string
	ignore: any[]
	lMatches?: string[]
	stack: any[]
	sp: number
	lastPos: number
	pos: number
	}

export type TRule = ($: TState) => TState

// --- Anything that can be converted to a TRule
type TLaxRule = (string | RegExp | TRule | TLaxRule[])

type TReducer<T> = (lMatches: T[], $: TState, $next: TState) => (T | undefined)
type TCallback = ($: TState, $next: TState) => void

// ---------------------------------------------------------------------------

export function getNewState(
		text: string,
		pos: number = 0
		): TState {

	return {
		text,
		ignore: [],
		stack: [],
		sp: 0,
		lastPos: 0,
		pos
		}
}

// ---------------------------------------------------------------------------

const nbuf = 24

const DBGMATCH = (
		desc: string,    // Describe what we're trying to match
		$: TState,
		$next: TState
		): void => {

	const str = escapeStr($.text.substring($.pos, $next.pos))
	const buf = spaces(nbuf - str.length - 1 - 3*logIndent)
	DBG(`[+${sprintf('%3d', $.pos)}] ${str}${buf}${desc}`)
	return
}

// ---------------------------------------------------------------------------

const DBGNOMATCH = (
		desc: string,    // Describe what we're trying to match
		$: TState
		): void => {

	const buf = spaces(nbuf - 3*logIndent)
	DBG(`[-${sprintf('%3d', $.pos)}]${buf}${desc}`)
	return
}

// ---------------------------------------------------------------------------

export const RegexMatcher = (re: RegExp): TRule => {

	return ($: TState): TState => {

		$.lastPos = $.pos

		const lMatches = re.exec($.text.substring($.pos))
		if (!lMatches) {
			DBGNOMATCH(re.toString(), $)
			return $
		}

		// --- Token is matched, add matches to state,
		//     return the next state
		const numChars = lMatches[0].length
		const $next = {
			...$,
			pos: $.pos + numChars,
			}
		$.lMatches = lMatches
		DBGMATCH(re.toString(), $, $next)
		return $next
	}
}

// ---------------------------------------------------------------------------

export const StringMatcher = (str: string): TRule => {

	return ($: TState): TState => {

		$.lastPos = $.pos
		if ($.text.startsWith(str, $.pos)) {
			const $next = {
				...$,
				pos: $.pos + str.length
				}
			DBGMATCH(`'${escapeStr(str)}'`, $, $next)
			return $next
		}
		else {
			DBGNOMATCH(`'${escapeStr(str)}'`, $)
			return $
		}
	}
}

// ---------------------------------------------------------------------------

export function getRule(rule: TLaxRule): TRule {

	if (Array.isArray(rule)) {
		const lRules = rule.map(getRule)
		return StrictAll(lRules)
	}
	if (typeof (rule) === 'function') {
		return rule
	}
	if (rule instanceof RegExp) {
		return RegexMatcher(rule)
	}
	if (typeof (rule) === 'string') {
		return StringMatcher(rule)
	}
	throw new Error('Invalid rule')
}

// ---------------------------------------------------------------------------

const skipIgnored = ($: TState): TState => {

	return ($.ignore.length === 0) ? $ : $.ignore.at(-1)($)
}
//	if ($.ignore.length == 0)
//		return $
//	return $.ignore.at(-1)($)

// ---------------------------------------------------------------------------
// --- Match a sequence of rules left to right

export function All(
		lLaxRules: TLaxRule[],
		hOptions: hash = {}
		): TRule {

	const lRules = lLaxRules.map(getRule)
	return StrictAll(lRules, hOptions)
}

// ---------------------------------------------------------------------------

export function StrictAll(
		lRules: TRule[],
		hOptions: hash = {}
		): TRule {

	const {name} = getOptions(hOptions, {
		name: undef
		})
	return ($) => {
		DBG(`Try: ${(name || 'All')}`, INDENT)
		let $cur = $
		let i1 = 0;for (const rule of lRules) {const i = i1++;
			const $before = (i > 0) ? skipIgnored($cur) : $cur
			const $after = rule($before)
			if ($after === $before) {
				// --- if one rule fails: fail all
				DBG('FAIL', UNDENT)
				return $
			}

//			if ($after.pos > $before.pos)
//				# --- All() should fail if all rules match,
//				#     but no progress is made
			$cur = $after
			DBG(`.....${i}`)
		}
		DBG(UNDENT)
		return $cur
	}
}

// ---------------------------------------------------------------------------
// --- Match any of the rules
//     with left-to-right preference

export function Any(
		lLaxRules: TLaxRule[],
		hOptions: hash = {}
		): TRule {

	const lRules = lLaxRules.map(getRule)
	const {name} = getOptions(hOptions, {
		name: undef
		})
	return ($) => {
		DBG(`Try: ${(name || 'Any')}`, INDENT)
		let i2 = 0;for (const rule of lRules) {const i = i2++;
			const $next = rule($)
			if ($next !== $) {
				DBG(UNDENT)
				return $next
			}
			DBG(`.....${i}`)
		}
		DBG(UNDENT)
		return $
	}
}

// ---------------------------------------------------------------------------
// --- Match a rule 1 or more times

export function Plus(laxRule: TLaxRule): TRule {

	const rule = getRule(laxRule)
	return ($) => {
		while (true) {
			const $cur = skipIgnored($)
			const $next = rule($cur)
			if ($next === $cur) {
				return $
			}
			$ = $next
		}
	}
}

// ---------------------------------------------------------------------------
// --- Match a rule optionally

export function Optional(laxRule: TLaxRule): TRule {

	const rule = getRule(laxRule)
	return ($) => {
		const $next = rule($)
		if ($next !== $) {
			return $next
		}

		// --- Otherwise return a shallow copy
		//     of the state to still indicate a match
		return {...$}
	}
}

// ---------------------------------------------------------------------------

export function Star(laxRule: TLaxRule): TRule {

	return Optional(Plus(laxRule))
}

// ---------------------------------------------------------------------------

export function Node<T>(
		laxRule: TLaxRule,
		reducer: TReducer<T>
		): TRule {

	const rule = getRule(laxRule)
	return ($) => {
		const $next = rule($)
		if ($next === $) {
			return $
		}

		// --- We have a match
		const node = reducer($.stack.slice($.sp, $next.sp), $, $next)
		$next.sp = $.sp
		if (node !== null) {
			$.stack[$next.sp++] = node
		}
		return $next
	}
}

// ---------------------------------------------------------------------------

export const getLineAndColumn = (text: string, pos: number) => {

	const countChars = (str: string, ch: string): number => {
		let count = 0
		let pos = -1
		while ((pos = str.indexOf(ch, pos+1)) !== -1) {
			count += 1
		}
		return count
	}


	// --- Get line number by counting number of \n chars
	//        before the current position
	//     Get column number by finding closest previous position
	//        of a \n and computing the difference

	const shortStr = text.substring(0, pos)
	return [
		countChars(shortStr, "\n") + 1,
		pos - shortStr.lastIndexOf('\n')
		]
}

// ---------------------------------------------------------------------------

type TStringMapper<T> = (str: string) => T

// ---------------------------------------------------------------------------

export function Ignore(
		laxToIgnore: TLaxRule,
		laxRule: TLaxRule
		): TRule {

	const rule = getRule(laxRule)
	const toIgnore = getRule(laxToIgnore)
	return ($: TState) => {
		const $cur = toIgnore($)
		$.ignore.push(toIgnore)
		const $next = rule($cur)
		$.ignore.pop()
		return ($next === $cur) ? $ : toIgnore($next)
	}
}

// ---------------------------------------------------------------------------
// --- Returns a function that:
//        1. accepts a string
//        2. returns a T

export function getParser<T>(
		laxRule: TLaxRule,
		hOptions: hash = {}
		): TStringMapper<T> {

	const {pos, partial, reSkip} = getOptions(hOptions, {
		pos: 0,
		partial: false,
		reSkip: /^\s+/
		})
	const rule = defined(reSkip) ? Ignore(reSkip, laxRule) : getRule(laxRule)

	return (text: string): T => {
		const $ = getNewState(text, pos)
		const $next = rule($)

		if ($ === $next) {
			const [line, column] = getLineAndColumn(text, $.pos)
			throw new SyntaxError(`No match at pos ${$.lastPos}
Remainder: ${escapeStr(text.slice($.pos))}`)
		}
		if (!partial && ($next.pos < text.length)) {
			// --- Not all input consumed
			const [line, column] = getLineAndColumn(text, $.pos)
			throw new SyntaxError(`Stopped at pos ${$.lastPos}
Remainder: ${escapeStr(text.slice($.pos))}`)
		}
		return $.stack[0]
	}
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9wYXJzZXIubGliLmNpdmV0LnRzeCIsInNvdXJjZXMiOlsic3JjL2xpYi9wYXJzZXIubGliLmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEsbUJBQWtCO0FBQ2xCLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUI7QUFDdkMsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDbEMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQjtBQUM1QixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUMvQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCO0FBQzFCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsd0JBQXdCO0FBQ2hELEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsV0FBVyxDQUFDLENBQUMsV0FBVyxDQUFDO0FBQzFCLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDO0FBQ2hELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUI7QUFDekIsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdEIsQUFBQSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU07QUFDYixBQUFBLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDZCxBQUFBLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxN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QUFFLE1BQU0sQ0FBQyxLO0NBQUssQztBQUFBLENBQUE7QUFDZCxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQWMsTUFBYixhQUFhLENBQUMsQ0FBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDL0MsQUFBQTtBQUNBLEFBQUEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUM5QixBQUFBO0FBQ0EsQUFBQSxFQUFFLENBQUMsQ0FBQyxPQUFPLEMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxHQUFHO0FBQ25CLEFBQUEsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUEsQ0FBQTtBQUNwQyxBQUFBLEdBQVEsTUFBTCxLQUFLLENBQUMsQ0FBRSxDQUFDLENBQUM7QUFDYixBQUFBLElBQUksR0FBRyxDQUFDLENBQUM7QUFDVCxBQUFBLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU07QUFDM0IsSUFBSSxDQUFDO0FBQ0wsQUFBQSxHQUFHLFFBQVEsQ0FBQSxBQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQTtBQUMzQyxBQUFBLEdBQUcsTUFBTSxDQUFDLEs7RUFBSyxDQUFBO0FBQ2YsQUFBQSxFQUFFLElBQUksQ0FBQSxDQUFBO0FBQ04sQUFBQSxHQUFHLFVBQVUsQ0FBQSxBQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFD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QUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUM3QyxBQUFBLEdBQUcsNkJBQTRCO0FBQy9CLEFBQUEsR0FBaUIsTUFBZCxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO0FBQ2xELEFBQUEsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFHLGVBQ1QsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQy9CLFdBQWUsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxBQUMxQyxDQUFHLEM7RUFBQyxDQUFBO0FBQ1IsQUFBQSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQztDQUFDLEM7QUFBQSxDQUFBO0FBQ25CIiwibmFtZXMiOltdLCJzb3VyY2VzQ29udGVudCI6WyIjIHBhcnNlci5saWIuY2l2ZXRcblxuaW1wb3J0IHtzcHJpbnRmfSBmcm9tIFwiQHN0ZC9mbXQvcHJpbnRmXCJcbmltcG9ydCB7XG5cdHVuZGVmLCBkZWZpbmVkLCBub3RkZWZpbmVkLCBoYXNoLFxuXHR9IGZyb20gJy4vZGF0YXR5cGVzLmxpYi50cydcbmltcG9ydCB7XG5cdGdldE9wdGlvbnMsIGVzY2FwZVN0ciwgc3BhY2VzLFxuXHR9IGZyb20gJy4vbGx1dGlscy5saWIudHMnXG5pbXBvcnQge2xvZ0luZGVudH0gZnJvbSAnLi9sb2ctZm9ybWF0dGVyLmxpYi50cydcbmltcG9ydCB7XG5cdGdldExvZ0xldmVsLCBzZXRMb2dMZXZlbCxcblx0cHVzaExvZ0xldmVsLCBwb3BMb2dMZXZlbCwgREJHLCBJTkRFTlQsIFVOREVOVCxcblx0fSBmcm9tICcuL2xvZ2dlci5saWIudHMnXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCB0eXBlIFRTdGF0ZSA9IHtcblx0dGV4dDogc3RyaW5nXG5cdGlnbm9yZTogYW55W11cblx0bE1hdGNoZXM/OiBzdHJpbmdbXVxuXHRzdGFjazogYW55W11cblx0c3A6IG51bWJlclxuXHRsYXN0UG9zOiBudW1iZXJcblx0cG9zOiBudW1iZXJcblx0fVxuXG5leHBvcnQgdHlwZSBUUnVsZSA9ICgkOiBUU3RhdGUpID0+IFRTdGF0ZVxuXG4jIC0tLSBBbnl0aGluZyB0aGF0IGNhbiBiZSBjb252ZXJ0ZWQgdG8gYSBUUnVsZVxudHlwZSBUTGF4UnVsZSA9IChzdHJpbmcgfCBSZWdFeHAgfCBUUnVsZSB8IFRMYXhSdWxlW10pXG5cbnR5cGUgVFJlZHVjZXI8VD4gPSAobE1hdGNoZXM6IFRbXSwgJDogVFN0YXRlLCAkbmV4dDogVFN0YXRlKSA9PiBUP1xudHlwZSBUQ2FsbGJhY2sgPSAoJDogVFN0YXRlLCAkbmV4dDogVFN0YXRlKSA9PiB2b2lkXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXROZXdTdGF0ZShcblx0XHR0ZXh0OiBzdHJpbmdcblx0XHRwb3M6IG51bWJlciA9IDBcblx0XHQpOiBUU3RhdGVcblxuXHRyZXR1cm4ge1xuXHRcdHRleHRcblx0XHRpZ25vcmU6IFtdXG5cdFx0c3RhY2s6IFtdXG5cdFx0c3A6IDBcblx0XHRsYXN0UG9zOiAwXG5cdFx0cG9zXG5cdFx0fVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5uYnVmIDo9IDI0XG5cbkRCR01BVENIIDo9IChcblx0XHRkZXNjOiBzdHJpbmcgICAgIyBEZXNjcmliZSB3aGF0IHdlJ3JlIHRyeWluZyB0byBtYXRjaFxuXHRcdCQ6IFRTdGF0ZVxuXHRcdCRuZXh0OiBUU3RhdGVcblx0XHQpOiB2b2lkID0+XG5cblx0c3RyIDo9IGVzY2FwZVN0cigkLnRleHQuc3Vic3RyaW5nKCQucG9zLCAkbmV4dC5wb3MpKVxuXHRidWYgOj0gc3BhY2VzKG5idWYgLSBzdHIubGVuZ3RoIC0gMSAtIDMqbG9nSW5kZW50KVxuXHREQkcgXCJbKyN7c3ByaW50ZignJTNkJywgJC5wb3MpfV0gI3tzdHJ9I3tidWZ9I3tkZXNjfVwiXG5cdHJldHVyblxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5EQkdOT01BVENIIDo9IChcblx0XHRkZXNjOiBzdHJpbmcgICAgIyBEZXNjcmliZSB3aGF0IHdlJ3JlIHRyeWluZyB0byBtYXRjaFxuXHRcdCQ6IFRTdGF0ZVxuXHRcdCk6IHZvaWQgPT5cblxuXHRidWYgOj0gc3BhY2VzKG5idWYgLSAzKmxvZ0luZGVudClcblx0REJHIFwiWy0je3NwcmludGYoJyUzZCcsICQucG9zKX1dI3tidWZ9I3tkZXNjfVwiXG5cdHJldHVyblxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgUmVnZXhNYXRjaGVyIDo9IChyZTogUmVnRXhwKTogVFJ1bGUgPT5cblxuXHRyZXR1cm4gKCQ6IFRTdGF0ZSk6IFRTdGF0ZSA9PlxuXG5cdFx0JC5sYXN0UG9zID0gJC5wb3NcblxuXHRcdGxNYXRjaGVzIDo9IHJlLmV4ZWMoJC50ZXh0LnN1YnN0cmluZygkLnBvcykpXG5cdFx0aWYgKG5vdCBsTWF0Y2hlcylcblx0XHRcdERCR05PTUFUQ0ggcmUudG9TdHJpbmcoKSwgJFxuXHRcdFx0cmV0dXJuICRcblxuXHRcdCMgLS0tIFRva2VuIGlzIG1hdGNoZWQsIGFkZCBtYXRjaGVzIHRvIHN0YXRlLFxuXHRcdCMgICAgIHJldHVybiB0aGUgbmV4dCBzdGF0ZVxuXHRcdG51bUNoYXJzIDo9IGxNYXRjaGVzWzBdLmxlbmd0aFxuXHRcdCRuZXh0IDo9IHtcblx0XHRcdC4uLiQsXG5cdFx0XHRwb3M6ICQucG9zICsgbnVtQ2hhcnMsXG5cdFx0XHR9XG5cdFx0JC5sTWF0Y2hlcyA9IGxNYXRjaGVzXG5cdFx0REJHTUFUQ0ggcmUudG9TdHJpbmcoKSwgJCwgJG5leHRcblx0XHRyZXR1cm4gJG5leHRcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IFN0cmluZ01hdGNoZXIgOj0gKHN0cjogc3RyaW5nKTogVFJ1bGUgPT5cblxuXHRyZXR1cm4gKCQ6IFRTdGF0ZSk6IFRTdGF0ZSA9PlxuXG5cdFx0JC5sYXN0UG9zID0gJC5wb3Ncblx0XHRpZiAoJC50ZXh0LnN0YXJ0c1dpdGgoc3RyLCAkLnBvcykpXG5cdFx0XHQkbmV4dCA6PSB7XG5cdFx0XHRcdC4uLiQsXG5cdFx0XHRcdHBvczogJC5wb3MgKyBzdHIubGVuZ3RoXG5cdFx0XHRcdH1cblx0XHRcdERCR01BVENIIFwiJyN7ZXNjYXBlU3RyKHN0cil9J1wiLCAkLCAkbmV4dFxuXHRcdFx0cmV0dXJuICRuZXh0XG5cdFx0ZWxzZVxuXHRcdFx0REJHTk9NQVRDSCBcIicje2VzY2FwZVN0cihzdHIpfSdcIiwgJFxuXHRcdFx0cmV0dXJuICRcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFJ1bGUocnVsZTogVExheFJ1bGUpOiBUUnVsZVxuXG5cdGlmIEFycmF5LmlzQXJyYXkocnVsZSlcblx0XHRsUnVsZXMgOj0gcnVsZS5tYXAoZ2V0UnVsZSlcblx0XHRyZXR1cm4gU3RyaWN0QWxsKGxSdWxlcylcblx0aWYgKHR5cGVvZihydWxlKSA9PSAnZnVuY3Rpb24nKVxuXHRcdHJldHVybiBydWxlXG5cdGlmIChydWxlIGluc3RhbmNlb2YgUmVnRXhwKVxuXHRcdHJldHVybiBSZWdleE1hdGNoZXIocnVsZSlcblx0aWYgKHR5cGVvZihydWxlKSA9PSAnc3RyaW5nJylcblx0XHRyZXR1cm4gU3RyaW5nTWF0Y2hlcihydWxlKVxuXHR0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcnVsZScpXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbnNraXBJZ25vcmVkIDo9ICgkOiBUU3RhdGUpOiBUU3RhdGUgPT5cblxuXHRyZXR1cm4gKCQuaWdub3JlLmxlbmd0aCA9PSAwKSA/ICQgOiAkLmlnbm9yZS5hdCgtMSkoJClcbiNcdGlmICgkLmlnbm9yZS5sZW5ndGggPT0gMClcbiNcdFx0cmV0dXJuICRcbiNcdHJldHVybiAkLmlnbm9yZS5hdCgtMSkoJClcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgLS0tIE1hdGNoIGEgc2VxdWVuY2Ugb2YgcnVsZXMgbGVmdCB0byByaWdodFxuXG5leHBvcnQgZnVuY3Rpb24gQWxsKFxuXHRcdGxMYXhSdWxlczogVExheFJ1bGVbXVxuXHRcdGhPcHRpb25zOiBoYXNoID0ge31cblx0XHQpOiBUUnVsZVxuXG5cdGxSdWxlcyA6PSBsTGF4UnVsZXMubWFwIGdldFJ1bGVcblx0cmV0dXJuIFN0cmljdEFsbChsUnVsZXMsIGhPcHRpb25zKVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgZnVuY3Rpb24gU3RyaWN0QWxsKFxuXHRcdGxSdWxlczogVFJ1bGVbXVxuXHRcdGhPcHRpb25zOiBoYXNoID0ge31cblx0XHQpOiBUUnVsZVxuXG5cdHtuYW1lfSA6PSBnZXRPcHRpb25zIGhPcHRpb25zLCB7XG5cdFx0bmFtZTogdW5kZWZcblx0XHR9XG5cdHJldHVybiAoJCkgPT5cblx0XHREQkcgXCJUcnk6ICN7KG5hbWUgfHwgJ0FsbCcpfVwiLCBJTkRFTlRcblx0XHRsZXQgJGN1ciA9ICRcblx0XHRmb3IgcnVsZSxpIG9mIGxSdWxlc1xuXHRcdFx0JGJlZm9yZSA6PSAoaSA+IDApID8gc2tpcElnbm9yZWQoJGN1cikgOiAkY3VyXG5cdFx0XHQkYWZ0ZXIgOj0gcnVsZSgkYmVmb3JlKVxuXHRcdFx0aWYgKCRhZnRlciA9PSAkYmVmb3JlKVxuXHRcdFx0XHQjIC0tLSBpZiBvbmUgcnVsZSBmYWlsczogZmFpbCBhbGxcblx0XHRcdFx0REJHICdGQUlMJywgVU5ERU5UXG5cdFx0XHRcdHJldHVybiAkXG5cbiNcdFx0XHRpZiAoJGFmdGVyLnBvcyA+ICRiZWZvcmUucG9zKVxuI1x0XHRcdFx0IyAtLS0gQWxsKCkgc2hvdWxkIGZhaWwgaWYgYWxsIHJ1bGVzIG1hdGNoLFxuI1x0XHRcdFx0IyAgICAgYnV0IG5vIHByb2dyZXNzIGlzIG1hZGVcblx0XHRcdCRjdXIgPSAkYWZ0ZXJcblx0XHRcdERCRyBcIi4uLi4uI3tpfVwiXG5cdFx0REJHIFVOREVOVFxuXHRcdHJldHVybiAkY3VyXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIC0tLSBNYXRjaCBhbnkgb2YgdGhlIHJ1bGVzXG4jICAgICB3aXRoIGxlZnQtdG8tcmlnaHQgcHJlZmVyZW5jZVxuXG5leHBvcnQgZnVuY3Rpb24gQW55KFxuXHRcdGxMYXhSdWxlczogVExheFJ1bGVbXVxuXHRcdGhPcHRpb25zOiBoYXNoID0ge31cblx0XHQpOiBUUnVsZVxuXG5cdGxSdWxlcyA6PSBsTGF4UnVsZXMubWFwIGdldFJ1bGVcblx0e25hbWV9IDo9IGdldE9wdGlvbnMgaE9wdGlvbnMsIHtcblx0XHRuYW1lOiB1bmRlZlxuXHRcdH1cblx0cmV0dXJuICgkKSA9PlxuXHRcdERCRyBcIlRyeTogI3sobmFtZSB8fCAnQW55Jyl9XCIsIElOREVOVFxuXHRcdGZvciBydWxlLGkgb2YgbFJ1bGVzXG5cdFx0XHQkbmV4dCA6PSBydWxlKCQpXG5cdFx0XHRpZiAoJG5leHQgIT0gJClcblx0XHRcdFx0REJHIFVOREVOVFxuXHRcdFx0XHRyZXR1cm4gJG5leHRcblx0XHRcdERCRyBcIi4uLi4uI3tpfVwiXG5cdFx0REJHIFVOREVOVFxuXHRcdHJldHVybiAkXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIC0tLSBNYXRjaCBhIHJ1bGUgMSBvciBtb3JlIHRpbWVzXG5cbmV4cG9ydCBmdW5jdGlvbiBQbHVzKGxheFJ1bGU6IFRMYXhSdWxlKTogVFJ1bGVcblxuXHRydWxlIDo9IGdldFJ1bGUgbGF4UnVsZVxuXHRyZXR1cm4gKCQpID0+XG5cdFx0d2hpbGUgKHRydWUpXG5cdFx0XHQkY3VyIDo9IHNraXBJZ25vcmVkKCQpXG5cdFx0XHQkbmV4dCA6PSBydWxlKCRjdXIpXG5cdFx0XHRpZiAoJG5leHQgPT0gJGN1cilcblx0XHRcdFx0cmV0dXJuICRcblx0XHRcdCQgPSAkbmV4dFxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyAtLS0gTWF0Y2ggYSBydWxlIG9wdGlvbmFsbHlcblxuZXhwb3J0IGZ1bmN0aW9uIE9wdGlvbmFsKGxheFJ1bGU6IFRMYXhSdWxlKTogVFJ1bGVcblxuXHRydWxlIDo9IGdldFJ1bGUgbGF4UnVsZVxuXHRyZXR1cm4gKCQpID0+XG5cdFx0JG5leHQgOj0gcnVsZSgkKVxuXHRcdGlmICgkbmV4dCAhPSAkKVxuXHRcdFx0cmV0dXJuICRuZXh0XG5cblx0XHQjIC0tLSBPdGhlcndpc2UgcmV0dXJuIGEgc2hhbGxvdyBjb3B5XG5cdFx0IyAgICAgb2YgdGhlIHN0YXRlIHRvIHN0aWxsIGluZGljYXRlIGEgbWF0Y2hcblx0XHRyZXR1cm4gey4uLiR9XG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBmdW5jdGlvbiBTdGFyKGxheFJ1bGU6IFRMYXhSdWxlKTogVFJ1bGVcblxuXHRyZXR1cm4gT3B0aW9uYWwoUGx1cyhsYXhSdWxlKSlcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGZ1bmN0aW9uIE5vZGU8VD4oXG5cdFx0bGF4UnVsZTogVExheFJ1bGUsXG5cdFx0cmVkdWNlcjogVFJlZHVjZXI8VD5cblx0XHQpOiBUUnVsZVxuXG5cdHJ1bGUgOj0gZ2V0UnVsZSBsYXhSdWxlXG5cdHJldHVybiAoJCkgPT5cblx0XHQkbmV4dCA6PSBydWxlKCQpXG5cdFx0aWYgKCRuZXh0ID09ICQpXG5cdFx0XHRyZXR1cm4gJFxuXG5cdFx0IyAtLS0gV2UgaGF2ZSBhIG1hdGNoXG5cdFx0bm9kZSA6PSByZWR1Y2VyKCQuc3RhY2suc2xpY2UoJC5zcCwgJG5leHQuc3ApLCAkLCAkbmV4dClcblx0XHQkbmV4dC5zcCA9ICQuc3Bcblx0XHRpZiAobm9kZSAhPSBudWxsKVxuXHRcdFx0JC5zdGFja1skbmV4dC5zcCsrXSA9IG5vZGVcblx0XHRyZXR1cm4gJG5leHRcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGdldExpbmVBbmRDb2x1bW4gOj0gKHRleHQ6IHN0cmluZywgcG9zOiBudW1iZXIpID0+XG5cblx0Y291bnRDaGFycyA6PSAoc3RyOiBzdHJpbmcsIGNoOiBzdHJpbmcpOiBudW1iZXIgPT5cblx0XHRsZXQgY291bnQgPSAwXG5cdFx0bGV0IHBvcyA9IC0xXG5cdFx0d2hpbGUgKHBvcyA9IHN0ci5pbmRleE9mKGNoLCBwb3MrMSkpICE9IC0xXG5cdFx0XHRjb3VudCArPSAxXG5cdFx0cmV0dXJuIGNvdW50XG5cblxuXHQjIC0tLSBHZXQgbGluZSBudW1iZXIgYnkgY291bnRpbmcgbnVtYmVyIG9mIFxcbiBjaGFyc1xuXHQjICAgICAgICBiZWZvcmUgdGhlIGN1cnJlbnQgcG9zaXRpb25cblx0IyAgICAgR2V0IGNvbHVtbiBudW1iZXIgYnkgZmluZGluZyBjbG9zZXN0IHByZXZpb3VzIHBvc2l0aW9uXG5cdCMgICAgICAgIG9mIGEgXFxuIGFuZCBjb21wdXRpbmcgdGhlIGRpZmZlcmVuY2VcblxuXHRzaG9ydFN0ciA6PSB0ZXh0LnN1YnN0cmluZygwLCBwb3MpXG5cdHJldHVybiBbXG5cdFx0Y291bnRDaGFycyhzaG9ydFN0ciwgXCJcXG5cIikgKyAxLFxuXHRcdHBvcyAtIHNob3J0U3RyLmxhc3RJbmRleE9mKCdcXG4nKVxuXHRcdF1cblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxudHlwZSBUU3RyaW5nTWFwcGVyPFQ+ID0gKHN0cjogc3RyaW5nKSA9PiBUXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBmdW5jdGlvbiBJZ25vcmUoXG5cdFx0bGF4VG9JZ25vcmU6IFRMYXhSdWxlLFxuXHRcdGxheFJ1bGU6IFRMYXhSdWxlXG5cdFx0KTogVFJ1bGVcblxuXHRydWxlIDo9IGdldFJ1bGUgbGF4UnVsZVxuXHR0b0lnbm9yZSA6PSBnZXRSdWxlIGxheFRvSWdub3JlXG5cdHJldHVybiAoJDogVFN0YXRlKSA9PlxuXHRcdCRjdXIgOj0gdG9JZ25vcmUoJClcblx0XHQkLmlnbm9yZS5wdXNoKHRvSWdub3JlKVxuXHRcdCRuZXh0IDo9IHJ1bGUoJGN1cilcblx0XHQkLmlnbm9yZS5wb3AoKVxuXHRcdHJldHVybiAoJG5leHQgPT0gJGN1cikgPyAkIDogdG9JZ25vcmUoJG5leHQpXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIC0tLSBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdDpcbiMgICAgICAgIDEuIGFjY2VwdHMgYSBzdHJpbmdcbiMgICAgICAgIDIuIHJldHVybnMgYSBUXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQYXJzZXI8VD4oXG5cdFx0bGF4UnVsZTogVExheFJ1bGVcblx0XHRoT3B0aW9uczogaGFzaCA9IHt9XG5cdFx0KTogVFN0cmluZ01hcHBlcjxUPlxuXG5cdHtwb3MsIHBhcnRpYWwsIHJlU2tpcH0gOj0gZ2V0T3B0aW9ucyBoT3B0aW9ucywge1xuXHRcdHBvczogMFxuXHRcdHBhcnRpYWw6IGZhbHNlXG5cdFx0cmVTa2lwOiAvXlxccysvXG5cdFx0fVxuXHRydWxlIDo9IGRlZmluZWQocmVTa2lwKSA/IElnbm9yZShyZVNraXAsIGxheFJ1bGUpIDogZ2V0UnVsZSBsYXhSdWxlXG5cblx0cmV0dXJuICh0ZXh0OiBzdHJpbmcpOiBUID0+XG5cdFx0JCA6PSBnZXROZXdTdGF0ZSh0ZXh0LCBwb3MpXG5cdFx0JG5leHQgOj0gcnVsZSgkKVxuXG5cdFx0aWYgKCQgPT0gJG5leHQpXG5cdFx0XHRbbGluZSwgY29sdW1uXSA6PSBnZXRMaW5lQW5kQ29sdW1uKHRleHQsICQucG9zKVxuXHRcdFx0dGhyb3cgbmV3IFN5bnRheEVycm9yKFwiXCJcIlxuXHRcdFx0XHRObyBtYXRjaCBhdCBwb3MgI3skLmxhc3RQb3N9XG5cdFx0XHRcdFJlbWFpbmRlcjogI3tlc2NhcGVTdHIodGV4dC5zbGljZSgkLnBvcykpfVxuXHRcdFx0XHRcIlwiXCIpXG5cdFx0aWYgbm90IHBhcnRpYWwgJiYgKCRuZXh0LnBvcyA8IHRleHQubGVuZ3RoKVxuXHRcdFx0IyAtLS0gTm90IGFsbCBpbnB1dCBjb25zdW1lZFxuXHRcdFx0W2xpbmUsIGNvbHVtbl0gOj0gZ2V0TGluZUFuZENvbHVtbih0ZXh0LCAkLnBvcylcblx0XHRcdHRocm93IG5ldyBTeW50YXhFcnJvcihcIlwiXCJcblx0XHRcdFx0U3RvcHBlZCBhdCBwb3MgI3skLmxhc3RQb3N9XG5cdFx0XHRcdFJlbWFpbmRlcjogI3tlc2NhcGVTdHIodGV4dC5zbGljZSgkLnBvcykpfVxuXHRcdFx0XHRcIlwiXCIpXG5cdFx0cmV0dXJuICQuc3RhY2tbMF1cbiJdfQ==