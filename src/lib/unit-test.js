// unit-test.civet

import {
	assert, assertEquals, assertNotEquals, assertObjectMatch,
	assertStringIncludes, assertMatch, assertArrayIncludes,
	} from '@std/assert'
import {
	OL, isArray, isHash, range, pushLogLevel, popLogLevel,
	} from '@jdeighan/utils/llutils.js'
import {getMyOutsideCaller} from '@jdeighan/utils/v8-stack.js'

/**
 * unit-test - provides functions for use in unit tests
 *
 * @module
 */

// ---------------------------------------------------------------------------
// typeof x may return
//    'number'
//    'string'
//    'boolean'
//    'undefined'
//    'bigint'
//    'symbol'
//    'object'
//    'function'
// ---------------------------------------------------------------------------
// available tests
//    equal
//    truthy
//    falsy
//    fails
//    succeeds
//    matches
//    like
//    includes
//    includesAll
// ---------------------------------------------------------------------------

const isString = (x) => {

	return (typeof x === 'string') || (x instanceof String)
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, checks if  value is deeply equal to
 * the expected value. Reports line number of the test.
 *
 * @param value {any} - any JavaScript value
 * @param expected {any} - any JavaScript value
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * equal 2+2, 4
 * ```
 * This test will pass.
 */

export const equal = (value, expected) => {

	const label = getTestName()
	Deno.test(label, () => assertEquals(value, expected))
	return
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, tests if value is truthy
 * Reports line number of the test.

 * @param value {any} - any JavaScript value
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * truthy isString('abc')
 * ```
 * This test will pass.
 */

export const truthy = (value) => {

	const label = getTestName()
	Deno.test(label, () => assert(value))
	return
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, tests if value is falsy
 * Reports line number of the test.
 *
 * @param value {any} - any JavaScript value
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * falsy isString(42)
 * ```
 * This test will pass.
 */

export const falsy = (value) => {

	const label = getTestName()
	Deno.test(label, () => assert((!value)))
	return
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, tests if calling the provided function
 * throws an exception. Reports line number of the test.
 *
 * @param func {any => any} - any JavaScript function
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * fails () => throw new Error('bad')
 * ```
 * This test will pass.
 */

export const fails = (func) => {

	assert((typeof func === 'function'), "test fails() passed non-function")
	const label = getTestName()
	pushLogLevel('silent')
	Deno.test(label, () => assert(llthrows(func)))
	popLogLevel()
	return
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, tests if calling the provided function
 * runs without throwing an exception.
 * Reports line number of the test.
 *
 * @param func {any => any} - any JavaScript function
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * succeeds () => return 42
 * ```
 * This test will pass.
 */

export const succeeds = (func) => {

	assert((typeof func === 'function'), "test succeeds() passed non-function")
	const label = getTestName()
	Deno.test(label, () => assert(!llthrows(func)))
	return
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, tests a value, which must be a string,
 * matches either a substring or a regular expression.
 * Reports line number of the test.
 *
 * @param value {any} - any JavaScript value
 * @param expected {any} - any JavaScript value
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * matches 'abcde', 'bce'
 * ```
 * This test will pass.
 *
 * @example
 * ```js
 * matches 'aabbcc', /a+b+c+/
 * ```
 * This test will pass.
 */

export const matches = (value, expected) => {

	const label = getTestName()
	assert(isString(value), `Not a string: ${value}`)
	if (isString(expected)) {
		Deno.test(label, () => assertStringIncludes(value, expected))
	}
	else if (expected instanceof RegExp) {
		Deno.test(label, () => assertMatch(value, expected))
	}
	else {
		Deno.test(label, () => assert(false))
	}
	return
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, tests a value, which must be an array or object,
 * matches another array or object. For objects, the value must
 * have all the properties in the expected value, but extra
 * properties are allowed. For arrays, the value must have
 * at least the length of the expected array, and each item in
 * the value array must be an object that has at least all of the
 * properties that the object in the expected array at the
 * same position has.
 * Reports line number of the test.
 *
 * @param value {array | object} - any JavaScript value
 * @param expected {array | object} - any JavaScript value
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * like {a:1, b:2, c:3}, {a:1, c:3}
 * ```
 * This test will pass.
 *
 * @example
 * ```js
 * like [{a:1, b:2, c:3}, {a:3, b:5, c:23}], [{a:1, b:2}]
 * ```
 * This test will pass.
 */

export const like = (value, expected) => {

	const label = getTestName()
	if (isHash(value) && isHash(expected)) {
		Deno.test(label, () => assertObjectMatch(value, expected))
	}
	else if (isArray(value) && isArray(expected)) {
		const valLen = value.length
		const expLen = expected.length
		const max = (valLen >= expLen) ? valLen : expLen
		for (const i of range(max)) {
			const actObj = value[i] || {}
			const expObj = expected[i] || {bad: 'bad'}
			Deno.test(label, () => assertObjectMatch(actObj, expObj))
		}
	}
	return
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, tests a value, which must be an array,
 * includes the expected value.
 * Reports line number of the test
 *
 * @param value {array} - an array
 * @param expected {any} - any JavaScript value
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * includes ['a', 'b', 'c'], 'b'
 * ```
 * This test will pass.
 */

export const includes = (value, expected) => {

	const label = getTestName()
	assert(Array.isArray(value), `not an array: ${value}`)
	Deno.test(label, () => assertArrayIncludes(value, [expected]))
	return
}

// ---------------------------------------------------------------------------

/**
 * In a unit test, tests a value, which must be an array,
 * includes all of the items in the expected array.
 * Reports line number of the test
 *
 * @param value {array} - an array
 * @param expected {array} - an array
 * @returns {void} - nothing
 *
 * @example
 * ```js
 * includesAll ['a', 'b', 'c'], ['b', 'c']
 * ```
 * This test will pass.
 */

export const includesAll = (value, expected) => {

	const label = getTestName()
	assert(Array.isArray(value), `not an array: ${value}`)
	assert(Array.isArray(expected), `not an array: ${expected}`)
	Deno.test(label, () => assertArrayIncludes(value, expected))
	return
}

// ---------------------------------------------------------------------------
// ---------------------------------------------------------------------------

export const getTestName = () => {

	pushLogLevel('silent')
	const frame = getMyOutsideCaller()
	popLogLevel()
	return `line ${frame.line}`
}

// ---------------------------------------------------------------------------

export const llthrows = (func) => {

	try {
		func()
		return false
	}
	catch (err) {
		return true
	}
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi91bml0LXRlc3QuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJzcmMvbGliL3VuaXQtdGVzdC5jaXZldCJdLCJtYXBwaW5ncyI6IkFBQUEsa0JBQWlCO0FBQ2pCLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQztBQUMxRCxDQUFDLG9CQUFvQixDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsbUJBQW1CLENBQUM7QUFDeEQsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWE7QUFDckIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLENBQUM7QUFDdkQsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLDRCQUE0QjtBQUNwQyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxJQUFJLENBQUMsNkJBQTZCO0FBQzlELEFBQUE7QUFDQSxBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBLHNCQUFxQjtBQUNyQixBQUFBLGNBQWE7QUFDYixBQUFBLGNBQWE7QUFDYixBQUFBLGVBQWM7QUFDZCxBQUFBLGlCQUFnQjtBQUNoQixBQUFBLGNBQWE7QUFDYixBQUFBLGNBQWE7QUFDYixBQUFBLGNBQWE7QUFDYixBQUFBLGdCQUFlO0FBQ2YsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQSxrQkFBaUI7QUFDakIsQUFBQSxXQUFVO0FBQ1YsQUFBQSxZQUFXO0FBQ1gsQUFBQSxXQUFVO0FBQ1YsQUFBQSxXQUFVO0FBQ1YsQUFBQSxjQUFhO0FBQ2IsQUFBQSxhQUFZO0FBQ1osQUFBQSxVQUFTO0FBQ1QsQUFBQSxjQUFhO0FBQ2IsQUFBQSxpQkFBZ0I7QUFDaEIsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUEsQUFBUSxNQUFSLFFBQVEsQ0FBQyxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUNsQixBQUFBO0FBQ0EsQUFBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDO0FBQUMsQ0FBQTtBQUN2RCxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQU0sTUFBTCxLQUFLLENBQUMsQ0FBRSxDQUFDLENBQUMsS0FBVSxDQUFDLENBQUMsUUFBYSxDQUFRLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDckQsQUFBQTtBQUNBLEFBQUEsQ0FBTSxNQUFMLEtBQUssQ0FBQyxDQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDdkIsQUFBQSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUEsQUFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQ3JELEFBQUEsQ0FBQyxNO0FBQU0sQ0FBQTtBQUNQLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQU8sTUFBTixNQUFNLENBQUMsQ0FBRSxDQUFDLENBQUMsS0FBVSxDQUFDLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDaEMsQUFBQTtBQUNBLEFBQUEsQ0FBTSxNQUFMLEtBQUssQ0FBQyxDQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDdkIsQUFBQSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUEsQUFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFBLEFBQUMsS0FBSyxDQUFBLENBQUE7QUFDcEMsQUFBQSxDQUFDLE07QUFBTSxDQUFBO0FBQ1AsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBTSxNQUFMLEtBQUssQ0FBQyxDQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUMxQixBQUFBO0FBQ0EsQUFBQSxDQUFNLE1BQUwsS0FBSyxDQUFDLENBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN2QixBQUFBLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQSxBQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUEsQUFBQyxDQUFDLENBQUksS0FBSyxDQUFDLENBQUEsQ0FBQTtBQUMxQyxBQUFBLENBQUMsTTtBQUFNLENBQUE7QUFDUCxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFNLE1BQUwsS0FBSyxDQUFDLENBQUUsQ0FBQyxDQUFDLElBQUksQ0FBTyxDQUFDLEVBQUUsQ0FBQSxDQUFBO0FBQy9CLEFBQUE7QUFDQSxBQUFBLENBQUMsTUFBTSxDQUFBLEFBQUMs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QzNCLEFBQUEsRUFBSyxNQUFILEdBQUcsQ0FBQyxDQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU07QUFDN0MsQUFBQSxFQUFFLEdBQUcsQ0FBQyxDQUFBLE1BQUEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ3JCLEFBQUEsR0FBUyxNQUFOLE1BQU0sQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDM0IsQUFBQSxHQUFTLE1BQU4sTUFBTSxDQUFDLENBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQ3hDLEFBQUEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFBLEFBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFBLEFBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFBLEM7RUFBQSxDO0NBQUEsQ0FBQTtBQUMxRCxBQUFBLENBQUMsTTtBQUFNLENBQUE7QUFDUCxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBUyxNQUFSLFFBQVEsQ0FBQyxDQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUN2QyxBQUFBO0FBQ0EsQUFBQSxDQUFNLE1BQUwsS0FBSyxDQUFDLENBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN2QixBQUFBLENBQUMsTUFBTSxDQUFBLEFBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUE7QUFDdEQsQUFBQSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUEsQUFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBO0FBQzlELEFBQUEsQ0FBQyxNO0FBQU0sQ0FBQTtBQUNQLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFZLE1BQVgsV0FBVyxDQUFDLENBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQSxDQUFBO0FBQzFDLEFBQUE7QUFDQSxBQUFBLENBQU0sTUFBTCxLQUFLLENBQUMsQ0FBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3ZCLEFBQUEsQ0FBQyxNQUFNLENBQUEsQUFBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQTtBQUN0RCxBQUFBLENBQUMsTUFBTSxDQUFBLEFBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUE7QUFDNUQsQUFBQSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUEsQUFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUE7QUFDNUQsQUFBQSxDQUFDLE07QUFBTSxDQUFBO0FBQ1AsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFZLE1BQVgsV0FBVyxDQUFDLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUMzQixBQUFBO0FBQ0EsQUFBQSxDQUFDLFlBQVksQ0FBQSxBQUFDLFFBQVEsQ0FBQTtBQUN0QixBQUFBLENBQU0sTUFBTCxLQUFLLENBQUMsQ0FBRSxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFDOUIsQUFBQSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ2QsQUFBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLEM7QUFBQyxDQUFBO0FBQzVCLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBUyxNQUFSLFFBQVEsQ0FBQyxDQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUM1QixBQUFBO0FBQ0EsQUFBQSxDQUFDLEdBQUcsQ0FBQSxDQUFBO0FBQ0osQUFBQSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ1IsQUFBQSxFQUFFLE1BQU0sQ0FBQyxLO0NBQUssQ0FBQTtBQUNkLEFBQUEsQ0FBQyxLQUFLLENBQUMsQ0FBQSxHQUFHLENBQUEsQ0FBQSxDQUFBO0FBQ1YsQUFBQSxFQUFFLE1BQU0sQ0FBQyxJO0NBQUksQztBQUFBLENBQUE7QUFDYiIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyB1bml0LXRlc3QuY2l2ZXRcclxuXHJcbmltcG9ydCB7XHJcblx0YXNzZXJ0LCBhc3NlcnRFcXVhbHMsIGFzc2VydE5vdEVxdWFscywgYXNzZXJ0T2JqZWN0TWF0Y2gsXHJcblx0YXNzZXJ0U3RyaW5nSW5jbHVkZXMsIGFzc2VydE1hdGNoLCBhc3NlcnRBcnJheUluY2x1ZGVzLFxyXG5cdH0gZnJvbSAnQHN0ZC9hc3NlcnQnXHJcbmltcG9ydCB7XHJcblx0T0wsIGlzQXJyYXksIGlzSGFzaCwgcmFuZ2UsIHB1c2hMb2dMZXZlbCwgcG9wTG9nTGV2ZWwsXHJcblx0fSBmcm9tICdAamRlaWdoYW4vdXRpbHMvbGx1dGlscy5qcydcclxuaW1wb3J0IHtnZXRNeU91dHNpZGVDYWxsZXJ9IGZyb20gJ0BqZGVpZ2hhbi91dGlscy92OC1zdGFjay5qcydcclxuXHJcbi8qKlxyXG4gKiB1bml0LXRlc3QgLSBwcm92aWRlcyBmdW5jdGlvbnMgZm9yIHVzZSBpbiB1bml0IHRlc3RzXHJcbiAqXHJcbiAqIEBtb2R1bGVcclxuICovXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4jIHR5cGVvZiB4IG1heSByZXR1cm5cclxuIyAgICAnbnVtYmVyJ1xyXG4jICAgICdzdHJpbmcnXHJcbiMgICAgJ2Jvb2xlYW4nXHJcbiMgICAgJ3VuZGVmaW5lZCdcclxuIyAgICAnYmlnaW50J1xyXG4jICAgICdzeW1ib2wnXHJcbiMgICAgJ29iamVjdCdcclxuIyAgICAnZnVuY3Rpb24nXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiMgYXZhaWxhYmxlIHRlc3RzXHJcbiMgICAgZXF1YWxcclxuIyAgICB0cnV0aHlcclxuIyAgICBmYWxzeVxyXG4jICAgIGZhaWxzXHJcbiMgICAgc3VjY2VlZHNcclxuIyAgICBtYXRjaGVzXHJcbiMgICAgbGlrZVxyXG4jICAgIGluY2x1ZGVzXHJcbiMgICAgaW5jbHVkZXNBbGxcclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmlzU3RyaW5nIDo9ICh4KSA9PlxyXG5cclxuXHRyZXR1cm4gKHR5cGVvZiB4ID09ICdzdHJpbmcnKSB8fCAoeCBpbnN0YW5jZW9mIFN0cmluZylcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vKipcclxuICogSW4gYSB1bml0IHRlc3QsIGNoZWNrcyBpZiAgdmFsdWUgaXMgZGVlcGx5IGVxdWFsIHRvXHJcbiAqIHRoZSBleHBlY3RlZCB2YWx1ZS4gUmVwb3J0cyBsaW5lIG51bWJlciBvZiB0aGUgdGVzdC5cclxuICpcclxuICogQHBhcmFtIHZhbHVlIHthbnl9IC0gYW55IEphdmFTY3JpcHQgdmFsdWVcclxuICogQHBhcmFtIGV4cGVjdGVkIHthbnl9IC0gYW55IEphdmFTY3JpcHQgdmFsdWVcclxuICogQHJldHVybnMge3ZvaWR9IC0gbm90aGluZ1xyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqc1xyXG4gKiBlcXVhbCAyKzIsIDRcclxuICogYGBgXHJcbiAqIFRoaXMgdGVzdCB3aWxsIHBhc3MuXHJcbiAqL1xyXG5cclxuZXhwb3J0IGVxdWFsIDo9ICh2YWx1ZTogYW55LCBleHBlY3RlZDogYW55KSA6IHZvaWQgPT5cclxuXHJcblx0bGFiZWwgOj0gZ2V0VGVzdE5hbWUoKVxyXG5cdERlbm8udGVzdCBsYWJlbCwgKCkgPT4gYXNzZXJ0RXF1YWxzKHZhbHVlLCBleHBlY3RlZClcclxuXHRyZXR1cm5cclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vKipcclxuICogSW4gYSB1bml0IHRlc3QsIHRlc3RzIGlmIHZhbHVlIGlzIHRydXRoeVxyXG4gKiBSZXBvcnRzIGxpbmUgbnVtYmVyIG9mIHRoZSB0ZXN0LlxyXG5cclxuICogQHBhcmFtIHZhbHVlIHthbnl9IC0gYW55IEphdmFTY3JpcHQgdmFsdWVcclxuICogQHJldHVybnMge3ZvaWR9IC0gbm90aGluZ1xyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqc1xyXG4gKiB0cnV0aHkgaXNTdHJpbmcoJ2FiYycpXHJcbiAqIGBgYFxyXG4gKiBUaGlzIHRlc3Qgd2lsbCBwYXNzLlxyXG4gKi9cclxuXHJcbmV4cG9ydCB0cnV0aHkgOj0gKHZhbHVlOiBhbnkpID0+XHJcblxyXG5cdGxhYmVsIDo9IGdldFRlc3ROYW1lKClcclxuXHREZW5vLnRlc3QgbGFiZWwsICgpID0+IGFzc2VydCB2YWx1ZVxyXG5cdHJldHVyblxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbi8qKlxyXG4gKiBJbiBhIHVuaXQgdGVzdCwgdGVzdHMgaWYgdmFsdWUgaXMgZmFsc3lcclxuICogUmVwb3J0cyBsaW5lIG51bWJlciBvZiB0aGUgdGVzdC5cclxuICpcclxuICogQHBhcmFtIHZhbHVlIHthbnl9IC0gYW55IEphdmFTY3JpcHQgdmFsdWVcclxuICogQHJldHVybnMge3ZvaWR9IC0gbm90aGluZ1xyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqc1xyXG4gKiBmYWxzeSBpc1N0cmluZyg0MilcclxuICogYGBgXHJcbiAqIFRoaXMgdGVzdCB3aWxsIHBhc3MuXHJcbiAqL1xyXG5cclxuZXhwb3J0IGZhbHN5IDo9ICh2YWx1ZSkgPT5cclxuXHJcblx0bGFiZWwgOj0gZ2V0VGVzdE5hbWUoKVxyXG5cdERlbm8udGVzdCBsYWJlbCwgKCkgPT4gYXNzZXJ0IChub3QgdmFsdWUpXHJcblx0cmV0dXJuXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuLyoqXHJcbiAqIEluIGEgdW5pdCB0ZXN0LCB0ZXN0cyBpZiBjYWxsaW5nIHRoZSBwcm92aWRlZCBmdW5jdGlvblxyXG4gKiB0aHJvd3MgYW4gZXhjZXB0aW9uLiBSZXBvcnRzIGxpbmUgbnVtYmVyIG9mIHRoZSB0ZXN0LlxyXG4gKlxyXG4gKiBAcGFyYW0gZnVuYyB7YW55ID0+IGFueX0gLSBhbnkgSmF2YVNjcmlwdCBmdW5jdGlvblxyXG4gKiBAcmV0dXJucyB7dm9pZH0gLSBub3RoaW5nXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGpzXHJcbiAqIGZhaWxzICgpID0+IHRocm93IG5ldyBFcnJvcignYmFkJylcclxuICogYGBgXHJcbiAqIFRoaXMgdGVzdCB3aWxsIHBhc3MuXHJcbiAqL1xyXG5cclxuZXhwb3J0IGZhaWxzIDo9IChmdW5jKTogdm9pZCA9PlxyXG5cclxuXHRhc3NlcnQgKHR5cGVvZiBmdW5jID09ICdmdW5jdGlvbicpLCBcInRlc3QgZmFpbHMoKSBwYXNzZWQgbm9uLWZ1bmN0aW9uXCJcclxuXHRsYWJlbCA6PSBnZXRUZXN0TmFtZSgpXHJcblx0cHVzaExvZ0xldmVsICdzaWxlbnQnXHJcblx0RGVuby50ZXN0IGxhYmVsLCAoKSA9PiBhc3NlcnQgbGx0aHJvd3MoZnVuYylcclxuXHRwb3BMb2dMZXZlbCgpXHJcblx0cmV0dXJuXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuLyoqXHJcbiAqIEluIGEgdW5pdCB0ZXN0LCB0ZXN0cyBpZiBjYWxsaW5nIHRoZSBwcm92aWRlZCBmdW5jdGlvblxyXG4gKiBydW5zIHdpdGhvdXQgdGhyb3dpbmcgYW4gZXhjZXB0aW9uLlxyXG4gKiBSZXBvcnRzIGxpbmUgbnVtYmVyIG9mIHRoZSB0ZXN0LlxyXG4gKlxyXG4gKiBAcGFyYW0gZnVuYyB7YW55ID0+IGFueX0gLSBhbnkgSmF2YVNjcmlwdCBmdW5jdGlvblxyXG4gKiBAcmV0dXJucyB7dm9pZH0gLSBub3RoaW5nXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGpzXHJcbiAqIHN1Y2NlZWRzICgpID0+IHJldHVybiA0MlxyXG4gKiBgYGBcclxuICogVGhpcyB0ZXN0IHdpbGwgcGFzcy5cclxuICovXHJcblxyXG5leHBvcnQgc3VjY2VlZHMgOj0gKGZ1bmMpOiB2b2lkID0+XHJcblxyXG5cdGFzc2VydCAodHlwZW9mIGZ1bmMgPT0gJ2Z1bmN0aW9uJyksIFwidGVzdCBzdWNjZWVkcygpIHBhc3NlZCBub24tZnVuY3Rpb25cIlxyXG5cdGxhYmVsIDo9IGdldFRlc3ROYW1lKClcclxuXHREZW5vLnRlc3QgbGFiZWwsICgpID0+IGFzc2VydCBub3QgbGx0aHJvd3MoZnVuYylcclxuXHRyZXR1cm5cclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vKipcclxuICogSW4gYSB1bml0IHRlc3QsIHRlc3RzIGEgdmFsdWUsIHdoaWNoIG11c3QgYmUgYSBzdHJpbmcsXHJcbiAqIG1hdGNoZXMgZWl0aGVyIGEgc3Vic3RyaW5nIG9yIGEgcmVndWxhciBleHByZXNzaW9uLlxyXG4gKiBSZXBvcnRzIGxpbmUgbnVtYmVyIG9mIHRoZSB0ZXN0LlxyXG4gKlxyXG4gKiBAcGFyYW0gdmFsdWUge2FueX0gLSBhbnkgSmF2YVNjcmlwdCB2YWx1ZVxyXG4gKiBAcGFyYW0gZXhwZWN0ZWQge2FueX0gLSBhbnkgSmF2YVNjcmlwdCB2YWx1ZVxyXG4gKiBAcmV0dXJucyB7dm9pZH0gLSBub3RoaW5nXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGpzXHJcbiAqIG1hdGNoZXMgJ2FiY2RlJywgJ2JjZSdcclxuICogYGBgXHJcbiAqIFRoaXMgdGVzdCB3aWxsIHBhc3MuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGpzXHJcbiAqIG1hdGNoZXMgJ2FhYmJjYycsIC9hK2IrYysvXHJcbiAqIGBgYFxyXG4gKiBUaGlzIHRlc3Qgd2lsbCBwYXNzLlxyXG4gKi9cclxuXHJcbmV4cG9ydCBtYXRjaGVzIDo9ICh2YWx1ZSwgZXhwZWN0ZWQpID0+XHJcblxyXG5cdGxhYmVsIDo9IGdldFRlc3ROYW1lKClcclxuXHRhc3NlcnQgaXNTdHJpbmcodmFsdWUpLCBcIk5vdCBhIHN0cmluZzogI3t2YWx1ZX1cIlxyXG5cdGlmIGlzU3RyaW5nKGV4cGVjdGVkKVxyXG5cdFx0RGVuby50ZXN0IGxhYmVsLCAoKSA9PiBhc3NlcnRTdHJpbmdJbmNsdWRlcyB2YWx1ZSwgZXhwZWN0ZWRcclxuXHRlbHNlIGlmIChleHBlY3RlZCBpbnN0YW5jZW9mIFJlZ0V4cClcclxuXHRcdERlbm8udGVzdCBsYWJlbCwgKCkgPT4gYXNzZXJ0TWF0Y2ggdmFsdWUsIGV4cGVjdGVkXHJcblx0ZWxzZVxyXG5cdFx0RGVuby50ZXN0IGxhYmVsLCAoKSA9PiBhc3NlcnQgZmFsc2VcclxuXHRyZXR1cm5cclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vKipcclxuICogSW4gYSB1bml0IHRlc3QsIHRlc3RzIGEgdmFsdWUsIHdoaWNoIG11c3QgYmUgYW4gYXJyYXkgb3Igb2JqZWN0LFxyXG4gKiBtYXRjaGVzIGFub3RoZXIgYXJyYXkgb3Igb2JqZWN0LiBGb3Igb2JqZWN0cywgdGhlIHZhbHVlIG11c3RcclxuICogaGF2ZSBhbGwgdGhlIHByb3BlcnRpZXMgaW4gdGhlIGV4cGVjdGVkIHZhbHVlLCBidXQgZXh0cmFcclxuICogcHJvcGVydGllcyBhcmUgYWxsb3dlZC4gRm9yIGFycmF5cywgdGhlIHZhbHVlIG11c3QgaGF2ZVxyXG4gKiBhdCBsZWFzdCB0aGUgbGVuZ3RoIG9mIHRoZSBleHBlY3RlZCBhcnJheSwgYW5kIGVhY2ggaXRlbSBpblxyXG4gKiB0aGUgdmFsdWUgYXJyYXkgbXVzdCBiZSBhbiBvYmplY3QgdGhhdCBoYXMgYXQgbGVhc3QgYWxsIG9mIHRoZVxyXG4gKiBwcm9wZXJ0aWVzIHRoYXQgdGhlIG9iamVjdCBpbiB0aGUgZXhwZWN0ZWQgYXJyYXkgYXQgdGhlXHJcbiAqIHNhbWUgcG9zaXRpb24gaGFzLlxyXG4gKiBSZXBvcnRzIGxpbmUgbnVtYmVyIG9mIHRoZSB0ZXN0LlxyXG4gKlxyXG4gKiBAcGFyYW0gdmFsdWUge2FycmF5IHwgb2JqZWN0fSAtIGFueSBKYXZhU2NyaXB0IHZhbHVlXHJcbiAqIEBwYXJhbSBleHBlY3RlZCB7YXJyYXkgfCBvYmplY3R9IC0gYW55IEphdmFTY3JpcHQgdmFsdWVcclxuICogQHJldHVybnMge3ZvaWR9IC0gbm90aGluZ1xyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqc1xyXG4gKiBsaWtlIHthOjEsIGI6MiwgYzozfSwge2E6MSwgYzozfVxyXG4gKiBgYGBcclxuICogVGhpcyB0ZXN0IHdpbGwgcGFzcy5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBganNcclxuICogbGlrZSBbe2E6MSwgYjoyLCBjOjN9LCB7YTozLCBiOjUsIGM6MjN9XSwgW3thOjEsIGI6Mn1dXHJcbiAqIGBgYFxyXG4gKiBUaGlzIHRlc3Qgd2lsbCBwYXNzLlxyXG4gKi9cclxuXHJcbmV4cG9ydCBsaWtlIDo9ICh2YWx1ZSwgZXhwZWN0ZWQpID0+XHJcblxyXG5cdGxhYmVsIDo9IGdldFRlc3ROYW1lKClcclxuXHRpZiBpc0hhc2godmFsdWUpICYmIGlzSGFzaChleHBlY3RlZClcclxuXHRcdERlbm8udGVzdCBsYWJlbCwgKCkgPT4gYXNzZXJ0T2JqZWN0TWF0Y2ggdmFsdWUsIGV4cGVjdGVkXHJcblx0ZWxzZSBpZiBpc0FycmF5KHZhbHVlKSAmJiBpc0FycmF5KGV4cGVjdGVkKVxyXG5cdFx0dmFsTGVuIDo9IHZhbHVlLmxlbmd0aFxyXG5cdFx0ZXhwTGVuIDo9IGV4cGVjdGVkLmxlbmd0aFxyXG5cdFx0bWF4IDo9ICh2YWxMZW4gPj0gZXhwTGVuKSA/IHZhbExlbiA6IGV4cExlblxyXG5cdFx0Zm9yIGkgb2YgcmFuZ2UobWF4KVxyXG5cdFx0XHRhY3RPYmogOj0gdmFsdWVbaV0gfHwge31cclxuXHRcdFx0ZXhwT2JqIDo9IGV4cGVjdGVkW2ldIHx8IHtiYWQ6ICdiYWQnfVxyXG5cdFx0XHREZW5vLnRlc3QgbGFiZWwsICgpID0+IGFzc2VydE9iamVjdE1hdGNoIGFjdE9iaiwgZXhwT2JqXHJcblx0cmV0dXJuXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuLyoqXHJcbiAqIEluIGEgdW5pdCB0ZXN0LCB0ZXN0cyBhIHZhbHVlLCB3aGljaCBtdXN0IGJlIGFuIGFycmF5LFxyXG4gKiBpbmNsdWRlcyB0aGUgZXhwZWN0ZWQgdmFsdWUuXHJcbiAqIFJlcG9ydHMgbGluZSBudW1iZXIgb2YgdGhlIHRlc3RcclxuICpcclxuICogQHBhcmFtIHZhbHVlIHthcnJheX0gLSBhbiBhcnJheVxyXG4gKiBAcGFyYW0gZXhwZWN0ZWQge2FueX0gLSBhbnkgSmF2YVNjcmlwdCB2YWx1ZVxyXG4gKiBAcmV0dXJucyB7dm9pZH0gLSBub3RoaW5nXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGpzXHJcbiAqIGluY2x1ZGVzIFsnYScsICdiJywgJ2MnXSwgJ2InXHJcbiAqIGBgYFxyXG4gKiBUaGlzIHRlc3Qgd2lsbCBwYXNzLlxyXG4gKi9cclxuXHJcbmV4cG9ydCBpbmNsdWRlcyA6PSAodmFsdWUsIGV4cGVjdGVkKSA9PlxyXG5cclxuXHRsYWJlbCA6PSBnZXRUZXN0TmFtZSgpXHJcblx0YXNzZXJ0IEFycmF5LmlzQXJyYXkodmFsdWUpLCBcIm5vdCBhbiBhcnJheTogI3t2YWx1ZX1cIlxyXG5cdERlbm8udGVzdCBsYWJlbCwgKCkgPT4gYXNzZXJ0QXJyYXlJbmNsdWRlcyh2YWx1ZSwgW2V4cGVjdGVkXSlcclxuXHRyZXR1cm5cclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vKipcclxuICogSW4gYSB1bml0IHRlc3QsIHRlc3RzIGEgdmFsdWUsIHdoaWNoIG11c3QgYmUgYW4gYXJyYXksXHJcbiAqIGluY2x1ZGVzIGFsbCBvZiB0aGUgaXRlbXMgaW4gdGhlIGV4cGVjdGVkIGFycmF5LlxyXG4gKiBSZXBvcnRzIGxpbmUgbnVtYmVyIG9mIHRoZSB0ZXN0XHJcbiAqXHJcbiAqIEBwYXJhbSB2YWx1ZSB7YXJyYXl9IC0gYW4gYXJyYXlcclxuICogQHBhcmFtIGV4cGVjdGVkIHthcnJheX0gLSBhbiBhcnJheVxyXG4gKiBAcmV0dXJucyB7dm9pZH0gLSBub3RoaW5nXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGpzXHJcbiAqIGluY2x1ZGVzQWxsIFsnYScsICdiJywgJ2MnXSwgWydiJywgJ2MnXVxyXG4gKiBgYGBcclxuICogVGhpcyB0ZXN0IHdpbGwgcGFzcy5cclxuICovXHJcblxyXG5leHBvcnQgaW5jbHVkZXNBbGwgOj0gKHZhbHVlLCBleHBlY3RlZCkgPT5cclxuXHJcblx0bGFiZWwgOj0gZ2V0VGVzdE5hbWUoKVxyXG5cdGFzc2VydCBBcnJheS5pc0FycmF5KHZhbHVlKSwgXCJub3QgYW4gYXJyYXk6ICN7dmFsdWV9XCJcclxuXHRhc3NlcnQgQXJyYXkuaXNBcnJheShleHBlY3RlZCksIFwibm90IGFuIGFycmF5OiAje2V4cGVjdGVkfVwiXHJcblx0RGVuby50ZXN0IGxhYmVsLCAoKSA9PiBhc3NlcnRBcnJheUluY2x1ZGVzKHZhbHVlLCBleHBlY3RlZClcclxuXHRyZXR1cm5cclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgZ2V0VGVzdE5hbWUgOj0gKCkgPT5cclxuXHJcblx0cHVzaExvZ0xldmVsICdzaWxlbnQnXHJcblx0ZnJhbWUgOj0gZ2V0TXlPdXRzaWRlQ2FsbGVyKClcclxuXHRwb3BMb2dMZXZlbCgpXHJcblx0cmV0dXJuIFwibGluZSAje2ZyYW1lLmxpbmV9XCJcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgbGx0aHJvd3MgOj0gKGZ1bmMpID0+XHJcblxyXG5cdHRyeVxyXG5cdFx0ZnVuYygpXHJcblx0XHRyZXR1cm4gZmFsc2VcclxuXHRjYXRjaCBlcnJcclxuXHRcdHJldHVybiB0cnVlXHJcbiJdfQ==