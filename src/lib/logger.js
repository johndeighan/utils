// logger.civet

import {assert} from '@std/assert'
import pathLib from 'path'
import {sprintf} from '@std/fmt/printf'
import {
	ConsoleHandler, FileHandler, setup, getLogger,
	} from "@std/log"

const defined = (x) => (x !== undefined) && (x !== null)

// ---------------------------------------------------------------------------

export const logFileName = "./logs/logs.txt"

export const sepdash = '-'.repeat(32)
export const sepeq   = '='.repeat(32)
const isSep = (str) => (str === sepdash) || (str === sepeq)

let indent = 0
const prefix = () => '   '.repeat(indent)

// --- Used when current logger is 'profile'
let prevMS = 0
let prevFileMS = 0
let headerOutput = false
let fileHeaderOutput = false

const hFileLabel = {
	DEBUG: 'D ',
	INFO:  'I ',
	WARN:  'W ',
	ERROR: 'ERROR: '
	}

const hConsoleLabel = {
	DEBUG: '',
	INFO:  '',
	WARN:  '',
	ERROR: ''
	}

// ---------------------------------------------------------------------------

export const hLoggerConfig = {
	handlers: {

		profile: new ConsoleHandler('DEBUG', {
			formatter: ((rec) => {
				const {datetime, msg, levelName} = rec
				const msStr = sprintf("%5d", datetime - prevMS)
				prevMS = datetime
				const label = hConsoleLabel[levelName]
				if (!headerOutput) {
					headerOutput = true
					return `ms\n-----\n${msStr} ${label}${prefix()}${msg}`
				}
				else {
					return `${msStr} ${label}${prefix()}${msg}`
				}
			}
				)
			}),

		pfile: new FileHandler('DEBUG', {
			filename: pathLib.resolve(logFileName),
			mode: 'a',
			useColors: false,
			formatter: (rec) => {
				const {datetime, msg, levelName} = rec
				const msStr = sprintf("%5d", datetime - prevFileMS)
				prevFileMS = datetime
				const label = hFileLabel[levelName]
				if (!fileHeaderOutput) {
					fileHeaderOutput = true
					return `ms\n-----\n${msStr} ${label}${prefix()}${msg}`
				}
				else {
					return `${msStr} ${label}${prefix()}${msg}`
				}
			}
			}),

		console: new ConsoleHandler('DEBUG', {
			formatter: ((rec) => {
				const {levelName, msg} = rec
				const label = hConsoleLabel[levelName]
				assert(defined(label), `No label for ${levelName}`)
				return `${label}${prefix()}${msg}`
			}
				)
			}),

		file: new FileHandler('DEBUG', {
			filename: logFileName,
			mode: 'a',
			useColors: false,
			formatter: (rec) => {
				const {levelName, msg} = rec
				if (isSep(msg)) {
					return msg
				}
				else {
					const label = hFileLabel[levelName]
					assert(defined(label), `No label for ${levelName}`)
					return `${label}${prefix()}${msg}`
				}
			}
				}),
	},

	// --- assign handlers to loggers
	//     must include:
	//        'profile', 'debug', 'info', 'warn', 'error', 'file' and 'silent'
	loggers: {
		profile: {
			level: "DEBUG",
			num: 1,
			handlers: ["profile", "pfile"]
			},
		debug: {
			level: "DEBUG",
			num: 2,
			handlers: ["console", "file"]
			},
		info: {
			level: "INFO",
			num: 3,
			handlers: ["console", "file"]
			},
		warn: {
			level: "WARN",
			num: 4,
			handlers: ["console", "file"]
			},
		error: {
			level: "ERROR",
			num: 5,
			handlers: ["console", "file"]
			},
		file: {
			level: "DEBUG",
			num: 6,
			handlers: ["file"]
			},
		silent: {
			level: "ERROR",
			num: 7,
			handlers: []
			}
		}
	}

await setup(hLoggerConfig)

export const INDENT = 'MOKaHenzkyZNbNWmUYijCNoqmIrIemFh'
export const UNDENT = 'MXrveSEaCkCfQjEgPdMIaEDFMIWMtHqz'
export const CLEAR  = '2EYCEu1v7xs0i4L3o5rAV1ZNLFkQYNHh'

// ---------------------------------------------------------------------------
// levels: profile, debug, info, warn, error, file, silent

class LoggerEx {

	constructor() {
		this.hConfig = hLoggerConfig
		const hLoggers = this.hConfig.loggers;this.hLoggers = hLoggers;
		const defLevel = Deno.env.get('DEFAULT_LOGGER') || 'info'
		this.check(defLevel)
		const lLoggerStack = [defLevel];this.lLoggerStack = lLoggerStack;
		let silent1 = false
	}

	curLevel() {
		return this.lLoggerStack.at(-1)
	}

	levelChanged() {
		switch(this.curLevel()) {
			case 'profile': {
				// --- NOTE: These are package global variables
				prevMS = prevFileMS = Date.now()
				headerOutput = false
				fileHeaderOutput = false;break;
			}
		}
		return
	}

	setLevel(level) {
		this.check(level)
		this.lLoggerStack[this.lLoggerStack.length-1] = level
		this.levelChanged()
		return
	}

	pushLevel(level) {
		this.check(level)
		this.lLoggerStack.push(level)
		this.levelChanged()
		return
	}

	popLevel() {
		assert((this.lLoggerStack.length > 0), "Empty logger stack")
		const level = this.lLoggerStack.pop()
		this.levelChanged()
		return level
	}

	isActive(level) {
		this.check(level)
		const curNum = this.hLoggers[this.curLevel()].num
		const lvlNum = this.hLoggers[level].num
		return (lvlNum >= curNum)
	}

	output(level, lItems) {
		if (this.isActive(level)) {
			for (const item of lItems) {
				switch(item) {
					case INDENT: {
						indent += 1;break;
					}
					case UNDENT: {
						indent = (indent===0) ? 0 : indent-1;break;
					}
					case CLEAR: {
						this.clearLog();break;
					}
					default: {
						getLogger(this.curLevel())[level](item)
					}
				}
			}
		}
		return
	}

	flush() {
		this.hConfig.handlers.file.flush()
		this.hConfig.handlers.pfile.flush()
		return
	}

	clearLog() {
		this.flush()
		Deno.writeTextFile(logFileName, '')
		prevMS = prevFileMS = Date.now()
		return
	}

	getLog() {
		this.flush()
		return Deno.readTextFileSync(logFileName).trim()
	}

	check(level) {
		assert(this.hLoggers[level], `Bad logger level: '${level}'`)
	}
}

export const logger = new LoggerEx()

// ---------------------------------------------------------------------------

export const DBG  = (...lItems) => logger.output('debug', lItems)
export const LOG  = (...lItems) => logger.output('info', lItems)
export const WARN = (...lItems) => logger.output('warn', lItems)
export const ERR  = (...lItems) => logger.output('error', lItems)

export const curLogLevel  = () => { return logger.curLevel() }
export const setLogLevel  = (level) => logger.setLevel(level)
export const pushLogLevel = (level) => logger.pushLevel(level)
export const popLogLevel  = () => { return logger.popLevel() }
export const clearLog     = () => { return logger.clearLog() }
export const getLog       = () => { return logger.getLog() }
export const flushLog     = () => logger.flush()

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9sb2dnZXIuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJzcmMvbGliL2xvZ2dlci5jaXZldCJdLCJtYXBwaW5ncyI6IkFBQUEsZUFBYztBQUNkLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhO0FBQ2xDLEFBQUEsQUFBQSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNO0FBQzFCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCO0FBQ3ZDLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsY0FBYyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQy9DLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVO0FBQ2xCLEFBQUE7QUFDQSxBQUFBLEFBQU8sTUFBUCxPQUFPLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRSxDQUFDLElBQUksQ0FBQztBQUNqRCxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQVksTUFBWCxXQUFXLENBQUMsQ0FBRSxDQUFDLGlCQUFpQjtBQUN2QyxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBUSxNQUFQLE9BQU8sQ0FBQyxDQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7QUFDaEMsQUFBQSxBQUFBLE1BQU0sQ0FBUSxNQUFQLEtBQUssR0FBRyxDQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7QUFDaEMsQUFBQSxBQUFLLE1BQUwsS0FBSyxDQUFDLENBQUUsQ0FBQyxDQUFDLEdBQUcs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QUMsTUFBTSxDQUFDLE1BQU0sQ0FBQSxBQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQTtBQUMzRCxBQUFBLEFBQUEsTUFBTSxDQUFLLE1BQUosR0FBRyxFQUFFLENBQUUsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUEsQUFBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUE7QUFDMUQsQUFBQSxBQUFBLE1BQU0sQ0FBSyxNQUFKLElBQUksQ0FBQyxDQUFFLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFBLEFBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFBO0FBQzFELEFBQUEsQUFBQSxNQUFNLENBQUssTUFBSixHQUFHLEVBQUUsQ0FBRSxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQSxBQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQTtBQUMzRCxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBYSxNQUFaLFdBQVcsRUFBRSxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBLENBQUEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUEsQ0FBQTtBQUNyRCxBQUFBLEFBQUEsTUFBTSxDQUFhLE1BQVosV0FBVyxFQUFFLENBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQztBQUN4RCxBQUFBLEFBQUEsTUFBTSxDQUFhLE1BQVosWUFBWSxDQUFDLENBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztBQUN6RCxBQUFBLEFBQUEsTUFBTSxDQUFhLE1BQVosV0FBVyxFQUFFLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUEsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQSxDQUFBO0FBQ3JELEFBQUEsQUFBQSxNQUFNLENBQWEsTUFBWixRQUFRLEtBQUssQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQSxDQUFBLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBLENBQUE7QUFDckQsQUFBQSxBQUFBLE1BQU0sQ0FBYSxNQUFaLE1BQU0sT0FBTyxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBLENBQUEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUEsQ0FBQTtBQUNuRCxBQUFBLEFBQUEsTUFBTSxDQUFhLE1BQVosUUFBUSxLQUFLLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzNDIiwibmFtZXMiOltdLCJzb3VyY2VzQ29udGVudCI6WyIjIGxvZ2dlci5jaXZldFxuXG5pbXBvcnQge2Fzc2VydH0gZnJvbSAnQHN0ZC9hc3NlcnQnXG5pbXBvcnQgcGF0aExpYiBmcm9tICdwYXRoJ1xuaW1wb3J0IHtzcHJpbnRmfSBmcm9tICdAc3RkL2ZtdC9wcmludGYnXG5pbXBvcnQge1xuXHRDb25zb2xlSGFuZGxlciwgRmlsZUhhbmRsZXIsIHNldHVwLCBnZXRMb2dnZXIsXG5cdH0gZnJvbSBcIkBzdGQvbG9nXCJcblxuZGVmaW5lZCA6PSAoeCkgPT4gKHggIT0gdW5kZWZpbmVkKSAmJiAoeCAhPSBudWxsKVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgbG9nRmlsZU5hbWUgOj0gXCIuL2xvZ3MvbG9ncy50eHRcIlxuXG5leHBvcnQgc2VwZGFzaCA6PSAnLScucmVwZWF0KDMyKVxuZXhwb3J0IHNlcGVxICAgOj0gJz0nLnJlcGVhdCgzMilcbmlzU2VwIDo9IChzdHIpID0+IChzdHIgPT0gc2VwZGFzaCkgfHwgKHN0ciA9PSBzZXBlcSlcblxubGV0IGluZGVudCA9IDBcbnByZWZpeCA6PSAoKSA9PiAnICAgJy5yZXBlYXQoaW5kZW50KVxuXG4jIC0tLSBVc2VkIHdoZW4gY3VycmVudCBsb2dnZXIgaXMgJ3Byb2ZpbGUnXG5sZXQgcHJldk1TID0gMFxubGV0IHByZXZGaWxlTVMgPSAwXG5sZXQgaGVhZGVyT3V0cHV0ID0gZmFsc2VcbmxldCBmaWxlSGVhZGVyT3V0cHV0ID0gZmFsc2VcblxuaEZpbGVMYWJlbCA6PSB7XG5cdERFQlVHOiAnRCAnXG5cdElORk86ICAnSSAnXG5cdFdBUk46ICAnVyAnXG5cdEVSUk9SOiAnRVJST1I6ICdcblx0fVxuXG5oQ29uc29sZUxhYmVsIDo9IHtcblx0REVCVUc6ICcnXG5cdElORk86ICAnJ1xuXHRXQVJOOiAgJydcblx0RVJST1I6ICcnXG5cdH1cblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGhMb2dnZXJDb25maWcgOj0ge1xuXHRoYW5kbGVyczpcblxuXHRcdHByb2ZpbGU6IG5ldyBDb25zb2xlSGFuZGxlcignREVCVUcnLCB7XG5cdFx0XHRmb3JtYXR0ZXI6ICgocmVjKSA9PlxuXHRcdFx0XHR7ZGF0ZXRpbWUsIG1zZywgbGV2ZWxOYW1lfSA6PSByZWNcblx0XHRcdFx0bXNTdHIgOj0gc3ByaW50ZihcIiU1ZFwiLCBkYXRldGltZSAtIHByZXZNUylcblx0XHRcdFx0cHJldk1TID0gZGF0ZXRpbWVcblx0XHRcdFx0bGFiZWwgOj0gaENvbnNvbGVMYWJlbFtsZXZlbE5hbWVdXG5cdFx0XHRcdGlmIG5vdCBoZWFkZXJPdXRwdXRcblx0XHRcdFx0XHRoZWFkZXJPdXRwdXQgPSB0cnVlXG5cdFx0XHRcdFx0cmV0dXJuIFwibXNcXG4tLS0tLVxcbiN7bXNTdHJ9ICN7bGFiZWx9I3twcmVmaXgoKX0je21zZ31cIlxuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0cmV0dXJuIFwiI3ttc1N0cn0gI3tsYWJlbH0je3ByZWZpeCgpfSN7bXNnfVwiXG5cdFx0XHRcdClcblx0XHRcdH0pXG5cblx0XHRwZmlsZTogbmV3IEZpbGVIYW5kbGVyKCdERUJVRycsIHtcblx0XHRcdGZpbGVuYW1lOiBwYXRoTGliLnJlc29sdmUobG9nRmlsZU5hbWUpXG5cdFx0XHRtb2RlOiAnYSdcblx0XHRcdHVzZUNvbG9yczogZmFsc2Vcblx0XHRcdGZvcm1hdHRlcjogKHJlYykgPT5cblx0XHRcdFx0e2RhdGV0aW1lLCBtc2csIGxldmVsTmFtZX0gOj0gcmVjXG5cdFx0XHRcdG1zU3RyIDo9IHNwcmludGYoXCIlNWRcIiwgZGF0ZXRpbWUgLSBwcmV2RmlsZU1TKVxuXHRcdFx0XHRwcmV2RmlsZU1TID0gZGF0ZXRpbWVcblx0XHRcdFx0bGFiZWwgOj0gaEZpbGVMYWJlbFtsZXZlbE5hbWVdXG5cdFx0XHRcdGlmIG5vdCBmaWxlSGVhZGVyT3V0cHV0XG5cdFx0XHRcdFx0ZmlsZUhlYWRlck91dHB1dCA9IHRydWVcblx0XHRcdFx0XHRyZXR1cm4gXCJtc1xcbi0tLS0tXFxuI3ttc1N0cn0gI3tsYWJlbH0je3ByZWZpeCgpfSN7bXNnfVwiXG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRyZXR1cm4gXCIje21zU3RyfSAje2xhYmVsfSN7cHJlZml4KCl9I3ttc2d9XCJcblx0XHRcdH0pXG5cblx0XHRjb25zb2xlOiBuZXcgQ29uc29sZUhhbmRsZXIoJ0RFQlVHJywge1xuXHRcdFx0Zm9ybWF0dGVyOiAoKHJlYykgPT5cblx0XHRcdFx0e2xldmVsTmFtZSwgbXNnfSA6PSByZWNcblx0XHRcdFx0bGFiZWwgOj0gaENvbnNvbGVMYWJlbFtsZXZlbE5hbWVdXG5cdFx0XHRcdGFzc2VydCBkZWZpbmVkKGxhYmVsKSwgXCJObyBsYWJlbCBmb3IgI3tsZXZlbE5hbWV9XCJcblx0XHRcdFx0cmV0dXJuIFwiI3tsYWJlbH0je3ByZWZpeCgpfSN7bXNnfVwiXG5cdFx0XHRcdClcblx0XHRcdH0pXG5cblx0XHRmaWxlOiBuZXcgRmlsZUhhbmRsZXIoJ0RFQlVHJywge1xuXHRcdFx0ZmlsZW5hbWU6IGxvZ0ZpbGVOYW1lXG5cdFx0XHRtb2RlOiAnYSdcblx0XHRcdHVzZUNvbG9yczogZmFsc2Vcblx0XHRcdGZvcm1hdHRlcjogKHJlYykgPT5cblx0XHRcdFx0e2xldmVsTmFtZSwgbXNnfSA6PSByZWNcblx0XHRcdFx0aWYgaXNTZXAobXNnKVxuXHRcdFx0XHRcdHJldHVybiBtc2dcblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdGxhYmVsIDo9IGhGaWxlTGFiZWxbbGV2ZWxOYW1lXVxuXHRcdFx0XHRcdGFzc2VydCBkZWZpbmVkKGxhYmVsKSwgXCJObyBsYWJlbCBmb3IgI3tsZXZlbE5hbWV9XCJcblx0XHRcdFx0XHRyZXR1cm4gXCIje2xhYmVsfSN7cHJlZml4KCl9I3ttc2d9XCJcblx0XHRcdFx0fSlcblxuXHQjIC0tLSBhc3NpZ24gaGFuZGxlcnMgdG8gbG9nZ2Vyc1xuXHQjICAgICBtdXN0IGluY2x1ZGU6XG5cdCMgICAgICAgICdwcm9maWxlJywgJ2RlYnVnJywgJ2luZm8nLCAnd2FybicsICdlcnJvcicsICdmaWxlJyBhbmQgJ3NpbGVudCdcblx0bG9nZ2Vyczoge1xuXHRcdHByb2ZpbGU6IHtcblx0XHRcdGxldmVsOiBcIkRFQlVHXCJcblx0XHRcdG51bTogMVxuXHRcdFx0aGFuZGxlcnM6IFtcInByb2ZpbGVcIiwgXCJwZmlsZVwiXVxuXHRcdFx0fVxuXHRcdGRlYnVnOiB7XG5cdFx0XHRsZXZlbDogXCJERUJVR1wiXG5cdFx0XHRudW06IDJcblx0XHRcdGhhbmRsZXJzOiBbXCJjb25zb2xlXCIsIFwiZmlsZVwiXVxuXHRcdFx0fVxuXHRcdGluZm86IHtcblx0XHRcdGxldmVsOiBcIklORk9cIlxuXHRcdFx0bnVtOiAzXG5cdFx0XHRoYW5kbGVyczogW1wiY29uc29sZVwiLCBcImZpbGVcIl1cblx0XHRcdH1cblx0XHR3YXJuOiB7XG5cdFx0XHRsZXZlbDogXCJXQVJOXCIsXG5cdFx0XHRudW06IDRcblx0XHRcdGhhbmRsZXJzOiBbXCJjb25zb2xlXCIsIFwiZmlsZVwiXVxuXHRcdFx0fVxuXHRcdGVycm9yOiB7XG5cdFx0XHRsZXZlbDogXCJFUlJPUlwiXG5cdFx0XHRudW06IDVcblx0XHRcdGhhbmRsZXJzOiBbXCJjb25zb2xlXCIsIFwiZmlsZVwiXVxuXHRcdFx0fVxuXHRcdGZpbGU6IHtcblx0XHRcdGxldmVsOiBcIkRFQlVHXCIsXG5cdFx0XHRudW06IDZcblx0XHRcdGhhbmRsZXJzOiBbXCJmaWxlXCJdXG5cdFx0XHR9XG5cdFx0c2lsZW50OiB7XG5cdFx0XHRsZXZlbDogXCJFUlJPUlwiXG5cdFx0XHRudW06IDdcblx0XHRcdGhhbmRsZXJzOiBbXVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5hd2FpdCBzZXR1cChoTG9nZ2VyQ29uZmlnKVxuXG5leHBvcnQgSU5ERU5UIDo9ICdNT0thSGVuemt5Wk5iTldtVVlpakNOb3FtSXJJZW1GaCdcbmV4cG9ydCBVTkRFTlQgOj0gJ01YcnZlU0VhQ2tDZlFqRWdQZE1JYUVERk1JV010SHF6J1xuZXhwb3J0IENMRUFSICA6PSAnMkVZQ0V1MXY3eHMwaTRMM281ckFWMVpOTEZrUVlOSGgnXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIGxldmVsczogcHJvZmlsZSwgZGVidWcsIGluZm8sIHdhcm4sIGVycm9yLCBmaWxlLCBzaWxlbnRcblxuY2xhc3MgTG9nZ2VyRXhcblxuXHRjb25zdHJ1Y3RvcjogKCkgLT5cblx0XHRAaENvbmZpZyA9IGhMb2dnZXJDb25maWdcblx0XHRAaExvZ2dlcnMgOj0gQGhDb25maWcubG9nZ2Vyc1xuXHRcdGRlZkxldmVsIDo9IERlbm8uZW52LmdldCgnREVGQVVMVF9MT0dHRVInKSB8fCAnaW5mbydcblx0XHRAY2hlY2sgZGVmTGV2ZWxcblx0XHRAbExvZ2dlclN0YWNrIDo9IFtkZWZMZXZlbF1cblx0XHRsZXQgQHNpbGVudCA9IGZhbHNlXG5cblx0Y3VyTGV2ZWw6ICgpIC0+XG5cdFx0cmV0dXJuIEBsTG9nZ2VyU3RhY2suYXQoLTEpXG5cblx0bGV2ZWxDaGFuZ2VkOiAoKSAtPlxuXHRcdHN3aXRjaCBAY3VyTGV2ZWwoKVxuXHRcdFx0d2hlbiAncHJvZmlsZSdcblx0XHRcdFx0IyAtLS0gTk9URTogVGhlc2UgYXJlIHBhY2thZ2UgZ2xvYmFsIHZhcmlhYmxlc1xuXHRcdFx0XHRwcmV2TVMgPSBwcmV2RmlsZU1TID0gRGF0ZS5ub3coKVxuXHRcdFx0XHRoZWFkZXJPdXRwdXQgPSBmYWxzZVxuXHRcdFx0XHRmaWxlSGVhZGVyT3V0cHV0ID0gZmFsc2Vcblx0XHRyZXR1cm5cblxuXHRzZXRMZXZlbDogKGxldmVsKSAtPlxuXHRcdEBjaGVjayBsZXZlbFxuXHRcdEBsTG9nZ2VyU3RhY2tbQGxMb2dnZXJTdGFjay5sZW5ndGgtMV0gPSBsZXZlbFxuXHRcdEBsZXZlbENoYW5nZWQoKVxuXHRcdHJldHVyblxuXG5cdHB1c2hMZXZlbDogKGxldmVsKSAtPlxuXHRcdEBjaGVjayBsZXZlbFxuXHRcdEBsTG9nZ2VyU3RhY2sucHVzaCBsZXZlbFxuXHRcdEBsZXZlbENoYW5nZWQoKVxuXHRcdHJldHVyblxuXG5cdHBvcExldmVsOiAoKSAtPlxuXHRcdGFzc2VydCAoQGxMb2dnZXJTdGFjay5sZW5ndGggPiAwKSwgXCJFbXB0eSBsb2dnZXIgc3RhY2tcIlxuXHRcdGxldmVsIDo9IEBsTG9nZ2VyU3RhY2sucG9wKClcblx0XHRAbGV2ZWxDaGFuZ2VkKClcblx0XHRyZXR1cm4gbGV2ZWxcblxuXHRpc0FjdGl2ZTogKGxldmVsKSAtPlxuXHRcdEBjaGVjayBsZXZlbFxuXHRcdGN1ck51bSA6PSBAaExvZ2dlcnNbQGN1ckxldmVsKCldLm51bVxuXHRcdGx2bE51bSA6PSBAaExvZ2dlcnNbbGV2ZWxdLm51bVxuXHRcdHJldHVybiAobHZsTnVtID49IGN1ck51bSlcblxuXHRvdXRwdXQ6IChsZXZlbCwgbEl0ZW1zKSAtPlxuXHRcdGlmIEBpc0FjdGl2ZShsZXZlbClcblx0XHRcdGZvciBpdGVtIG9mIGxJdGVtc1xuXHRcdFx0XHRzd2l0Y2ggaXRlbVxuXHRcdFx0XHRcdHdoZW4gSU5ERU5UXG5cdFx0XHRcdFx0XHRpbmRlbnQgKz0gMVxuXHRcdFx0XHRcdHdoZW4gVU5ERU5UXG5cdFx0XHRcdFx0XHRpbmRlbnQgPSAoaW5kZW50PT0wKSA/IDAgOiBpbmRlbnQtMVxuXHRcdFx0XHRcdHdoZW4gQ0xFQVJcblx0XHRcdFx0XHRcdEBjbGVhckxvZygpXG5cdFx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdFx0Z2V0TG9nZ2VyKEBjdXJMZXZlbCgpKVtsZXZlbF0gaXRlbVxuXHRcdHJldHVyblxuXG5cdGZsdXNoOiAoKSAtPlxuXHRcdEBoQ29uZmlnLmhhbmRsZXJzLmZpbGUuZmx1c2goKVxuXHRcdEBoQ29uZmlnLmhhbmRsZXJzLnBmaWxlLmZsdXNoKClcblx0XHRyZXR1cm5cblxuXHRjbGVhckxvZzogKCkgLT5cblx0XHRAZmx1c2goKVxuXHRcdERlbm8ud3JpdGVUZXh0RmlsZSBsb2dGaWxlTmFtZSwgJydcblx0XHRwcmV2TVMgPSBwcmV2RmlsZU1TID0gRGF0ZS5ub3coKVxuXHRcdHJldHVyblxuXG5cdGdldExvZzogKCkgLT5cblx0XHRAZmx1c2goKVxuXHRcdHJldHVybiBEZW5vLnJlYWRUZXh0RmlsZVN5bmMobG9nRmlsZU5hbWUpLnRyaW0oKVxuXG5cdGNoZWNrOiAobGV2ZWwpIC0+XG5cdFx0YXNzZXJ0IEBoTG9nZ2Vyc1tsZXZlbF0sIFwiQmFkIGxvZ2dlciBsZXZlbDogJyN7bGV2ZWx9J1wiXG5cbmV4cG9ydCBsb2dnZXIgOj0gbmV3IExvZ2dlckV4KClcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IERCRyAgOj0gKC4uLmxJdGVtcykgPT4gbG9nZ2VyLm91dHB1dCAnZGVidWcnLCBsSXRlbXNcbmV4cG9ydCBMT0cgIDo9ICguLi5sSXRlbXMpID0+IGxvZ2dlci5vdXRwdXQgJ2luZm8nLCBsSXRlbXNcbmV4cG9ydCBXQVJOIDo9ICguLi5sSXRlbXMpID0+IGxvZ2dlci5vdXRwdXQgJ3dhcm4nLCBsSXRlbXNcbmV4cG9ydCBFUlIgIDo9ICguLi5sSXRlbXMpID0+IGxvZ2dlci5vdXRwdXQgJ2Vycm9yJywgbEl0ZW1zXG5cbmV4cG9ydCBjdXJMb2dMZXZlbCAgOj0gKCkgPT4gcmV0dXJuIGxvZ2dlci5jdXJMZXZlbCgpXG5leHBvcnQgc2V0TG9nTGV2ZWwgIDo9IChsZXZlbCkgPT4gbG9nZ2VyLnNldExldmVsKGxldmVsKVxuZXhwb3J0IHB1c2hMb2dMZXZlbCA6PSAobGV2ZWwpID0+IGxvZ2dlci5wdXNoTGV2ZWwobGV2ZWwpXG5leHBvcnQgcG9wTG9nTGV2ZWwgIDo9ICgpID0+IHJldHVybiBsb2dnZXIucG9wTGV2ZWwoKVxuZXhwb3J0IGNsZWFyTG9nICAgICA6PSAoKSA9PiByZXR1cm4gbG9nZ2VyLmNsZWFyTG9nKClcbmV4cG9ydCBnZXRMb2cgICAgICAgOj0gKCkgPT4gcmV0dXJuIGxvZ2dlci5nZXRMb2coKVxuZXhwb3J0IGZsdXNoTG9nICAgICA6PSAoKSA9PiBsb2dnZXIuZmx1c2goKVxuIl19