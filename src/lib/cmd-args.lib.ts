"use strict";
// cmd-args.lib.civet

import {
	undef, defined, notdefined, assert, croak,
	hash, hashof,
	isEmpty, isArray, isBoolean, isInteger, isHash, isString,
	} from 'datatypes'
import {
	keys, OL, getOptions, o, spaces,
	} from 'llutils'
import {
	TLogLevel, setLogLevel,
	} from 'log-levels'
import {LOG, DBG} from 'logger'

// ---------------------------------------------------------------------------

const hKeyToLogLevel: hashof<TLogLevel> = {
	P: 'profile',
	D: 'debug',
	I: 'info',
	W: 'warn',
	E: 'error',
	S: 'silent',
	N: 'none'
	}

export const logLevelFromArgs = (lArgs: string[]): (TLogLevel | undefined) => {

	for (const str of lArgs) {
		const lMatches = str.match(/^-([A-Za-z0-9_-]*)(=)?/)
		if (defined(lMatches)) {
			const keyStr = lMatches[1]
			const hasEq = lMatches[2]
			if (isEmpty(hasEq)) {
				for (const key of keys(hKeyToLogLevel)) {
					if (keyStr.includes(key)) {
						return hKeyToLogLevel[key]
					}
				}
			}
		}
	}
	return undef
}

// ---------------------------------------------------------------------------

/**
 * Parse command line arguments, optionally specifying which
 * options to expect and/or the expected number of non-options
 *
 * There are 3 kinds of items allowed on the command line:
 *
 * 1. flags, e.g.
 * 	`-fnx` - sets flags `f`, 'n' and `x` to true
 *    flags must be upper or lower case letters
 *
 * 2. an option with a value, e.g.
 * 	`-label=mylabel` - sets option `label` to `'mylabel'`
 * 	if the value contains a space char, it must be quoted
 * 	if the value looks like a number, it's set to a number
 *
 * 3. anything else is a non-option, e.g.
 * 	c:/temp/temp.txt
 * 	if it includes a space char or starts with `-`,
 * 		it must be quoted
 *
 * the 1st argument to getCmdArgs() is optional, and is a hash
 * of information about the expected arguments.
 *
 * If key '_' is present, it must be a hash possibly including keys:
 *    'range' - either an integer specifying the exact number of
 *              non-options expected, or an array of 2 integers
 *              specifying the minimum and maximum number of
 *              non-options expected.
 *    'desc' - a text description of what non-options are
 *
 * All other keys are names of options allowed
 *    the associated value
 * must be a hash with possibly these keys:
 *    type - the type of value expected (defaults to 'boolean')
 *    desc - a text description of the option (used on help screens)
 *
 * the 2nd argument to getCmdArgs() is an array of string arguments
 * from the command line (defaults to Deno.args)
 *
 * the 3rd argument to getCmdArgs() is a hash of possible options:
 *    doSetLogger - defaults to true - if false, then options
 *                  -P, -D, -Q, -I and -S no longer set logging options
 *                  and may therefore be used for other purposes
 *
 * By default, the following flags are recognized, and therefore
 * cannot be included in hDesc (this behavior can be
 * disabled by setting hOptions.doSetLogger to false):
 *
 * `-P` - set the current log level to 'profile'
 * `-D` - set the current log level to 'debug'
 * `-Q` - set the current log level to 'warn'
 * `-I` - set the current log level to 'info'
 * `-S` - set the current log level to 'silent'
 *
 * (see library @jdeighan/logger)
 */

type TCmdArgs = {
	[key: string]: unknown
	}

// --- Return a hash of args and an array of non-options

export const getCmdArgs = (
	hDesc: (hash | undefined) = undef,
	lArgs: string[] = Deno.args,
	hOptions: hash = {}
	): [TCmdArgs, string[]] => {

	type opt = {
		doSetLogger: boolean
		}
	const {doSetLogger} = getOptions<opt>(hOptions, {
		doSetLogger: true
		})

	if (doSetLogger && defined(hDesc)) {
		// --- Make sure hDesc does NOT include any of:
		//        P, D, Q, I, S
		for (const key of keys(hKeyToLogLevel)) {
			assert(notdefined(hDesc[key]),
					`invalid key ${OL(key)} set in hDesc`)
		}
		const logLevel = logLevelFromArgs(lArgs)
		if (defined(logLevel)) {
			setLogLevel(logLevel)
		}
	}

	if (defined(hDesc)) {
		DBG(`hDesc is: ${OL(hDesc)}`)
	}
	DBG(`lArgs is: ${OL(lArgs)}`)

	if ((lArgs.length === 1)
			&& ['-h','--h','-help','--help'].includes(lArgs[0])
			) {
		if (defined(hDesc)) {
			LOG(helpStr(hDesc))
		}
		else {
			LOG("No help available")
		}
		Deno.exit(0)
	}

	const hResult: TCmdArgs = {}
	const lNonOptions: string[] = []

	// --- Utility functions

	// --- Even gets called for -D, -Q, -P, -S
	const addOption = (name: string, value: string | boolean) => {
		DBG(`addOption(${OL(name)}, ${OL(value)})`)
		assert((!(name in hResult)),
				`dup key ${name}, hResult = ${OL(hResult)}`)

		if (doSetLogger) {
			const logger = hKeyToLogLevel[name]
			if (defined(logger)) {
				hResult[name] = true
				setLogLevel(logger)
				return
			}
		}

		if (notdefined(hDesc)) {
			hResult[name] = value
			return
		}
		const {type} = getOptionInfo(hDesc, name)

		// --- type checking
		if (isArray(type)) {
			assert(type.includes(value), "type not an array")
			hResult[name] = value
		}
		else if (isBoolean(value)) {
			hResult[name] = value
		}
		else {
			// --- it's a string
			const float = parseFloat(value)
			if (Number.isNaN(float)) {
				hResult[name] = value
			}
			else {
				hResult[name] = float
			}
		}
		return
	}

	const addNonOption = (str: string) => {
		DBG(`addNonOption(${OL(str)})`)
		lNonOptions.push(str)
	}

	for (const str of lArgs) {
		// --- ignore '--'
		if (str === '--') {
			DBG("skipping --")
			continue
		}

		// --- check if it's an option
		const lMatches = str.match(/^-([A-Za-z0-9_-]*)(?:(=)(.*))?$/)
		if (lMatches === null) {
			// --- it's a non-option
			addNonOption(str)
		}
		else {
			// --- it's an option
			const [_, optStr, eqStr, valueStr] = lMatches
			if (eqStr) {
				addOption(optStr, valueStr)
			}
			else {
				for (const ch of optStr.split('')) {
					addOption(ch, true)
				}
			}
		}
	}

	// --- if hDesc is set, then
	//     Fill in default values if available

	if (defined(hDesc)) {
		// --- Fill in missing keys with default values
		DBG("Filling in missing keys with default values")
		for (const name of keys(hDesc, o`except=_`)) {
			if (notdefined(hResult[name])) {
				const {defaultVal} = getOptionInfo(hDesc, name)
				if (defined(defaultVal)) {
					hResult[name] = defaultVal
				}
			}
		}

		// --- Check of there's a restriction on the number of non-options
		if (('_' in hDesc) && isArray(hResult._)) {
			const len = hResult._.length
			DBG(`Check number of non-options (${len})`)
			const hInfo = getNonOptionInfo(hDesc)
			DBG(`Non-option info: ${OL(hInfo)}`)
			if (defined(hInfo)) {
				const {min, max} = hInfo
				if (defined(hInfo.min)) {
					assert((len >= hInfo.min), `${len} non-options < min (${hInfo.min})`)
				}
				if (defined(hInfo.max)) {
					assert((len <= hInfo.max), `${len} non-options > max (${hInfo.max})`)
				}
			}
		}
	}

	DBG(`hResult = ${OL(hResult)}`)
	DBG(`lNonOptions = ${OL(lNonOptions)}`)
	return [hResult, lNonOptions]
}

// ---------------------------------------------------------------------------

export const getOptionInfo = (hDesc: hash, name: string): hash => {

	// --- Return value is a hash with keys: type, desc

	assert((name !== '_'), "getOptionInfo(hDesc, '_') called")
	assert((name in hDesc), `No such option: -${name}`)
	const h = isHash(hDesc[name]) ? hDesc[name] : {desc: hDesc[name]}
	if (notdefined(h.type)) {
		h.type = (name.length === 1) ? 'boolean' : 'string'
	}
	if (notdefined(h.desc)) {
		h.desc = '<no description available>'
	}
	if ((!('defaultVal' in h)) && (h.type === 'boolean')) {
		h.defaultVal = false
	}
	return h
}

// ---------------------------------------------------------------------------
// --- returns undef if no '_' key in hDesc

type TNonOptionInfo = {
	desc: string
	min: number
	max: number
	}

export const getNonOptionInfo = (hDesc: hash): (TNonOptionInfo | undefined) => {

	DBG(`hDesc = ${OL(hDesc)}`)
	if (!('_' in hDesc)) {
		DBG("No '_' key in hDesc")
		return undef
	}
	const h = hDesc._
	if (!isHash(h)) {
		DBG("hDesc._ not a hash")
		return undef
	}
	let {desc, range} = h
	const realDesc = (
		  isEmpty(desc)  ? '<no description available>'
		: isString(desc) ? desc
		: "<bad _ description>"
		)
	DBG(`desc = ${desc}`)
	if (notdefined(range)) {
		DBG("No range key")
		return {
			desc: realDesc,
			min: 0,
			max: Number.MAX_SAFE_INTEGER
			}
	}

	DBG(`range = ${OL(range)}`)
	if (isInteger(range)) {
		DBG(`Integer range: ${range}`)
		return {
			desc: realDesc,
			min: range,
			max: range
			}
	}
	else if (isArray(range)) {
		assert((range.length === 2), `Bad '_' key: ${OL(range)}`)
		const [min, max] = range
		DBG(`Array range: ${min}..${max}`)
		if (isInteger(min) && isInteger(max)) {
			return {
				desc: realDesc,
				min,
				max
				}
		}
		else {
			croak(`range min or max not an integer: ${OL(min)}..${OL(max)}`)
		}
	}
	else {
		croak(`Invalid range: ${OL(range)}`)
	}
}

// ---------------------------------------------------------------------------

const cntStr = (n: number, str: string): string => {
	return (n===1) ? `1 ${str}` : `${n} ${str}s`
}

export const helpStr = (hDesc: hash): string => {

	const lLines = ["Available options:"]
	const push = (str: string, level: number=0): void => {
		lLines.push(spaces(3*level) + str)
	}

	for (const name of keys(hDesc, {lExcept: '_'})) {
		const {type, desc} = getOptionInfo(hDesc, name)
		push(`-${name}: ${type} - ${desc}`, 1)
	}
	if (defined(hDesc._)) {
		push("Non-options:")
		const hInfo = getNonOptionInfo(hDesc)
		if (defined(hInfo)) {
			const {desc, min, max} = hInfo
			push(desc, 1)
			if (min === max) {
				push(`There must be exactly ${min} non-options`, 1)
			}
			else {
				if (min > 0) {
					push(`There must be at least ${cntStr(min, 'non-option')}`, 1)
				}
				if (max < Number.MAX_SAFE_INTEGER) {
					push(`There must be at most ${cntStr(max, 'non-option')}`, 1)
				}
			}
		}
		else {
			croak("Bad descriptor for '_'")
		}
	}
	return lLines.join('\n')
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxqb2huZFxcdXRpbHNcXHNyY1xcbGliXFxjbWQtYXJncy5saWIuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGpvaG5kXFx1dGlsc1xcc3JjXFxsaWJcXGNtZC1hcmdzLmxpYi5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLHFCQUFvQjtBQUNwQixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQzNDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDO0FBQ2QsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUM7QUFDMUQsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVc7QUFDbkIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFDakMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVM7QUFDakIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLENBQUM7QUFDeEIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVk7QUFDcEIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRO0FBQy9CLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQSxBQUFpQyxNQUFqQyxjQUFjLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBRSxDQUFDLENBQUM7QUFD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QUFBQSxDQUFDLE1BQU0sQ0FBQSxBQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQTtBQUNuRCxBQUFBLENBQUUsTUFBRCxDQUFDLENBQUMsQ0FBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM3RCxBQUFBLENBQUMsR0FBRyxDQUFBLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ3RCLEFBQUEsRUFBRSxDQUFDLENBQUMsSUFBSSxDLENBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFE7Q0FBUSxDQUFBO0FBQ3BELEFBQUEsQ0FBQyxHQUFHLENBQUEsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDdEIsQUFBQSxFQUFFLENBQUMsQ0FBQyxJQUFJLEMsQ0FBRSxDQUFDLDRCO0NBQTRCLENBQUE7QUFDdkMsQUFBQSxDQUFDLEdBQUcsQ0FBQSxDLEMsQ0FBQyxZQUFZLENBQUMsRUFBTSxDQUFDLEMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFFLENBQUMsU0FBUyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ3BELEFBQUEsRUFBRSxDQUFDLENBQUMsVUFBVSxDLENBQUUsQ0FBQyxLO0NBQUssQ0FBQTtBQUN0QixBQUFBLENBQUMsTUFBTSxDQUFDLEM7QUFBQyxDQUFBO0FBQ1QsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUEsMkNBQTBDO0FBQzFDLEFB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QSxBQUFBLEFBQU0sTUFBTixNQUFNLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDN0MsQUFBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQztBQUFDLENBQUE7QUFDNUMsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQVEsTUFBUCxPQUFPLENBQUMsQ0FBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDMUMsQUFBQTtBQUNBLEFBQUEsQ0FBTyxNQUFOLE1BQU0sQ0FBQyxDQUFFLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztBQUNqQyxBQUFBLENBQUssTUFBSixJQUFJLENBQUMsQ0FBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFBO0FBQ2hELEFBQUEsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFBLEFBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDO0NBQUEsQ0FBQTtBQUNuQyxBQUFBO0FBQ0EsQUFBQSxDQUFDLEdBQUcsQ0FBQyxDQUFBLE1BQUEsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUN4QyxBQUFBLEVBQWMsTUFBWixDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUUsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQzVDLEFBQUEsRUFBRSxJQUFJLENBQUEsQUFBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQztDQUFBLENBQUE7QUFDdkMsQUFBQSxDQUFDLEdBQUcsQ0FBQSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNwQixBQUFBLEVBQUUsSUFBSSxDQUFBLEFBQUMsY0FBYyxDQUFBO0FBQ3JCLEFBQUEsRUFBTyxNQUFMLEtBQUssQ0FBQyxDQUFFLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDO0FBQ2xDLEFBQUEsRUFBRSxHQUFHLENBQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNuQixBQUFBLEdBQW1CLE1BQWhCLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxDQUFDLEtBQUs7QUFDNUIsQUFBQSxHQUFHLElBQUksQ0FBQSxBQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNmLEFBQUEsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQSxDQUFBO0FBQ2xCLEFBQUEsSUFBSSxJQUFJLENBQUEsQUFBQyxDQUFDLHNCQUFzQixFQUFFLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQztHQUFBLENBQUE7QUFDdEQsQUFBQSxHQUFHLElBQUksQ0FBQSxDQUFBO0FBQ1AsQUFBQSxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUE7QUFDaEIsQUFBQSxLQUFLLElBQUksQ0FBQSxBQUFDLENBQUMsdUJBQXVCLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQztJQUFBLENBQUE7QUFDbEUsQUFBQSxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBLENBQUE7QUFDdEMsQUFBQSxLQUFLLElBQUksQ0FBQSxBQUFDLENBQUMsc0JBQXNCLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQztJQUFBLEM7R0FBQSxDO0VBQUEsQ0FBQTtBQUNqRSxBQUFBLEVBQUUsSUFBSSxDQUFBLENBQUE7QUFDTixBQUFBLEdBQUcsS0FBSyxDQUFBLEFBQUMsd0JBQXdCLEM7RUFBQSxDO0NBQUEsQ0FBQTtBQUNqQyxBQUFBLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDO0FBQUMsQ0FBQTtBQUN6QiIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyBjbWQtYXJncy5saWIuY2l2ZXRcclxuXHJcbmltcG9ydCB7XHJcblx0dW5kZWYsIGRlZmluZWQsIG5vdGRlZmluZWQsIGFzc2VydCwgY3JvYWssXHJcblx0aGFzaCwgaGFzaG9mLFxyXG5cdGlzRW1wdHksIGlzQXJyYXksIGlzQm9vbGVhbiwgaXNJbnRlZ2VyLCBpc0hhc2gsIGlzU3RyaW5nLFxyXG5cdH0gZnJvbSAnZGF0YXR5cGVzJ1xyXG5pbXBvcnQge1xyXG5cdGtleXMsIE9MLCBnZXRPcHRpb25zLCBvLCBzcGFjZXMsXHJcblx0fSBmcm9tICdsbHV0aWxzJ1xyXG5pbXBvcnQge1xyXG5cdFRMb2dMZXZlbCwgc2V0TG9nTGV2ZWwsXHJcblx0fSBmcm9tICdsb2ctbGV2ZWxzJ1xyXG5pbXBvcnQge0xPRywgREJHfSBmcm9tICdsb2dnZXInXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuaEtleVRvTG9nTGV2ZWw6IGhhc2hvZjxUTG9nTGV2ZWw+IDo9IHtcclxuXHRQOiAncHJvZmlsZSdcclxuXHREOiAnZGVidWcnXHJcblx0STogJ2luZm8nXHJcblx0VzogJ3dhcm4nXHJcblx0RTogJ2Vycm9yJ1xyXG5cdFM6ICdzaWxlbnQnXHJcblx0TjogJ25vbmUnXHJcblx0fVxyXG5cclxuZXhwb3J0IGxvZ0xldmVsRnJvbUFyZ3MgOj0gKGxBcmdzOiBzdHJpbmdbXSk6IFRMb2dMZXZlbD8gPT5cclxuXHJcblx0Zm9yIHN0ciBvZiBsQXJnc1xyXG5cdFx0bE1hdGNoZXMgOj0gc3RyLm1hdGNoKC8vL15cclxuXHRcdFx0LVxyXG5cdFx0XHQoW0EtWmEtejAtOV8tXSopXHJcblx0XHRcdCg9KT9cclxuXHRcdFx0Ly8vKVxyXG5cdFx0aWYgZGVmaW5lZChsTWF0Y2hlcylcclxuXHRcdFx0a2V5U3RyIDo9IGxNYXRjaGVzWzFdXHJcblx0XHRcdGhhc0VxIDo9IGxNYXRjaGVzWzJdXHJcblx0XHRcdGlmIGlzRW1wdHkoaGFzRXEpXHJcblx0XHRcdFx0Zm9yIGtleSBvZiBrZXlzKGhLZXlUb0xvZ0xldmVsKVxyXG5cdFx0XHRcdFx0aWYga2V5U3RyLmluY2x1ZGVzKGtleSlcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGhLZXlUb0xvZ0xldmVsW2tleV1cclxuXHRyZXR1cm4gdW5kZWZcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vKipcclxuICogUGFyc2UgY29tbWFuZCBsaW5lIGFyZ3VtZW50cywgb3B0aW9uYWxseSBzcGVjaWZ5aW5nIHdoaWNoXHJcbiAqIG9wdGlvbnMgdG8gZXhwZWN0IGFuZC9vciB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIG5vbi1vcHRpb25zXHJcbiAqXHJcbiAqIFRoZXJlIGFyZSAzIGtpbmRzIG9mIGl0ZW1zIGFsbG93ZWQgb24gdGhlIGNvbW1hbmQgbGluZTpcclxuICpcclxuICogMS4gZmxhZ3MsIGUuZy5cclxuICogXHRgLWZueGAgLSBzZXRzIGZsYWdzIGBmYCwgJ24nIGFuZCBgeGAgdG8gdHJ1ZVxyXG4gKiAgICBmbGFncyBtdXN0IGJlIHVwcGVyIG9yIGxvd2VyIGNhc2UgbGV0dGVyc1xyXG4gKlxyXG4gKiAyLiBhbiBvcHRpb24gd2l0aCBhIHZhbHVlLCBlLmcuXHJcbiAqIFx0YC1sYWJlbD1teWxhYmVsYCAtIHNldHMgb3B0aW9uIGBsYWJlbGAgdG8gYCdteWxhYmVsJ2BcclxuICogXHRpZiB0aGUgdmFsdWUgY29udGFpbnMgYSBzcGFjZSBjaGFyLCBpdCBtdXN0IGJlIHF1b3RlZFxyXG4gKiBcdGlmIHRoZSB2YWx1ZSBsb29rcyBsaWtlIGEgbnVtYmVyLCBpdCdzIHNldCB0byBhIG51bWJlclxyXG4gKlxyXG4gKiAzLiBhbnl0aGluZyBlbHNlIGlzIGEgbm9uLW9wdGlvbiwgZS5nLlxyXG4gKiBcdGM6L3RlbXAvdGVtcC50eHRcclxuICogXHRpZiBpdCBpbmNsdWRlcyBhIHNwYWNlIGNoYXIgb3Igc3RhcnRzIHdpdGggYC1gLFxyXG4gKiBcdFx0aXQgbXVzdCBiZSBxdW90ZWRcclxuICpcclxuICogdGhlIDFzdCBhcmd1bWVudCB0byBnZXRDbWRBcmdzKCkgaXMgb3B0aW9uYWwsIGFuZCBpcyBhIGhhc2hcclxuICogb2YgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGV4cGVjdGVkIGFyZ3VtZW50cy5cclxuICpcclxuICogSWYga2V5ICdfJyBpcyBwcmVzZW50LCBpdCBtdXN0IGJlIGEgaGFzaCBwb3NzaWJseSBpbmNsdWRpbmcga2V5czpcclxuICogICAgJ3JhbmdlJyAtIGVpdGhlciBhbiBpbnRlZ2VyIHNwZWNpZnlpbmcgdGhlIGV4YWN0IG51bWJlciBvZlxyXG4gKiAgICAgICAgICAgICAgbm9uLW9wdGlvbnMgZXhwZWN0ZWQsIG9yIGFuIGFycmF5IG9mIDIgaW50ZWdlcnNcclxuICogICAgICAgICAgICAgIHNwZWNpZnlpbmcgdGhlIG1pbmltdW0gYW5kIG1heGltdW0gbnVtYmVyIG9mXHJcbiAqICAgICAgICAgICAgICBub24tb3B0aW9ucyBleHBlY3RlZC5cclxuICogICAgJ2Rlc2MnIC0gYSB0ZXh0IGRlc2NyaXB0aW9uIG9mIHdoYXQgbm9uLW9wdGlvbnMgYXJlXHJcbiAqXHJcbiAqIEFsbCBvdGhlciBrZXlzIGFyZSBuYW1lcyBvZiBvcHRpb25zIGFsbG93ZWRcclxuICogICAgdGhlIGFzc29jaWF0ZWQgdmFsdWVcclxuICogbXVzdCBiZSBhIGhhc2ggd2l0aCBwb3NzaWJseSB0aGVzZSBrZXlzOlxyXG4gKiAgICB0eXBlIC0gdGhlIHR5cGUgb2YgdmFsdWUgZXhwZWN0ZWQgKGRlZmF1bHRzIHRvICdib29sZWFuJylcclxuICogICAgZGVzYyAtIGEgdGV4dCBkZXNjcmlwdGlvbiBvZiB0aGUgb3B0aW9uICh1c2VkIG9uIGhlbHAgc2NyZWVucylcclxuICpcclxuICogdGhlIDJuZCBhcmd1bWVudCB0byBnZXRDbWRBcmdzKCkgaXMgYW4gYXJyYXkgb2Ygc3RyaW5nIGFyZ3VtZW50c1xyXG4gKiBmcm9tIHRoZSBjb21tYW5kIGxpbmUgKGRlZmF1bHRzIHRvIERlbm8uYXJncylcclxuICpcclxuICogdGhlIDNyZCBhcmd1bWVudCB0byBnZXRDbWRBcmdzKCkgaXMgYSBoYXNoIG9mIHBvc3NpYmxlIG9wdGlvbnM6XHJcbiAqICAgIGRvU2V0TG9nZ2VyIC0gZGVmYXVsdHMgdG8gdHJ1ZSAtIGlmIGZhbHNlLCB0aGVuIG9wdGlvbnNcclxuICogICAgICAgICAgICAgICAgICAtUCwgLUQsIC1RLCAtSSBhbmQgLVMgbm8gbG9uZ2VyIHNldCBsb2dnaW5nIG9wdGlvbnNcclxuICogICAgICAgICAgICAgICAgICBhbmQgbWF5IHRoZXJlZm9yZSBiZSB1c2VkIGZvciBvdGhlciBwdXJwb3Nlc1xyXG4gKlxyXG4gKiBCeSBkZWZhdWx0LCB0aGUgZm9sbG93aW5nIGZsYWdzIGFyZSByZWNvZ25pemVkLCBhbmQgdGhlcmVmb3JlXHJcbiAqIGNhbm5vdCBiZSBpbmNsdWRlZCBpbiBoRGVzYyAodGhpcyBiZWhhdmlvciBjYW4gYmVcclxuICogZGlzYWJsZWQgYnkgc2V0dGluZyBoT3B0aW9ucy5kb1NldExvZ2dlciB0byBmYWxzZSk6XHJcbiAqXHJcbiAqIGAtUGAgLSBzZXQgdGhlIGN1cnJlbnQgbG9nIGxldmVsIHRvICdwcm9maWxlJ1xyXG4gKiBgLURgIC0gc2V0IHRoZSBjdXJyZW50IGxvZyBsZXZlbCB0byAnZGVidWcnXHJcbiAqIGAtUWAgLSBzZXQgdGhlIGN1cnJlbnQgbG9nIGxldmVsIHRvICd3YXJuJ1xyXG4gKiBgLUlgIC0gc2V0IHRoZSBjdXJyZW50IGxvZyBsZXZlbCB0byAnaW5mbydcclxuICogYC1TYCAtIHNldCB0aGUgY3VycmVudCBsb2cgbGV2ZWwgdG8gJ3NpbGVudCdcclxuICpcclxuICogKHNlZSBsaWJyYXJ5IEBqZGVpZ2hhbi9sb2dnZXIpXHJcbiAqL1xyXG5cclxudHlwZSBUQ21kQXJncyA9IHtcclxuXHRba2V5OiBzdHJpbmddOiB1bmtub3duXHJcblx0fVxyXG5cclxuIyAtLS0gUmV0dXJuIGEgaGFzaCBvZiBhcmdzIGFuZCBhbiBhcnJheSBvZiBub24tb3B0aW9uc1xyXG5cclxuZXhwb3J0IGdldENtZEFyZ3MgOj0gKFxyXG5cdGhEZXNjOiBoYXNoPyA9IHVuZGVmLFxyXG5cdGxBcmdzOiBzdHJpbmdbXSA9IERlbm8uYXJncyxcclxuXHRoT3B0aW9uczogaGFzaCA9IHt9XHJcblx0KTogW1RDbWRBcmdzLCBzdHJpbmdbXV0gPT5cclxuXHJcblx0dHlwZSBvcHQgPSB7XHJcblx0XHRkb1NldExvZ2dlcjogYm9vbGVhblxyXG5cdFx0fVxyXG5cdHtkb1NldExvZ2dlcn0gOj0gZ2V0T3B0aW9uczxvcHQ+IGhPcHRpb25zLCB7XHJcblx0XHRkb1NldExvZ2dlcjogdHJ1ZVxyXG5cdFx0fVxyXG5cclxuXHRpZiBkb1NldExvZ2dlciAmJiBkZWZpbmVkKGhEZXNjKVxyXG5cdFx0IyAtLS0gTWFrZSBzdXJlIGhEZXNjIGRvZXMgTk9UIGluY2x1ZGUgYW55IG9mOlxyXG5cdFx0IyAgICAgICAgUCwgRCwgUSwgSSwgU1xyXG5cdFx0Zm9yIGtleSBvZiBrZXlzKGhLZXlUb0xvZ0xldmVsKVxyXG5cdFx0XHRhc3NlcnQgbm90ZGVmaW5lZChoRGVzY1trZXldKSxcclxuXHRcdFx0XHRcdFwiaW52YWxpZCBrZXkgI3tPTChrZXkpfSBzZXQgaW4gaERlc2NcIlxyXG5cdFx0bG9nTGV2ZWwgOj0gbG9nTGV2ZWxGcm9tQXJncyhsQXJncylcclxuXHRcdGlmIGRlZmluZWQobG9nTGV2ZWwpXHJcblx0XHRcdHNldExvZ0xldmVsIGxvZ0xldmVsXHJcblxyXG5cdGlmIGRlZmluZWQoaERlc2MpXHJcblx0XHREQkcgXCJoRGVzYyBpczogI3tPTChoRGVzYyl9XCJcclxuXHREQkcgXCJsQXJncyBpczogI3tPTChsQXJncyl9XCJcclxuXHJcblx0aWYgKChsQXJncy5sZW5ndGggPT0gMSlcclxuXHRcdFx0JiYgWyctaCcsJy0taCcsJy1oZWxwJywnLS1oZWxwJ10uaW5jbHVkZXMobEFyZ3NbMF0pXHJcblx0XHRcdClcclxuXHRcdGlmIGRlZmluZWQoaERlc2MpXHJcblx0XHRcdExPRyBoZWxwU3RyKGhEZXNjKVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRMT0cgXCJObyBoZWxwIGF2YWlsYWJsZVwiXHJcblx0XHREZW5vLmV4aXQoMClcclxuXHJcblx0aFJlc3VsdDogVENtZEFyZ3MgOj0ge31cclxuXHRsTm9uT3B0aW9uczogc3RyaW5nW10gOj0gW11cclxuXHJcblx0IyAtLS0gVXRpbGl0eSBmdW5jdGlvbnNcclxuXHJcblx0IyAtLS0gRXZlbiBnZXRzIGNhbGxlZCBmb3IgLUQsIC1RLCAtUCwgLVNcclxuXHRhZGRPcHRpb24gOj0gKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IGJvb2xlYW4pID0+XHJcblx0XHREQkcgXCJhZGRPcHRpb24oI3tPTChuYW1lKX0sICN7T0wodmFsdWUpfSlcIlxyXG5cdFx0YXNzZXJ0IChuYW1lIG5vdCBpbiBoUmVzdWx0KSxcclxuXHRcdFx0XHRcImR1cCBrZXkgI3tuYW1lfSwgaFJlc3VsdCA9ICN7T0woaFJlc3VsdCl9XCJcclxuXHJcblx0XHRpZiBkb1NldExvZ2dlclxyXG5cdFx0XHRsb2dnZXIgOj0gaEtleVRvTG9nTGV2ZWxbbmFtZV1cclxuXHRcdFx0aWYgZGVmaW5lZChsb2dnZXIpXHJcblx0XHRcdFx0aFJlc3VsdFtuYW1lXSA9IHRydWVcclxuXHRcdFx0XHRzZXRMb2dMZXZlbCBsb2dnZXJcclxuXHRcdFx0XHRyZXR1cm5cclxuXHJcblx0XHRpZiBub3RkZWZpbmVkKGhEZXNjKVxyXG5cdFx0XHRoUmVzdWx0W25hbWVdID0gdmFsdWVcclxuXHRcdFx0cmV0dXJuXHJcblx0XHR7dHlwZX0gOj0gZ2V0T3B0aW9uSW5mbyhoRGVzYywgbmFtZSlcclxuXHJcblx0XHQjIC0tLSB0eXBlIGNoZWNraW5nXHJcblx0XHRpZiBpc0FycmF5KHR5cGUpXHJcblx0XHRcdGFzc2VydCB0eXBlLmluY2x1ZGVzKHZhbHVlKSwgXCJ0eXBlIG5vdCBhbiBhcnJheVwiXHJcblx0XHRcdGhSZXN1bHRbbmFtZV0gPSB2YWx1ZVxyXG5cdFx0ZWxzZSBpZiBpc0Jvb2xlYW4odmFsdWUpXHJcblx0XHRcdGhSZXN1bHRbbmFtZV0gPSB2YWx1ZVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHQjIC0tLSBpdCdzIGEgc3RyaW5nXHJcblx0XHRcdGZsb2F0IDo9IHBhcnNlRmxvYXQodmFsdWUpXHJcblx0XHRcdGlmIChOdW1iZXIuaXNOYU4oZmxvYXQpKVxyXG5cdFx0XHRcdGhSZXN1bHRbbmFtZV0gPSB2YWx1ZVxyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0aFJlc3VsdFtuYW1lXSA9IGZsb2F0XHJcblx0XHRyZXR1cm5cclxuXHJcblx0YWRkTm9uT3B0aW9uIDo9IChzdHI6IHN0cmluZykgPT5cclxuXHRcdERCRyBcImFkZE5vbk9wdGlvbigje09MKHN0cil9KVwiXHJcblx0XHRsTm9uT3B0aW9ucy5wdXNoIHN0clxyXG5cclxuXHRmb3Igc3RyIG9mIGxBcmdzXHJcblx0XHQjIC0tLSBpZ25vcmUgJy0tJ1xyXG5cdFx0aWYgKHN0ciA9PSAnLS0nKVxyXG5cdFx0XHREQkcgXCJza2lwcGluZyAtLVwiXHJcblx0XHRcdGNvbnRpbnVlXHJcblxyXG5cdFx0IyAtLS0gY2hlY2sgaWYgaXQncyBhbiBvcHRpb25cclxuXHRcdGxNYXRjaGVzIDo9IHN0ci5tYXRjaCgvLy9eXHJcblx0XHRcdC1cclxuXHRcdFx0KFtBLVphLXowLTlfLV0qKVxyXG5cdFx0XHQoPzpcclxuXHRcdFx0XHQoPSlcclxuXHRcdFx0XHQoLiopXHJcblx0XHRcdFx0KT9cclxuXHRcdFx0JC8vLylcclxuXHRcdGlmIChsTWF0Y2hlcyA9PSBudWxsKVxyXG5cdFx0XHQjIC0tLSBpdCdzIGEgbm9uLW9wdGlvblxyXG5cdFx0XHRhZGROb25PcHRpb24gc3RyXHJcblx0XHRlbHNlXHJcblx0XHRcdCMgLS0tIGl0J3MgYW4gb3B0aW9uXHJcblx0XHRcdFtfLCBvcHRTdHIsIGVxU3RyLCB2YWx1ZVN0cl0gOj0gbE1hdGNoZXNcclxuXHRcdFx0aWYgZXFTdHJcclxuXHRcdFx0XHRhZGRPcHRpb24gb3B0U3RyLCB2YWx1ZVN0clxyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0Zm9yIGNoIG9mIG9wdFN0ci5zcGxpdCgnJylcclxuXHRcdFx0XHRcdGFkZE9wdGlvbiBjaCwgdHJ1ZVxyXG5cclxuXHQjIC0tLSBpZiBoRGVzYyBpcyBzZXQsIHRoZW5cclxuXHQjICAgICBGaWxsIGluIGRlZmF1bHQgdmFsdWVzIGlmIGF2YWlsYWJsZVxyXG5cclxuXHRpZiBkZWZpbmVkKGhEZXNjKVxyXG5cdFx0IyAtLS0gRmlsbCBpbiBtaXNzaW5nIGtleXMgd2l0aCBkZWZhdWx0IHZhbHVlc1xyXG5cdFx0REJHIFwiRmlsbGluZyBpbiBtaXNzaW5nIGtleXMgd2l0aCBkZWZhdWx0IHZhbHVlc1wiXHJcblx0XHRmb3IgbmFtZSBvZiBrZXlzKGhEZXNjLCBvJ2V4Y2VwdD1fJylcclxuXHRcdFx0aWYgbm90ZGVmaW5lZChoUmVzdWx0W25hbWVdKVxyXG5cdFx0XHRcdHtkZWZhdWx0VmFsfSA6PSBnZXRPcHRpb25JbmZvKGhEZXNjLCBuYW1lKVxyXG5cdFx0XHRcdGlmIGRlZmluZWQoZGVmYXVsdFZhbClcclxuXHRcdFx0XHRcdGhSZXN1bHRbbmFtZV0gPSBkZWZhdWx0VmFsXHJcblxyXG5cdFx0IyAtLS0gQ2hlY2sgb2YgdGhlcmUncyBhIHJlc3RyaWN0aW9uIG9uIHRoZSBudW1iZXIgb2Ygbm9uLW9wdGlvbnNcclxuXHRcdGlmICgnXycgaW4gaERlc2MpICYmIGlzQXJyYXkoaFJlc3VsdC5fKVxyXG5cdFx0XHRsZW4gOj0gaFJlc3VsdC5fLmxlbmd0aFxyXG5cdFx0XHREQkcgXCJDaGVjayBudW1iZXIgb2Ygbm9uLW9wdGlvbnMgKCN7bGVufSlcIlxyXG5cdFx0XHRoSW5mbyA6PSBnZXROb25PcHRpb25JbmZvKGhEZXNjKVxyXG5cdFx0XHREQkcgXCJOb24tb3B0aW9uIGluZm86ICN7T0woaEluZm8pfVwiXHJcblx0XHRcdGlmIGRlZmluZWQoaEluZm8pXHJcblx0XHRcdFx0e21pbiwgbWF4fSA6PSBoSW5mb1xyXG5cdFx0XHRcdGlmIGRlZmluZWQoaEluZm8ubWluKVxyXG5cdFx0XHRcdFx0YXNzZXJ0IChsZW4gPj0gaEluZm8ubWluKSwgXCIje2xlbn0gbm9uLW9wdGlvbnMgPCBtaW4gKCN7aEluZm8ubWlufSlcIlxyXG5cdFx0XHRcdGlmIGRlZmluZWQoaEluZm8ubWF4KVxyXG5cdFx0XHRcdFx0YXNzZXJ0IChsZW4gPD0gaEluZm8ubWF4KSwgXCIje2xlbn0gbm9uLW9wdGlvbnMgPiBtYXggKCN7aEluZm8ubWF4fSlcIlxyXG5cclxuXHREQkcgXCJoUmVzdWx0ID0gI3tPTChoUmVzdWx0KX1cIlxyXG5cdERCRyBcImxOb25PcHRpb25zID0gI3tPTChsTm9uT3B0aW9ucyl9XCJcclxuXHRyZXR1cm4gW2hSZXN1bHQsIGxOb25PcHRpb25zXVxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCBnZXRPcHRpb25JbmZvIDo9IChoRGVzYzogaGFzaCwgbmFtZTogc3RyaW5nKTogaGFzaCA9PlxyXG5cclxuXHQjIC0tLSBSZXR1cm4gdmFsdWUgaXMgYSBoYXNoIHdpdGgga2V5czogdHlwZSwgZGVzY1xyXG5cclxuXHRhc3NlcnQgKG5hbWUgIT0gJ18nKSwgXCJnZXRPcHRpb25JbmZvKGhEZXNjLCAnXycpIGNhbGxlZFwiXHJcblx0YXNzZXJ0IChuYW1lIGluIGhEZXNjKSwgXCJObyBzdWNoIG9wdGlvbjogLSN7bmFtZX1cIlxyXG5cdGggOj0gaXNIYXNoKGhEZXNjW25hbWVdKSA/IGhEZXNjW25hbWVdIDoge2Rlc2M6IGhEZXNjW25hbWVdfVxyXG5cdGlmIG5vdGRlZmluZWQoaC50eXBlKVxyXG5cdFx0aC50eXBlID0gKG5hbWUubGVuZ3RoID09IDEpID8gJ2Jvb2xlYW4nIDogJ3N0cmluZydcclxuXHRpZiBub3RkZWZpbmVkKGguZGVzYylcclxuXHRcdGguZGVzYyA9ICc8bm8gZGVzY3JpcHRpb24gYXZhaWxhYmxlPidcclxuXHRpZiAoJ2RlZmF1bHRWYWwnIG5vdCBpbiBoKSAmJiAoaC50eXBlID09ICdib29sZWFuJylcclxuXHRcdGguZGVmYXVsdFZhbCA9IGZhbHNlXHJcblx0cmV0dXJuIGhcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiMgLS0tIHJldHVybnMgdW5kZWYgaWYgbm8gJ18nIGtleSBpbiBoRGVzY1xyXG5cclxudHlwZSBUTm9uT3B0aW9uSW5mbyA9IHtcclxuXHRkZXNjOiBzdHJpbmdcclxuXHRtaW46IG51bWJlclxyXG5cdG1heDogbnVtYmVyXHJcblx0fVxyXG5cclxuZXhwb3J0IGdldE5vbk9wdGlvbkluZm8gOj0gKGhEZXNjOiBoYXNoKTogVE5vbk9wdGlvbkluZm8/ID0+XHJcblxyXG5cdERCRyBcImhEZXNjID0gI3tPTChoRGVzYyl9XCJcclxuXHRpZiAoJ18nIG5vdCBpbiBoRGVzYylcclxuXHRcdERCRyBcIk5vICdfJyBrZXkgaW4gaERlc2NcIlxyXG5cdFx0cmV0dXJuIHVuZGVmXHJcblx0aCA6PSBoRGVzYy5fXHJcblx0aWYgbm90IGlzSGFzaChoKVxyXG5cdFx0REJHIFwiaERlc2MuXyBub3QgYSBoYXNoXCJcclxuXHRcdHJldHVybiB1bmRlZlxyXG5cdGxldCB7ZGVzYywgcmFuZ2V9ID0gaFxyXG5cdHJlYWxEZXNjIDo9IChcclxuXHRcdCAgaXNFbXB0eShkZXNjKSAgPyAnPG5vIGRlc2NyaXB0aW9uIGF2YWlsYWJsZT4nXHJcblx0XHQ6IGlzU3RyaW5nKGRlc2MpID8gZGVzY1xyXG5cdFx0OiBcIjxiYWQgXyBkZXNjcmlwdGlvbj5cIlxyXG5cdFx0KVxyXG5cdERCRyBcImRlc2MgPSAje2Rlc2N9XCJcclxuXHRpZiBub3RkZWZpbmVkKHJhbmdlKVxyXG5cdFx0REJHIFwiTm8gcmFuZ2Uga2V5XCJcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGRlc2M6IHJlYWxEZXNjXHJcblx0XHRcdG1pbjogMFxyXG5cdFx0XHRtYXg6IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSXHJcblx0XHRcdH1cclxuXHJcblx0REJHIFwicmFuZ2UgPSAje09MKHJhbmdlKX1cIlxyXG5cdGlmIGlzSW50ZWdlcihyYW5nZSlcclxuXHRcdERCRyBcIkludGVnZXIgcmFuZ2U6ICN7cmFuZ2V9XCJcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGRlc2M6IHJlYWxEZXNjXHJcblx0XHRcdG1pbjogcmFuZ2VcclxuXHRcdFx0bWF4OiByYW5nZVxyXG5cdFx0XHR9XHJcblx0ZWxzZSBpZiBpc0FycmF5KHJhbmdlKVxyXG5cdFx0YXNzZXJ0IChyYW5nZS5sZW5ndGggPT0gMiksIFwiQmFkICdfJyBrZXk6ICN7T0wocmFuZ2UpfVwiXHJcblx0XHRbbWluLCBtYXhdIDo9IHJhbmdlXHJcblx0XHREQkcgXCJBcnJheSByYW5nZTogI3ttaW59Li4je21heH1cIlxyXG5cdFx0aWYgaXNJbnRlZ2VyKG1pbikgJiYgaXNJbnRlZ2VyKG1heClcclxuXHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRkZXNjOiByZWFsRGVzY1xyXG5cdFx0XHRcdG1pblxyXG5cdFx0XHRcdG1heFxyXG5cdFx0XHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdFx0Y3JvYWsgXCJyYW5nZSBtaW4gb3IgbWF4IG5vdCBhbiBpbnRlZ2VyOiAje09MKG1pbil9Li4je09MKG1heCl9XCJcclxuXHRlbHNlXHJcblx0XHRjcm9hayBcIkludmFsaWQgcmFuZ2U6ICN7T0wocmFuZ2UpfVwiXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuY250U3RyIDo9IChuOiBudW1iZXIsIHN0cjogc3RyaW5nKTogc3RyaW5nID0+XHJcblx0cmV0dXJuIChuPT0xKSA/IFwiMSAje3N0cn1cIiA6IFwiI3tufSAje3N0cn1zXCJcclxuXHJcbmV4cG9ydCBoZWxwU3RyIDo9IChoRGVzYzogaGFzaCk6IHN0cmluZyA9PlxyXG5cclxuXHRsTGluZXMgOj0gW1wiQXZhaWxhYmxlIG9wdGlvbnM6XCJdXHJcblx0cHVzaCA6PSAoc3RyOiBzdHJpbmcsIGxldmVsOiBudW1iZXI9MCk6IHZvaWQgPT5cclxuXHRcdGxMaW5lcy5wdXNoIHNwYWNlcygzKmxldmVsKSArIHN0clxyXG5cclxuXHRmb3IgbmFtZSBvZiBrZXlzKGhEZXNjLCB7bEV4Y2VwdDogJ18nfSlcclxuXHRcdHt0eXBlLCBkZXNjfSA6PSBnZXRPcHRpb25JbmZvKGhEZXNjLCBuYW1lKVxyXG5cdFx0cHVzaCBcIi0je25hbWV9OiAje3R5cGV9IC0gI3tkZXNjfVwiLCAxXHJcblx0aWYgZGVmaW5lZChoRGVzYy5fKVxyXG5cdFx0cHVzaCBcIk5vbi1vcHRpb25zOlwiXHJcblx0XHRoSW5mbyA6PSBnZXROb25PcHRpb25JbmZvKGhEZXNjKVxyXG5cdFx0aWYgZGVmaW5lZChoSW5mbylcclxuXHRcdFx0e2Rlc2MsIG1pbiwgbWF4fSA6PSBoSW5mb1xyXG5cdFx0XHRwdXNoIGRlc2MsIDFcclxuXHRcdFx0aWYgKG1pbiA9PSBtYXgpXHJcblx0XHRcdFx0cHVzaCBcIlRoZXJlIG11c3QgYmUgZXhhY3RseSAje21pbn0gbm9uLW9wdGlvbnNcIiwgMVxyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0aWYgKG1pbiA+IDApXHJcblx0XHRcdFx0XHRwdXNoIFwiVGhlcmUgbXVzdCBiZSBhdCBsZWFzdCAje2NudFN0cihtaW4sICdub24tb3B0aW9uJyl9XCIsIDFcclxuXHRcdFx0XHRpZiAobWF4IDwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpXHJcblx0XHRcdFx0XHRwdXNoIFwiVGhlcmUgbXVzdCBiZSBhdCBtb3N0ICN7Y250U3RyKG1heCwgJ25vbi1vcHRpb24nKX1cIiwgMVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRjcm9hayBcIkJhZCBkZXNjcmlwdG9yIGZvciAnXydcIlxyXG5cdHJldHVybiBsTGluZXMuam9pbignXFxuJylcclxuIl19