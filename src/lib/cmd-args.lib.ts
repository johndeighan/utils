"use strict";
// cmd-args.lib.civet

import {mapNonOption} from 'base-utils'
import {
	undef, defined, notdefined, assert, croak,
	hash, hashof,
	isEmpty, isArray, isBoolean, isInteger, isHash, isString,
	} from 'datatypes'
import {
	keys, getOptions, o, spaces,
	} from 'llutils'
import {OL, DUMP} from 'to-nice'
import {
	TLogLevel, setLogLevel,
	} from 'log-levels'
import {LOG, DBG} from 'logger'
import {execCmd} from 'base-utils'

// ---------------------------------------------------------------------------

const hKeyToLogLevel: hashof<TLogLevel> = {
	P: 'profile',
	D: 'debug',
	I: 'info',
	W: 'warn',
	E: 'error',
	S: 'silent',
	N: 'none'
	}

export const logLevelFromArgs = (lArgs: string[]): (TLogLevel | undefined) => {

	for (const str of lArgs) {
		const lMatches = str.match(/^-([A-Za-z0-9_-]*)(=)?/)
		if (defined(lMatches)) {
			const keyStr = lMatches[1]
			const hasEq = lMatches[2]
			if (isEmpty(hasEq)) {
				for (const key of keys(hKeyToLogLevel)) {
					if (keyStr.includes(key)) {
						return hKeyToLogLevel[key]
					}
				}
			}
		}
	}
	return undef
}

// ---------------------------------------------------------------------------

type TCmdArgs = {
	[key: string]: unknown
	}

// --- Return a hash of args and an array of non-options

export const getCmdArgs = (
	hDesc: (hash | undefined) = undef,
	lArgs: string[] = Deno.args,
	hOptions: hash = {}
	): [TCmdArgs, string[]] => {

	type opt = {
		doSetLogger: boolean
		}
	const {doSetLogger} = getOptions<opt>(hOptions, {
		doSetLogger: true
		})

	if (lArgs.at(-1) === '!') {
		execCmd('clear')
		lArgs.pop()
	}

	if (doSetLogger && defined(hDesc)) {
		// --- Make sure hDesc does NOT include any of:
		//        P, D, Q, I, S
		for (const key of keys(hKeyToLogLevel)) {
			assert(notdefined(hDesc[key]),
					`invalid key ${OL(key)} set in hDesc`)
		}
		const logLevel = logLevelFromArgs(lArgs)
		if (defined(logLevel)) {
			setLogLevel(logLevel)
		}
	}

	if (defined(hDesc)) {
		DBG(`hDesc is: ${OL(hDesc)}`)
	}
	DBG(`lArgs is: ${OL(lArgs)}`)

	if (lArgs.includes('-h')) {
		if (defined(hDesc)) {
			LOG(helpStr(hDesc))
		}
		else {
			LOG("No help available")
		}
		Deno.exit(0)
	}

	const hResult: TCmdArgs = {}
	const lNonOptions: string[] = []

	// --- Utility functions

	// --- Even gets called for -D, -Q, -P, -S
	const addOption = (name: string, value: string | boolean) => {
		DBG(`addOption(${OL(name)}, ${OL(value)})`)
		assert((!(name in hResult)),
				`dup key ${name}, hResult = ${OL(hResult)}`)

		if (doSetLogger) {
			const logger = hKeyToLogLevel[name]
			if (defined(logger)) {
				hResult[name] = true
				setLogLevel(logger)
				return
			}
		}

		if (notdefined(hDesc)) {
			hResult[name] = value
			return
		}
		const {type} = getOptionInfo(hDesc, name)

		// --- type checking
		if (isArray(type)) {
			assert(type.includes(value), "type not an array")
			hResult[name] = value
		}
		else if (isBoolean(value)) {
			hResult[name] = value
		}
		else {
			// --- it's a string
			const float = parseFloat(value)
			if (Number.isNaN(float)) {
				hResult[name] = value
			}
			else {
				hResult[name] = float
			}
		}
		return
	}

	const addNonOption = (str: string) => {
		DBG(`addNonOption(${OL(str)})`)
		lNonOptions.push(mapNonOption(str))
	}

	for (const str of lArgs) {
		// --- ignore '--'
		if (str === '--') {
			DBG("skipping --")
			continue
		}

		// --- check if it's an option
		const lMatches = str.match(/^-([A-Za-z0-9_-]*)(?:(=)(.*))?$/)
		if (lMatches === null) {
			// --- it's a non-option
			addNonOption(str)
		}
		else {
			// --- it's an option
			const [_, optStr, eqStr, valueStr] = lMatches
			if (eqStr) {
				addOption(optStr, valueStr)
			}
			else {
				for (const ch of optStr.split('')) {
					addOption(ch, true)
				}
			}
		}
	}

	// --- if hDesc is set, then
	//     Fill in default values if available

	if (defined(hDesc)) {
		// --- Fill in missing keys with default values
		DBG("Filling in missing keys with default values")
		for (const name of keys(hDesc)) {
			if ((name !== '_') && notdefined(hResult[name])) {
				const {defaultVal} = getOptionInfo(hDesc, name)
				if (defined(defaultVal)) {
					hResult[name] = defaultVal
				}
			}
		}

		// --- Check of there's a restriction on the number of non-options
		if (('_' in hDesc) && isArray(hResult._)) {
			const len = hResult._.length
			DBG(`Check number of non-options (${len})`)
			const hInfo = getNonOptionInfo(hDesc)
			DBG(`Non-option info: ${OL(hInfo)}`)
			if (defined(hInfo)) {
				const {min, max} = hInfo
				if (defined(hInfo.min)) {
					assert((len >= hInfo.min), `${len} non-options < min (${hInfo.min})`)
				}
				if (defined(hInfo.max)) {
					assert((len <= hInfo.max), `${len} non-options > max (${hInfo.max})`)
				}
			}
		}
	}

	DBG(`hResult = ${OL(hResult)}`)
	DBG(`lNonOptions = ${OL(lNonOptions)}`)
	return [hResult, lNonOptions]
}

// ---------------------------------------------------------------------------

export const getOptionInfo = (hDesc: hash, name: string): hash => {

	// --- Return value is a hash with keys: type, desc

	assert((name !== '_'), "getOptionInfo(hDesc, '_') called")
	assert((name in hDesc), `No such option: -${name}`)
	const h = isHash(hDesc[name]) ? hDesc[name] : {desc: hDesc[name]}
	if (notdefined(h.type)) {
		h.type = (name.length === 1) ? 'boolean' : 'string'
	}
	if (notdefined(h.desc)) {
		h.desc = '<no description available>'
	}
	if ((!('defaultVal' in h)) && (h.type === 'boolean')) {
		h.defaultVal = false
	}
	return h
}

// ---------------------------------------------------------------------------
// --- returns undef if no '_' key in hDesc

type TNonOptionInfo = {
	desc: string
	min: number
	max: number
	}

export const getNonOptionInfo = (hDesc: hash): (TNonOptionInfo | undefined) => {

	DBG(`hDesc = ${OL(hDesc)}`)
	if (!('_' in hDesc)) {
		DBG("No '_' key in hDesc")
		return undef
	}
	const h = hDesc._
	if (!isHash(h)) {
		DBG("hDesc._ not a hash")
		return undef
	}
	let {desc, range} = h
	const realDesc = (
		  isEmpty(desc)  ? '<no description available>'
		: isString(desc) ? desc
		: "<bad _ description>"
		)
	DBG(`desc = ${desc}`)
	if (notdefined(range)) {
		DBG("No range key")
		return {
			desc: realDesc,
			min: 0,
			max: Number.MAX_SAFE_INTEGER
			}
	}

	DBG(`range = ${OL(range)}`)
	if (isInteger(range)) {
		DBG(`Integer range: ${range}`)
		return {
			desc: realDesc,
			min: range,
			max: range
			}
	}
	else if (isArray(range)) {
		assert((range.length === 2), `Bad '_' key: ${OL(range)}`)
		const [min, max] = range
		DBG(`Array range: ${min}..${max}`)
		if (isInteger(min) && isInteger(max)) {
			return {
				desc: realDesc,
				min,
				max
				}
		}
		else {
			croak(`range min or max not an integer: ${OL(min)}..${OL(max)}`)
		}
	}
	else {
		croak(`Invalid range: ${OL(range)}`)
	}
}

// ---------------------------------------------------------------------------

const cntStr = (n: number, str: string): string => {
	return (n===1) ? `1 ${str}` : `${n} ${str}s`
}

export const helpStr = (hDesc: hash): string => {

	const lLines = ["Available options:"]

	// --- define a utility function
	const push = (str: string, level: number=0): void => {
		lLines.push(spaces(3*level) + str)
	}

	for (const name of keys(hDesc)) {
		if (name !== '_') {
			const {type, desc} = getOptionInfo(hDesc, name)
			push(`-${name}: ${type} - ${desc}`, 1)
		}
	}
	if (defined(hDesc._)) {
		push("Non-options:")
		const hInfo = getNonOptionInfo(hDesc)
		if (defined(hInfo)) {
			const {desc, min, max} = hInfo
			push(desc, 1)
			if (min === max) {
				push(`There must be exactly ${min} non-options`, 1)
			}
			else {
				if (min > 0) {
					push(`There must be at least ${cntStr(min, 'non-option')}`, 1)
				}
				if (max < Number.MAX_SAFE_INTEGER) {
					push(`There must be at most ${cntStr(max, 'non-option')}`, 1)
				}
			}
		}
		else {
			DUMP(hDesc._)
			croak("Bad descriptor for '_'")
		}
	}
	return lLines.join('\n')
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvam9obmQvdXRpbHMvc3JjL2xpYi9jbWQtYXJncy5saWIuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJDOi9Vc2Vycy9qb2huZC91dGlscy9zcmMvbGliL2NtZC1hcmdzLmxpYi5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLHFCQUFvQjtBQUNwQixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWTtBQUN2QyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQztBQUMzQyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUNkLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDO0FBQzFELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXO0FBQ25CLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsSUFBSSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0FBQzdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQ2pCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUztBQUNoQyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsQ0FBQztBQUN4QixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWTtBQUNwQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVE7QUFDL0IsQUFB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QUEsS0FBSyxJQUFJLENBQUEsQUFBQyxDQUFDLHVCQUF1QixFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEM7SUFBQSxDQUFBO0FBQ2xFLEFBQUEsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQSxDQUFBO0FBQ3RDLEFBQUEsS0FBSyxJQUFJLENBQUEsQUFBQyxDQUFDLHNCQUFzQixFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEM7SUFBQSxDO0dBQUEsQztFQUFBLENBQUE7QUFDakUsQUFBQSxFQUFFLElBQUksQ0FBQSxDQUFBO0FBQ04sQUFBQSxHQUFHLElBQUksQ0FBQSxBQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7QUFDZixBQUFBLEdBQUcsS0FBSyxDQUFBLEFBQUMsd0JBQXdCLEM7RUFBQSxDO0NBQUEsQ0FBQTtBQUNqQyxBQUFBLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDO0FBQUMsQ0FBQTtBQUN6QiIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyBjbWQtYXJncy5saWIuY2l2ZXRcclxuXHJcbmltcG9ydCB7bWFwTm9uT3B0aW9ufSBmcm9tICdiYXNlLXV0aWxzJ1xyXG5pbXBvcnQge1xyXG5cdHVuZGVmLCBkZWZpbmVkLCBub3RkZWZpbmVkLCBhc3NlcnQsIGNyb2FrLFxyXG5cdGhhc2gsIGhhc2hvZixcclxuXHRpc0VtcHR5LCBpc0FycmF5LCBpc0Jvb2xlYW4sIGlzSW50ZWdlciwgaXNIYXNoLCBpc1N0cmluZyxcclxuXHR9IGZyb20gJ2RhdGF0eXBlcydcclxuaW1wb3J0IHtcclxuXHRrZXlzLCBnZXRPcHRpb25zLCBvLCBzcGFjZXMsXHJcblx0fSBmcm9tICdsbHV0aWxzJ1xyXG5pbXBvcnQge09MLCBEVU1QfSBmcm9tICd0by1uaWNlJ1xyXG5pbXBvcnQge1xyXG5cdFRMb2dMZXZlbCwgc2V0TG9nTGV2ZWwsXHJcblx0fSBmcm9tICdsb2ctbGV2ZWxzJ1xyXG5pbXBvcnQge0xPRywgREJHfSBmcm9tICdsb2dnZXInXHJcbmltcG9ydCB7ZXhlY0NtZH0gZnJvbSAnYmFzZS11dGlscydcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5oS2V5VG9Mb2dMZXZlbDogaGFzaG9mPFRMb2dMZXZlbD4gOj0ge1xyXG5cdFA6ICdwcm9maWxlJ1xyXG5cdEQ6ICdkZWJ1ZydcclxuXHRJOiAnaW5mbydcclxuXHRXOiAnd2FybidcclxuXHRFOiAnZXJyb3InXHJcblx0UzogJ3NpbGVudCdcclxuXHROOiAnbm9uZSdcclxuXHR9XHJcblxyXG5leHBvcnQgbG9nTGV2ZWxGcm9tQXJncyA6PSAobEFyZ3M6IHN0cmluZ1tdKTogVExvZ0xldmVsPyA9PlxyXG5cclxuXHRmb3Igc3RyIG9mIGxBcmdzXHJcblx0XHRsTWF0Y2hlcyA6PSBzdHIubWF0Y2goLy8vXlxyXG5cdFx0XHQtXHJcblx0XHRcdChbQS1aYS16MC05Xy1dKilcclxuXHRcdFx0KD0pP1xyXG5cdFx0XHQvLy8pXHJcblx0XHRpZiBkZWZpbmVkKGxNYXRjaGVzKVxyXG5cdFx0XHRrZXlTdHIgOj0gbE1hdGNoZXNbMV1cclxuXHRcdFx0aGFzRXEgOj0gbE1hdGNoZXNbMl1cclxuXHRcdFx0aWYgaXNFbXB0eShoYXNFcSlcclxuXHRcdFx0XHRmb3Iga2V5IG9mIGtleXMoaEtleVRvTG9nTGV2ZWwpXHJcblx0XHRcdFx0XHRpZiBrZXlTdHIuaW5jbHVkZXMoa2V5KVxyXG5cdFx0XHRcdFx0XHRyZXR1cm4gaEtleVRvTG9nTGV2ZWxba2V5XVxyXG5cdHJldHVybiB1bmRlZlxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbnR5cGUgVENtZEFyZ3MgPSB7XHJcblx0W2tleTogc3RyaW5nXTogdW5rbm93blxyXG5cdH1cclxuXHJcbiMgLS0tIFJldHVybiBhIGhhc2ggb2YgYXJncyBhbmQgYW4gYXJyYXkgb2Ygbm9uLW9wdGlvbnNcclxuXHJcbmV4cG9ydCBnZXRDbWRBcmdzIDo9IChcclxuXHRoRGVzYzogaGFzaD8gPSB1bmRlZixcclxuXHRsQXJnczogc3RyaW5nW10gPSBEZW5vLmFyZ3MsXHJcblx0aE9wdGlvbnM6IGhhc2ggPSB7fVxyXG5cdCk6IFtUQ21kQXJncywgc3RyaW5nW11dID0+XHJcblxyXG5cdHR5cGUgb3B0ID0ge1xyXG5cdFx0ZG9TZXRMb2dnZXI6IGJvb2xlYW5cclxuXHRcdH1cclxuXHR7ZG9TZXRMb2dnZXJ9IDo9IGdldE9wdGlvbnM8b3B0PiBoT3B0aW9ucywge1xyXG5cdFx0ZG9TZXRMb2dnZXI6IHRydWVcclxuXHRcdH1cclxuXHJcblx0aWYgKGxBcmdzLmF0KC0xKSA9PSAnIScpXHJcblx0XHRleGVjQ21kICdjbGVhcidcclxuXHRcdGxBcmdzLnBvcCgpXHJcblxyXG5cdGlmIGRvU2V0TG9nZ2VyICYmIGRlZmluZWQoaERlc2MpXHJcblx0XHQjIC0tLSBNYWtlIHN1cmUgaERlc2MgZG9lcyBOT1QgaW5jbHVkZSBhbnkgb2Y6XHJcblx0XHQjICAgICAgICBQLCBELCBRLCBJLCBTXHJcblx0XHRmb3Iga2V5IG9mIGtleXMoaEtleVRvTG9nTGV2ZWwpXHJcblx0XHRcdGFzc2VydCBub3RkZWZpbmVkKGhEZXNjW2tleV0pLFxyXG5cdFx0XHRcdFx0XCJpbnZhbGlkIGtleSAje09MKGtleSl9IHNldCBpbiBoRGVzY1wiXHJcblx0XHRsb2dMZXZlbCA6PSBsb2dMZXZlbEZyb21BcmdzKGxBcmdzKVxyXG5cdFx0aWYgZGVmaW5lZChsb2dMZXZlbClcclxuXHRcdFx0c2V0TG9nTGV2ZWwgbG9nTGV2ZWxcclxuXHJcblx0aWYgZGVmaW5lZChoRGVzYylcclxuXHRcdERCRyBcImhEZXNjIGlzOiAje09MKGhEZXNjKX1cIlxyXG5cdERCRyBcImxBcmdzIGlzOiAje09MKGxBcmdzKX1cIlxyXG5cclxuXHRpZiBsQXJncy5pbmNsdWRlcygnLWgnKVxyXG5cdFx0aWYgZGVmaW5lZChoRGVzYylcclxuXHRcdFx0TE9HIGhlbHBTdHIoaERlc2MpXHJcblx0XHRlbHNlXHJcblx0XHRcdExPRyBcIk5vIGhlbHAgYXZhaWxhYmxlXCJcclxuXHRcdERlbm8uZXhpdCgwKVxyXG5cclxuXHRoUmVzdWx0OiBUQ21kQXJncyA6PSB7fVxyXG5cdGxOb25PcHRpb25zOiBzdHJpbmdbXSA6PSBbXVxyXG5cclxuXHQjIC0tLSBVdGlsaXR5IGZ1bmN0aW9uc1xyXG5cclxuXHQjIC0tLSBFdmVuIGdldHMgY2FsbGVkIGZvciAtRCwgLVEsIC1QLCAtU1xyXG5cdGFkZE9wdGlvbiA6PSAobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgYm9vbGVhbikgPT5cclxuXHRcdERCRyBcImFkZE9wdGlvbigje09MKG5hbWUpfSwgI3tPTCh2YWx1ZSl9KVwiXHJcblx0XHRhc3NlcnQgKG5hbWUgbm90IGluIGhSZXN1bHQpLFxyXG5cdFx0XHRcdFwiZHVwIGtleSAje25hbWV9LCBoUmVzdWx0ID0gI3tPTChoUmVzdWx0KX1cIlxyXG5cclxuXHRcdGlmIGRvU2V0TG9nZ2VyXHJcblx0XHRcdGxvZ2dlciA6PSBoS2V5VG9Mb2dMZXZlbFtuYW1lXVxyXG5cdFx0XHRpZiBkZWZpbmVkKGxvZ2dlcilcclxuXHRcdFx0XHRoUmVzdWx0W25hbWVdID0gdHJ1ZVxyXG5cdFx0XHRcdHNldExvZ0xldmVsIGxvZ2dlclxyXG5cdFx0XHRcdHJldHVyblxyXG5cclxuXHRcdGlmIG5vdGRlZmluZWQoaERlc2MpXHJcblx0XHRcdGhSZXN1bHRbbmFtZV0gPSB2YWx1ZVxyXG5cdFx0XHRyZXR1cm5cclxuXHRcdHt0eXBlfSA6PSBnZXRPcHRpb25JbmZvKGhEZXNjLCBuYW1lKVxyXG5cclxuXHRcdCMgLS0tIHR5cGUgY2hlY2tpbmdcclxuXHRcdGlmIGlzQXJyYXkodHlwZSlcclxuXHRcdFx0YXNzZXJ0IHR5cGUuaW5jbHVkZXModmFsdWUpLCBcInR5cGUgbm90IGFuIGFycmF5XCJcclxuXHRcdFx0aFJlc3VsdFtuYW1lXSA9IHZhbHVlXHJcblx0XHRlbHNlIGlmIGlzQm9vbGVhbih2YWx1ZSlcclxuXHRcdFx0aFJlc3VsdFtuYW1lXSA9IHZhbHVlXHJcblx0XHRlbHNlXHJcblx0XHRcdCMgLS0tIGl0J3MgYSBzdHJpbmdcclxuXHRcdFx0ZmxvYXQgOj0gcGFyc2VGbG9hdCh2YWx1ZSlcclxuXHRcdFx0aWYgKE51bWJlci5pc05hTihmbG9hdCkpXHJcblx0XHRcdFx0aFJlc3VsdFtuYW1lXSA9IHZhbHVlXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRoUmVzdWx0W25hbWVdID0gZmxvYXRcclxuXHRcdHJldHVyblxyXG5cclxuXHRhZGROb25PcHRpb24gOj0gKHN0cjogc3RyaW5nKSA9PlxyXG5cdFx0REJHIFwiYWRkTm9uT3B0aW9uKCN7T0woc3RyKX0pXCJcclxuXHRcdGxOb25PcHRpb25zLnB1c2ggbWFwTm9uT3B0aW9uKHN0cilcclxuXHJcblx0Zm9yIHN0ciBvZiBsQXJnc1xyXG5cdFx0IyAtLS0gaWdub3JlICctLSdcclxuXHRcdGlmIChzdHIgPT0gJy0tJylcclxuXHRcdFx0REJHIFwic2tpcHBpbmcgLS1cIlxyXG5cdFx0XHRjb250aW51ZVxyXG5cclxuXHRcdCMgLS0tIGNoZWNrIGlmIGl0J3MgYW4gb3B0aW9uXHJcblx0XHRsTWF0Y2hlcyA6PSBzdHIubWF0Y2goLy8vXlxyXG5cdFx0XHQtXHJcblx0XHRcdChbQS1aYS16MC05Xy1dKilcclxuXHRcdFx0KD86XHJcblx0XHRcdFx0KD0pXHJcblx0XHRcdFx0KC4qKVxyXG5cdFx0XHRcdCk/XHJcblx0XHRcdCQvLy8pXHJcblx0XHRpZiAobE1hdGNoZXMgPT0gbnVsbClcclxuXHRcdFx0IyAtLS0gaXQncyBhIG5vbi1vcHRpb25cclxuXHRcdFx0YWRkTm9uT3B0aW9uIHN0clxyXG5cdFx0ZWxzZVxyXG5cdFx0XHQjIC0tLSBpdCdzIGFuIG9wdGlvblxyXG5cdFx0XHRbXywgb3B0U3RyLCBlcVN0ciwgdmFsdWVTdHJdIDo9IGxNYXRjaGVzXHJcblx0XHRcdGlmIGVxU3RyXHJcblx0XHRcdFx0YWRkT3B0aW9uIG9wdFN0ciwgdmFsdWVTdHJcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGZvciBjaCBvZiBvcHRTdHIuc3BsaXQoJycpXHJcblx0XHRcdFx0XHRhZGRPcHRpb24gY2gsIHRydWVcclxuXHJcblx0IyAtLS0gaWYgaERlc2MgaXMgc2V0LCB0aGVuXHJcblx0IyAgICAgRmlsbCBpbiBkZWZhdWx0IHZhbHVlcyBpZiBhdmFpbGFibGVcclxuXHJcblx0aWYgZGVmaW5lZChoRGVzYylcclxuXHRcdCMgLS0tIEZpbGwgaW4gbWlzc2luZyBrZXlzIHdpdGggZGVmYXVsdCB2YWx1ZXNcclxuXHRcdERCRyBcIkZpbGxpbmcgaW4gbWlzc2luZyBrZXlzIHdpdGggZGVmYXVsdCB2YWx1ZXNcIlxyXG5cdFx0Zm9yIG5hbWUgb2Yga2V5cyhoRGVzYylcclxuXHRcdFx0aWYgKG5hbWUgIT0gJ18nKSAmJiBub3RkZWZpbmVkKGhSZXN1bHRbbmFtZV0pXHJcblx0XHRcdFx0e2RlZmF1bHRWYWx9IDo9IGdldE9wdGlvbkluZm8oaERlc2MsIG5hbWUpXHJcblx0XHRcdFx0aWYgZGVmaW5lZChkZWZhdWx0VmFsKVxyXG5cdFx0XHRcdFx0aFJlc3VsdFtuYW1lXSA9IGRlZmF1bHRWYWxcclxuXHJcblx0XHQjIC0tLSBDaGVjayBvZiB0aGVyZSdzIGEgcmVzdHJpY3Rpb24gb24gdGhlIG51bWJlciBvZiBub24tb3B0aW9uc1xyXG5cdFx0aWYgKCdfJyBpbiBoRGVzYykgJiYgaXNBcnJheShoUmVzdWx0Ll8pXHJcblx0XHRcdGxlbiA6PSBoUmVzdWx0Ll8ubGVuZ3RoXHJcblx0XHRcdERCRyBcIkNoZWNrIG51bWJlciBvZiBub24tb3B0aW9ucyAoI3tsZW59KVwiXHJcblx0XHRcdGhJbmZvIDo9IGdldE5vbk9wdGlvbkluZm8oaERlc2MpXHJcblx0XHRcdERCRyBcIk5vbi1vcHRpb24gaW5mbzogI3tPTChoSW5mbyl9XCJcclxuXHRcdFx0aWYgZGVmaW5lZChoSW5mbylcclxuXHRcdFx0XHR7bWluLCBtYXh9IDo9IGhJbmZvXHJcblx0XHRcdFx0aWYgZGVmaW5lZChoSW5mby5taW4pXHJcblx0XHRcdFx0XHRhc3NlcnQgKGxlbiA+PSBoSW5mby5taW4pLCBcIiN7bGVufSBub24tb3B0aW9ucyA8IG1pbiAoI3toSW5mby5taW59KVwiXHJcblx0XHRcdFx0aWYgZGVmaW5lZChoSW5mby5tYXgpXHJcblx0XHRcdFx0XHRhc3NlcnQgKGxlbiA8PSBoSW5mby5tYXgpLCBcIiN7bGVufSBub24tb3B0aW9ucyA+IG1heCAoI3toSW5mby5tYXh9KVwiXHJcblxyXG5cdERCRyBcImhSZXN1bHQgPSAje09MKGhSZXN1bHQpfVwiXHJcblx0REJHIFwibE5vbk9wdGlvbnMgPSAje09MKGxOb25PcHRpb25zKX1cIlxyXG5cdHJldHVybiBbaFJlc3VsdCwgbE5vbk9wdGlvbnNdXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IGdldE9wdGlvbkluZm8gOj0gKGhEZXNjOiBoYXNoLCBuYW1lOiBzdHJpbmcpOiBoYXNoID0+XHJcblxyXG5cdCMgLS0tIFJldHVybiB2YWx1ZSBpcyBhIGhhc2ggd2l0aCBrZXlzOiB0eXBlLCBkZXNjXHJcblxyXG5cdGFzc2VydCAobmFtZSAhPSAnXycpLCBcImdldE9wdGlvbkluZm8oaERlc2MsICdfJykgY2FsbGVkXCJcclxuXHRhc3NlcnQgKG5hbWUgaW4gaERlc2MpLCBcIk5vIHN1Y2ggb3B0aW9uOiAtI3tuYW1lfVwiXHJcblx0aCA6PSBpc0hhc2goaERlc2NbbmFtZV0pID8gaERlc2NbbmFtZV0gOiB7ZGVzYzogaERlc2NbbmFtZV19XHJcblx0aWYgbm90ZGVmaW5lZChoLnR5cGUpXHJcblx0XHRoLnR5cGUgPSAobmFtZS5sZW5ndGggPT0gMSkgPyAnYm9vbGVhbicgOiAnc3RyaW5nJ1xyXG5cdGlmIG5vdGRlZmluZWQoaC5kZXNjKVxyXG5cdFx0aC5kZXNjID0gJzxubyBkZXNjcmlwdGlvbiBhdmFpbGFibGU+J1xyXG5cdGlmICgnZGVmYXVsdFZhbCcgbm90IGluIGgpICYmIChoLnR5cGUgPT0gJ2Jvb2xlYW4nKVxyXG5cdFx0aC5kZWZhdWx0VmFsID0gZmFsc2VcclxuXHRyZXR1cm4gaFxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuIyAtLS0gcmV0dXJucyB1bmRlZiBpZiBubyAnXycga2V5IGluIGhEZXNjXHJcblxyXG50eXBlIFROb25PcHRpb25JbmZvID0ge1xyXG5cdGRlc2M6IHN0cmluZ1xyXG5cdG1pbjogbnVtYmVyXHJcblx0bWF4OiBudW1iZXJcclxuXHR9XHJcblxyXG5leHBvcnQgZ2V0Tm9uT3B0aW9uSW5mbyA6PSAoaERlc2M6IGhhc2gpOiBUTm9uT3B0aW9uSW5mbz8gPT5cclxuXHJcblx0REJHIFwiaERlc2MgPSAje09MKGhEZXNjKX1cIlxyXG5cdGlmICgnXycgbm90IGluIGhEZXNjKVxyXG5cdFx0REJHIFwiTm8gJ18nIGtleSBpbiBoRGVzY1wiXHJcblx0XHRyZXR1cm4gdW5kZWZcclxuXHRoIDo9IGhEZXNjLl9cclxuXHRpZiBub3QgaXNIYXNoKGgpXHJcblx0XHREQkcgXCJoRGVzYy5fIG5vdCBhIGhhc2hcIlxyXG5cdFx0cmV0dXJuIHVuZGVmXHJcblx0bGV0IHtkZXNjLCByYW5nZX0gPSBoXHJcblx0cmVhbERlc2MgOj0gKFxyXG5cdFx0ICBpc0VtcHR5KGRlc2MpICA/ICc8bm8gZGVzY3JpcHRpb24gYXZhaWxhYmxlPidcclxuXHRcdDogaXNTdHJpbmcoZGVzYykgPyBkZXNjXHJcblx0XHQ6IFwiPGJhZCBfIGRlc2NyaXB0aW9uPlwiXHJcblx0XHQpXHJcblx0REJHIFwiZGVzYyA9ICN7ZGVzY31cIlxyXG5cdGlmIG5vdGRlZmluZWQocmFuZ2UpXHJcblx0XHREQkcgXCJObyByYW5nZSBrZXlcIlxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0ZGVzYzogcmVhbERlc2NcclxuXHRcdFx0bWluOiAwXHJcblx0XHRcdG1heDogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJcclxuXHRcdFx0fVxyXG5cclxuXHREQkcgXCJyYW5nZSA9ICN7T0wocmFuZ2UpfVwiXHJcblx0aWYgaXNJbnRlZ2VyKHJhbmdlKVxyXG5cdFx0REJHIFwiSW50ZWdlciByYW5nZTogI3tyYW5nZX1cIlxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0ZGVzYzogcmVhbERlc2NcclxuXHRcdFx0bWluOiByYW5nZVxyXG5cdFx0XHRtYXg6IHJhbmdlXHJcblx0XHRcdH1cclxuXHRlbHNlIGlmIGlzQXJyYXkocmFuZ2UpXHJcblx0XHRhc3NlcnQgKHJhbmdlLmxlbmd0aCA9PSAyKSwgXCJCYWQgJ18nIGtleTogI3tPTChyYW5nZSl9XCJcclxuXHRcdFttaW4sIG1heF0gOj0gcmFuZ2VcclxuXHRcdERCRyBcIkFycmF5IHJhbmdlOiAje21pbn0uLiN7bWF4fVwiXHJcblx0XHRpZiBpc0ludGVnZXIobWluKSAmJiBpc0ludGVnZXIobWF4KVxyXG5cdFx0XHRyZXR1cm4ge1xyXG5cdFx0XHRcdGRlc2M6IHJlYWxEZXNjXHJcblx0XHRcdFx0bWluXHJcblx0XHRcdFx0bWF4XHJcblx0XHRcdFx0fVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRjcm9hayBcInJhbmdlIG1pbiBvciBtYXggbm90IGFuIGludGVnZXI6ICN7T0wobWluKX0uLiN7T0wobWF4KX1cIlxyXG5cdGVsc2VcclxuXHRcdGNyb2FrIFwiSW52YWxpZCByYW5nZTogI3tPTChyYW5nZSl9XCJcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5jbnRTdHIgOj0gKG46IG51bWJlciwgc3RyOiBzdHJpbmcpOiBzdHJpbmcgPT5cclxuXHRyZXR1cm4gKG49PTEpID8gXCIxICN7c3RyfVwiIDogXCIje259ICN7c3RyfXNcIlxyXG5cclxuZXhwb3J0IGhlbHBTdHIgOj0gKGhEZXNjOiBoYXNoKTogc3RyaW5nID0+XHJcblxyXG5cdGxMaW5lcyA6PSBbXCJBdmFpbGFibGUgb3B0aW9uczpcIl1cclxuXHJcblx0IyAtLS0gZGVmaW5lIGEgdXRpbGl0eSBmdW5jdGlvblxyXG5cdHB1c2ggOj0gKHN0cjogc3RyaW5nLCBsZXZlbDogbnVtYmVyPTApOiB2b2lkID0+XHJcblx0XHRsTGluZXMucHVzaCBzcGFjZXMoMypsZXZlbCkgKyBzdHJcclxuXHJcblx0Zm9yIG5hbWUgb2Yga2V5cyhoRGVzYylcclxuXHRcdGlmIChuYW1lICE9ICdfJylcclxuXHRcdFx0e3R5cGUsIGRlc2N9IDo9IGdldE9wdGlvbkluZm8oaERlc2MsIG5hbWUpXHJcblx0XHRcdHB1c2ggXCItI3tuYW1lfTogI3t0eXBlfSAtICN7ZGVzY31cIiwgMVxyXG5cdGlmIGRlZmluZWQoaERlc2MuXylcclxuXHRcdHB1c2ggXCJOb24tb3B0aW9uczpcIlxyXG5cdFx0aEluZm8gOj0gZ2V0Tm9uT3B0aW9uSW5mbyhoRGVzYylcclxuXHRcdGlmIGRlZmluZWQoaEluZm8pXHJcblx0XHRcdHtkZXNjLCBtaW4sIG1heH0gOj0gaEluZm9cclxuXHRcdFx0cHVzaCBkZXNjLCAxXHJcblx0XHRcdGlmIChtaW4gPT0gbWF4KVxyXG5cdFx0XHRcdHB1c2ggXCJUaGVyZSBtdXN0IGJlIGV4YWN0bHkgI3ttaW59IG5vbi1vcHRpb25zXCIsIDFcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGlmIChtaW4gPiAwKVxyXG5cdFx0XHRcdFx0cHVzaCBcIlRoZXJlIG11c3QgYmUgYXQgbGVhc3QgI3tjbnRTdHIobWluLCAnbm9uLW9wdGlvbicpfVwiLCAxXHJcblx0XHRcdFx0aWYgKG1heCA8IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKVxyXG5cdFx0XHRcdFx0cHVzaCBcIlRoZXJlIG11c3QgYmUgYXQgbW9zdCAje2NudFN0cihtYXgsICdub24tb3B0aW9uJyl9XCIsIDFcclxuXHRcdGVsc2VcclxuXHRcdFx0RFVNUCBoRGVzYy5fXHJcblx0XHRcdGNyb2FrIFwiQmFkIGRlc2NyaXB0b3IgZm9yICdfJ1wiXHJcblx0cmV0dXJuIGxMaW5lcy5qb2luKCdcXG4nKVxyXG4iXX0=