"use strict";
// exec.lib.civet

type AutoPromise<T> = Promise<Awaited<T>>;
import fs from 'node:fs'
import {stripAnsiCode} from "@std/fmt/colors"
import {
	CompilerOptions, ScriptTarget, ModuleKind, CompilerHost,
	createSourceFile, createProgram, getPreEmitDiagnostics,
	flattenDiagnosticMessageText, createCompilerHost,
	} from "npm:typescript"

import {
	undef, defined, notdefined, assert, croak, hash,
	isString, isArray, isArrayOfStrings,
	} from 'datatypes'
import {
	getOptions, OL, pass, blockToArray,
	} from 'llutils'
import {
	barf,
	} from 'fsys'
import {
	getLogLevel, pushLogLevel, popLogLevel,
	DBG, LOG, WARN, ERR, LOGVALUE,
	INDENT, UNDENT,
	} from 'logger'

/**
 * @module exec-utils - utilities for executing external code
 */

const textDecoder = new TextDecoder()

// ---------------------------------------------------------------------------

/**
 * convert ArrayBuffer, Int8Array, etc. to a string
 */

export const mkstr = (item: any): string => {

	if (isString(item)) {
		return stripAnsiCode(item)
	}
	else if (isArray(item)) {
		return stripAnsiCode(item.join(''))
	}
	else if (item instanceof ArrayBuffer) {
		return stripAnsiCode(textDecoder.decode(item))
	}
	else if (item instanceof Int8Array) {
		return stripAnsiCode(textDecoder.decode(item))
	}
	return ''
}

// ---------------------------------------------------------------------------

/**
 * build a command line from a command name and array of arguments
 */

export const getCmdLine = (cmdName: string, lArgs: string[]): string => {

	assert(isString(cmdName), `cmdName not a string: ${OL(cmdName)}`)
	assert(isArrayOfStrings(lArgs), `not an array of strings: ${OL(lArgs)}`)
	const cmdLine = `${cmdName} ${lArgs.join(' ')}`
	DBG(`cmdLine = ${OL(cmdLine)}`)
	return cmdLine
}

// ---------------------------------------------------------------------------

/**
 * build result hash to be returned by execCmd() or execCmdSync()
 */

export type TExecResult = {
	success: boolean
	code: number
	signal: (string | undefined)
	stdout: (string | undefined)
	stderr: (string | undefined)
	}

// ---------------------------------------------------------------------------

/**
 * get options to pass to Deno.Command constructor
 * 2nd argument determines whether stdout and stderr are
 * sent to parent process's stdout and stderr or are
 * collected to be returned to the caller
 */

export const getProcOpt = (
	lArgs: string[],
	collect: boolean
	): Deno.CommandOptions => {

	const hEnv: hash = {
		DEFAULT_LOGGER: getLogLevel()
		}

	return (collect?
		({
			args: lArgs,
			env: {DEFAULT_LOGGER: getLogLevel()},
			stdout: 'piped',
			stderr: 'piped'
			})
	:
		({
			args: lArgs,
			env: {DEFAULT_LOGGER: getLogLevel()},
			stdout: 'inherit',
			stderr: 'inherit'
			}))
}

// ---------------------------------------------------------------------------
// ASYNC

export const execCmd = async (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): AutoPromise<TExecResult> => {

	type opt = {
		collect: boolean
		nolog: boolean
		}
	const {collect, nolog} = getOptions<opt>(hOptions, {
		collect: false,
		nolog: false
		})
	if (nolog) {
		pushLogLevel('silent')
	}

	DBG(`EXEC: ${OL(getCmdLine(cmdName, lArgs))}`)
	DBG(INDENT)
	const hProcOpt = getProcOpt(lArgs, collect)
	const child = new Deno.Command(cmdName, hProcOpt)
	DBG(UNDENT)
	const {success, code, signal, stdout, stderr} = await child.output();
	if (nolog) {
		popLogLevel()
	}
	return {
		success,
		code,
		signal: signal || undef,
		stdout: collect ? mkstr(stdout) : undef,
		stderr: collect ? mkstr(stderr) : undef
		}
}

// ---------------------------------------------------------------------------

export const execCmdSync = (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): TExecResult => {

	type opt = {
		collect: boolean
		nolog: boolean
		}
	const {collect, nolog} = getOptions<opt>(hOptions, {
		collect: false,
		nolog: false
		})
	if (nolog) {
		pushLogLevel('silent')
	}
	DBG(`EXEC SYNC: ${OL(getCmdLine(cmdName, lArgs))}`)
	DBG(INDENT)
	const hProcOpt = getProcOpt(lArgs, collect)
	const child = new Deno.Command(cmdName, hProcOpt)
	DBG(UNDENT)
	const {success, code, signal, stdout, stderr} = child.outputSync()
	if (nolog) {
		popLogLevel()
	}
	return {
		success,
		code,
		signal: signal || undef,
		stdout: collect ? mkstr(stdout) : undef,
		stderr: collect ? mkstr(stderr) : undef
		}
}

// ---------------------------------------------------------------------------

export const cmdSucceeds = (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): boolean => {

	type opt = {
		quiet: boolean
		}
	const {quiet} = getOptions<opt>(hOptions, {
		quiet: true
		})
	try {
		const h = quiet ? {collect: true, nolog: true} : {}
		execCmdSync(cmdName, lArgs, h)
		return true
	}
	catch (err) {
		return false
	}
}

// ---------------------------------------------------------------------------

const getErrorMsgs = (stderr: (string | undefined)): string[] => {

	if (notdefined(stderr)) {
		return ['Unknown error']
	}
	else {
		const lMsgs = (
			(()=>{const results=[];for (const line of blockToArray(stderr)) {
				let ref;if ((ref = line.match(/\[ERROR\]:\s*(.*)$/))) {const lMatches = ref;
					results.push(lMatches[1])
				}
				else {
					results.push(undef)
				}
			}return results})()
			).filter((x) => defined(x))
		if (lMsgs.length === 0) {
			return ['Unknown error']
		}
		else {
			return lMsgs
		}
	}
}

// ---------------------------------------------------------------------------

/**
 * type checks TypeScript code, and returns
 * an array of diagnostic messages if errors are found
 */

export const typeCheck = (
		tsCode: string
		): ((string[]) | undefined) => {

	// --- We must place the TypeScript file at the project root
	//     so that paths gotten from .symbols resolve correctly

	const path = "./_typecheck_.ts"
	barf(path, tsCode)
	const hResult = execCmdSync('deno', ['check', path], {collect: true})
	const {success, code, stdout, stderr} = hResult
	if (success && (code === 0)) {
		return []
	}
	else {
		return getErrorMsgs(stderr)
	}
}

// ---------------------------------------------------------------------------

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9leGVjLmxpYi5jaXZldC50c3giLCJzb3VyY2VzIjpbInNyYy9saWIvZXhlYy5saWIuY2l2ZXQiXSwibWFwcGluZ3MiOiI7QUFBQSxpQkFBZ0I7QUFDaEIsQUFBQTtBQUNBLEssVyx5QjtBQUFBLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVM7QUFDeEIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUI7QUFDN0MsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxlQUFlLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDekQsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLHFCQUFxQixDQUFDO0FBQ3hELENBQUMsNEJBQTRCLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQztBQUNsRCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCO0FBQ3hCLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQztBQUNqRCxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixDQUFDO0FBQ3JDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXO0FBQ25CLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxDQUFDO0FBQ3BDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQ2pCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsSUFBSSxDQUFDO0FBQ04sQ0FBQyxDQUFDLENBQUMsSUFBSSxD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Q0EsQUFBQSxDQUFLLE1BQUosSUFBSSxDQUFDLENBQUUsQ0FBQyxrQkFBa0I7QUFDM0IsQUFBQSxDQUFDLElBQUksQ0FBQSxBQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQTtBQUNsQixBQUFBLENBQVEsTUFBUCxPQUFPLENBQUMsQ0FBRSxDQUFDLFdBQVcsQ0FBQSxBQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ2hFLEFBQUEsQ0FBZ0MsTUFBL0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFFLENBQUMsT0FBTztBQUMzQyxBQUFBLENBQUMsR0FBRyxDQUFBLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUMxQixBQUFBLEVBQUUsTUFBTSxDQUFDLENBQUMsQztDQUFDLENBQUE7QUFDWCxBQUFBLENBQUMsSUFBSSxDQUFBLENBQUE7QUFDTCxBQUFBLEVBQUUsTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLEM7Q0FBQyxDO0FBQUEsQ0FBQTtBQUM3QjtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFIiwibmFtZXMiOltdLCJzb3VyY2VzQ29udGVudCI6WyIjIGV4ZWMubGliLmNpdmV0XG5cbmltcG9ydCBmcyBmcm9tICdub2RlOmZzJ1xuaW1wb3J0IHtzdHJpcEFuc2lDb2RlfSBmcm9tIFwiQHN0ZC9mbXQvY29sb3JzXCJcbmltcG9ydCB7XG5cdENvbXBpbGVyT3B0aW9ucywgU2NyaXB0VGFyZ2V0LCBNb2R1bGVLaW5kLCBDb21waWxlckhvc3QsXG5cdGNyZWF0ZVNvdXJjZUZpbGUsIGNyZWF0ZVByb2dyYW0sIGdldFByZUVtaXREaWFnbm9zdGljcyxcblx0ZmxhdHRlbkRpYWdub3N0aWNNZXNzYWdlVGV4dCwgY3JlYXRlQ29tcGlsZXJIb3N0LFxuXHR9IGZyb20gXCJucG06dHlwZXNjcmlwdFwiXG5cbmltcG9ydCB7XG5cdHVuZGVmLCBkZWZpbmVkLCBub3RkZWZpbmVkLCBhc3NlcnQsIGNyb2FrLCBoYXNoLFxuXHRpc1N0cmluZywgaXNBcnJheSwgaXNBcnJheU9mU3RyaW5ncyxcblx0fSBmcm9tICdkYXRhdHlwZXMnXG5pbXBvcnQge1xuXHRnZXRPcHRpb25zLCBPTCwgcGFzcywgYmxvY2tUb0FycmF5LFxuXHR9IGZyb20gJ2xsdXRpbHMnXG5pbXBvcnQge1xuXHRiYXJmLFxuXHR9IGZyb20gJ2ZzeXMnXG5pbXBvcnQge1xuXHRnZXRMb2dMZXZlbCwgcHVzaExvZ0xldmVsLCBwb3BMb2dMZXZlbCxcblx0REJHLCBMT0csIFdBUk4sIEVSUiwgTE9HVkFMVUUsXG5cdElOREVOVCwgVU5ERU5ULFxuXHR9IGZyb20gJ2xvZ2dlcidcblxuLyoqXG4gKiBAbW9kdWxlIGV4ZWMtdXRpbHMgLSB1dGlsaXRpZXMgZm9yIGV4ZWN1dGluZyBleHRlcm5hbCBjb2RlXG4gKi9cblxudGV4dERlY29kZXIgOj0gbmV3IFRleHREZWNvZGVyKClcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLyoqXG4gKiBjb252ZXJ0IEFycmF5QnVmZmVyLCBJbnQ4QXJyYXksIGV0Yy4gdG8gYSBzdHJpbmdcbiAqL1xuXG5leHBvcnQgbWtzdHIgOj0gKGl0ZW06IGFueSk6IHN0cmluZyA9PlxuXG5cdGlmIGlzU3RyaW5nKGl0ZW0pXG5cdFx0cmV0dXJuIHN0cmlwQW5zaUNvZGUoaXRlbSlcblx0ZWxzZSBpZiBpc0FycmF5KGl0ZW0pXG5cdFx0cmV0dXJuIHN0cmlwQW5zaUNvZGUoaXRlbS5qb2luKCcnKSlcblx0ZWxzZSBpZiAoaXRlbSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKVxuXHRcdHJldHVybiBzdHJpcEFuc2lDb2RlKHRleHREZWNvZGVyLmRlY29kZShpdGVtKSlcblx0ZWxzZSBpZiAoaXRlbSBpbnN0YW5jZW9mIEludDhBcnJheSlcblx0XHRyZXR1cm4gc3RyaXBBbnNpQ29kZSh0ZXh0RGVjb2Rlci5kZWNvZGUoaXRlbSkpXG5cdHJldHVybiAnJ1xuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vKipcbiAqIGJ1aWxkIGEgY29tbWFuZCBsaW5lIGZyb20gYSBjb21tYW5kIG5hbWUgYW5kIGFycmF5IG9mIGFyZ3VtZW50c1xuICovXG5cbmV4cG9ydCBnZXRDbWRMaW5lIDo9IChjbWROYW1lOiBzdHJpbmcsIGxBcmdzOiBzdHJpbmdbXSk6IHN0cmluZyA9PlxuXG5cdGFzc2VydCBpc1N0cmluZyhjbWROYW1lKSwgXCJjbWROYW1lIG5vdCBhIHN0cmluZzogI3tPTChjbWROYW1lKX1cIlxuXHRhc3NlcnQgaXNBcnJheU9mU3RyaW5ncyhsQXJncyksIFwibm90IGFuIGFycmF5IG9mIHN0cmluZ3M6ICN7T0wobEFyZ3MpfVwiXG5cdGNtZExpbmUgOj0gXCIje2NtZE5hbWV9ICN7bEFyZ3Muam9pbignICcpfVwiXG5cdERCRyBcImNtZExpbmUgPSAje09MKGNtZExpbmUpfVwiXG5cdHJldHVybiBjbWRMaW5lXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8qKlxuICogYnVpbGQgcmVzdWx0IGhhc2ggdG8gYmUgcmV0dXJuZWQgYnkgZXhlY0NtZCgpIG9yIGV4ZWNDbWRTeW5jKClcbiAqL1xuXG5leHBvcnQgdHlwZSBURXhlY1Jlc3VsdCA9IHtcblx0c3VjY2VzczogYm9vbGVhblxuXHRjb2RlOiBudW1iZXJcblx0c2lnbmFsOiBzdHJpbmc/XG5cdHN0ZG91dDogc3RyaW5nP1xuXHRzdGRlcnI6IHN0cmluZz9cblx0fVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vKipcbiAqIGdldCBvcHRpb25zIHRvIHBhc3MgdG8gRGVuby5Db21tYW5kIGNvbnN0cnVjdG9yXG4gKiAybmQgYXJndW1lbnQgZGV0ZXJtaW5lcyB3aGV0aGVyIHN0ZG91dCBhbmQgc3RkZXJyIGFyZVxuICogc2VudCB0byBwYXJlbnQgcHJvY2VzcydzIHN0ZG91dCBhbmQgc3RkZXJyIG9yIGFyZVxuICogY29sbGVjdGVkIHRvIGJlIHJldHVybmVkIHRvIHRoZSBjYWxsZXJcbiAqL1xuXG5leHBvcnQgZ2V0UHJvY09wdCA6PSAoXG5cdGxBcmdzOiBzdHJpbmdbXSxcblx0Y29sbGVjdDogYm9vbGVhblxuXHQpOiBEZW5vLkNvbW1hbmRPcHRpb25zID0+XG5cblx0aEVudjogaGFzaCA6PSB7XG5cdFx0REVGQVVMVF9MT0dHRVI6IGdldExvZ0xldmVsKClcblx0XHR9XG5cblx0cmV0dXJuIGlmIGNvbGxlY3Rcblx0XHR7XG5cdFx0XHRhcmdzOiBsQXJncyxcblx0XHRcdGVudjoge0RFRkFVTFRfTE9HR0VSOiBnZXRMb2dMZXZlbCgpfVxuXHRcdFx0c3Rkb3V0OiAncGlwZWQnXG5cdFx0XHRzdGRlcnI6ICdwaXBlZCdcblx0XHRcdH1cblx0ZWxzZVxuXHRcdHtcblx0XHRcdGFyZ3M6IGxBcmdzLFxuXHRcdFx0ZW52OiB7REVGQVVMVF9MT0dHRVI6IGdldExvZ0xldmVsKCl9XG5cdFx0XHRzdGRvdXQ6ICdpbmhlcml0J1xuXHRcdFx0c3RkZXJyOiAnaW5oZXJpdCdcblx0XHRcdH1cblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgQVNZTkNcblxuZXhwb3J0IGV4ZWNDbWQgOj0gKFxuXHRjbWROYW1lOiBzdHJpbmcsXG5cdGxBcmdzOiBzdHJpbmdbXSA9IFtdLFxuXHRoT3B0aW9uczogaGFzaCA9IHt9XG5cdCk6IFRFeGVjUmVzdWx0ID0+XG5cblx0dHlwZSBvcHQgPSB7XG5cdFx0Y29sbGVjdDogYm9vbGVhblxuXHRcdG5vbG9nOiBib29sZWFuXG5cdFx0fVxuXHR7Y29sbGVjdCwgbm9sb2d9IDo9IGdldE9wdGlvbnM8b3B0PiBoT3B0aW9ucywge1xuXHRcdGNvbGxlY3Q6IGZhbHNlXG5cdFx0bm9sb2c6IGZhbHNlXG5cdFx0fVxuXHRpZiBub2xvZ1xuXHRcdHB1c2hMb2dMZXZlbCAnc2lsZW50J1xuXG5cdERCRyBcIkVYRUM6ICN7T0woZ2V0Q21kTGluZShjbWROYW1lLCBsQXJncykpfVwiXG5cdERCRyBJTkRFTlRcblx0aFByb2NPcHQgOj0gZ2V0UHJvY09wdChsQXJncywgY29sbGVjdClcblx0Y2hpbGQgOj0gbmV3IERlbm8uQ29tbWFuZChjbWROYW1lLCBoUHJvY09wdClcblx0REJHIFVOREVOVFxuXHR7c3VjY2VzcywgY29kZSwgc2lnbmFsLCBzdGRvdXQsIHN0ZGVycn0gOj0gYXdhaXQgY2hpbGQub3V0cHV0KCk7XG5cdGlmIG5vbG9nXG5cdFx0cG9wTG9nTGV2ZWwoKVxuXHRyZXR1cm4ge1xuXHRcdHN1Y2Nlc3Ncblx0XHRjb2RlXG5cdFx0c2lnbmFsOiBzaWduYWwgfHwgdW5kZWZcblx0XHRzdGRvdXQ6IGNvbGxlY3QgPyBta3N0cihzdGRvdXQpIDogdW5kZWZcblx0XHRzdGRlcnI6IGNvbGxlY3QgPyBta3N0cihzdGRlcnIpIDogdW5kZWZcblx0XHR9XG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBleGVjQ21kU3luYyA6PSAoXG5cdGNtZE5hbWU6IHN0cmluZyxcblx0bEFyZ3M6IHN0cmluZ1tdID0gW10sXG5cdGhPcHRpb25zOiBoYXNoID0ge31cblx0KTogVEV4ZWNSZXN1bHQgPT5cblxuXHR0eXBlIG9wdCA9IHtcblx0XHRjb2xsZWN0OiBib29sZWFuXG5cdFx0bm9sb2c6IGJvb2xlYW5cblx0XHR9XG5cdHtjb2xsZWN0LCBub2xvZ30gOj0gZ2V0T3B0aW9uczxvcHQ+IGhPcHRpb25zLCB7XG5cdFx0Y29sbGVjdDogZmFsc2Vcblx0XHRub2xvZzogZmFsc2Vcblx0XHR9XG5cdGlmIG5vbG9nXG5cdFx0cHVzaExvZ0xldmVsICdzaWxlbnQnXG5cdERCRyBcIkVYRUMgU1lOQzogI3tPTChnZXRDbWRMaW5lKGNtZE5hbWUsIGxBcmdzKSl9XCJcblx0REJHIElOREVOVFxuXHRoUHJvY09wdCA6PSBnZXRQcm9jT3B0KGxBcmdzLCBjb2xsZWN0KVxuXHRjaGlsZCA6PSBuZXcgRGVuby5Db21tYW5kKGNtZE5hbWUsIGhQcm9jT3B0KVxuXHREQkcgVU5ERU5UXG5cdHtzdWNjZXNzLCBjb2RlLCBzaWduYWwsIHN0ZG91dCwgc3RkZXJyfSA6PSBjaGlsZC5vdXRwdXRTeW5jKClcblx0aWYgbm9sb2dcblx0XHRwb3BMb2dMZXZlbCgpXG5cdHJldHVybiB7XG5cdFx0c3VjY2Vzc1xuXHRcdGNvZGVcblx0XHRzaWduYWw6IHNpZ25hbCB8fCB1bmRlZlxuXHRcdHN0ZG91dDogY29sbGVjdCA/IG1rc3RyKHN0ZG91dCkgOiB1bmRlZlxuXHRcdHN0ZGVycjogY29sbGVjdCA/IG1rc3RyKHN0ZGVycikgOiB1bmRlZlxuXHRcdH1cblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGNtZFN1Y2NlZWRzIDo9IChcblx0Y21kTmFtZTogc3RyaW5nLFxuXHRsQXJnczogc3RyaW5nW10gPSBbXSxcblx0aE9wdGlvbnM6IGhhc2ggPSB7fVxuXHQpOiBib29sZWFuID0+XG5cblx0dHlwZSBvcHQgPSB7XG5cdFx0cXVpZXQ6IGJvb2xlYW5cblx0XHR9XG5cdHtxdWlldH0gOj0gZ2V0T3B0aW9uczxvcHQ+IGhPcHRpb25zLCB7XG5cdFx0cXVpZXQ6IHRydWVcblx0XHR9XG5cdHRyeVxuXHRcdGggOj0gcXVpZXQgPyB7Y29sbGVjdDogdHJ1ZSwgbm9sb2c6IHRydWV9IDoge31cblx0XHRleGVjQ21kU3luYyBjbWROYW1lLCBsQXJncywgaFxuXHRcdHJldHVybiB0cnVlXG5cdGNhdGNoIGVyclxuXHRcdHJldHVybiBmYWxzZVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5nZXRFcnJvck1zZ3MgOj0gKHN0ZGVycjogc3RyaW5nPyk6IHN0cmluZ1tdID0+XG5cblx0aWYgbm90ZGVmaW5lZChzdGRlcnIpXG5cdFx0cmV0dXJuIFsnVW5rbm93biBlcnJvciddXG5cdGVsc2Vcblx0XHRsTXNncyA6PSAoXG5cdFx0XHRmb3IgbGluZSBvZiBibG9ja1RvQXJyYXkoc3RkZXJyKVxuXHRcdFx0XHRpZiBsTWF0Y2hlcyA6PSBsaW5lLm1hdGNoKC8vLyBcXFsgRVJST1IgXFxdIDogXFxzKiAoLiopJC8vLylcblx0XHRcdFx0XHRsTWF0Y2hlc1sxXVxuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0dW5kZWZcblx0XHRcdCkuZmlsdGVyKCh4KSA9PiBkZWZpbmVkKHgpKVxuXHRcdGlmIChsTXNncy5sZW5ndGggPT0gMClcblx0XHRcdHJldHVybiBbJ1Vua25vd24gZXJyb3InXVxuXHRcdGVsc2Vcblx0XHRcdHJldHVybiBsTXNnc1xuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vKipcbiAqIHR5cGUgY2hlY2tzIFR5cGVTY3JpcHQgY29kZSwgYW5kIHJldHVybnNcbiAqIGFuIGFycmF5IG9mIGRpYWdub3N0aWMgbWVzc2FnZXMgaWYgZXJyb3JzIGFyZSBmb3VuZFxuICovXG5cbmV4cG9ydCB0eXBlQ2hlY2sgOj0gKFxuXHRcdHRzQ29kZTogc3RyaW5nXG5cdFx0KTogc3RyaW5nW10/ID0+XG5cblx0IyAtLS0gV2UgbXVzdCBwbGFjZSB0aGUgVHlwZVNjcmlwdCBmaWxlIGF0IHRoZSBwcm9qZWN0IHJvb3Rcblx0IyAgICAgc28gdGhhdCBwYXRocyBnb3R0ZW4gZnJvbSAuc3ltYm9scyByZXNvbHZlIGNvcnJlY3RseVxuXG5cdHBhdGggOj0gXCIuL190eXBlY2hlY2tfLnRzXCJcblx0YmFyZiBwYXRoLCB0c0NvZGVcblx0aFJlc3VsdCA6PSBleGVjQ21kU3luYyAnZGVubycsIFsnY2hlY2snLCBwYXRoXSwge2NvbGxlY3Q6IHRydWV9XG5cdHtzdWNjZXNzLCBjb2RlLCBzdGRvdXQsIHN0ZGVycn0gOj0gaFJlc3VsdFxuXHRpZiBzdWNjZXNzICYmIChjb2RlID09IDApXG5cdFx0cmV0dXJuIFtdXG5cdGVsc2Vcblx0XHRyZXR1cm4gZ2V0RXJyb3JNc2dzKHN0ZGVycilcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiJdfQ==