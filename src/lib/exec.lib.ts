"use strict";
// exec.lib.civet

type AutoPromise<T> = Promise<Awaited<T>>;
import fs from 'node:fs'
import {stripAnsiCode} from "@std/fmt/colors"
import {
	CompilerOptions, ScriptTarget, ModuleKind, CompilerHost,
	createSourceFile, createProgram, getPreEmitDiagnostics,
	flattenDiagnosticMessageText, createCompilerHost,
	} from "npm:typescript"

import {
	undef, defined, notdefined, assert, hash,
	isString, isArray, isArrayOfStrings,
	} from './datatypes.lib.ts'
import {
	getOptions, croak, OL, pass, blockToArray,
	} from './llutils.lib.ts'
import {
	barf,
	} from './fs.lib.ts'
import {
	getLogLevel, pushLogLevel, popLogLevel,
	DBG, LOG, WARN, ERR, LOGVALUE,
	INDENT, UNDENT,
	} from './logger.lib.ts'

/**
 * @module exec-utils - utilities for executing external code
 */

const textDecoder = new TextDecoder()

// ---------------------------------------------------------------------------

/**
 * convert ArrayBuffer, Int8Array, etc. to a string
 */

export const mkstr = (item: any): string => {

	if (defined(item)) {
		if (isString(item)) {
			return stripAnsiCode(item)
		}
		else if (isArray(item)) {
			return stripAnsiCode(item.join(''))
		}
		else {
			return stripAnsiCode(textDecoder.decode(item))
		}
	}
	else {
		return ''
	}
}

// ---------------------------------------------------------------------------

/**
 * build a command line from a command name and array of arguments
 */

export const getCmdLine = (cmdName: string, lArgs: string[]): string => {

	assert(isString(cmdName), `cmdName not a string: ${OL(cmdName)}`)
	assert(isArrayOfStrings(lArgs), `not an array of strings: ${OL(lArgs)}`)
	const cmdLine = `${cmdName} ${lArgs.join(' ')}`
	DBG(`cmdLine = ${OL(cmdLine)}`)
	return cmdLine
}

// ---------------------------------------------------------------------------

/**
 * build result hash to be returned by execCmd() or execCmdSync()
 */

export type TExecResult = {
	success: boolean
	code: number
	signal: (string | undefined)
	stdout: (string | undefined)
	stderr: (string | undefined)
	}

const getFinalResult = (
	hResult: hash,
	collect: boolean
	): TExecResult => {

	let ref;if (collect) {
		ref = ({
			success: hResult.success,
			code:    hResult.code,
			signal:  hResult.signal,
			stdout:  mkstr(hResult.stdout),
			stderr:  mkstr(hResult.stderr)
			})
	}
	else {
		ref = ({
			success: hResult.success,
			code:    hResult.code,
			signal:  hResult.signal,
			stdout:  undef,
			stderr:  undef
			})
	};const hRes =ref
	DBG(`hResult = ${OL(hRes)}`)
	return hRes
}

// ---------------------------------------------------------------------------

/**
 * get options to pass to Deno.Command constructor
 * 2nd argument determines whether stdout and stderr are
 * sent to parent process's stdout and stderr or are
 * collected to be returned to the caller
 */

export const getProcOpt = (
	lArgs: string[],
	collect: boolean
	): Deno.CommandOptions => {

	const hEnv: hash = {
		DEFAULT_LOGGER: getLogLevel()
		}

	return (collect?
		({
			args: lArgs,
			env: hEnv,
			stdout: 'piped',
			stderr: 'piped'
			})
	:
		({
			args: lArgs,
			env: hEnv,
			stdout: 'inherit',
			stderr: 'inherit'
			}))
}

// ---------------------------------------------------------------------------
// ASYNC

export const execCmd = async (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): AutoPromise<TExecResult> => {

	const {collect, nolog} = getOptions(hOptions, {
		collect: false,
		nolog: false
		})
	if (nolog) {
		pushLogLevel('silent')
	}
	DBG(`EXEC: ${OL(getCmdLine(cmdName, lArgs))}`)
	DBG(INDENT)
	const hProcOpt = getProcOpt(lArgs, collect)
	const child = new Deno.Command(cmdName, hProcOpt)
	DBG(UNDENT)
	const hResult = await child.output()
	const hFinalResult = getFinalResult(hResult, collect)
	if (nolog) {
		popLogLevel()
	}
	return hFinalResult
}

// ---------------------------------------------------------------------------

export const execCmdSync = (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): TExecResult => {

	const {collect, nolog} = getOptions(hOptions, {
		collect: false,
		nolog: false
		})
	if (nolog) {
		pushLogLevel('silent')
	}
	DBG(`EXEC SYNC: ${OL(getCmdLine(cmdName, lArgs))}`)
	DBG(INDENT)
	const hProcOpt = getProcOpt(lArgs, collect)
	const child = new Deno.Command(cmdName, hProcOpt)
	DBG(UNDENT)
	const hResult = child.outputSync()
	const hFinalResult = getFinalResult(hResult, collect)
	if (nolog) {
		popLogLevel()
	}
	return hFinalResult
}

// ---------------------------------------------------------------------------

export const cmdSucceeds = (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): boolean => {

	const {quiet} = getOptions(hOptions, {
		quiet: true
		})
	try {
		const h = quiet ? {collect: true, nolog: true} : {}
		execCmdSync(cmdName, lArgs, h)
		return true
	}
	catch (err) {
		return false
	}
}

// ---------------------------------------------------------------------------

const getErrorMsgs = (stderr: (string | undefined)): string[] => {

	if (notdefined(stderr)) {
		return ['Unknown error']
	}
	else {
		const lMsgs = (
			(()=>{const results=[];for (const line of blockToArray(stderr)) {
				let ref1;if ((ref1 = line.match(/\[ERROR\]:\s*(.*)$/))) {const lMatches = ref1;
					results.push(lMatches[1])
				}
				else {
					results.push(undef)
				}
			}return results})()
			).filter((x) => defined(x))
		if (lMsgs.length === 0) {
			return ['Unknown error']
		}
		else {
			return lMsgs
		}
	}
}

// ---------------------------------------------------------------------------

/**
 * type checks TypeScript code, and returns
 * an array of diagnostic messages if errors are found
 */

export const typeCheck = (
		tsCode: string
		): ((string[]) | undefined) => {

	// --- We must place the TypeScript file at the project root
	//     so that paths gotten from .symbols resolve correctly

	const path = "./_typecheck_.ts"
	barf(path, tsCode)
	const hResult = execCmdSync('deno', ['check', path], {collect: true})
	const {success, code, stdout, stderr} = hResult
	if (success && (code === 0)) {
		return []
	}
	else {
		return getErrorMsgs(stderr)
	}
}

// ---------------------------------------------------------------------------

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9leGVjLmxpYi5jaXZldC50c3giLCJzb3VyY2VzIjpbInNyYy9saWIvZXhlYy5saWIuY2l2ZXQiXSwibWFwcGluZ3MiOiI7QUFBQSxpQkFBZ0I7QUFDaEIsQUFBQTtBQUNBLEssVyx5QjtBQUFBLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVM7QUFDeEIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUI7QUFDN0MsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxlQUFlLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDekQsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLHFCQUFxQixDQUFDO0FBQ3hELENBQUMsNEJBQTRCLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQztBQUNsRCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCO0FBQ3hCLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQztBQUMxQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixDQUFDO0FBQ3JDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBb0I7QUFDNUIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDM0MsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQjtBQUMxQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLElBQUksQ0FBQztBQUNOLENBQUMsQ0FBQyxDQUFDLElB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QUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDaEUsQUFBQSxDQUFnQyxNQUEvQixDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUUsQ0FBQyxPQUFPO0FBQzNDLEFBQUEsQ0FBQyxHQUFHLENBQUEsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFFLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQzFCLEFBQUEsRUFBRSxNQUFNLENBQUMsQ0FBQyxDO0NBQUMsQ0FBQTtBQUNYLEFBQUEsQ0FBQyxJQUFJLENBQUEsQ0FBQTtBQUNMLEFBQUEsRUFBRSxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQztDQUFDLEM7QUFBQSxDQUFBO0FBQzdCO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgZXhlYy5saWIuY2l2ZXRcblxuaW1wb3J0IGZzIGZyb20gJ25vZGU6ZnMnXG5pbXBvcnQge3N0cmlwQW5zaUNvZGV9IGZyb20gXCJAc3RkL2ZtdC9jb2xvcnNcIlxuaW1wb3J0IHtcblx0Q29tcGlsZXJPcHRpb25zLCBTY3JpcHRUYXJnZXQsIE1vZHVsZUtpbmQsIENvbXBpbGVySG9zdCxcblx0Y3JlYXRlU291cmNlRmlsZSwgY3JlYXRlUHJvZ3JhbSwgZ2V0UHJlRW1pdERpYWdub3N0aWNzLFxuXHRmbGF0dGVuRGlhZ25vc3RpY01lc3NhZ2VUZXh0LCBjcmVhdGVDb21waWxlckhvc3QsXG5cdH0gZnJvbSBcIm5wbTp0eXBlc2NyaXB0XCJcblxuaW1wb3J0IHtcblx0dW5kZWYsIGRlZmluZWQsIG5vdGRlZmluZWQsIGFzc2VydCwgaGFzaCxcblx0aXNTdHJpbmcsIGlzQXJyYXksIGlzQXJyYXlPZlN0cmluZ3MsXG5cdH0gZnJvbSAnLi9kYXRhdHlwZXMubGliLnRzJ1xuaW1wb3J0IHtcblx0Z2V0T3B0aW9ucywgY3JvYWssIE9MLCBwYXNzLCBibG9ja1RvQXJyYXksXG5cdH0gZnJvbSAnLi9sbHV0aWxzLmxpYi50cydcbmltcG9ydCB7XG5cdGJhcmYsXG5cdH0gZnJvbSAnLi9mcy5saWIudHMnXG5pbXBvcnQge1xuXHRnZXRMb2dMZXZlbCwgcHVzaExvZ0xldmVsLCBwb3BMb2dMZXZlbCxcblx0REJHLCBMT0csIFdBUk4sIEVSUiwgTE9HVkFMVUUsXG5cdElOREVOVCwgVU5ERU5ULFxuXHR9IGZyb20gJy4vbG9nZ2VyLmxpYi50cydcblxuLyoqXG4gKiBAbW9kdWxlIGV4ZWMtdXRpbHMgLSB1dGlsaXRpZXMgZm9yIGV4ZWN1dGluZyBleHRlcm5hbCBjb2RlXG4gKi9cblxudGV4dERlY29kZXIgOj0gbmV3IFRleHREZWNvZGVyKClcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLyoqXG4gKiBjb252ZXJ0IEFycmF5QnVmZmVyLCBJbnQ4QXJyYXksIGV0Yy4gdG8gYSBzdHJpbmdcbiAqL1xuXG5leHBvcnQgbWtzdHIgOj0gKGl0ZW06IGFueSk6IHN0cmluZyA9PlxuXG5cdGlmIGRlZmluZWQoaXRlbSlcblx0XHRpZiBpc1N0cmluZyhpdGVtKVxuXHRcdFx0cmV0dXJuIHN0cmlwQW5zaUNvZGUoaXRlbSlcblx0XHRlbHNlIGlmIGlzQXJyYXkoaXRlbSlcblx0XHRcdHJldHVybiBzdHJpcEFuc2lDb2RlKGl0ZW0uam9pbignJykpXG5cdFx0ZWxzZVxuXHRcdFx0cmV0dXJuIHN0cmlwQW5zaUNvZGUodGV4dERlY29kZXIuZGVjb2RlKGl0ZW0pKVxuXHRlbHNlXG5cdFx0cmV0dXJuICcnXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8qKlxuICogYnVpbGQgYSBjb21tYW5kIGxpbmUgZnJvbSBhIGNvbW1hbmQgbmFtZSBhbmQgYXJyYXkgb2YgYXJndW1lbnRzXG4gKi9cblxuZXhwb3J0IGdldENtZExpbmUgOj0gKGNtZE5hbWU6IHN0cmluZywgbEFyZ3M6IHN0cmluZ1tdKTogc3RyaW5nID0+XG5cblx0YXNzZXJ0IGlzU3RyaW5nKGNtZE5hbWUpLCBcImNtZE5hbWUgbm90IGEgc3RyaW5nOiAje09MKGNtZE5hbWUpfVwiXG5cdGFzc2VydCBpc0FycmF5T2ZTdHJpbmdzKGxBcmdzKSwgXCJub3QgYW4gYXJyYXkgb2Ygc3RyaW5nczogI3tPTChsQXJncyl9XCJcblx0Y21kTGluZSA6PSBcIiN7Y21kTmFtZX0gI3tsQXJncy5qb2luKCcgJyl9XCJcblx0REJHIFwiY21kTGluZSA9ICN7T0woY21kTGluZSl9XCJcblx0cmV0dXJuIGNtZExpbmVcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLyoqXG4gKiBidWlsZCByZXN1bHQgaGFzaCB0byBiZSByZXR1cm5lZCBieSBleGVjQ21kKCkgb3IgZXhlY0NtZFN5bmMoKVxuICovXG5cbmV4cG9ydCB0eXBlIFRFeGVjUmVzdWx0ID0ge1xuXHRzdWNjZXNzOiBib29sZWFuXG5cdGNvZGU6IG51bWJlclxuXHRzaWduYWw6IHN0cmluZz9cblx0c3Rkb3V0OiBzdHJpbmc/XG5cdHN0ZGVycjogc3RyaW5nP1xuXHR9XG5cbmdldEZpbmFsUmVzdWx0IDo9IChcblx0aFJlc3VsdDogaGFzaCxcblx0Y29sbGVjdDogYm9vbGVhblxuXHQpOiBURXhlY1Jlc3VsdCA9PlxuXG5cdGhSZXMgOj0gaWYgY29sbGVjdFxuXHRcdHtcblx0XHRcdHN1Y2Nlc3M6IGhSZXN1bHQuc3VjY2Vzc1xuXHRcdFx0Y29kZTogICAgaFJlc3VsdC5jb2RlXG5cdFx0XHRzaWduYWw6ICBoUmVzdWx0LnNpZ25hbFxuXHRcdFx0c3Rkb3V0OiAgbWtzdHIoaFJlc3VsdC5zdGRvdXQpXG5cdFx0XHRzdGRlcnI6ICBta3N0cihoUmVzdWx0LnN0ZGVycilcblx0XHRcdH1cblx0ZWxzZVxuXHRcdHtcblx0XHRcdHN1Y2Nlc3M6IGhSZXN1bHQuc3VjY2Vzc1xuXHRcdFx0Y29kZTogICAgaFJlc3VsdC5jb2RlXG5cdFx0XHRzaWduYWw6ICBoUmVzdWx0LnNpZ25hbFxuXHRcdFx0c3Rkb3V0OiAgdW5kZWZcblx0XHRcdHN0ZGVycjogIHVuZGVmXG5cdFx0XHR9XG5cdERCRyBcImhSZXN1bHQgPSAje09MKGhSZXMpfVwiXG5cdHJldHVybiBoUmVzXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8qKlxuICogZ2V0IG9wdGlvbnMgdG8gcGFzcyB0byBEZW5vLkNvbW1hbmQgY29uc3RydWN0b3JcbiAqIDJuZCBhcmd1bWVudCBkZXRlcm1pbmVzIHdoZXRoZXIgc3Rkb3V0IGFuZCBzdGRlcnIgYXJlXG4gKiBzZW50IHRvIHBhcmVudCBwcm9jZXNzJ3Mgc3Rkb3V0IGFuZCBzdGRlcnIgb3IgYXJlXG4gKiBjb2xsZWN0ZWQgdG8gYmUgcmV0dXJuZWQgdG8gdGhlIGNhbGxlclxuICovXG5cbmV4cG9ydCBnZXRQcm9jT3B0IDo9IChcblx0bEFyZ3M6IHN0cmluZ1tdLFxuXHRjb2xsZWN0OiBib29sZWFuXG5cdCk6IERlbm8uQ29tbWFuZE9wdGlvbnMgPT5cblxuXHRoRW52OiBoYXNoIDo9IHtcblx0XHRERUZBVUxUX0xPR0dFUjogZ2V0TG9nTGV2ZWwoKVxuXHRcdH1cblxuXHRyZXR1cm4gaWYgY29sbGVjdFxuXHRcdHtcblx0XHRcdGFyZ3M6IGxBcmdzLFxuXHRcdFx0ZW52OiBoRW52XG5cdFx0XHRzdGRvdXQ6ICdwaXBlZCdcblx0XHRcdHN0ZGVycjogJ3BpcGVkJ1xuXHRcdFx0fVxuXHRlbHNlXG5cdFx0e1xuXHRcdFx0YXJnczogbEFyZ3MsXG5cdFx0XHRlbnY6IGhFbnZcblx0XHRcdHN0ZG91dDogJ2luaGVyaXQnXG5cdFx0XHRzdGRlcnI6ICdpbmhlcml0J1xuXHRcdFx0fVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyBBU1lOQ1xuXG5leHBvcnQgZXhlY0NtZCA6PSAoXG5cdGNtZE5hbWU6IHN0cmluZyxcblx0bEFyZ3M6IHN0cmluZ1tdID0gW10sXG5cdGhPcHRpb25zOiBoYXNoID0ge31cblx0KTogVEV4ZWNSZXN1bHQgPT5cblxuXHR7Y29sbGVjdCwgbm9sb2d9IDo9IGdldE9wdGlvbnMgaE9wdGlvbnMsIHtcblx0XHRjb2xsZWN0OiBmYWxzZVxuXHRcdG5vbG9nOiBmYWxzZVxuXHRcdH1cblx0aWYgbm9sb2dcblx0XHRwdXNoTG9nTGV2ZWwgJ3NpbGVudCdcblx0REJHIFwiRVhFQzogI3tPTChnZXRDbWRMaW5lKGNtZE5hbWUsIGxBcmdzKSl9XCJcblx0REJHIElOREVOVFxuXHRoUHJvY09wdCA6PSBnZXRQcm9jT3B0KGxBcmdzLCBjb2xsZWN0KVxuXHRjaGlsZCA6PSBuZXcgRGVuby5Db21tYW5kKGNtZE5hbWUsIGhQcm9jT3B0KVxuXHREQkcgVU5ERU5UXG5cdGhSZXN1bHQgOj0gYXdhaXQgY2hpbGQub3V0cHV0KClcblx0aEZpbmFsUmVzdWx0IDo9IGdldEZpbmFsUmVzdWx0KGhSZXN1bHQsIGNvbGxlY3QpXG5cdGlmIG5vbG9nXG5cdFx0cG9wTG9nTGV2ZWwoKVxuXHRyZXR1cm4gaEZpbmFsUmVzdWx0XG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBleGVjQ21kU3luYyA6PSAoXG5cdGNtZE5hbWU6IHN0cmluZyxcblx0bEFyZ3M6IHN0cmluZ1tdID0gW10sXG5cdGhPcHRpb25zOiBoYXNoID0ge31cblx0KTogVEV4ZWNSZXN1bHQgPT5cblxuXHR7Y29sbGVjdCwgbm9sb2d9IDo9IGdldE9wdGlvbnMgaE9wdGlvbnMsIHtcblx0XHRjb2xsZWN0OiBmYWxzZVxuXHRcdG5vbG9nOiBmYWxzZVxuXHRcdH1cblx0aWYgbm9sb2dcblx0XHRwdXNoTG9nTGV2ZWwgJ3NpbGVudCdcblx0REJHIFwiRVhFQyBTWU5DOiAje09MKGdldENtZExpbmUoY21kTmFtZSwgbEFyZ3MpKX1cIlxuXHREQkcgSU5ERU5UXG5cdGhQcm9jT3B0IDo9IGdldFByb2NPcHQobEFyZ3MsIGNvbGxlY3QpXG5cdGNoaWxkIDo9IG5ldyBEZW5vLkNvbW1hbmQoY21kTmFtZSwgaFByb2NPcHQpXG5cdERCRyBVTkRFTlRcblx0aFJlc3VsdCA6PSBjaGlsZC5vdXRwdXRTeW5jKClcblx0aEZpbmFsUmVzdWx0IDo9IGdldEZpbmFsUmVzdWx0KGhSZXN1bHQsIGNvbGxlY3QpXG5cdGlmIG5vbG9nXG5cdFx0cG9wTG9nTGV2ZWwoKVxuXHRyZXR1cm4gaEZpbmFsUmVzdWx0XG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBjbWRTdWNjZWVkcyA6PSAoXG5cdGNtZE5hbWU6IHN0cmluZyxcblx0bEFyZ3M6IHN0cmluZ1tdID0gW10sXG5cdGhPcHRpb25zOiBoYXNoID0ge31cblx0KTogYm9vbGVhbiA9PlxuXG5cdHtxdWlldH0gOj0gZ2V0T3B0aW9ucyBoT3B0aW9ucywge1xuXHRcdHF1aWV0OiB0cnVlXG5cdFx0fVxuXHR0cnlcblx0XHRoIDo9IHF1aWV0ID8ge2NvbGxlY3Q6IHRydWUsIG5vbG9nOiB0cnVlfSA6IHt9XG5cdFx0ZXhlY0NtZFN5bmMgY21kTmFtZSwgbEFyZ3MsIGhcblx0XHRyZXR1cm4gdHJ1ZVxuXHRjYXRjaCBlcnJcblx0XHRyZXR1cm4gZmFsc2VcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZ2V0RXJyb3JNc2dzIDo9IChzdGRlcnI6IHN0cmluZz8pOiBzdHJpbmdbXSA9PlxuXG5cdGlmIG5vdGRlZmluZWQoc3RkZXJyKVxuXHRcdHJldHVybiBbJ1Vua25vd24gZXJyb3InXVxuXHRlbHNlXG5cdFx0bE1zZ3MgOj0gKFxuXHRcdFx0Zm9yIGxpbmUgb2YgYmxvY2tUb0FycmF5KHN0ZGVycilcblx0XHRcdFx0aWYgbE1hdGNoZXMgOj0gbGluZS5tYXRjaCgvLy8gXFxbIEVSUk9SIFxcXSA6IFxccyogKC4qKSQvLy8pXG5cdFx0XHRcdFx0bE1hdGNoZXNbMV1cblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdHVuZGVmXG5cdFx0XHQpLmZpbHRlcigoeCkgPT4gZGVmaW5lZCh4KSlcblx0XHRpZiAobE1zZ3MubGVuZ3RoID09IDApXG5cdFx0XHRyZXR1cm4gWydVbmtub3duIGVycm9yJ11cblx0XHRlbHNlXG5cdFx0XHRyZXR1cm4gbE1zZ3NcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLyoqXG4gKiB0eXBlIGNoZWNrcyBUeXBlU2NyaXB0IGNvZGUsIGFuZCByZXR1cm5zXG4gKiBhbiBhcnJheSBvZiBkaWFnbm9zdGljIG1lc3NhZ2VzIGlmIGVycm9ycyBhcmUgZm91bmRcbiAqL1xuXG5leHBvcnQgdHlwZUNoZWNrIDo9IChcblx0XHR0c0NvZGU6IHN0cmluZ1xuXHRcdCk6IHN0cmluZ1tdPyA9PlxuXG5cdCMgLS0tIFdlIG11c3QgcGxhY2UgdGhlIFR5cGVTY3JpcHQgZmlsZSBhdCB0aGUgcHJvamVjdCByb290XG5cdCMgICAgIHNvIHRoYXQgcGF0aHMgZ290dGVuIGZyb20gLnN5bWJvbHMgcmVzb2x2ZSBjb3JyZWN0bHlcblxuXHRwYXRoIDo9IFwiLi9fdHlwZWNoZWNrXy50c1wiXG5cdGJhcmYgcGF0aCwgdHNDb2RlXG5cdGhSZXN1bHQgOj0gZXhlY0NtZFN5bmMgJ2Rlbm8nLCBbJ2NoZWNrJywgcGF0aF0sIHtjb2xsZWN0OiB0cnVlfVxuXHR7c3VjY2VzcywgY29kZSwgc3Rkb3V0LCBzdGRlcnJ9IDo9IGhSZXN1bHRcblx0aWYgc3VjY2VzcyAmJiAoY29kZSA9PSAwKVxuXHRcdHJldHVybiBbXVxuXHRlbHNlXG5cdFx0cmV0dXJuIGdldEVycm9yTXNncyhzdGRlcnIpXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4iXX0=