"use strict";
// exec.lib.civet

type AutoPromise<T> = Promise<Awaited<T>>;
import fs from 'node:fs'
import {stripAnsiCode} from "@std/fmt/colors"
import {
	CompilerOptions, ScriptTarget, ModuleKind, CompilerHost,
	createSourceFile, createProgram, getPreEmitDiagnostics,
	flattenDiagnosticMessageText, createCompilerHost,
	} from "npm:typescript"

import {
	undef, defined, notdefined, assert, hash,
	isString, isArray, isArrayOfStrings, stringify,
	} from './datatypes.lib.ts'
import {
	getOptions, croak, OL, pass, blockToArray,
	} from './llutils.lib.ts'
import {
	barf,
	} from './fs.lib.ts'
import {
	curLogLevel, pushLogLevel, popLogLevel,
	LogCmd, DBG, LOG, WARN, ERR, LOGVALUE,
	} from './logger.lib.ts'

/**
 * @module exec-utils - utilities for executing external code
 */

const textDecoder = new TextDecoder()

// ---------------------------------------------------------------------------

/**
 * convert ArrayBuffer, Int8Array, etc. to a string
 */

export const mkstr = (item: any): string => {

	if (defined(item)) {
		if (isString(item)) {
			return stripAnsiCode(item)
		}
		else if (isArray(item)) {
			return stripAnsiCode(item.join(''))
		}
		else {
			return stripAnsiCode(textDecoder.decode(item))
		}
	}
	else {
		return ''
	}
}

// ---------------------------------------------------------------------------

/**
 * build a command line from a command name and array of arguments
 */

export const getCmdLine = (cmdName: string, lArgs: string[]): string => {

	assert(isString(cmdName), `cmdName not a string: ${OL(cmdName)}`)
	assert(isArrayOfStrings(lArgs), `not an array of strings: ${OL(lArgs)}`)
	const cmdLine = `${cmdName} ${lArgs.join(' ')}`
	DBG(`cmdLine = ${OL(cmdLine)}`)
	return cmdLine
}

// ---------------------------------------------------------------------------

/**
 * build result hash to be returned by execCmd() or execCmdSync()
 */

export type execCmdResult = {
	success: boolean
	code: number
	signal: (string | undefined)
	stdout: (string | undefined)
	stderr: (string | undefined)
	}

const getFinalResult = (
	hResult: hash,
	collect: boolean
	): execCmdResult => {

	let ref;if (collect) {
		ref = ({
			success: hResult.success,
			code:    hResult.code,
			signal:  hResult.signal,
			stdout:  mkstr(hResult.stdout),
			stderr:  mkstr(hResult.stderr)
			})
	}
	else {
		ref = ({
			success: hResult.success,
			code:    hResult.code,
			signal:  hResult.signal,
			stdout:  undef,
			stderr:  undef
			})
	};const hRes =ref
	DBG(`hResult = ${OL(hRes)}`)
	return hRes
}

// ---------------------------------------------------------------------------

/**
 * get options to pass to Deno.Command constructor
 * 2nd argument determines whether stdout and stderr are
 * sent to parent process's stdout and stderr or are
 * collected to be returned to the caller
 */

export const getProcOpt = (
	lArgs: string[],
	collect: boolean
	): Deno.CommandOptions => {

	const hEnv: hash = {
		DEFAULT_LOGGER: curLogLevel()
		}

	return (collect?
		({
			args: lArgs,
			env: hEnv,
			stdout: 'piped',
			stderr: 'piped'
			})
	:
		({
			args: lArgs,
			env: hEnv,
			stdout: 'inherit',
			stderr: 'inherit'
			}))
}

// ---------------------------------------------------------------------------
// ASYNC

export const execCmd = async (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): AutoPromise<execCmdResult> => {

	const {collect, nolog} = getOptions(hOptions, {
		collect: false,
		nolog: false
		})
	if (nolog) {
		pushLogLevel('silent')
	}
	DBG(`EXEC: ${OL(getCmdLine(cmdName, lArgs))}`)
	DBG(LogCmd.INDENT)
	const hProcOpt = getProcOpt(lArgs, collect)
	const child = new Deno.Command(cmdName, hProcOpt)
	DBG(LogCmd.UNDENT)
	const hResult = await child.output()
	const hFinalResult = getFinalResult(hResult, collect)
	if (nolog) {
		popLogLevel()
	}
	return hFinalResult
}

// ---------------------------------------------------------------------------

export const execCmdSync = (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): execCmdResult => {

	const {collect, nolog} = getOptions(hOptions, {
		collect: false,
		nolog: false
		})
	if (nolog) {
		pushLogLevel('silent')
	}
	DBG(`EXEC SYNC: ${OL(getCmdLine(cmdName, lArgs))}`)
	DBG(LogCmd.INDENT)
	const hProcOpt = getProcOpt(lArgs, collect)
	const child = new Deno.Command(cmdName, hProcOpt)
	DBG(LogCmd.UNDENT)
	const hResult = child.outputSync()
	const hFinalResult = getFinalResult(hResult, collect)
	if (nolog) {
		popLogLevel()
	}
	return hFinalResult
}

// ---------------------------------------------------------------------------

export const cmdSucceeds = (
	cmdName: string,
	lArgs: string[] = [],
	hOptions: hash = {}
	): boolean => {

	const {quiet} = getOptions(hOptions, {
		quiet: true
		})
	try {
		const h = quiet ? {collect: true, nolog: true} : {}
		execCmdSync(cmdName, lArgs, h)
		return true
	}
	catch (err) {
		return false
	}
}

// ---------------------------------------------------------------------------

const getErrorMsgs = (stderr: (string | undefined)): string[] => {

	if (notdefined(stderr)) {
		return ['Unknown error']
	}
	else {
		const lMsgs = (
			(()=>{const results=[];for (const line of blockToArray(stderr)) {
				let ref1;if ((ref1 = line.match(/\[ERROR\]:\s*(.*)$/))) {const lMatches = ref1;
					results.push(lMatches[1])
				}
				else {
					results.push(undef)
				}
			}return results})()
			).filter((x) => defined(x))
		if (lMsgs.length === 0) {
			return ['Unknown error']
		}
		else {
			return lMsgs
		}
	}
}

// ---------------------------------------------------------------------------

/**
 * type checks TypeScript code, and returns
 * an array of diagnostic messages if errors are found
 */

export const typeCheck = (
		tsCode: string
		): ((string[]) | undefined) => {

	// --- We must place the TypeScript file at the project root
	//     so that paths gotten from .symbols resolve correctly

	const path = "./_typecheck_.ts"
	barf(path, tsCode)
	const hResult = execCmdSync('deno', ['check', path], {collect: true})
	const {success, code, stdout, stderr} = hResult
	if (success && (code === 0)) {
		return []
	}
	else {
		return getErrorMsgs(stderr)
	}
}

// ---------------------------------------------------------------------------

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9leGVjLmxpYi5jaXZldC50c3giLCJzb3VyY2VzIjpbInNyYy9saWIvZXhlYy5saWIuY2l2ZXQiXSwibWFwcGluZ3MiOiI7QUFBQSxpQkFBZ0I7QUFDaEIsQUFBQTtBQUNBLEssVyx5QjtBQUFBLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVM7QUFDeEIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUI7QUFDN0MsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxlQUFlLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDekQsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLHFCQUFxQixDQUFDO0FBQ3hELENBQUMsNEJBQTRCLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQztBQUNsRCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCO0FBQ3hCLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQztBQUMxQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsU0FBUyxDQUFDO0FBQ2hELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBb0I7QUFDNUIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDM0MsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQjtBQUMxQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLElBQUksQ0FBQztBQUNOLENB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SSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoRCxBQUFBLEVBQUUsV0FBVyxDQUFBLEFBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQy9CLEFBQUEsRUFBRSxNQUFNLENBQUMsSTtDQUFJLENBQUE7QUFDYixBQUFBLENBQUMsS0FBSyxDQUFDLENBQUEsR0FBRyxDQUFBLENBQUEsQ0FBQTtBQUNWLEFBQUEsRUFBRSxNQUFNLENBQUMsSztDQUFLLEM7QUFBQSxDQUFBO0FBQ2QsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQVksTUFBWixZQUFZLENBQUMsQ0FBRSxDQUFDLENBQUMsTUFBTSxDLEMsQ0FBQyxBQUFDLE0sWSxDQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDOUMsQUFBQTtBQUNBLEFBQUEsQ0FBQyxHQUFHLENBQUEsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUN0QixBQUFBLEVBQUUsTUFBTSxDQUFDLENBQUMsZUFBZSxDO0NBQUMsQ0FBQTtBQUMxQixBQUFBLENBQUMsSUFBSSxDQUFBLENBQUE7QUFDTCxBQUFBLEVBQU8sTUFBTCxLQUFLLENBQUMsQ0FBRSxDQUFDLENBQUM7QUFDWixBQUFBLEcsQyxDLEMsRSxDLEssQyxPLEcsQ0FBRyxHQUFHLENBQUMsQ0FBQSxNQUFBLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNuQyxBQUFBLEksSSxJLENBQUksR0FBRyxDLEMsSUFBUSxDQUFDLENBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUcsQUFBQyxFQUFFLEFBQUMsS0FBSyxBQUFDLEVBQUUsQUFBQyxDQUFDLEFBQUMsRUFBRSxDQUFDLEFBQUMsSUFBSSxDQUFDLENBQUcsQyxDQUFDLENBQUEsQ0FBQSxDQUE5QyxNQUFSLFEsRyxJLENBQXNEO0FBQzdELEFBQUEsSyxPLE1BQUssUUFBUSxDQUFDLENBQUMsQyxDO0lBQUMsQ0FBQTtBQUNoQixBQUFBLElBQUksSUFBSSxDQUFBLENBQUE7QUFDUixBQUFBLEssTyxNQUFLLEssQztJQUFLLEM7R0FBQSxDLE8sTyxDLEMsRUFBQTtBQUNWLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDOUIsQUFBQSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFBO0FBQ3hCLEFBQUEsR0FBRyxNQUFNLENBQUMsQ0FBQyxlQUFlLEM7RUFBQyxDQUFBO0FBQzNCLEFBQUEsRUFBRSxJQUFJLENBQUEsQ0FBQTtBQUNOLEFBQUEsR0FBRyxNQUFNLENBQUMsSztFQUFLLEM7Q0FBQSxDO0FBQUEsQ0FBQTtBQUNmLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQVUsTUFBVCxTQUFTLENBQUMsQ0FBRSxDQUFDLENBQUM7QUFDckIsQUFBQSxFQUFFLE1BQU0sQ0FBQyxDQUFDLE1BQU07QUFDaEIsRUFBRSxDQUFDLEMsQyxDLENBQUMsQUFBQyxNQUFNLENBQUMsQyxDLFksQ0FBRSxDQUFDLEVBQUUsQ0FBQSxDQUFBO0FBQ2pCLEFBQUE7QUFDQSxBQUFBLENBQUMsNERBQTJEO0FBQzVELEFBQUEsQ0FBQywyREFBMEQ7QUFDM0QsQUFBQTtBQUNBLEFBQUEsQ0FBSyxNQUFKLElBQUksQ0FBQyxDQUFFLENBQUMsa0JBQWtCO0FBQzNCLEFBQUEsQ0FBQyxJQUFJLENBQUEsQUFBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUE7QUFDbEIsQUFBQSxDQUFRLE1BQVAsT0FBTyxDQUFDLENBQUUsQ0FBQyxXQUFXLENBQUEsQUFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUNoRSxBQUFBLENBQWdDLE1BQS9CLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBRSxDQUFDLE9BQU87QUFDM0MsQUFBQSxDQUFDLEdBQUcsQ0FBQSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDMUIsQUFBQSxFQUFFLE1BQU0sQ0FBQyxDQUFDLEM7Q0FBQyxDQUFBO0FBQ1gsQUFBQSxDQUFDLElBQUksQ0FBQSxDQUFBO0FBQ0wsQUFBQSxFQUFFLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDO0NBQUMsQztBQUFBLENBQUE7QUFDN0I7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyBleGVjLmxpYi5jaXZldFxuXG5pbXBvcnQgZnMgZnJvbSAnbm9kZTpmcydcbmltcG9ydCB7c3RyaXBBbnNpQ29kZX0gZnJvbSBcIkBzdGQvZm10L2NvbG9yc1wiXG5pbXBvcnQge1xuXHRDb21waWxlck9wdGlvbnMsIFNjcmlwdFRhcmdldCwgTW9kdWxlS2luZCwgQ29tcGlsZXJIb3N0LFxuXHRjcmVhdGVTb3VyY2VGaWxlLCBjcmVhdGVQcm9ncmFtLCBnZXRQcmVFbWl0RGlhZ25vc3RpY3MsXG5cdGZsYXR0ZW5EaWFnbm9zdGljTWVzc2FnZVRleHQsIGNyZWF0ZUNvbXBpbGVySG9zdCxcblx0fSBmcm9tIFwibnBtOnR5cGVzY3JpcHRcIlxuXG5pbXBvcnQge1xuXHR1bmRlZiwgZGVmaW5lZCwgbm90ZGVmaW5lZCwgYXNzZXJ0LCBoYXNoLFxuXHRpc1N0cmluZywgaXNBcnJheSwgaXNBcnJheU9mU3RyaW5ncywgc3RyaW5naWZ5LFxuXHR9IGZyb20gJy4vZGF0YXR5cGVzLmxpYi50cydcbmltcG9ydCB7XG5cdGdldE9wdGlvbnMsIGNyb2FrLCBPTCwgcGFzcywgYmxvY2tUb0FycmF5LFxuXHR9IGZyb20gJy4vbGx1dGlscy5saWIudHMnXG5pbXBvcnQge1xuXHRiYXJmLFxuXHR9IGZyb20gJy4vZnMubGliLnRzJ1xuaW1wb3J0IHtcblx0Y3VyTG9nTGV2ZWwsIHB1c2hMb2dMZXZlbCwgcG9wTG9nTGV2ZWwsXG5cdExvZ0NtZCwgREJHLCBMT0csIFdBUk4sIEVSUiwgTE9HVkFMVUUsXG5cdH0gZnJvbSAnLi9sb2dnZXIubGliLnRzJ1xuXG4vKipcbiAqIEBtb2R1bGUgZXhlYy11dGlscyAtIHV0aWxpdGllcyBmb3IgZXhlY3V0aW5nIGV4dGVybmFsIGNvZGVcbiAqL1xuXG50ZXh0RGVjb2RlciA6PSBuZXcgVGV4dERlY29kZXIoKVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vKipcbiAqIGNvbnZlcnQgQXJyYXlCdWZmZXIsIEludDhBcnJheSwgZXRjLiB0byBhIHN0cmluZ1xuICovXG5cbmV4cG9ydCBta3N0ciA6PSAoaXRlbTogYW55KTogc3RyaW5nID0+XG5cblx0aWYgZGVmaW5lZChpdGVtKVxuXHRcdGlmIGlzU3RyaW5nKGl0ZW0pXG5cdFx0XHRyZXR1cm4gc3RyaXBBbnNpQ29kZShpdGVtKVxuXHRcdGVsc2UgaWYgaXNBcnJheShpdGVtKVxuXHRcdFx0cmV0dXJuIHN0cmlwQW5zaUNvZGUoaXRlbS5qb2luKCcnKSlcblx0XHRlbHNlXG5cdFx0XHRyZXR1cm4gc3RyaXBBbnNpQ29kZSh0ZXh0RGVjb2Rlci5kZWNvZGUoaXRlbSkpXG5cdGVsc2Vcblx0XHRyZXR1cm4gJydcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLyoqXG4gKiBidWlsZCBhIGNvbW1hbmQgbGluZSBmcm9tIGEgY29tbWFuZCBuYW1lIGFuZCBhcnJheSBvZiBhcmd1bWVudHNcbiAqL1xuXG5leHBvcnQgZ2V0Q21kTGluZSA6PSAoY21kTmFtZTogc3RyaW5nLCBsQXJnczogc3RyaW5nW10pOiBzdHJpbmcgPT5cblxuXHRhc3NlcnQgaXNTdHJpbmcoY21kTmFtZSksIFwiY21kTmFtZSBub3QgYSBzdHJpbmc6ICN7T0woY21kTmFtZSl9XCJcblx0YXNzZXJ0IGlzQXJyYXlPZlN0cmluZ3MobEFyZ3MpLCBcIm5vdCBhbiBhcnJheSBvZiBzdHJpbmdzOiAje09MKGxBcmdzKX1cIlxuXHRjbWRMaW5lIDo9IFwiI3tjbWROYW1lfSAje2xBcmdzLmpvaW4oJyAnKX1cIlxuXHREQkcgXCJjbWRMaW5lID0gI3tPTChjbWRMaW5lKX1cIlxuXHRyZXR1cm4gY21kTGluZVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vKipcbiAqIGJ1aWxkIHJlc3VsdCBoYXNoIHRvIGJlIHJldHVybmVkIGJ5IGV4ZWNDbWQoKSBvciBleGVjQ21kU3luYygpXG4gKi9cblxuZXhwb3J0IHR5cGUgZXhlY0NtZFJlc3VsdCA9IHtcblx0c3VjY2VzczogYm9vbGVhblxuXHRjb2RlOiBudW1iZXJcblx0c2lnbmFsOiBzdHJpbmc/XG5cdHN0ZG91dDogc3RyaW5nP1xuXHRzdGRlcnI6IHN0cmluZz9cblx0fVxuXG5nZXRGaW5hbFJlc3VsdCA6PSAoXG5cdGhSZXN1bHQ6IGhhc2gsXG5cdGNvbGxlY3Q6IGJvb2xlYW5cblx0KTogZXhlY0NtZFJlc3VsdCA9PlxuXG5cdGhSZXMgOj0gaWYgY29sbGVjdFxuXHRcdHtcblx0XHRcdHN1Y2Nlc3M6IGhSZXN1bHQuc3VjY2Vzc1xuXHRcdFx0Y29kZTogICAgaFJlc3VsdC5jb2RlXG5cdFx0XHRzaWduYWw6ICBoUmVzdWx0LnNpZ25hbFxuXHRcdFx0c3Rkb3V0OiAgbWtzdHIoaFJlc3VsdC5zdGRvdXQpXG5cdFx0XHRzdGRlcnI6ICBta3N0cihoUmVzdWx0LnN0ZGVycilcblx0XHRcdH1cblx0ZWxzZVxuXHRcdHtcblx0XHRcdHN1Y2Nlc3M6IGhSZXN1bHQuc3VjY2Vzc1xuXHRcdFx0Y29kZTogICAgaFJlc3VsdC5jb2RlXG5cdFx0XHRzaWduYWw6ICBoUmVzdWx0LnNpZ25hbFxuXHRcdFx0c3Rkb3V0OiAgdW5kZWZcblx0XHRcdHN0ZGVycjogIHVuZGVmXG5cdFx0XHR9XG5cdERCRyBcImhSZXN1bHQgPSAje09MKGhSZXMpfVwiXG5cdHJldHVybiBoUmVzXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8qKlxuICogZ2V0IG9wdGlvbnMgdG8gcGFzcyB0byBEZW5vLkNvbW1hbmQgY29uc3RydWN0b3JcbiAqIDJuZCBhcmd1bWVudCBkZXRlcm1pbmVzIHdoZXRoZXIgc3Rkb3V0IGFuZCBzdGRlcnIgYXJlXG4gKiBzZW50IHRvIHBhcmVudCBwcm9jZXNzJ3Mgc3Rkb3V0IGFuZCBzdGRlcnIgb3IgYXJlXG4gKiBjb2xsZWN0ZWQgdG8gYmUgcmV0dXJuZWQgdG8gdGhlIGNhbGxlclxuICovXG5cbmV4cG9ydCBnZXRQcm9jT3B0IDo9IChcblx0bEFyZ3M6IHN0cmluZ1tdLFxuXHRjb2xsZWN0OiBib29sZWFuXG5cdCk6IERlbm8uQ29tbWFuZE9wdGlvbnMgPT5cblxuXHRoRW52OiBoYXNoIDo9IHtcblx0XHRERUZBVUxUX0xPR0dFUjogY3VyTG9nTGV2ZWwoKVxuXHRcdH1cblxuXHRyZXR1cm4gaWYgY29sbGVjdFxuXHRcdHtcblx0XHRcdGFyZ3M6IGxBcmdzLFxuXHRcdFx0ZW52OiBoRW52XG5cdFx0XHRzdGRvdXQ6ICdwaXBlZCdcblx0XHRcdHN0ZGVycjogJ3BpcGVkJ1xuXHRcdFx0fVxuXHRlbHNlXG5cdFx0e1xuXHRcdFx0YXJnczogbEFyZ3MsXG5cdFx0XHRlbnY6IGhFbnZcblx0XHRcdHN0ZG91dDogJ2luaGVyaXQnXG5cdFx0XHRzdGRlcnI6ICdpbmhlcml0J1xuXHRcdFx0fVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyBBU1lOQ1xuXG5leHBvcnQgZXhlY0NtZCA6PSAoXG5cdGNtZE5hbWU6IHN0cmluZyxcblx0bEFyZ3M6IHN0cmluZ1tdID0gW10sXG5cdGhPcHRpb25zOiBoYXNoID0ge31cblx0KTogZXhlY0NtZFJlc3VsdCA9PlxuXG5cdHtjb2xsZWN0LCBub2xvZ30gOj0gZ2V0T3B0aW9ucyBoT3B0aW9ucywge1xuXHRcdGNvbGxlY3Q6IGZhbHNlXG5cdFx0bm9sb2c6IGZhbHNlXG5cdFx0fVxuXHRpZiBub2xvZ1xuXHRcdHB1c2hMb2dMZXZlbCAnc2lsZW50J1xuXHREQkcgXCJFWEVDOiAje09MKGdldENtZExpbmUoY21kTmFtZSwgbEFyZ3MpKX1cIlxuXHREQkcgTG9nQ21kLklOREVOVFxuXHRoUHJvY09wdCA6PSBnZXRQcm9jT3B0KGxBcmdzLCBjb2xsZWN0KVxuXHRjaGlsZCA6PSBuZXcgRGVuby5Db21tYW5kKGNtZE5hbWUsIGhQcm9jT3B0KVxuXHREQkcgTG9nQ21kLlVOREVOVFxuXHRoUmVzdWx0IDo9IGF3YWl0IGNoaWxkLm91dHB1dCgpXG5cdGhGaW5hbFJlc3VsdCA6PSBnZXRGaW5hbFJlc3VsdChoUmVzdWx0LCBjb2xsZWN0KVxuXHRpZiBub2xvZ1xuXHRcdHBvcExvZ0xldmVsKClcblx0cmV0dXJuIGhGaW5hbFJlc3VsdFxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgZXhlY0NtZFN5bmMgOj0gKFxuXHRjbWROYW1lOiBzdHJpbmcsXG5cdGxBcmdzOiBzdHJpbmdbXSA9IFtdLFxuXHRoT3B0aW9uczogaGFzaCA9IHt9XG5cdCk6IGV4ZWNDbWRSZXN1bHQgPT5cblxuXHR7Y29sbGVjdCwgbm9sb2d9IDo9IGdldE9wdGlvbnMgaE9wdGlvbnMsIHtcblx0XHRjb2xsZWN0OiBmYWxzZVxuXHRcdG5vbG9nOiBmYWxzZVxuXHRcdH1cblx0aWYgbm9sb2dcblx0XHRwdXNoTG9nTGV2ZWwgJ3NpbGVudCdcblx0REJHIFwiRVhFQyBTWU5DOiAje09MKGdldENtZExpbmUoY21kTmFtZSwgbEFyZ3MpKX1cIlxuXHREQkcgTG9nQ21kLklOREVOVFxuXHRoUHJvY09wdCA6PSBnZXRQcm9jT3B0KGxBcmdzLCBjb2xsZWN0KVxuXHRjaGlsZCA6PSBuZXcgRGVuby5Db21tYW5kKGNtZE5hbWUsIGhQcm9jT3B0KVxuXHREQkcgTG9nQ21kLlVOREVOVFxuXHRoUmVzdWx0IDo9IGNoaWxkLm91dHB1dFN5bmMoKVxuXHRoRmluYWxSZXN1bHQgOj0gZ2V0RmluYWxSZXN1bHQoaFJlc3VsdCwgY29sbGVjdClcblx0aWYgbm9sb2dcblx0XHRwb3BMb2dMZXZlbCgpXG5cdHJldHVybiBoRmluYWxSZXN1bHRcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGNtZFN1Y2NlZWRzIDo9IChcblx0Y21kTmFtZTogc3RyaW5nLFxuXHRsQXJnczogc3RyaW5nW10gPSBbXSxcblx0aE9wdGlvbnM6IGhhc2ggPSB7fVxuXHQpOiBib29sZWFuID0+XG5cblx0e3F1aWV0fSA6PSBnZXRPcHRpb25zIGhPcHRpb25zLCB7XG5cdFx0cXVpZXQ6IHRydWVcblx0XHR9XG5cdHRyeVxuXHRcdGggOj0gcXVpZXQgPyB7Y29sbGVjdDogdHJ1ZSwgbm9sb2c6IHRydWV9IDoge31cblx0XHRleGVjQ21kU3luYyBjbWROYW1lLCBsQXJncywgaFxuXHRcdHJldHVybiB0cnVlXG5cdGNhdGNoIGVyclxuXHRcdHJldHVybiBmYWxzZVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5nZXRFcnJvck1zZ3MgOj0gKHN0ZGVycjogc3RyaW5nPyk6IHN0cmluZ1tdID0+XG5cblx0aWYgbm90ZGVmaW5lZChzdGRlcnIpXG5cdFx0cmV0dXJuIFsnVW5rbm93biBlcnJvciddXG5cdGVsc2Vcblx0XHRsTXNncyA6PSAoXG5cdFx0XHRmb3IgbGluZSBvZiBibG9ja1RvQXJyYXkoc3RkZXJyKVxuXHRcdFx0XHRpZiBsTWF0Y2hlcyA6PSBsaW5lLm1hdGNoKC8vLyBcXFsgRVJST1IgXFxdIDogXFxzKiAoLiopJC8vLylcblx0XHRcdFx0XHRsTWF0Y2hlc1sxXVxuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0dW5kZWZcblx0XHRcdCkuZmlsdGVyKCh4KSA9PiBkZWZpbmVkKHgpKVxuXHRcdGlmIChsTXNncy5sZW5ndGggPT0gMClcblx0XHRcdHJldHVybiBbJ1Vua25vd24gZXJyb3InXVxuXHRcdGVsc2Vcblx0XHRcdHJldHVybiBsTXNnc1xuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vKipcbiAqIHR5cGUgY2hlY2tzIFR5cGVTY3JpcHQgY29kZSwgYW5kIHJldHVybnNcbiAqIGFuIGFycmF5IG9mIGRpYWdub3N0aWMgbWVzc2FnZXMgaWYgZXJyb3JzIGFyZSBmb3VuZFxuICovXG5cbmV4cG9ydCB0eXBlQ2hlY2sgOj0gKFxuXHRcdHRzQ29kZTogc3RyaW5nXG5cdFx0KTogc3RyaW5nW10/ID0+XG5cblx0IyAtLS0gV2UgbXVzdCBwbGFjZSB0aGUgVHlwZVNjcmlwdCBmaWxlIGF0IHRoZSBwcm9qZWN0IHJvb3Rcblx0IyAgICAgc28gdGhhdCBwYXRocyBnb3R0ZW4gZnJvbSAuc3ltYm9scyByZXNvbHZlIGNvcnJlY3RseVxuXG5cdHBhdGggOj0gXCIuL190eXBlY2hlY2tfLnRzXCJcblx0YmFyZiBwYXRoLCB0c0NvZGVcblx0aFJlc3VsdCA6PSBleGVjQ21kU3luYyAnZGVubycsIFsnY2hlY2snLCBwYXRoXSwge2NvbGxlY3Q6IHRydWV9XG5cdHtzdWNjZXNzLCBjb2RlLCBzdGRvdXQsIHN0ZGVycn0gOj0gaFJlc3VsdFxuXHRpZiBzdWNjZXNzICYmIChjb2RlID09IDApXG5cdFx0cmV0dXJuIFtdXG5cdGVsc2Vcblx0XHRyZXR1cm4gZ2V0RXJyb3JNc2dzKHN0ZGVycilcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiJdfQ==