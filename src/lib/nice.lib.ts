"use strict";
// nice.lib.civet

import {
	undef, defined, notdefined, assert, croak, hash, hashof,
	isArray, isFunction, isBoolean, isString, isClass, isArrayOfStrings,
	jsType, className, functionName, symbolName,
	nonEmpty, classDef, functionDef, regexpDef,
	} from 'datatypes'
import {
	getOptions, escapeStr, unescapeStr,
	keys, toBlock, o, OL, rtrim, Fetcher,
	} from 'llutils'
import {
	indented,
	} from 'indent'
import {
	TPLLToken, tkEOF, tkIndent, tkUndent,
	TTokenGenerator, allTokensInBlock,
	} from 'pll'

// ---------------------------------------------------------------------------

type TCompareFunc = (a: string, b: string) => number

// ---------------------------------------------------------------------------

export const alphaCompare: TCompareFunc = (
		a: string,
		b: string
		): number => {

	return (a < b) ? -1 : (a > b) ? 1 : 0
}

// ---------------------------------------------------------------------------

// --- Returns a function that:
//        compares 2 strings based on their position in lSortKeys
//        else compares alphabetically

const getCompareFunc = (
		lSortKeys: string[]
		): TCompareFunc => {

	// --- Create map of key to number
	const h: hashof<number> = {}
	let i1 = 0;for (const key of lSortKeys) {const i = i1++;
		h[key] = i+1
	}

	return function(a: string, b: string): number {
		const aVal = h[a]
		const bVal = h[b]

		if (defined(aVal)) {
			if (defined(bVal)) {
				// --- compare numerically
				return (aVal < bVal) ? -1 : (aVal > bVal) ? 1 : 0
			}
			else {
				return -1
			}
		}
		else {
			if (defined(bVal)) {
				return 1
			}
			else {
				return alphaCompare(a, b)
			}
		}
	}
}

// ---------------------------------------------------------------------------

export const toNice = (
		x: unknown,
		hOptions: hash={}
		): string => {

	// --- When strict, classes and function
	//     include their definitions, with escaped chars

	type opt = {
		strict: boolean
		sortFunc: (TCompareFunc | undefined)
		sortKeys: ((string[]) | undefined)
		}
	const {strict, sortFunc, sortKeys
		} = getOptions<opt>(hOptions, {
		strict: false,
		sortFunc: undef,
		sortKeys: undef
		})

	if (typeof x === 'undefined') {
		return '.undef.'
	}

	if (typeof x === 'bigint') {
		return x.toString()
	}

	if (typeof x === 'number') {
		return (
			  Number.isNaN(x)    ? '.NaN.'
			: Number.isFinite(x) ? x.toString()
			: ((x < 0) ? '.neginfinity.' : '.infinity.')
			)
	}

	if (typeof x === 'function') {
		if (isClass(x)) {
			return `.class ${classDef(x)}.`
		}
		else {
			return `.function ${functionDef(x)}.`
		}
	}

	if (typeof x === 'object') {

		if (x === null) {
			return '.null.'
		}

		if (isArray(x)) {
			if (x.length === 0) {
				return '.[].'
			}
			const lLines = []
			for (const item of x) {
				const block = toNice(item, hOptions)
				if (shouldSplit(item)) {
					lLines.push('-')
					lLines.push(indented(block))
				}
				else {
					lLines.push(`- ${block}`)
				}
			}
			return toBlock(lLines)
		}

		if (x instanceof String) {
			const s = x.toString()
			if (needsPreEsc(s)) {
				return '\\' + escapeStr(s, o`style=C`)
			}
			else {
				return escapeStr(s, o`style=C`)
			}
		}

		if (x instanceof Boolean) {
			return x ? '.true.' : '.false.'
		}

		if (x instanceof Number) {
			return x.toString()
		}

		if (x instanceof RegExp) {
			const def = regexpDef(x)
			return def ? `.regexp ${def}.` : '.regexp.'
		}

//		sortKeysFunc: TCompareFunc := (
//			  isArray(sortKeys)    ? getCompareFunc(sortKeys)
//			: isFunction(sortKeys) ? sortKeys
//			:                        alphaCompare
//			)

		let sortKeysFunc: TCompareFunc
		if (defined(sortFunc)) {
			sortKeysFunc = sortFunc
		}
		else if (defined(sortKeys)) {
			sortKeysFunc = getCompareFunc(sortKeys)
		}
		else {
			sortKeysFunc = alphaCompare
		}

		const lKeys = Object.keys(x)
		if (lKeys.length === 0) {
			return '.{}.'
		}
		const lLines = []
		for (const key of lKeys.sort(sortKeysFunc)) {
			if (isString(key)) {
				const val = (x as hashof<unknown>)[key]
				const block = toNice(val, hOptions)
				if (shouldSplit(val)) {
					lLines.push(`${key}:`)
					lLines.push(indented(block))
				}
				else {
					lLines.push(`${key}: ${block}`)
				}
			}
		}
		return toBlock(lLines)
	}

	else {
		return `<Unknown object ${x}>`
	}
}

// ---------------------------------------------------------------------------

export const needsPreEsc = (str: string) => {

	// --- if it looks like an array item, it needs leading \
	if (str.match(/^-/)) {
		return true
	}

	// --- if it looks like a hash key, it needs leading \
	if (str.match(/^[A-Za-z][A-Za-z0-9_]*:/)) {
		return true
	}

	// --- if it looks like a number, it needs leading \
	if (str.match(/^\d+(?:\.\d*)?/)) {
		return true
	}

	// --- if it starts with a '.', it needs leading \
	if ((str.length > 0) && (str[0] === '.')) {
		return true
	}

	return false
}

// ---------------------------------------------------------------------------

const shouldSplit = (x: any): boolean => {

	return ['hash','array','class','instance'].includes(jsType(x))
}

// ---------------------------------------------------------------------------

export const niceSplitter: TTokenGenerator = function*(
		str: string
		) {
	let ref;let ref1;if ((ref = str.match(/^-(.*)$/))) {let lMatches = ref;
		const tail = lMatches[1].trim()
		if (tail) {
			yield {
				kind: 'list-item',
				str,
				value: getPrimitive(tail)
				}
		}
		else {
			yield {
				kind: 'list-head',
				name: str,
				str: ''
				}
		}
	}
	else if ((ref1 = str.match(/^([A-Za-z][A-Za-z0-9_]*):(.*)$/))) {let lMatches = ref1;
		const name = lMatches[1]
		const tail = lMatches[2].trim()
		if (tail) {
			yield {
				kind: 'hash-item',
				str,
				name,
				value: getPrimitive(tail)
				}
		}
		else {
			yield {
				kind: 'hash-head',
				name,
				str
				}
		}
	}
	else {
		yield {
			kind: 'primitive',
			str,
			value: getPrimitive(str)
			}
	}
}

// ---------------------------------------------------------------------------

export const allNiceTokens = function*(
		block: string,
		): Generator<TPLLToken, void, void> {

	for (const h of allTokensInBlock(block, niceSplitter)) {
		yield h
	}
	return
}

// ---------------------------------------------------------------------------

export const fromNice = (
		str: string,
		): any => {

	// --- Create a Fetcher, then use
	//     recursive descent parsing

	const fetcher = new Fetcher<TPLLToken>(allNiceTokens(str), tkEOF)

	const parseObj = (): any => {
		const {kind, str} = fetcher.peek()
		if(kind === 'list-item' || kind === 'list-head') {
				return parseList()}
else if(kind === 'hash-item' || kind === 'hash-head') {
				return parseHash()}
else if(kind === 'eof') {
				return undef}
else  {
				fetcher.skip()
				return getPrimitive(str)
			}
	}

	const parseList = (): any[] => {
		const lItems: any[] = []
		let {kind} = fetcher.peek()
		while (['list-item', 'list-head'].includes(kind)) {
			if (kind === 'list-head') {
				lItems.push(parseListNest())
			}
			else {
				lItems.push(fetcher.get().value)
			}
			kind = fetcher.peek().kind
		}
		return lItems
	}

	const parseListNest = (): any[] => {
		fetcher.get({kind: 'list-head', str: ''})
		fetcher.get({kind: 'indent', str: ''})
		const value = parseObj()
		fetcher.get({kind: 'undent', str: ''})
		return value
	}

	const parseHash = (): hash => {
		const hItems: hash = {}
		let {kind, name} = fetcher.peek()
		if (kind === 'hash-head') {
			fetcher.skip()
			fetcher.get({kind: 'indent', str: ''})
			const value = parseObj()
			if (defined(name)) {
				hItems[name] = value
			}
			fetcher.get({kind: 'undent', str: ''})
		}
		else {
			while (kind === 'hash-item') {
				const {name, value} = fetcher.get()
				if (defined(name)) {
					hItems[name] = value
				};
				({kind} = fetcher.peek())
			}
		}
		return hItems
	}

	debugger
	return parseObj()
}

// ---------------------------------------------------------------------------

export const getPrimitive = (
		str: string,
		): any => {

	str = str.trim()
	let ref2;if ((ref2 = str.match(/^\.(.*)\.$/))) {const lMatches = ref2;
		const s = lMatches[1].trim()
		if(s === 'undef') { return undef}
else if(s === 'null') { return null}
else if(s === 'true') { return true}
else if(s === 'false') { return false}
else if(s === 'NaN') { return NaN}
else if(s === 'infinity') { return Infinity}
else if(s === 'neginfinity') { return -Infinity}
else if(s === 'symbol') { return Symbol()}
else if(s === '[]') { return []}
else if(s === '{}') { return {}}
else if(typeof s === 'string' && /^symbol\s+(.+)$/.test(s)) {
				const lMatches = s.match(/^symbol\s+(.+)$/)
				if (defined(lMatches)) {
					const name = lMatches[1]
					return Symbol(name)
				}
				else {
					return Symbol()
				}}
else if(typeof s === 'string' && /^regexp\s+(.+)$/.test(s)) {
				const lMatches = s.match(/^regexp\s+(.+)$/)
				if (defined(lMatches)) {
					const name = lMatches[1]
					return new RegExp(name)
				}
				else {
					return new RegExp('^$')
				}}
else  {
				croak("Not Implemented")
			}
	}
	else if (str.match(/^\d+$/)) {
		return parseInt(str, 10)
	}
	else if (str.match(/^\d+\.\d*$/)) {
		return parseFloat(str)
	}
	else {
		return unescapeStr(str, o`purpose=C`)
	}
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9uaWNlLmxpYi5jaXZldC50c3giLCJzb3VyY2VzIjpbInNyYy9saWIvbmljZS5saWIuY2l2ZXQiXSwibWFwcGluZ3MiOiI7QUFBQSxpQkFBZ0I7QUFDaEIsQUFBQTtBQUNBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUN6RCxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixDQUFDO0FBQ3JFLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsVUFBVSxDQUFDO0FBQzdDLENBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQzVDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXO0FBQ25CLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsVUFBVSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFDO0FBQ3BDLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQ3RDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQ2pCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsUUFBUSxDQUFDO0FBQ1YsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVE7QUFDaEIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLENB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QUFFLENBQUMsQ0FBQyxDQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFBLEFBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztBQUNsQyxBQUFBLEVBQUUsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFBO0FBQ2YsQUFBQSxFQUFFLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQTtBQUNqQixBQUFBLEVBQUUsUUFBUSxDQUFDLENBQUMsS0FBSztBQUNqQixFQUFFLENBQUMsQ0FBQTtBQUNILEFBQUE7QUFDQSxBQUFBLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRSxDQUFDLFdBQVcsQ0FBQyxDQUFBLENBQUE7QUFDN0IsQUFBQSxFQUFFLE1BQU0sQ0FBQyxTO0NBQVMsQ0FBQTtBQUNsQixBQUFBO0FBQ0EsQUFBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFBO0FBQzFCLEFBQUEsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDO0NBQUMsQ0FBQTtBQUNyQixBQUFBO0FBQ0EsQUFBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFBO0FBQzFCLEFBQUEsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUNWLEFBQUEsS0FBSyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPO0FBQ2pDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN0QyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDL0MsR0FBRyxDO0NBQUMsQ0FBQTtBQUNKLEFBQUE7QUFDQSxBQUFB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QUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEM7Q0FBQyxDQUFBO0FBQ3hCLEFBQUEsQ0FBQyxJQUFJLENBQUEsQ0FBQTtBQUNMLEFBQUEsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEMsV0FBWSxDO0NBQUMsQztBQUFBLENBQUE7QUFDdkMiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgbmljZS5saWIuY2l2ZXRcclxuXHJcbmltcG9ydCB7XHJcblx0dW5kZWYsIGRlZmluZWQsIG5vdGRlZmluZWQsIGFzc2VydCwgY3JvYWssIGhhc2gsIGhhc2hvZixcclxuXHRpc0FycmF5LCBpc0Z1bmN0aW9uLCBpc0Jvb2xlYW4sIGlzU3RyaW5nLCBpc0NsYXNzLCBpc0FycmF5T2ZTdHJpbmdzLFxyXG5cdGpzVHlwZSwgY2xhc3NOYW1lLCBmdW5jdGlvbk5hbWUsIHN5bWJvbE5hbWUsXHJcblx0bm9uRW1wdHksIGNsYXNzRGVmLCBmdW5jdGlvbkRlZiwgcmVnZXhwRGVmLFxyXG5cdH0gZnJvbSAnZGF0YXR5cGVzJ1xyXG5pbXBvcnQge1xyXG5cdGdldE9wdGlvbnMsIGVzY2FwZVN0ciwgdW5lc2NhcGVTdHIsXHJcblx0a2V5cywgdG9CbG9jaywgbywgT0wsIHJ0cmltLCBGZXRjaGVyLFxyXG5cdH0gZnJvbSAnbGx1dGlscydcclxuaW1wb3J0IHtcclxuXHRpbmRlbnRlZCxcclxuXHR9IGZyb20gJ2luZGVudCdcclxuaW1wb3J0IHtcclxuXHRUUExMVG9rZW4sIHRrRU9GLCB0a0luZGVudCwgdGtVbmRlbnQsXHJcblx0VFRva2VuR2VuZXJhdG9yLCBhbGxUb2tlbnNJbkJsb2NrLFxyXG5cdH0gZnJvbSAncGxsJ1xyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbnR5cGUgVENvbXBhcmVGdW5jID0gKGE6IHN0cmluZywgYjogc3RyaW5nKSA9PiBudW1iZXJcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgYWxwaGFDb21wYXJlOiBUQ29tcGFyZUZ1bmMgOj0gKFxyXG5cdFx0YTogc3RyaW5nLFxyXG5cdFx0Yjogc3RyaW5nXHJcblx0XHQpOiBudW1iZXIgPT5cclxuXHJcblx0cmV0dXJuIChhIDwgYikgPyAtMSA6IChhID4gYikgPyAxIDogMFxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiMgLS0tIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0OlxyXG4jICAgICAgICBjb21wYXJlcyAyIHN0cmluZ3MgYmFzZWQgb24gdGhlaXIgcG9zaXRpb24gaW4gbFNvcnRLZXlzXHJcbiMgICAgICAgIGVsc2UgY29tcGFyZXMgYWxwaGFiZXRpY2FsbHlcclxuXHJcbmdldENvbXBhcmVGdW5jIDo9IChcclxuXHRcdGxTb3J0S2V5czogc3RyaW5nW11cclxuXHRcdCk6IFRDb21wYXJlRnVuYyA9PlxyXG5cclxuXHQjIC0tLSBDcmVhdGUgbWFwIG9mIGtleSB0byBudW1iZXJcclxuXHRoOiBoYXNob2Y8bnVtYmVyPiA6PSB7fVxyXG5cdGZvciBrZXksaSBvZiBsU29ydEtleXNcclxuXHRcdGhba2V5XSA9IGkrMVxyXG5cclxuXHRyZXR1cm4gKGE6IHN0cmluZywgYjogc3RyaW5nKTogbnVtYmVyIC0+XHJcblx0XHRhVmFsIDo9IGhbYV1cclxuXHRcdGJWYWwgOj0gaFtiXVxyXG5cclxuXHRcdGlmIGRlZmluZWQoYVZhbClcclxuXHRcdFx0aWYgZGVmaW5lZChiVmFsKVxyXG5cdFx0XHRcdCMgLS0tIGNvbXBhcmUgbnVtZXJpY2FsbHlcclxuXHRcdFx0XHRyZXR1cm4gKGFWYWwgPCBiVmFsKSA/IC0xIDogKGFWYWwgPiBiVmFsKSA/IDEgOiAwXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRyZXR1cm4gLTFcclxuXHRcdGVsc2VcclxuXHRcdFx0aWYgZGVmaW5lZChiVmFsKVxyXG5cdFx0XHRcdHJldHVybiAxXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRyZXR1cm4gYWxwaGFDb21wYXJlKGEsIGIpXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IHRvTmljZSA6PSAoXHJcblx0XHR4OiB1bmtub3duLFxyXG5cdFx0aE9wdGlvbnM6IGhhc2g9e31cclxuXHRcdCk6IHN0cmluZyA9PlxyXG5cclxuXHQjIC0tLSBXaGVuIHN0cmljdCwgY2xhc3NlcyBhbmQgZnVuY3Rpb25cclxuXHQjICAgICBpbmNsdWRlIHRoZWlyIGRlZmluaXRpb25zLCB3aXRoIGVzY2FwZWQgY2hhcnNcclxuXHJcblx0dHlwZSBvcHQgPSB7XHJcblx0XHRzdHJpY3Q6IGJvb2xlYW5cclxuXHRcdHNvcnRGdW5jOiBUQ29tcGFyZUZ1bmM/XHJcblx0XHRzb3J0S2V5czogc3RyaW5nW10/XHJcblx0XHR9XHJcblx0e3N0cmljdCwgc29ydEZ1bmMsIHNvcnRLZXlzXHJcblx0XHR9IDo9IGdldE9wdGlvbnM8b3B0PiBoT3B0aW9ucywge1xyXG5cdFx0c3RyaWN0OiBmYWxzZVxyXG5cdFx0c29ydEZ1bmM6IHVuZGVmXHJcblx0XHRzb3J0S2V5czogdW5kZWZcclxuXHRcdH1cclxuXHJcblx0aWYgKHR5cGVvZiB4ID09ICd1bmRlZmluZWQnKVxyXG5cdFx0cmV0dXJuICcudW5kZWYuJ1xyXG5cclxuXHRpZiAodHlwZW9mIHggPT0gJ2JpZ2ludCcpXHJcblx0XHRyZXR1cm4geC50b1N0cmluZygpXHJcblxyXG5cdGlmICh0eXBlb2YgeCA9PSAnbnVtYmVyJylcclxuXHRcdHJldHVybiAoXHJcblx0XHRcdCAgTnVtYmVyLmlzTmFOKHgpICAgID8gJy5OYU4uJ1xyXG5cdFx0XHQ6IE51bWJlci5pc0Zpbml0ZSh4KSA/IHgudG9TdHJpbmcoKVxyXG5cdFx0XHQ6ICgoeCA8IDApID8gJy5uZWdpbmZpbml0eS4nIDogJy5pbmZpbml0eS4nKVxyXG5cdFx0XHQpXHJcblxyXG5cdGlmICh0eXBlb2YgeCA9PSAnZnVuY3Rpb24nKVxyXG5cdFx0aWYgaXNDbGFzcyh4KVxyXG5cdFx0XHRyZXR1cm4gXCIuY2xhc3MgI3tjbGFzc0RlZih4KX0uXCJcclxuXHRcdGVsc2VcclxuXHRcdFx0cmV0dXJuIFwiLmZ1bmN0aW9uICN7ZnVuY3Rpb25EZWYoeCl9LlwiXHJcblxyXG5cdGlmICh0eXBlb2YgeCA9PSAnb2JqZWN0JylcclxuXHJcblx0XHRpZiAoeCA9PSBudWxsKVxyXG5cdFx0XHRyZXR1cm4gJy5udWxsLidcclxuXHJcblx0XHRpZiBpc0FycmF5KHgpXHJcblx0XHRcdGlmICh4Lmxlbmd0aCA9PSAwKVxyXG5cdFx0XHRcdHJldHVybiAnLltdLidcclxuXHRcdFx0bExpbmVzIDo9IFtdXHJcblx0XHRcdGZvciBpdGVtIG9mIHhcclxuXHRcdFx0XHRibG9jayA6PSB0b05pY2UoaXRlbSwgaE9wdGlvbnMpXHJcblx0XHRcdFx0aWYgc2hvdWxkU3BsaXQoaXRlbSlcclxuXHRcdFx0XHRcdGxMaW5lcy5wdXNoICctJ1xyXG5cdFx0XHRcdFx0bExpbmVzLnB1c2ggaW5kZW50ZWQoYmxvY2spXHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0bExpbmVzLnB1c2ggXCItICN7YmxvY2t9XCJcclxuXHRcdFx0cmV0dXJuIHRvQmxvY2sobExpbmVzKVxyXG5cclxuXHRcdGlmICh4IGluc3RhbmNlb2YgU3RyaW5nKVxyXG5cdFx0XHRzIDo9IHgudG9TdHJpbmcoKVxyXG5cdFx0XHRpZiBuZWVkc1ByZUVzYyhzKVxyXG5cdFx0XHRcdHJldHVybiAnXFxcXCcgKyBlc2NhcGVTdHIocywgbydzdHlsZT1DJylcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdHJldHVybiBlc2NhcGVTdHIocywgbydzdHlsZT1DJylcclxuXHJcblx0XHRpZiAoeCBpbnN0YW5jZW9mIEJvb2xlYW4pXHJcblx0XHRcdHJldHVybiB4ID8gJy50cnVlLicgOiAnLmZhbHNlLidcclxuXHJcblx0XHRpZiAoeCBpbnN0YW5jZW9mIE51bWJlcilcclxuXHRcdFx0cmV0dXJuIHgudG9TdHJpbmcoKVxyXG5cclxuXHRcdGlmICh4IGluc3RhbmNlb2YgUmVnRXhwKVxyXG5cdFx0XHRkZWYgOj0gcmVnZXhwRGVmKHgpXHJcblx0XHRcdHJldHVybiBkZWYgPyBcIi5yZWdleHAgI3tkZWZ9LlwiIDogJy5yZWdleHAuJ1xyXG5cclxuI1x0XHRzb3J0S2V5c0Z1bmM6IFRDb21wYXJlRnVuYyA6PSAoXHJcbiNcdFx0XHQgIGlzQXJyYXkoc29ydEtleXMpICAgID8gZ2V0Q29tcGFyZUZ1bmMoc29ydEtleXMpXHJcbiNcdFx0XHQ6IGlzRnVuY3Rpb24oc29ydEtleXMpID8gc29ydEtleXNcclxuI1x0XHRcdDogICAgICAgICAgICAgICAgICAgICAgICBhbHBoYUNvbXBhcmVcclxuI1x0XHRcdClcclxuXHJcblx0XHRsZXQgc29ydEtleXNGdW5jOiBUQ29tcGFyZUZ1bmNcclxuXHRcdGlmIGRlZmluZWQoc29ydEZ1bmMpXHJcblx0XHRcdHNvcnRLZXlzRnVuYyA9IHNvcnRGdW5jXHJcblx0XHRlbHNlIGlmIGRlZmluZWQoc29ydEtleXMpXHJcblx0XHRcdHNvcnRLZXlzRnVuYyA9IGdldENvbXBhcmVGdW5jKHNvcnRLZXlzKVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRzb3J0S2V5c0Z1bmMgPSBhbHBoYUNvbXBhcmVcclxuXHJcblx0XHRsS2V5cyA6PSBPYmplY3Qua2V5cyh4KVxyXG5cdFx0aWYgKGxLZXlzLmxlbmd0aCA9PSAwKVxyXG5cdFx0XHRyZXR1cm4gJy57fS4nXHJcblx0XHRsTGluZXMgOj0gW11cclxuXHRcdGZvciBrZXkgb2YgbEtleXMuc29ydChzb3J0S2V5c0Z1bmMpXHJcblx0XHRcdGlmIGlzU3RyaW5nKGtleSlcclxuXHRcdFx0XHR2YWwgOj0gKHggYXMgaGFzaG9mPHVua25vd24+KVtrZXldXHJcblx0XHRcdFx0YmxvY2sgOj0gdG9OaWNlKHZhbCwgaE9wdGlvbnMpXHJcblx0XHRcdFx0aWYgc2hvdWxkU3BsaXQodmFsKVxyXG5cdFx0XHRcdFx0bExpbmVzLnB1c2ggXCIje2tleX06XCJcclxuXHRcdFx0XHRcdGxMaW5lcy5wdXNoIGluZGVudGVkKGJsb2NrKVxyXG5cdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdGxMaW5lcy5wdXNoIFwiI3trZXl9OiAje2Jsb2NrfVwiXHJcblx0XHRyZXR1cm4gdG9CbG9jayhsTGluZXMpXHJcblxyXG5cdGVsc2VcclxuXHRcdHJldHVybiBcIjxVbmtub3duIG9iamVjdCAje3h9PlwiXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IG5lZWRzUHJlRXNjIDo9IChzdHI6IHN0cmluZykgPT5cclxuXHJcblx0IyAtLS0gaWYgaXQgbG9va3MgbGlrZSBhbiBhcnJheSBpdGVtLCBpdCBuZWVkcyBsZWFkaW5nIFxcXHJcblx0aWYgc3RyLm1hdGNoKC9eLS8pXHJcblx0XHRyZXR1cm4gdHJ1ZVxyXG5cclxuXHQjIC0tLSBpZiBpdCBsb29rcyBsaWtlIGEgaGFzaCBrZXksIGl0IG5lZWRzIGxlYWRpbmcgXFxcclxuXHRpZiBzdHIubWF0Y2goL15bQS1aYS16XVtBLVphLXowLTlfXSo6LylcclxuXHRcdHJldHVybiB0cnVlXHJcblxyXG5cdCMgLS0tIGlmIGl0IGxvb2tzIGxpa2UgYSBudW1iZXIsIGl0IG5lZWRzIGxlYWRpbmcgXFxcclxuXHRpZiBzdHIubWF0Y2goL15cXGQrKD86XFwuXFxkKik/LylcclxuXHRcdHJldHVybiB0cnVlXHJcblxyXG5cdCMgLS0tIGlmIGl0IHN0YXJ0cyB3aXRoIGEgJy4nLCBpdCBuZWVkcyBsZWFkaW5nIFxcXHJcblx0aWYgKHN0ci5sZW5ndGggPiAwKSAmJiAoc3RyWzBdID09ICcuJylcclxuXHRcdHJldHVybiB0cnVlXHJcblxyXG5cdHJldHVybiBmYWxzZVxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbnNob3VsZFNwbGl0IDo9ICh4OiBhbnkpOiBib29sZWFuID0+XHJcblxyXG5cdHJldHVybiBbJ2hhc2gnLCdhcnJheScsJ2NsYXNzJywnaW5zdGFuY2UnXS5pbmNsdWRlcyhqc1R5cGUoeCkpXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IG5pY2VTcGxpdHRlcjogVFRva2VuR2VuZXJhdG9yIDo9IChcclxuXHRcdHN0cjogc3RyaW5nXHJcblx0XHQpIC0+XHJcblx0aWYgbGV0IGxNYXRjaGVzID0gc3RyLm1hdGNoKC8vL15cclxuXHRcdFx0LVxyXG5cdFx0XHQoLiopXHJcblx0XHRcdCQvLy8pXHJcblx0XHR0YWlsIDo9IGxNYXRjaGVzWzFdLnRyaW0oKVxyXG5cdFx0aWYgdGFpbFxyXG5cdFx0XHR5aWVsZCB7XHJcblx0XHRcdFx0a2luZDogJ2xpc3QtaXRlbSdcclxuXHRcdFx0XHRzdHJcclxuXHRcdFx0XHR2YWx1ZTogZ2V0UHJpbWl0aXZlKHRhaWwpXHJcblx0XHRcdFx0fVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHR5aWVsZCB7XHJcblx0XHRcdFx0a2luZDogJ2xpc3QtaGVhZCdcclxuXHRcdFx0XHRuYW1lOiBzdHJcclxuXHRcdFx0XHRzdHI6ICcnXHJcblx0XHRcdFx0fVxyXG5cdGVsc2UgaWYgbGV0IGxNYXRjaGVzID0gc3RyLm1hdGNoKC8vL15cclxuXHRcdFx0KFtBLVphLXpdW0EtWmEtejAtOV9dKilcclxuXHRcdFx0OlxyXG5cdFx0XHQoLiopXHJcblx0XHRcdCQvLy8pXHJcblx0XHRuYW1lIDo9IGxNYXRjaGVzWzFdXHJcblx0XHR0YWlsIDo9IGxNYXRjaGVzWzJdLnRyaW0oKVxyXG5cdFx0aWYgdGFpbFxyXG5cdFx0XHR5aWVsZCB7XHJcblx0XHRcdFx0a2luZDogJ2hhc2gtaXRlbSdcclxuXHRcdFx0XHRzdHJcclxuXHRcdFx0XHRuYW1lXHJcblx0XHRcdFx0dmFsdWU6IGdldFByaW1pdGl2ZSh0YWlsKVxyXG5cdFx0XHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdFx0eWllbGQge1xyXG5cdFx0XHRcdGtpbmQ6ICdoYXNoLWhlYWQnXHJcblx0XHRcdFx0bmFtZVxyXG5cdFx0XHRcdHN0clxyXG5cdFx0XHRcdH1cclxuXHRlbHNlXHJcblx0XHR5aWVsZCB7XHJcblx0XHRcdGtpbmQ6ICdwcmltaXRpdmUnXHJcblx0XHRcdHN0clxyXG5cdFx0XHR2YWx1ZTogZ2V0UHJpbWl0aXZlKHN0cilcclxuXHRcdFx0fVxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCBhbGxOaWNlVG9rZW5zIDo9IChcclxuXHRcdGJsb2NrOiBzdHJpbmcsXHJcblx0XHQpOiBHZW5lcmF0b3I8VFBMTFRva2VuLCB2b2lkLCB2b2lkPiAtPlxyXG5cclxuXHRmb3IgaCBvZiBhbGxUb2tlbnNJbkJsb2NrKGJsb2NrLCBuaWNlU3BsaXR0ZXIpXHJcblx0XHR5aWVsZCBoXHJcblx0cmV0dXJuXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IGZyb21OaWNlIDo9IChcclxuXHRcdHN0cjogc3RyaW5nLFxyXG5cdFx0KTogYW55ID0+XHJcblxyXG5cdCMgLS0tIENyZWF0ZSBhIEZldGNoZXIsIHRoZW4gdXNlXHJcblx0IyAgICAgcmVjdXJzaXZlIGRlc2NlbnQgcGFyc2luZ1xyXG5cclxuXHRmZXRjaGVyIDo9IG5ldyBGZXRjaGVyPFRQTExUb2tlbj4oYWxsTmljZVRva2VucyhzdHIpLCB0a0VPRilcclxuXHJcblx0cGFyc2VPYmogOj0gKCk6IGFueSA9PlxyXG5cdFx0e2tpbmQsIHN0cn0gOj0gZmV0Y2hlci5wZWVrKClcclxuXHRcdHN3aXRjaCBraW5kXHJcblx0XHRcdCdsaXN0LWl0ZW0nLCAnbGlzdC1oZWFkJ1xyXG5cdFx0XHRcdHJldHVybiBwYXJzZUxpc3QoKVxyXG5cdFx0XHQnaGFzaC1pdGVtJywgJ2hhc2gtaGVhZCdcclxuXHRcdFx0XHRyZXR1cm4gcGFyc2VIYXNoKClcclxuXHRcdFx0J2VvZidcclxuXHRcdFx0XHRyZXR1cm4gdW5kZWZcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGZldGNoZXIuc2tpcCgpXHJcblx0XHRcdFx0cmV0dXJuIGdldFByaW1pdGl2ZShzdHIpXHJcblxyXG5cdHBhcnNlTGlzdCA6PSAoKTogYW55W10gPT5cclxuXHRcdGxJdGVtczogYW55W10gOj0gW11cclxuXHRcdGxldCB7a2luZH0gPSBmZXRjaGVyLnBlZWsoKVxyXG5cdFx0d2hpbGUgWydsaXN0LWl0ZW0nLCAnbGlzdC1oZWFkJ10uaW5jbHVkZXMga2luZFxyXG5cdFx0XHRpZiAoa2luZCA9PSAnbGlzdC1oZWFkJylcclxuXHRcdFx0XHRsSXRlbXMucHVzaCBwYXJzZUxpc3ROZXN0KClcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGxJdGVtcy5wdXNoIGZldGNoZXIuZ2V0KCkudmFsdWVcclxuXHRcdFx0a2luZCA9IGZldGNoZXIucGVlaygpLmtpbmRcclxuXHRcdHJldHVybiBsSXRlbXNcclxuXHJcblx0cGFyc2VMaXN0TmVzdCA6PSAoKTogYW55W10gPT5cclxuXHRcdGZldGNoZXIuZ2V0KHtraW5kOiAnbGlzdC1oZWFkJywgc3RyOiAnJ30pXHJcblx0XHRmZXRjaGVyLmdldCh7a2luZDogJ2luZGVudCcsIHN0cjogJyd9KVxyXG5cdFx0dmFsdWUgOj0gcGFyc2VPYmooKVxyXG5cdFx0ZmV0Y2hlci5nZXQoe2tpbmQ6ICd1bmRlbnQnLCBzdHI6ICcnfSlcclxuXHRcdHJldHVybiB2YWx1ZVxyXG5cclxuXHRwYXJzZUhhc2ggOj0gKCk6IGhhc2ggPT5cclxuXHRcdGhJdGVtczogaGFzaCA6PSB7fVxyXG5cdFx0bGV0IHtraW5kLCBuYW1lfSA9IGZldGNoZXIucGVlaygpXHJcblx0XHRpZiAoa2luZCA9PSAnaGFzaC1oZWFkJylcclxuXHRcdFx0ZmV0Y2hlci5za2lwKClcclxuXHRcdFx0ZmV0Y2hlci5nZXQoe2tpbmQ6ICdpbmRlbnQnLCBzdHI6ICcnfSlcclxuXHRcdFx0dmFsdWUgOj0gcGFyc2VPYmooKVxyXG5cdFx0XHRpZiBkZWZpbmVkKG5hbWUpXHJcblx0XHRcdFx0aEl0ZW1zW25hbWVdID0gdmFsdWVcclxuXHRcdFx0ZmV0Y2hlci5nZXQoe2tpbmQ6ICd1bmRlbnQnLCBzdHI6ICcnfSlcclxuXHRcdGVsc2VcclxuXHRcdFx0d2hpbGUgKGtpbmQgPT0gJ2hhc2gtaXRlbScpXHJcblx0XHRcdFx0e25hbWUsIHZhbHVlfSA6PSBmZXRjaGVyLmdldCgpXHJcblx0XHRcdFx0aWYgZGVmaW5lZChuYW1lKVxyXG5cdFx0XHRcdFx0aEl0ZW1zW25hbWVdID0gdmFsdWVcclxuXHRcdFx0XHR7a2luZH0gPSBmZXRjaGVyLnBlZWsoKVxyXG5cdFx0cmV0dXJuIGhJdGVtc1xyXG5cclxuXHRkZWJ1Z2dlclxyXG5cdHJldHVybiBwYXJzZU9iaigpXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IGdldFByaW1pdGl2ZSA6PSAoXHJcblx0XHRzdHI6IHN0cmluZyxcclxuXHRcdCk6IGFueSA9PlxyXG5cclxuXHRzdHIgPSBzdHIudHJpbSgpXHJcblx0aWYgbE1hdGNoZXMgOj0gc3RyLm1hdGNoKC9eXFwuKC4qKVxcLiQvKVxyXG5cdFx0cyA6PSBsTWF0Y2hlc1sxXS50cmltKClcclxuXHRcdHN3aXRjaCBzXHJcblx0XHRcdCd1bmRlZicgICAgICAgdGhlbiByZXR1cm4gdW5kZWZcclxuXHRcdFx0J251bGwnICAgICAgICB0aGVuIHJldHVybiBudWxsXHJcblx0XHRcdCd0cnVlJyAgICAgICAgdGhlbiByZXR1cm4gdHJ1ZVxyXG5cdFx0XHQnZmFsc2UnICAgICAgIHRoZW4gcmV0dXJuIGZhbHNlXHJcblx0XHRcdCdOYU4nICAgICAgICAgdGhlbiByZXR1cm4gTmFOXHJcblx0XHRcdCdpbmZpbml0eScgICAgdGhlbiByZXR1cm4gSW5maW5pdHlcclxuXHRcdFx0J25lZ2luZmluaXR5JyB0aGVuIHJldHVybiAtSW5maW5pdHlcclxuXHRcdFx0J3N5bWJvbCcgICAgICB0aGVuIHJldHVybiBTeW1ib2woKVxyXG5cdFx0XHQnW10nICAgICAgICAgIHRoZW4gcmV0dXJuIFtdXHJcblx0XHRcdCd7fScgICAgICAgICAgdGhlbiByZXR1cm4ge31cclxuXHRcdFx0L15zeW1ib2xcXHMrKC4rKSQvXHJcblx0XHRcdFx0bE1hdGNoZXMgOj0gcy5tYXRjaCgvXnN5bWJvbFxccysoLispJC8pXHJcblx0XHRcdFx0aWYgZGVmaW5lZChsTWF0Y2hlcylcclxuXHRcdFx0XHRcdG5hbWUgOj0gbE1hdGNoZXNbMV1cclxuXHRcdFx0XHRcdHJldHVybiBTeW1ib2wobmFtZSlcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRyZXR1cm4gU3ltYm9sKClcclxuXHRcdFx0L15yZWdleHBcXHMrKC4rKSQvXHJcblx0XHRcdFx0bE1hdGNoZXMgOj0gcy5tYXRjaCgvXnJlZ2V4cFxccysoLispJC8pXHJcblx0XHRcdFx0aWYgZGVmaW5lZChsTWF0Y2hlcylcclxuXHRcdFx0XHRcdG5hbWUgOj0gbE1hdGNoZXNbMV1cclxuXHRcdFx0XHRcdHJldHVybiBuZXcgUmVnRXhwKG5hbWUpXHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0cmV0dXJuIG5ldyBSZWdFeHAoJ14kJylcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGNyb2FrIFwiTm90IEltcGxlbWVudGVkXCJcclxuXHRlbHNlIGlmIHN0ci5tYXRjaCgvXlxcZCskLylcclxuXHRcdHJldHVybiBwYXJzZUludChzdHIsIDEwKVxyXG5cdGVsc2UgaWYgc3RyLm1hdGNoKC9eXFxkK1xcLlxcZCokLylcclxuXHRcdHJldHVybiBwYXJzZUZsb2F0KHN0cilcclxuXHRlbHNlXHJcblx0XHRyZXR1cm4gdW5lc2NhcGVTdHIoc3RyLCBvJ3B1cnBvc2U9QycpXHJcbiJdfQ==