"use strict";
// nice.civet

import {
	undef, defined, notdefined, assert, hash,
	isArray, isFunction, isBoolean, isString,
	jsType, className, functionName, symbolName,
	nonEmpty, functionDef, regexpDef,
	} from './datatypes.lib.ts'
import {
	getOptions, escapeStr, unescapeStr,
	keys, toBlock, o, OL, croak, rtrim, Fetcher,
	} from './llutils.lib.ts'
import {
	indented,
	} from './indent.lib.ts'
import {
	Token, TTokenGenerator, allTokensInBlock,
	} from './tokens.lib.ts'

type TCompareFunc = (a: string, b: string) => number

// ---------------------------------------------------------------------------

export const niceSplitter: TTokenGenerator = function*(
		str: string
		) {
	let ref;let ref1;if ((ref = str.match(/^-(.*)$/))) {let lMatches = ref;
		const tail = lMatches[1].trim()
		if (tail) {
			yield {
				kind: 'list-item',
				str,
				value: getPrimitive(tail)
				}
		}
		else {
			yield {
				kind: 'list-head',
				str
				}
		}
	}
	else if ((ref1 = str.match(/^([A-Za-z][A-Za-z0-9_]*):(.*)$/))) {let lMatches = ref1;
		const name = lMatches[1]
		const tail = lMatches[2].trim()
		if (tail) {
			yield {
				kind: 'hash-item',
				str,
				name,
				value: getPrimitive(tail)
				}
		}
		else {
			yield {
				kind: 'hash-head',
				name,
				str
				}
		}
	}
	else {
		yield {
			kind: 'primitive',
			str,
			value: getPrimitive(str)
			}
	}
}

// ---------------------------------------------------------------------------

const getCompareFunc = (lSortKeys: string[]): TCompareFunc => {

	// --- Convert to a function
	const h: hash = {}
	let i1 = 0;for (const key of lSortKeys) {const i = i1++;
		h[key] = i+1
	}

	return function(a: string, b: string): number {
		const aVal = h[a]
		const bVal = h[b]

		if (defined(aVal)) {
			if (defined(bVal)) {
				// --- compare numerically
				return (aVal < bVal) ? -1 : (aVal > bVal) ? 1 : 0
			}
			else {
				return -1
			}
		}
		else {
			if (defined(bVal)) {
				return 1
			}
			else {
				return (a < b) ? -1 : (a > b) ? 1 : 0
			}
		}
	}
}

// ---------------------------------------------------------------------------

export const toNice = (x: any, hOptions: hash={}): string => {

	switch(jsType(x)) {
		case 'undef': {
			return '.undef.'
		}
		case 'boolean': {
			return x ? '.true.' : '.false.'
		}
		case 'string': {
			if (needsEsc(x)) {
				return '\\' + escapeStr(x, o`style=C`)
			}
			else {
				return escapeStr(x, o`style=C`)
			}
		}
		case 'NaN': {
			return '.NaN.'
		}
		case 'infinity': {
			return (x > 0) ? '.infinity.' : '.neginfinity.'
		}
		case 'number':case 'integer': {
			return x.toString()
		}
		case 'class': {
			const name = className(x)
			return name ? `.class ${name}.` : '.class'
		}
		case 'function': {
			const name = functionName(x)
			return name ? `.function ${name}.` : ".function."
		}
		case 'symbol': {
			const name = symbolName(x)
			return name ? `.symbol ${name}.` : ".symbol."
		}
		case 'regexp': {
			const def = regexpDef(x)
			return def ? `.regexp ${def}.` : '.regexp.'
		}

		case 'array': {
			if (x.length === 0) {
				return '.[].'
			}
			const lLines = []
			for (const item of x) {
				const block = toNice(item, hOptions)
				if (shouldSplit(item)) {
					lLines.push('-')
					lLines.push(indented(block))
				}
				else {
					lLines.push(`- ${block}`)
				}
			}
			return toBlock(lLines)
		}

		case 'hash':case 'instance': {
			const {sortKeys} = getOptions(hOptions, {
				sortKeys: false    // --- can be boolean/array/function
				})

			const sortKeysFunc: TCompareFunc = (
				  isArray(sortKeys)    ? getCompareFunc(sortKeys)
				: isFunction(sortKeys) ? sortKeys
				:                        (a: string, b: string) => { return (a < b) ? -1 : (a > b) ? 1 : 0 }
				)

			const lKeys = Object.keys(x)
			if (lKeys.length === 0) {
				return '.{}.'
			}
			const lLines = []
			if (sortKeys === true) {
				lKeys.sort()
			}
			else if (sortKeys !== false) {
				lKeys.sort(sortKeysFunc)
			}
			for (const key of lKeys) {
				assert(isString(key), `key not a string: ${OL(key)}`)
				const val = x[key]
				const block = toNice(val, hOptions)
				if (shouldSplit(val)) {
					lLines.push(`${key}:`)
					lLines.push(indented(block))
				}
				else {
					lLines.push(`${key}: ${block}`)
				}
			}
			return toBlock(lLines)
		}
		default: {
			return `<Unknown object ${x}`
		}
	}
}

// ---------------------------------------------------------------------------

export const needsEsc = (str: string) => {

	// --- if it looks like an array item, it needs quotes
	if (str.match(/^-/)) {
		return true
	}

	// --- if it looks like a hash key, it needs quotes
	if (str.match(/^[A-Za-z][A-Za-z0-9_]*:/)) {
		return true
	}

	// --- if it looks like a number, it needs quotes
	if (str.match(/^\d+(?:\.\d*)?/)) {
		return true
	}

	return false
}

// ---------------------------------------------------------------------------

const shouldSplit = (x: any): boolean => {

	return ['hash','array','class','instance'].includes(jsType(x))
}

// ---------------------------------------------------------------------------

export const allNiceTokens = function*(
		block: string,
		): Generator<Token, void, void> {

	for (const h of allTokensInBlock(block, niceSplitter)) {
		yield h
	}
	return
}

// ---------------------------------------------------------------------------

export const fromNice = (
		str: string,
		): any => {

	// --- Create a Fetcher, then use
	//     recursive descent parsing

	let ref2;let ref3;if ((ref2 = str.match(/^-(?:\s+(.*))?$/))) {const lMatches = ref2;
		// --- an array
		croak("Not Implemented")
	}
	else if ((ref3 = str.match(/^([A-Za-z][A-Za-z0-9_]*)\:\s+(.*)$/))) {const lMatches = ref3;
		// --- a hash
		croak("Not Implemented")
	}
	else {
		return getPrimitive(str)
	}
}

// ---------------------------------------------------------------------------

export const getPrimitive = (
		str: string,
		): any => {

	str = rtrim(str)
	let ref4;if ((ref4 = str.match(/^\.(.*)\.$/))) {const lMatches = ref4;
		const s = lMatches[1].trim()
		if(s === 'undef') { return undef}
else if(s === 'true') { return true}
else if(s === 'false') { return false}
else if(s === 'NaN') { return NaN}
else if(s === 'infinity') { return Infinity}
else if(s === 'neginfinity') { return -Infinity}
else if(s === 'symbol') { return Symbol()}
else if(s === '[]') { return []}
else if(s === '{}') { return {}}
else if(typeof s === 'string' && /^symbol\s+(.+)$/.test(s)) {
				const lMatches = s.match(/^symbol\s+(.+)$/)
				if (defined(lMatches)) {
					const name = lMatches[1]
					return Symbol(name)
				}
				else {
					return Symbol()
				}}
else if(typeof s === 'string' && /^regexp\s+(.+)$/.test(s)) {
				const lMatches = s.match(/^regexp\s+(.+)$/)
				if (defined(lMatches)) {
					const name = lMatches[1]
					return new RegExp(name)
				}
				else {
					return new RegExp('^$')
				}}
else  {
				croak("Not Implemented")
			}
	}
	else if (str.match(/^\d+$/)) {
		return parseInt(str, 10)
	}
	else if (str.match(/^\d+\.\d*$/)) {
		return parseFloat(str)
	}
	else {
		return unescapeStr(str, o`purpose=C`)
	}
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9uaWNlLmxpYi5jaXZldC50c3giLCJzb3VyY2VzIjpbInNyYy9saWIvbmljZS5saWIuY2l2ZXQiXSwibWFwcGluZ3MiOiI7QUFBQSxhQUFZO0FBQ1osQUFBQTtBQUNBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQztBQUMxQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztBQUMxQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLFVBQVUsQ0FBQztBQUM3QyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CO0FBQzVCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsVUFBVSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFDO0FBQ3BDLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQzdDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0I7QUFDMUIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxRQUFRLENBQUM7QUFDVixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCO0FBQ3pCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsS0FBSyxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsZ0JBQWdCLENBQUM7QUFDMUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQjtBQUN6QixBQUFBO0FBQ0EsQUFBQSxBQUFBLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU07QUFDcEQsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUE4QixNQUE3QixZQUFZLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBRSxDQUVuQyxRLENBRm9DLENBQUM7QUFDekMsQUFBQSxFQUFFLEdBQUcsQ0FBQyxDQUFDLE1BQU07QUFDYixFQUFFLENBQUksQ0FBQSxDQUFBO0FBQ04sQUFBQSxDLEksRyxDLEksSSxDQUFDLEdBQUcsQyxDLEdBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFHLENBQUMsQUFDOUIsQ0FBQyxBQUNELElBQUksQUFDSixDQUFDLENBQUcsQyxDQUFDLENBQUEsQ0FBQSxDQUhKLEdBQUcsQ0FBQyxRLEcsRyxDQUdBO0FBQ1IsQUFBQSxFQUFNLE1BQUosSUFBSSxDQUFDLENBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDNUIsQUFBQSxFQUFFLEdBQUcsQ0FBQSxJQUFJLENBQUEsQ0FBQSxDQUFBO0FBQ1QsQUFBQSxHQUFHLEtBQUssQ0FBQyxDQUFDO0FBQ1YsQUFBQSxJQUFJLElBQUksQ0FBQyxDQUFDLFdBQVcsQ0FBQTtBQUNyQixBQUFBLElBQUksR0FBRyxDQUFBO0FBQ1AsQUFBQSxJQUFJLEtBQUssQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUM7QUFDN0IsSUFBSSxDO0VBQUMsQ0FBQTtBQUNMLEFBQUEsRUFBRSxJQUFJLENBQUEsQ0FBQTtBQUNOLEFBQUEsR0FBRyxLQUFLLENBQUMsQ0FBQztBQUNWLEFBQUEsSUFBSSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUE7QUFDckIsQUFBQSxJQUFJLEdBQUc7QUFDUCxJQUFJLEM7RUFBQyxDO0NBQUEsQ0FBQTtBQUNMLEFBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDLEMsSUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUcsQ0FBQyxBQUNuQyxDQUFDLFFBQVEsWUFBWSxFQUFFLEFBQ3ZCLENBQUMsQUFDRCxJQUFJLEFBQ0osQ0FBQyxDQUFHLEMsQ0FBQyxDQUFBLENBQUEsQ0FKQyxHQUFHLENBQUMsUSxHLEksQ0FJTDtBQUNSLEFBQUEsRUFBTSxNQUFKLElBQUksQ0FBQyxDQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztBQUNyQixBQUFBLEVBQU0sTUFBSixJQUFJLENBQUMsQ0FBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM1QixBQUFBLEVBQUUsR0FBRyxDQUFBLElBQUksQ0FBQSxDQUFBLENBQUE7QUFDVCxBQUFBLEdBQUcsS0FBSyxDQUFDLENBQUM7QUFDVixBQUFBLElBQUksSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFBO0FBQ3JCLEFBQUEsSUFBSSxHQUFHLENBQUE7QUFDUCxBQUFBLElBQUksSUFBSSxDQUFBO0FBQ1IsQUFBQSxJQUFJLEtBQUssQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUM7QUFDN0IsSUFBSSxDO0VBQUMsQ0FBQTtBQUNMLEFBQUEsRUFBRSxJQUFJLENBQUEsQ0FBQTtBQUNOLEFBQUEsR0FBRyxLQUFLLENBQUMsQ0FBQztBQUNWLEFBQUEsSUFBSSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUE7QUFDckIsQUFBQSxJQUFJLElBQUksQ0FBQTtBQUNSLEFBQUEsSUFBSSxHQUFHO0FBQ1AsSUFBSSxDO0VBQUMsQztDQUFBLENBQUE7QUFDTCxBQUFBLENBQUMsSUFBSSxDQUFBLENBQUE7QUFDTCxBQUFBLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDVCxBQUFBLEdBQUcsSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFBO0FBQ3BCLEFBQUEsR0FBRyxHQUFHLENBQUE7QUFDTixBQUFBLEdBQUcsS0FBSyxDQUFDLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQztBQUMzQixHQUFHLEM7Q0FBQyxDO0FBQUEsQ0FBQTtBQUNKLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQSxBQUFjLE1BQWQsY0FBYyxDQUFDLENBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUN4RCxBQUFBO0FBQ0EsQUFBQSxDQUFDLDRCQUEyQjtBQUM1QixBQUFBLENBQVEsTUFBUCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQztBQUNkLEFBQUEsQyxJLEUsSSxDQUFDLEdBQUcsQ0FBQyxDQUFBLE1BQUEsR0FBSyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUEsQ0FBQSxDQUFkLE1BQUEsQyxHLEUsRSxDQUFjO0FBQ3ZCLEFBQUEsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLEMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDO0NBQUMsQ0FBQTtBQUNkLEFBQUE7QUFDQSxBQUFBLENBQUMsTUFBTSxDQUFnQyxRQUEvQixDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBUyxDQUFBLENBQUE7QUFDekMsQUFBQSxFQUFNLE1BQUosSUFBSSxDQUFDLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2QsQUFBQSxFQUFNLE1BQUosSUFBSSxDQUFDLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2QsQUFBQTtBQUNBLEFBQUEsRUFBRSxHQUFHLENBQUEsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNsQixBQUFBLEdBQUcsR0FBRyxDQUFBLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDbkIsQUFBQSxJQUFJLDBCQUF5QjtBQUM3QixBQUFBLElBQUksTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDO0dBQUMsQ0FBQTtBQUNyRCxBQUFBLEdBQUcsSUFBSSxDQUFBLENBQUE7QUFDUCxBQUFBLElBQUksTUFBTSxDQUFDLENBQUMsQztHQUFDLEM7RUFBQSxDQUFBO0FBQ2IsQUFBQSxFQUFFLElBQUksQ0FBQSxDQUFBO0FBQ04sQUFBQSxHQUFHLEdBQUcsQ0FBQSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ25CLEFBQUEsSUFBSSxNQUFNLENBQUMsQztHQUFDLENBQUE7QUFDWixBQUFBLEdBQUcsSUFBSSxDQUFBLENBQUE7QUFDUCxBQUFBLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDO0dBQUMsQztFQUFBLEM7Q0FBQSxDO0FBQUEsQ0FBQTtBQUN6QyxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQU8sTUFBTixNQUFNLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDdkQsQUFBQTtBQUNBLEFBQUEsQ0FBQyxNQUFNLENBQUEsQUFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ2pCLEFBQUEsRUFB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Q0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDeEIsQUFBQSxLQUFTLE1BQUosSUFBSSxDQUFDLENBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBQ3hCLEFBQUEsS0FBSyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEM7SUFBQyxDQUFBO0FBQzVCLEFBQUEsSUFBSSxJQUFJLENBQUEsQ0FBQTtBQUNSLEFBQUEsS0FBSyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEM7SUFBQyxDLEM7S0FDckIsQ0FBQSxDQUFBO0FBQ1AsQUFBQSxJQUFJLEtBQUssQ0FBQSxBQUFDLGlCQUFpQixDO0dBQUEsQztDQUFBLENBQUE7QUFDM0IsQUFBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUEsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDM0IsQUFBQSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDO0NBQUMsQ0FBQTtBQUMxQixBQUFBLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQSxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNoQyxBQUFBLEVBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEM7Q0FBQyxDQUFBO0FBQ3hCLEFBQUEsQ0FBQyxJQUFJLENBQUEsQ0FBQTtBQUNMLEFBQUEsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEMsV0FBWSxDO0NBQUMsQztBQUFBLENBQUE7QUFDdkMiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgbmljZS5jaXZldFxyXG5cclxuaW1wb3J0IHtcclxuXHR1bmRlZiwgZGVmaW5lZCwgbm90ZGVmaW5lZCwgYXNzZXJ0LCBoYXNoLFxyXG5cdGlzQXJyYXksIGlzRnVuY3Rpb24sIGlzQm9vbGVhbiwgaXNTdHJpbmcsXHJcblx0anNUeXBlLCBjbGFzc05hbWUsIGZ1bmN0aW9uTmFtZSwgc3ltYm9sTmFtZSxcclxuXHRub25FbXB0eSwgZnVuY3Rpb25EZWYsIHJlZ2V4cERlZixcclxuXHR9IGZyb20gJy4vZGF0YXR5cGVzLmxpYi50cydcclxuaW1wb3J0IHtcclxuXHRnZXRPcHRpb25zLCBlc2NhcGVTdHIsIHVuZXNjYXBlU3RyLFxyXG5cdGtleXMsIHRvQmxvY2ssIG8sIE9MLCBjcm9haywgcnRyaW0sIEZldGNoZXIsXHJcblx0fSBmcm9tICcuL2xsdXRpbHMubGliLnRzJ1xyXG5pbXBvcnQge1xyXG5cdGluZGVudGVkLFxyXG5cdH0gZnJvbSAnLi9pbmRlbnQubGliLnRzJ1xyXG5pbXBvcnQge1xyXG5cdFRva2VuLCBUVG9rZW5HZW5lcmF0b3IsIGFsbFRva2Vuc0luQmxvY2ssXHJcblx0fSBmcm9tICcuL3Rva2Vucy5saWIudHMnXHJcblxyXG50eXBlIFRDb21wYXJlRnVuYyA9IChhOiBzdHJpbmcsIGI6IHN0cmluZykgPT4gbnVtYmVyXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IG5pY2VTcGxpdHRlcjogVFRva2VuR2VuZXJhdG9yIDo9IChcclxuXHRcdHN0cjogc3RyaW5nXHJcblx0XHQpIC0+XHJcblx0aWYgbGV0IGxNYXRjaGVzID0gc3RyLm1hdGNoKC8vL15cclxuXHRcdFx0LVxyXG5cdFx0XHQoLiopXHJcblx0XHRcdCQvLy8pXHJcblx0XHR0YWlsIDo9IGxNYXRjaGVzWzFdLnRyaW0oKVxyXG5cdFx0aWYgdGFpbFxyXG5cdFx0XHR5aWVsZCB7XHJcblx0XHRcdFx0a2luZDogJ2xpc3QtaXRlbSdcclxuXHRcdFx0XHRzdHJcclxuXHRcdFx0XHR2YWx1ZTogZ2V0UHJpbWl0aXZlKHRhaWwpXHJcblx0XHRcdFx0fVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHR5aWVsZCB7XHJcblx0XHRcdFx0a2luZDogJ2xpc3QtaGVhZCdcclxuXHRcdFx0XHRzdHJcclxuXHRcdFx0XHR9XHJcblx0ZWxzZSBpZiBsZXQgbE1hdGNoZXMgPSBzdHIubWF0Y2goLy8vXlxyXG5cdFx0XHQoW0EtWmEtel1bQS1aYS16MC05X10qKVxyXG5cdFx0XHQ6XHJcblx0XHRcdCguKilcclxuXHRcdFx0JC8vLylcclxuXHRcdG5hbWUgOj0gbE1hdGNoZXNbMV1cclxuXHRcdHRhaWwgOj0gbE1hdGNoZXNbMl0udHJpbSgpXHJcblx0XHRpZiB0YWlsXHJcblx0XHRcdHlpZWxkIHtcclxuXHRcdFx0XHRraW5kOiAnaGFzaC1pdGVtJ1xyXG5cdFx0XHRcdHN0clxyXG5cdFx0XHRcdG5hbWVcclxuXHRcdFx0XHR2YWx1ZTogZ2V0UHJpbWl0aXZlKHRhaWwpXHJcblx0XHRcdFx0fVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHR5aWVsZCB7XHJcblx0XHRcdFx0a2luZDogJ2hhc2gtaGVhZCdcclxuXHRcdFx0XHRuYW1lXHJcblx0XHRcdFx0c3RyXHJcblx0XHRcdFx0fVxyXG5cdGVsc2VcclxuXHRcdHlpZWxkIHtcclxuXHRcdFx0a2luZDogJ3ByaW1pdGl2ZSdcclxuXHRcdFx0c3RyXHJcblx0XHRcdHZhbHVlOiBnZXRQcmltaXRpdmUoc3RyKVxyXG5cdFx0XHR9XHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZ2V0Q29tcGFyZUZ1bmMgOj0gKGxTb3J0S2V5czogc3RyaW5nW10pOiBUQ29tcGFyZUZ1bmMgPT5cclxuXHJcblx0IyAtLS0gQ29udmVydCB0byBhIGZ1bmN0aW9uXHJcblx0aDogaGFzaCA6PSB7fVxyXG5cdGZvciBrZXksaSBvZiBsU29ydEtleXNcclxuXHRcdGhba2V5XSA9IGkrMVxyXG5cclxuXHRyZXR1cm4gKGE6IHN0cmluZywgYjogc3RyaW5nKTogbnVtYmVyIC0+XHJcblx0XHRhVmFsIDo9IGhbYV1cclxuXHRcdGJWYWwgOj0gaFtiXVxyXG5cclxuXHRcdGlmIGRlZmluZWQoYVZhbClcclxuXHRcdFx0aWYgZGVmaW5lZChiVmFsKVxyXG5cdFx0XHRcdCMgLS0tIGNvbXBhcmUgbnVtZXJpY2FsbHlcclxuXHRcdFx0XHRyZXR1cm4gKGFWYWwgPCBiVmFsKSA/IC0xIDogKGFWYWwgPiBiVmFsKSA/IDEgOiAwXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRyZXR1cm4gLTFcclxuXHRcdGVsc2VcclxuXHRcdFx0aWYgZGVmaW5lZChiVmFsKVxyXG5cdFx0XHRcdHJldHVybiAxXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRyZXR1cm4gKGEgPCBiKSA/IC0xIDogKGEgPiBiKSA/IDEgOiAwXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IHRvTmljZSA6PSAoeDogYW55LCBoT3B0aW9uczogaGFzaD17fSk6IHN0cmluZyA9PlxyXG5cclxuXHRzd2l0Y2gganNUeXBlKHgpXHJcblx0XHR3aGVuICd1bmRlZidcclxuXHRcdFx0cmV0dXJuICcudW5kZWYuJ1xyXG5cdFx0d2hlbiAnYm9vbGVhbidcclxuXHRcdFx0cmV0dXJuIHggPyAnLnRydWUuJyA6ICcuZmFsc2UuJ1xyXG5cdFx0d2hlbiAnc3RyaW5nJ1xyXG5cdFx0XHRpZiBuZWVkc0VzYyh4KVxyXG5cdFx0XHRcdHJldHVybiAnXFxcXCcgKyBlc2NhcGVTdHIoeCwgbydzdHlsZT1DJylcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdHJldHVybiBlc2NhcGVTdHIoeCwgbydzdHlsZT1DJylcclxuXHRcdHdoZW4gJ05hTidcclxuXHRcdFx0cmV0dXJuICcuTmFOLidcclxuXHRcdHdoZW4gJ2luZmluaXR5J1xyXG5cdFx0XHRyZXR1cm4gKHggPiAwKSA/ICcuaW5maW5pdHkuJyA6ICcubmVnaW5maW5pdHkuJ1xyXG5cdFx0d2hlbiAnbnVtYmVyJywnaW50ZWdlcidcclxuXHRcdFx0cmV0dXJuIHgudG9TdHJpbmcoKVxyXG5cdFx0d2hlbiAnY2xhc3MnXHJcblx0XHRcdG5hbWUgOj0gY2xhc3NOYW1lKHgpXHJcblx0XHRcdHJldHVybiBuYW1lID8gXCIuY2xhc3MgI3tuYW1lfS5cIiA6ICcuY2xhc3MnXHJcblx0XHR3aGVuICdmdW5jdGlvbidcclxuXHRcdFx0bmFtZSA6PSBmdW5jdGlvbk5hbWUoeClcclxuXHRcdFx0cmV0dXJuIG5hbWUgPyBcIi5mdW5jdGlvbiAje25hbWV9LlwiIDogXCIuZnVuY3Rpb24uXCJcclxuXHRcdHdoZW4gJ3N5bWJvbCdcclxuXHRcdFx0bmFtZSA6PSBzeW1ib2xOYW1lKHgpXHJcblx0XHRcdHJldHVybiBuYW1lID8gXCIuc3ltYm9sICN7bmFtZX0uXCIgOiBcIi5zeW1ib2wuXCJcclxuXHRcdHdoZW4gJ3JlZ2V4cCdcclxuXHRcdFx0ZGVmIDo9IHJlZ2V4cERlZih4KVxyXG5cdFx0XHRyZXR1cm4gZGVmID8gXCIucmVnZXhwICN7ZGVmfS5cIiA6ICcucmVnZXhwLidcclxuXHJcblx0XHR3aGVuICdhcnJheSdcclxuXHRcdFx0aWYgKHgubGVuZ3RoID09IDApXHJcblx0XHRcdFx0cmV0dXJuICcuW10uJ1xyXG5cdFx0XHRsTGluZXMgOj0gW11cclxuXHRcdFx0Zm9yIGl0ZW0gb2YgeFxyXG5cdFx0XHRcdGJsb2NrIDo9IHRvTmljZShpdGVtLCBoT3B0aW9ucylcclxuXHRcdFx0XHRpZiBzaG91bGRTcGxpdChpdGVtKVxyXG5cdFx0XHRcdFx0bExpbmVzLnB1c2ggJy0nXHJcblx0XHRcdFx0XHRsTGluZXMucHVzaCBpbmRlbnRlZChibG9jaylcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRsTGluZXMucHVzaCBcIi0gI3tibG9ja31cIlxyXG5cdFx0XHRyZXR1cm4gdG9CbG9jayhsTGluZXMpXHJcblxyXG5cdFx0d2hlbiAnaGFzaCcsJ2luc3RhbmNlJ1xyXG5cdFx0XHR7c29ydEtleXN9IDo9IGdldE9wdGlvbnMgaE9wdGlvbnMsIHtcclxuXHRcdFx0XHRzb3J0S2V5czogZmFsc2UgICAgIyAtLS0gY2FuIGJlIGJvb2xlYW4vYXJyYXkvZnVuY3Rpb25cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRzb3J0S2V5c0Z1bmM6IFRDb21wYXJlRnVuYyA6PSAoXHJcblx0XHRcdFx0ICBpc0FycmF5KHNvcnRLZXlzKSAgICA/IGdldENvbXBhcmVGdW5jKHNvcnRLZXlzKVxyXG5cdFx0XHRcdDogaXNGdW5jdGlvbihzb3J0S2V5cykgPyBzb3J0S2V5c1xyXG5cdFx0XHRcdDogICAgICAgICAgICAgICAgICAgICAgICAoYTogc3RyaW5nLCBiOiBzdHJpbmcpID0+IHJldHVybiAoYSA8IGIpID8gLTEgOiAoYSA+IGIpID8gMSA6IDBcclxuXHRcdFx0XHQpXHJcblxyXG5cdFx0XHRsS2V5cyA6PSBPYmplY3Qua2V5cyh4KVxyXG5cdFx0XHRpZiAobEtleXMubGVuZ3RoID09IDApXHJcblx0XHRcdFx0cmV0dXJuICcue30uJ1xyXG5cdFx0XHRsTGluZXMgOj0gW11cclxuXHRcdFx0aWYgKHNvcnRLZXlzID09IHRydWUpXHJcblx0XHRcdFx0bEtleXMuc29ydCgpXHJcblx0XHRcdGVsc2UgaWYgKHNvcnRLZXlzICE9IGZhbHNlKVxyXG5cdFx0XHRcdGxLZXlzLnNvcnQoc29ydEtleXNGdW5jKVxyXG5cdFx0XHRmb3Iga2V5IG9mIGxLZXlzXHJcblx0XHRcdFx0YXNzZXJ0IGlzU3RyaW5nKGtleSksIFwia2V5IG5vdCBhIHN0cmluZzogI3tPTChrZXkpfVwiXHJcblx0XHRcdFx0dmFsIDo9IHhba2V5XVxyXG5cdFx0XHRcdGJsb2NrIDo9IHRvTmljZSh2YWwsIGhPcHRpb25zKVxyXG5cdFx0XHRcdGlmIHNob3VsZFNwbGl0KHZhbClcclxuXHRcdFx0XHRcdGxMaW5lcy5wdXNoIFwiI3trZXl9OlwiXHJcblx0XHRcdFx0XHRsTGluZXMucHVzaCBpbmRlbnRlZChibG9jaylcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRsTGluZXMucHVzaCBcIiN7a2V5fTogI3tibG9ja31cIlxyXG5cdFx0XHRyZXR1cm4gdG9CbG9jayhsTGluZXMpXHJcblx0XHRlbHNlXHJcblx0XHRcdHJldHVybiBcIjxVbmtub3duIG9iamVjdCAje3h9XCJcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgbmVlZHNFc2MgOj0gKHN0cjogc3RyaW5nKSA9PlxyXG5cclxuXHQjIC0tLSBpZiBpdCBsb29rcyBsaWtlIGFuIGFycmF5IGl0ZW0sIGl0IG5lZWRzIHF1b3Rlc1xyXG5cdGlmIHN0ci5tYXRjaCgvXi0vKVxyXG5cdFx0cmV0dXJuIHRydWVcclxuXHJcblx0IyAtLS0gaWYgaXQgbG9va3MgbGlrZSBhIGhhc2gga2V5LCBpdCBuZWVkcyBxdW90ZXNcclxuXHRpZiBzdHIubWF0Y2goL15bQS1aYS16XVtBLVphLXowLTlfXSo6LylcclxuXHRcdHJldHVybiB0cnVlXHJcblxyXG5cdCMgLS0tIGlmIGl0IGxvb2tzIGxpa2UgYSBudW1iZXIsIGl0IG5lZWRzIHF1b3Rlc1xyXG5cdGlmIHN0ci5tYXRjaCgvXlxcZCsoPzpcXC5cXGQqKT8vKVxyXG5cdFx0cmV0dXJuIHRydWVcclxuXHJcblx0cmV0dXJuIGZhbHNlXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuc2hvdWxkU3BsaXQgOj0gKHg6IGFueSk6IGJvb2xlYW4gPT5cclxuXHJcblx0cmV0dXJuIFsnaGFzaCcsJ2FycmF5JywnY2xhc3MnLCdpbnN0YW5jZSddLmluY2x1ZGVzKGpzVHlwZSh4KSlcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgYWxsTmljZVRva2VucyA6PSAoXHJcblx0XHRibG9jazogc3RyaW5nLFxyXG5cdFx0KTogR2VuZXJhdG9yPFRva2VuLCB2b2lkLCB2b2lkPiAtPlxyXG5cclxuXHRmb3IgaCBvZiBhbGxUb2tlbnNJbkJsb2NrKGJsb2NrLCBuaWNlU3BsaXR0ZXIpXHJcblx0XHR5aWVsZCBoXHJcblx0cmV0dXJuXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IGZyb21OaWNlIDo9IChcclxuXHRcdHN0cjogc3RyaW5nLFxyXG5cdFx0KTogYW55ID0+XHJcblxyXG5cdCMgLS0tIENyZWF0ZSBhIEZldGNoZXIsIHRoZW4gdXNlXHJcblx0IyAgICAgcmVjdXJzaXZlIGRlc2NlbnQgcGFyc2luZ1xyXG5cclxuXHRpZiBsTWF0Y2hlcyA6PSBzdHIubWF0Y2goLy8vXlxyXG5cdFx0XHQtXHJcblx0XHRcdCg/OlxyXG5cdFx0XHRcdFxccytcclxuXHRcdFx0XHQoLiopXHJcblx0XHRcdFx0KT9cclxuXHRcdFx0JC8vLylcclxuXHRcdCMgLS0tIGFuIGFycmF5XHJcblx0XHRjcm9hayBcIk5vdCBJbXBsZW1lbnRlZFwiXHJcblx0ZWxzZSBpZiBsTWF0Y2hlcyA6PSBzdHIubWF0Y2goLy8vXlxyXG5cdFx0XHQoW0EtWmEtel1bQS1aYS16MC05X10qKVxyXG5cdFx0XHRcXDpcclxuXHRcdFx0XFxzKyguKilcclxuXHRcdFx0JC8vLylcclxuXHRcdCMgLS0tIGEgaGFzaFxyXG5cdFx0Y3JvYWsgXCJOb3QgSW1wbGVtZW50ZWRcIlxyXG5cdGVsc2VcclxuXHRcdHJldHVybiBnZXRQcmltaXRpdmUoc3RyKVxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCBnZXRQcmltaXRpdmUgOj0gKFxyXG5cdFx0c3RyOiBzdHJpbmcsXHJcblx0XHQpOiBhbnkgPT5cclxuXHJcblx0c3RyID0gcnRyaW0oc3RyKVxyXG5cdGlmIGxNYXRjaGVzIDo9IHN0ci5tYXRjaCgvXlxcLiguKilcXC4kLylcclxuXHRcdHMgOj0gbE1hdGNoZXNbMV0udHJpbSgpXHJcblx0XHRzd2l0Y2ggc1xyXG5cdFx0XHQndW5kZWYnIHRoZW4gcmV0dXJuIHVuZGVmXHJcblx0XHRcdCd0cnVlJyAgdGhlbiByZXR1cm4gdHJ1ZVxyXG5cdFx0XHQnZmFsc2UnIHRoZW4gcmV0dXJuIGZhbHNlXHJcblx0XHRcdCdOYU4nICAgdGhlbiByZXR1cm4gTmFOXHJcblx0XHRcdCdpbmZpbml0eScgICB0aGVuIHJldHVybiBJbmZpbml0eVxyXG5cdFx0XHQnbmVnaW5maW5pdHknICAgdGhlbiByZXR1cm4gLUluZmluaXR5XHJcblx0XHRcdCdzeW1ib2wnIHRoZW4gcmV0dXJuIFN5bWJvbCgpXHJcblx0XHRcdCdbXScgICAgIHRoZW4gcmV0dXJuIFtdXHJcblx0XHRcdCd7fScgICAgIHRoZW4gcmV0dXJuIHt9XHJcblx0XHRcdC9ec3ltYm9sXFxzKyguKykkL1xyXG5cdFx0XHRcdGxNYXRjaGVzIDo9IHMubWF0Y2goL15zeW1ib2xcXHMrKC4rKSQvKVxyXG5cdFx0XHRcdGlmIGRlZmluZWQobE1hdGNoZXMpXHJcblx0XHRcdFx0XHRuYW1lIDo9IGxNYXRjaGVzWzFdXHJcblx0XHRcdFx0XHRyZXR1cm4gU3ltYm9sKG5hbWUpXHJcblx0XHRcdFx0ZWxzZVxyXG5cdFx0XHRcdFx0cmV0dXJuIFN5bWJvbCgpXHJcblx0XHRcdC9ecmVnZXhwXFxzKyguKykkL1xyXG5cdFx0XHRcdGxNYXRjaGVzIDo9IHMubWF0Y2goL15yZWdleHBcXHMrKC4rKSQvKVxyXG5cdFx0XHRcdGlmIGRlZmluZWQobE1hdGNoZXMpXHJcblx0XHRcdFx0XHRuYW1lIDo9IGxNYXRjaGVzWzFdXHJcblx0XHRcdFx0XHRyZXR1cm4gbmV3IFJlZ0V4cChuYW1lKVxyXG5cdFx0XHRcdGVsc2VcclxuXHRcdFx0XHRcdHJldHVybiBuZXcgUmVnRXhwKCdeJCcpXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRjcm9hayBcIk5vdCBJbXBsZW1lbnRlZFwiXHJcblx0ZWxzZSBpZiBzdHIubWF0Y2goL15cXGQrJC8pXHJcblx0XHRyZXR1cm4gcGFyc2VJbnQoc3RyLCAxMClcclxuXHRlbHNlIGlmIHN0ci5tYXRjaCgvXlxcZCtcXC5cXGQqJC8pXHJcblx0XHRyZXR1cm4gcGFyc2VGbG9hdChzdHIpXHJcblx0ZWxzZVxyXG5cdFx0cmV0dXJuIHVuZXNjYXBlU3RyKHN0ciwgbydwdXJwb3NlPUMnKVxyXG4iXX0=