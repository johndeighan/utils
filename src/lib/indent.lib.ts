"use strict";
// indent.lib.civet

import {
	undef, defined, notdefined, assert, croak, array,
	isString, isArray, isArrayOfStrings, hash, hashof, isHash,
	integer, isInteger,
	} from 'datatypes'
import {
	rtrim, countChars, escapeStr, getOptions,
	blockToArray, arrayToBlock, toArray, toBlock,
	widthOf, heightOf, blockify, keys,
	} from 'llutils'

export let oneIndent: (string | undefined) = undef

// ---------------------------------------------------------------------------

export const resetOneIndent = (str: (string | undefined)=undef): void => {

	oneIndent = str
	return
}

// ---------------------------------------------------------------------------

export const indentLevel = (line: string): number => {

	// --- This will always match, and it's greedy
	//     (but TypeScript doesn't know that)
	const [prefix] = line.match(/^\s*/) || ['']

	if (prefix.length === 0) {
		return 0
	}

	// --- Check if we're using TABs or spaces
	const numTABs = countChars(prefix, "\t")
	const numSpaces = countChars(prefix, " ")
	assert((numTABs===0) || (numSpaces===0),
		`Invalid mix of TABs and spaces in ${escapeStr(line)}`)

	// --- oneIndent must be one of:
	//        undef
	//        a single TAB character
	//        some number of space characters

	// --- Set variables oneIndent & level
	switch(oneIndent) {
		case undef: {
			if (numTABs > 0) {
				oneIndent = "\t"
				return numTABs
			}
			else {
				oneIndent = ' '.repeat(numSpaces)
				return 1
			}
		}
		case "\t": {
			assert((numSpaces===0), "Expecting TABs, found spaces")
			return numTABs
		}
		default: {
			// --- using some number of spaces
			assert((numTABs === 0), "Expecting spaces, found TABs")
			assert((numSpaces % oneIndent.length === 0), `Invalid num spaces: ${numSpaces},
oneIndent = ${escapeStr(oneIndent)}`)
			return numSpaces / oneIndent.length
		}
	}
}

// ---------------------------------------------------------------------------

export type lineDesc = [
	level: number,
	text: string
	]

export const splitLine = (line: string): lineDesc => {

	const [_, prefix, str] = line.match(/^(\s*)(.*)$/) || ['', '', '']
	return [indentLevel(prefix), str.trim()]
}

// ---------------------------------------------------------------------------

export function indented(
		input: string,
		hOptions?: hash
		): string
export function indented(
		input: string[],
		hOptions?: hash
		): string[]
export function indented(
		input: string | string[],
		hOptions: hash = {}
		): string | string[] {

	// --- Because there's a global named oneIndent,
	//     we have to put the option in a new variable, i.e. 'ind'
	type opt = {
		oneIndent: (string | undefined)
		level: integer
		}
	const {oneIndent: ind, level} = getOptions<opt>(hOptions, {
		oneIndent: undef,
		level: 1
		})

	const useIndent: string = (
		  defined(ind) ? ind
		: defined(oneIndent) ? oneIndent
		: '\t'
		)

	const lLines: string[] = isArray(input) ? input : input.split('\n')
	const results=[];for (const line of lLines) {
		results.push(useIndent.repeat(level) + line)
	};const lNewLines: string[] =results
	return isArray(input) ? lNewLines : lNewLines.join('\n')
	}

// ---------------------------------------------------------------------------

export const undented = (input: string | string[]): string | string[] => {

	// --- input must be either a string or array of strings
	const lLines = toArray(input)

	// --- NOTE: leave empty lines empty

	let toRemove: (string | undefined)  = undef
	let nToRemove: number = 0
	const lNewLines: string[] = []
	for (const line of lLines) {
		const trimmed = rtrim(line)
		if (trimmed === '') {
			lNewLines.push('')
		}
		else if (notdefined(toRemove)) {
			const [_, prefix, rest] = trimmed.match(/^(\s*)(.*)$/) || ['','','']
			if (prefix.length === 0) {
				lNewLines.push(trimmed)
			}
			else {
				toRemove = prefix
				nToRemove = prefix.length
				lNewLines.push(rest)
			}
		}
		else {
			assert((line.indexOf(toRemove) === 0),
				`can't remove ${escapeStr(toRemove)} from ${escapeStr(line)}`)
			lNewLines.push(trimmed.substr(nToRemove))
		}
	}

	return isString(input) ? arrayToBlock(lNewLines) : lNewLines
}

// ---------------------------------------------------------------------------

export type TBlockDesc = string[] | {[key: string]: TBlockDesc}

export const Blockify = (
		desc: TBlockDesc,
		hOptions: hash = {}
		): string => {

	type opt = {
		sep: string
		endsep: string
		oneIndent: string
		width: number
		}
	const {sep, endsep, width, oneIndent,
		} = getOptions<opt>(hOptions, {
		sep: ' ',
		endsep: '',
		oneIndent: '   ',
		width: 64
		})

	if (isArray(desc)) {
		if (desc.length === 0) {
			return ''
		}    // --- has 0 height
		else {
			return blockify(desc, hOptions)
		}
	}
	else {
		// --- width must be reduced since block will be indented
		const hOpts = {sep, endsep, oneIndent, width: width-3}

		const results1=[];for (const label of keys(desc)) {
			const block = Blockify(desc[label], hOpts)
			if (heightOf(block) === 0) {
				results1.push(`${label}: (none)`)
			}
			else if ((heightOf(block) === 1) && (label.length + widthOf(block) < width)) {
				results1.push(`${label}: ${block}`)
			}
			else {
				results1.push(`${label}:\n${indented(block, {oneIndent})}`)
			}
		};const lParts =results1
		return lParts.join('\n')
	}
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxqb2huZFxcdXRpbHNcXHNyY1xcbGliXFxpbmRlbnQubGliLmNpdmV0LnRzeCIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxqb2huZFxcdXRpbHNcXHNyY1xcbGliXFxpbmRlbnQubGliLmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEsbUJBQWtCO0FBQ2xCLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUM7QUFDbEQsQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUMzRCxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUNwQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVztBQUNuQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFVBQVUsQ0FBQztBQUMxQyxDQUFDLFlBQVksQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUM5QyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQztBQUNuQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUztBQUNqQixBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxDLEMsQ0FBQyxBQUFDLE0sWSxDQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUs7QUFDckMsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFlLE1BQWQsY0FB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QyxJQUFJLENBQUMsQ0FBQyxDQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztBQUNsRSxBQUFBLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUE7QUFDMUIsQUFBQSxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUEsQUFBQyxPQUFPLEM7R0FBQSxDQUFBO0FBQzFCLEFBQUEsR0FBRyxJQUFJLENBQUEsQ0FBQTtBQUNQLEFBQUEsSUFBSSxRQUFRLEMsQ0FBRSxDQUFDLE1BQU07QUFDckIsQUFBQSxJQUFJLFNBQVMsQyxDQUFFLENBQUMsTUFBTSxDQUFDLE1BQU07QUFDN0IsQUFBQSxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUEsQUFBQyxJQUFJLEM7R0FBQSxDO0VBQUEsQ0FBQTtBQUN2QixBQUFBLEVBQUUsSUFBSSxDQUFBLENBQUE7QUFDTixBQUFBLEdBQUcsTUFBTSxDQUFBLEFBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4QyxBQUFBLElBQUksQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ2pFLEFBQUEsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFBLEFBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQztFQUFBLEM7Q0FBQSxDQUFBO0FBQzNDLEFBQUE7QUFDQSxBQUFBLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTO0FBQVMsQ0FBQTtBQUM3RCxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNB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QUMsQ0FBQyxHQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDNUUsQUFBQSxJLFEsTUFBSSxDQUFDLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQyxDO0dBQUMsQ0FBQTtBQUN4QixBQUFBLEdBQUcsSUFBSSxDQUFBLENBQUE7QUFDUCxBQUFBLEksUSxNQUFJLENBQUMsRUFBRSxLQUFLLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQyxDO0dBQUMsQztFQUFBLEMsQ0FQeEMsTUFBTixNQUFNLENBQUMsQyxRQU91QztBQUNoRCxBQUFBLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDO0NBQUMsQztBQUFBLENBQUE7QUFDMUIiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgaW5kZW50LmxpYi5jaXZldFxyXG5cclxuaW1wb3J0IHtcclxuXHR1bmRlZiwgZGVmaW5lZCwgbm90ZGVmaW5lZCwgYXNzZXJ0LCBjcm9haywgYXJyYXksXHJcblx0aXNTdHJpbmcsIGlzQXJyYXksIGlzQXJyYXlPZlN0cmluZ3MsIGhhc2gsIGhhc2hvZiwgaXNIYXNoLFxyXG5cdGludGVnZXIsIGlzSW50ZWdlcixcclxuXHR9IGZyb20gJ2RhdGF0eXBlcydcclxuaW1wb3J0IHtcclxuXHRydHJpbSwgY291bnRDaGFycywgZXNjYXBlU3RyLCBnZXRPcHRpb25zLFxyXG5cdGJsb2NrVG9BcnJheSwgYXJyYXlUb0Jsb2NrLCB0b0FycmF5LCB0b0Jsb2NrLFxyXG5cdHdpZHRoT2YsIGhlaWdodE9mLCBibG9ja2lmeSwga2V5cyxcclxuXHR9IGZyb20gJ2xsdXRpbHMnXHJcblxyXG5leHBvcnQgbGV0IG9uZUluZGVudDogc3RyaW5nPyA9IHVuZGVmXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IHJlc2V0T25lSW5kZW50IDo9IChzdHI6IHN0cmluZz89dW5kZWYpOiB2b2lkID0+XHJcblxyXG5cdG9uZUluZGVudCA9IHN0clxyXG5cdHJldHVyblxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCBpbmRlbnRMZXZlbCA6PSAobGluZTogc3RyaW5nKTogbnVtYmVyID0+XHJcblxyXG5cdCMgLS0tIFRoaXMgd2lsbCBhbHdheXMgbWF0Y2gsIGFuZCBpdCdzIGdyZWVkeVxyXG5cdCMgICAgIChidXQgVHlwZVNjcmlwdCBkb2Vzbid0IGtub3cgdGhhdClcclxuXHRbcHJlZml4XSA6PSBsaW5lLm1hdGNoKC9eXFxzKi8pIHx8IFsnJ11cclxuXHJcblx0aWYgKHByZWZpeC5sZW5ndGggPT0gMClcclxuXHRcdHJldHVybiAwXHJcblxyXG5cdCMgLS0tIENoZWNrIGlmIHdlJ3JlIHVzaW5nIFRBQnMgb3Igc3BhY2VzXHJcblx0bnVtVEFCcyA6PSBjb3VudENoYXJzKHByZWZpeCwgXCJcXHRcIilcclxuXHRudW1TcGFjZXMgOj0gY291bnRDaGFycyhwcmVmaXgsIFwiIFwiKVxyXG5cdGFzc2VydCAobnVtVEFCcz09MCkgfHwgKG51bVNwYWNlcz09MCksXHJcblx0XHRcIkludmFsaWQgbWl4IG9mIFRBQnMgYW5kIHNwYWNlcyBpbiAje2VzY2FwZVN0cihsaW5lKX1cIlxyXG5cclxuXHQjIC0tLSBvbmVJbmRlbnQgbXVzdCBiZSBvbmUgb2Y6XHJcblx0IyAgICAgICAgdW5kZWZcclxuXHQjICAgICAgICBhIHNpbmdsZSBUQUIgY2hhcmFjdGVyXHJcblx0IyAgICAgICAgc29tZSBudW1iZXIgb2Ygc3BhY2UgY2hhcmFjdGVyc1xyXG5cclxuXHQjIC0tLSBTZXQgdmFyaWFibGVzIG9uZUluZGVudCAmIGxldmVsXHJcblx0c3dpdGNoIG9uZUluZGVudFxyXG5cdFx0d2hlbiB1bmRlZlxyXG5cdFx0XHRpZiAobnVtVEFCcyA+IDApXHJcblx0XHRcdFx0b25lSW5kZW50ID0gXCJcXHRcIlxyXG5cdFx0XHRcdHJldHVybiBudW1UQUJzXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRvbmVJbmRlbnQgPSAnICcucmVwZWF0KG51bVNwYWNlcylcclxuXHRcdFx0XHRyZXR1cm4gMVxyXG5cdFx0d2hlbiBcIlxcdFwiXHJcblx0XHRcdGFzc2VydCAobnVtU3BhY2VzPT0wKSwgXCJFeHBlY3RpbmcgVEFCcywgZm91bmQgc3BhY2VzXCJcclxuXHRcdFx0cmV0dXJuIG51bVRBQnNcclxuXHRcdGVsc2VcclxuXHRcdFx0IyAtLS0gdXNpbmcgc29tZSBudW1iZXIgb2Ygc3BhY2VzXHJcblx0XHRcdGFzc2VydCAobnVtVEFCcyA9PSAwKSwgXCJFeHBlY3Rpbmcgc3BhY2VzLCBmb3VuZCBUQUJzXCJcclxuXHRcdFx0YXNzZXJ0IChudW1TcGFjZXMgJSBvbmVJbmRlbnQubGVuZ3RoID09IDApLCBcIlwiXCJcclxuXHRcdFx0XHRcdEludmFsaWQgbnVtIHNwYWNlczogI3tudW1TcGFjZXN9LFxyXG5cdFx0XHRcdFx0b25lSW5kZW50ID0gI3tlc2NhcGVTdHIob25lSW5kZW50KX1cclxuXHRcdFx0XHRcdFwiXCJcIlxyXG5cdFx0XHRyZXR1cm4gbnVtU3BhY2VzIC8gb25lSW5kZW50Lmxlbmd0aFxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCB0eXBlIGxpbmVEZXNjID0gW1xyXG5cdGxldmVsOiBudW1iZXJcclxuXHR0ZXh0OiBzdHJpbmdcclxuXHRdXHJcblxyXG5leHBvcnQgc3BsaXRMaW5lIDo9IChsaW5lOiBzdHJpbmcpOiBsaW5lRGVzYyA9PlxyXG5cclxuXHRbXywgcHJlZml4LCBzdHJdIDo9IGxpbmUubWF0Y2goL14oXFxzKikoLiopJC8pIHx8IFsnJywgJycsICcnXVxyXG5cdHJldHVybiBbaW5kZW50TGV2ZWwocHJlZml4KSwgc3RyLnRyaW0oKV1cclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaW5kZW50ZWQoXHJcblx0XHRpbnB1dDogc3RyaW5nLFxyXG5cdFx0aE9wdGlvbnM/OiBoYXNoXHJcblx0XHQpOiBzdHJpbmdcclxuZXhwb3J0IGZ1bmN0aW9uIGluZGVudGVkKFxyXG5cdFx0aW5wdXQ6IHN0cmluZ1tdLFxyXG5cdFx0aE9wdGlvbnM/OiBoYXNoXHJcblx0XHQpOiBzdHJpbmdbXVxyXG5leHBvcnQgZnVuY3Rpb24gaW5kZW50ZWQoXHJcblx0XHRpbnB1dDogc3RyaW5nIHwgc3RyaW5nW10sXHJcblx0XHRoT3B0aW9uczogaGFzaCA9IHt9XHJcblx0XHQpOiBzdHJpbmcgfCBzdHJpbmdbXSB7XHJcblxyXG5cdCMgLS0tIEJlY2F1c2UgdGhlcmUncyBhIGdsb2JhbCBuYW1lZCBvbmVJbmRlbnQsXHJcblx0IyAgICAgd2UgaGF2ZSB0byBwdXQgdGhlIG9wdGlvbiBpbiBhIG5ldyB2YXJpYWJsZSwgaS5lLiAnaW5kJ1xyXG5cdHR5cGUgb3B0ID0ge1xyXG5cdFx0b25lSW5kZW50OiBzdHJpbmc/XHJcblx0XHRsZXZlbDogaW50ZWdlclxyXG5cdFx0fVxyXG5cdHtvbmVJbmRlbnQ6IGluZCwgbGV2ZWx9IDo9IGdldE9wdGlvbnM8b3B0PiBoT3B0aW9ucywge1xyXG5cdFx0b25lSW5kZW50OiB1bmRlZlxyXG5cdFx0bGV2ZWw6IDFcclxuXHRcdH1cclxuXHJcblx0dXNlSW5kZW50OiBzdHJpbmcgOj0gKFxyXG5cdFx0ICBkZWZpbmVkKGluZCkgPyBpbmRcclxuXHRcdDogZGVmaW5lZChvbmVJbmRlbnQpID8gb25lSW5kZW50XHJcblx0XHQ6ICdcXHQnXHJcblx0XHQpXHJcblxyXG5cdGxMaW5lczogc3RyaW5nW10gOj0gaXNBcnJheShpbnB1dCkgPyBpbnB1dCA6IGlucHV0LnNwbGl0KCdcXG4nKVxyXG5cdGxOZXdMaW5lczogc3RyaW5nW10gOj0gZm9yIGxpbmUgb2YgbExpbmVzXHJcblx0XHR1c2VJbmRlbnQucmVwZWF0KGxldmVsKSArIGxpbmVcclxuXHRyZXR1cm4gaXNBcnJheShpbnB1dCkgPyBsTmV3TGluZXMgOiBsTmV3TGluZXMuam9pbignXFxuJylcclxuXHR9XHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IHVuZGVudGVkIDo9IChpbnB1dDogc3RyaW5nIHwgc3RyaW5nW10pOiBzdHJpbmcgfCBzdHJpbmdbXSA9PlxyXG5cclxuXHQjIC0tLSBpbnB1dCBtdXN0IGJlIGVpdGhlciBhIHN0cmluZyBvciBhcnJheSBvZiBzdHJpbmdzXHJcblx0bExpbmVzIDo9IHRvQXJyYXkoaW5wdXQpXHJcblxyXG5cdCMgLS0tIE5PVEU6IGxlYXZlIGVtcHR5IGxpbmVzIGVtcHR5XHJcblxyXG5cdGxldCB0b1JlbW92ZTogc3RyaW5nPyAgPSB1bmRlZlxyXG5cdGxldCBuVG9SZW1vdmU6IG51bWJlciA9IDBcclxuXHRsTmV3TGluZXM6IHN0cmluZ1tdIDo9IFtdXHJcblx0Zm9yIGxpbmUgb2YgbExpbmVzXHJcblx0XHR0cmltbWVkIDo9IHJ0cmltKGxpbmUpXHJcblx0XHRpZiAodHJpbW1lZCA9PSAnJylcclxuXHRcdFx0bE5ld0xpbmVzLnB1c2ggJydcclxuXHRcdGVsc2UgaWYgbm90ZGVmaW5lZCh0b1JlbW92ZSlcclxuXHRcdFx0W18sIHByZWZpeCwgcmVzdF0gOj0gdHJpbW1lZC5tYXRjaCgvXihcXHMqKSguKikkLykgfHwgWycnLCcnLCcnXVxyXG5cdFx0XHRpZiAocHJlZml4Lmxlbmd0aCA9PSAwKVxyXG5cdFx0XHRcdGxOZXdMaW5lcy5wdXNoIHRyaW1tZWRcclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdHRvUmVtb3ZlID0gcHJlZml4XHJcblx0XHRcdFx0blRvUmVtb3ZlID0gcHJlZml4Lmxlbmd0aFxyXG5cdFx0XHRcdGxOZXdMaW5lcy5wdXNoIHJlc3RcclxuXHRcdGVsc2VcclxuXHRcdFx0YXNzZXJ0IChsaW5lLmluZGV4T2YodG9SZW1vdmUpID09IDApLFxyXG5cdFx0XHRcdFwiY2FuJ3QgcmVtb3ZlICN7ZXNjYXBlU3RyKHRvUmVtb3ZlKX0gZnJvbSAje2VzY2FwZVN0cihsaW5lKX1cIlxyXG5cdFx0XHRsTmV3TGluZXMucHVzaCB0cmltbWVkLnN1YnN0cihuVG9SZW1vdmUpXHJcblxyXG5cdHJldHVybiBpc1N0cmluZyhpbnB1dCkgPyBhcnJheVRvQmxvY2sobE5ld0xpbmVzKSA6IGxOZXdMaW5lc1xyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCB0eXBlIFRCbG9ja0Rlc2MgPSBzdHJpbmdbXSB8IHtba2V5OiBzdHJpbmddOiBUQmxvY2tEZXNjfVxyXG5cclxuZXhwb3J0IEJsb2NraWZ5IDo9IChcclxuXHRcdGRlc2M6IFRCbG9ja0Rlc2NcclxuXHRcdGhPcHRpb25zOiBoYXNoID0ge31cclxuXHRcdCk6IHN0cmluZyA9PlxyXG5cclxuXHR0eXBlIG9wdCA9IHtcclxuXHRcdHNlcDogc3RyaW5nXHJcblx0XHRlbmRzZXA6IHN0cmluZ1xyXG5cdFx0b25lSW5kZW50OiBzdHJpbmdcclxuXHRcdHdpZHRoOiBudW1iZXJcclxuXHRcdH1cclxuXHR7c2VwLCBlbmRzZXAsIHdpZHRoLCBvbmVJbmRlbnQsXHJcblx0XHR9IDo9IGdldE9wdGlvbnM8b3B0PiBoT3B0aW9ucywge1xyXG5cdFx0c2VwOiAnICdcclxuXHRcdGVuZHNlcDogJydcclxuXHRcdG9uZUluZGVudDogJyAgICdcclxuXHRcdHdpZHRoOiA2NFxyXG5cdFx0fVxyXG5cclxuXHRpZiBpc0FycmF5KGRlc2MpXHJcblx0XHRpZiAoZGVzYy5sZW5ndGggPT0gMClcclxuXHRcdFx0cmV0dXJuICcnICAgICMgLS0tIGhhcyAwIGhlaWdodFxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRyZXR1cm4gYmxvY2tpZnkgZGVzYywgaE9wdGlvbnNcclxuXHRlbHNlXHJcblx0XHQjIC0tLSB3aWR0aCBtdXN0IGJlIHJlZHVjZWQgc2luY2UgYmxvY2sgd2lsbCBiZSBpbmRlbnRlZFxyXG5cdFx0aE9wdHMgOj0ge3NlcCwgZW5kc2VwLCBvbmVJbmRlbnQsIHdpZHRoOiB3aWR0aC0zfVxyXG5cclxuXHRcdGxQYXJ0cyA6PSBmb3IgbGFiZWwgb2Yga2V5cyhkZXNjKVxyXG5cdFx0XHRibG9jayA6PSBCbG9ja2lmeSBkZXNjW2xhYmVsXSwgaE9wdHNcclxuXHRcdFx0aWYgKGhlaWdodE9mKGJsb2NrKSA9PSAwKVxyXG5cdFx0XHRcdFwiI3tsYWJlbH06IChub25lKVwiXHJcblx0XHRcdGVsc2UgaWYgKGhlaWdodE9mKGJsb2NrKSA9PSAxKSAmJiAobGFiZWwubGVuZ3RoICsgd2lkdGhPZihibG9jaykgPCB3aWR0aClcclxuXHRcdFx0XHRcIiN7bGFiZWx9OiAje2Jsb2NrfVwiXHJcblx0XHRcdGVsc2VcclxuXHRcdFx0XHRcIiN7bGFiZWx9OlxcbiN7aW5kZW50ZWQoYmxvY2ssIHtvbmVJbmRlbnR9KX1cIlxyXG5cdFx0cmV0dXJuIGxQYXJ0cy5qb2luKCdcXG4nKVxyXG4iXX0=