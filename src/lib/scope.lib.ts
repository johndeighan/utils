"use strict";
// scope.lib.civet

import {
	undef, defined, notdefined, assert, croak, hash,
	} from 'datatypes'
import {hasKey} from 'llutils'
import {LOG} from 'logger'

// ---------------------------------------------------------------------------

export class CScope {
	name: (string | undefined)      // --- undef for anonymous functions
	sDefined = new Set<string>()
	sUsed = new Set<string>()
	parent: (CScope | undefined)
	lChildren: CScope[]

	// ..........................................................

	*allDefined(): Generator<string, void, void> {

		for (const name of this.sDefined.values()) {
			yield name
		}
		return
	}

	// ..........................................................

	getDefined(): string[] {

		return Array.from(this.sDefined.keys())
	}

	// ..........................................................

	*allUsed(): Generator<string, void, void> {

		for (const name of this.sUsed.values()) {
			yield name
		}
		return
	}

	// ..........................................................

	getUsed(): string[] {

		return Array.from(this.sUsed.keys())
	}

	// ..........................................................

	asString(): string {

		return `----------
NAME: ${this.name || '.undef'}
DEFINED: ${this.getDefined().join(' ')}
USED: ${this.getUsed().join(' ')}
PARENT: ${defined(this.parent) ? this.parent.name : '.undef'}
CHILDREN: ${this.lChildren.length}`
	}

	// ..........................................................

	constructor(
			name1: (string | undefined),
			lArgs: string[],
			parent1: (CScope | undefined) = undef
			) {

		this.name = name1;

		this.parent = parent1;

		for (const name of lArgs) {
			this.define(name)
		}
		this.lChildren = []
	}

	// ..........................................................

	newChildScope(
			name: (string | undefined),
			lArgs: string[]
			) {

		const scope = new CScope(name, lArgs, this)
		this.lChildren.push(scope)
		return scope
	}

	// ..........................................................

	define(name: string): void {

		this.sDefined.add(name)
		return
	}

	// ..........................................................

	use(name: string): void {

		this.sUsed.add(name)
		return
	}

	// ..........................................................
	// --- is name defined in current function or any ancestor

	isDefined(name: string): boolean {

		if (this.sDefined.has(name)) {
			return true
		}

		if (defined(this.parent)) {
			return this.parent.isDefined(name)
		}

		return false
	}

	// ..........................................................
	// --- is name used in the current scope or in child scopes

	isUsed(name: string): boolean {

		if (this.sUsed.has(name)) {
			return true
		}

		for (const childScope of this.lChildren) {
			if (childScope.isUsed(name)) {
				return true
			}
		}

		return false
	}
}

// ---------------------------------------------------------------------------

export class CMainScope extends CScope {

	constructor() {

		super('main', [])
	}

	// ..........................................................

	newScope(name: (string | undefined), lArgs: string[]): CScope {

		return this.newChildScope(name, lArgs)
	}

	// ..........................................................

	endScope(scope: CScope): (CScope | undefined) {

		return scope.parent
	}
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvam9obmQvdXRpbHMvc3JjL2xpYi9zY29wZS5saWIuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJDOi9Vc2Vycy9qb2huZC91dGlscy9zcmMvbGliL3Njb3BlLmxpYi5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLGtCQUFpQjtBQUNqQixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ2pELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXO0FBQ25CLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUztBQUM5QixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVE7QUFDMUIsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUEsQ0FBQTtBQUNuQixBQUFBLENBQUMsSUFBSSxDLEMsQ0FBQyxBQUFDLE0sWSxDQUFPLE1BQU0sb0NBQW1DO0FBQ3ZELEFBQUEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUM3QixBQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDMUIsQUFBQSxDQUFDLE1BQU0sQyxDLENBQUMsQUFBQyxNLFksQ0FBTztBQUNoQixBQUFBLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDcEIsQUFBQTtBQUNBLEFBQUEsQ0FBQyw2REFBNEQ7QUFDN0QsQUFBQTtBQUNBLEFBQUEsQyxDLFVBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQTtBQUM1QyxBQUFBO0FBQ0EsQUFBQSxFQUFFLEdBQUcsQ0FBQyxDQUFBLE1BQUEsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ2hDLEFBQUEsR0FBRyxLQUFLLENBQUMsSTtFQUFJLENBQUE7QUFDYixBQUFBLEVBQUUsTTtDQUFNLENBQUE7QUFDUixBQUFBO0FBQ0EsQUFBQSxDQUFDLDZEQUE0RDtBQUM3RCxBQUFBO0FBQ0EsQUFBQSxDLFVBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFBLENBQUE7QUFDdkIsQUFBQTtBQUNBLEFBQUEsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEM7Q0FBQyxDQUFBO0FBQ3JDLEFBQUE7QUFDQSxBQUFBLENBQUMsNkRBQTREO0FBQzdELEFBQUE7QUFDQSxBQUFBLEMsQyxPQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUE7QUFDekMsQUFBQTtBQUNBLEFBQUEsRUFBRSxHQUFHLENBQUMsQ0FBQSxNQUFBLElBQUksQ0FBQyxFQUFFLENBQUMsSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUM3QixBQUFBLEdBQUcsS0FBSyxDQUFDLEk7RUFBSSxDQUFBO0FBQ2IsQUFBQSxFQUFFLE07Q0FBTSxDQUFBO0FBQ1IsQUFBQTtBQUNBLEFBQUEsQ0FBQyw2REFBNEQ7QUFDN0QsQUFBQTtBQUNBLEFBQUEsQyxPQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQSxDQUFBO0FBQ3BCLEFBQUE7QUFDQSxB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WyIjIHNjb3BlLmxpYi5jaXZldFxuXG5pbXBvcnQge1xuXHR1bmRlZiwgZGVmaW5lZCwgbm90ZGVmaW5lZCwgYXNzZXJ0LCBjcm9haywgaGFzaCxcblx0fSBmcm9tICdkYXRhdHlwZXMnXG5pbXBvcnQge2hhc0tleX0gZnJvbSAnbGx1dGlscydcbmltcG9ydCB7TE9HfSBmcm9tICdsb2dnZXInXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBjbGFzcyBDU2NvcGVcblx0bmFtZTogc3RyaW5nPyAgICAgICMgLS0tIHVuZGVmIGZvciBhbm9ueW1vdXMgZnVuY3Rpb25zXG5cdHNEZWZpbmVkID0gbmV3IFNldDxzdHJpbmc+KClcblx0c1VzZWQgPSBuZXcgU2V0PHN0cmluZz4oKVxuXHRwYXJlbnQ6IENTY29wZT9cblx0bENoaWxkcmVuOiBDU2NvcGVbXVxuXG5cdCMgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuXG5cdGFsbERlZmluZWQoKTogR2VuZXJhdG9yPHN0cmluZywgdm9pZCwgdm9pZD5cblxuXHRcdGZvciBuYW1lIG9mIEBzRGVmaW5lZC52YWx1ZXMoKVxuXHRcdFx0eWllbGQgbmFtZVxuXHRcdHJldHVyblxuXG5cdCMgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuXG5cdGdldERlZmluZWQoKTogc3RyaW5nW11cblxuXHRcdHJldHVybiBBcnJheS5mcm9tKEBzRGVmaW5lZC5rZXlzKCkpXG5cblx0IyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXG5cblx0YWxsVXNlZCgpOiBHZW5lcmF0b3I8c3RyaW5nLCB2b2lkLCB2b2lkPlxuXG5cdFx0Zm9yIG5hbWUgb2YgQHNVc2VkLnZhbHVlcygpXG5cdFx0XHR5aWVsZCBuYW1lXG5cdFx0cmV0dXJuXG5cblx0IyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXG5cblx0Z2V0VXNlZCgpOiBzdHJpbmdbXVxuXG5cdFx0cmV0dXJuIEFycmF5LmZyb20oQHNVc2VkLmtleXMoKSlcblxuXHQjIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cblxuXHRhc1N0cmluZygpOiBzdHJpbmdcblxuXHRcdHJldHVybiBcIlwiXCJcblx0XHRcdC0tLS0tLS0tLS1cblx0XHRcdE5BTUU6ICN7QG5hbWUgfHwgJy51bmRlZid9XG5cdFx0XHRERUZJTkVEOiAje0BnZXREZWZpbmVkKCkuam9pbignICcpfVxuXHRcdFx0VVNFRDogI3tAZ2V0VXNlZCgpLmpvaW4oJyAnKX1cblx0XHRcdFBBUkVOVDogI3tkZWZpbmVkKEBwYXJlbnQpID8gQHBhcmVudC5uYW1lIDogJy51bmRlZid9XG5cdFx0XHRDSElMRFJFTjogI3tAbENoaWxkcmVuLmxlbmd0aH1cblx0XHRcdFwiXCJcIlxuXG5cdCMgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuXG5cdGNvbnN0cnVjdG9yKFxuXHRcdFx0QG5hbWU6IHN0cmluZz9cblx0XHRcdGxBcmdzOiBzdHJpbmdbXVxuXHRcdFx0QHBhcmVudDogQ1Njb3BlPyA9IHVuZGVmXG5cdFx0XHQpXG5cblx0XHRmb3IgbmFtZSBvZiBsQXJnc1xuXHRcdFx0QGRlZmluZSBuYW1lXG5cdFx0QGxDaGlsZHJlbiA9IFtdXG5cblx0IyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXG5cblx0bmV3Q2hpbGRTY29wZShcblx0XHRcdG5hbWU6IHN0cmluZz9cblx0XHRcdGxBcmdzOiBzdHJpbmdbXVxuXHRcdFx0KVxuXG5cdFx0c2NvcGUgOj0gbmV3IENTY29wZShuYW1lLCBsQXJncywgQClcblx0XHRAbENoaWxkcmVuLnB1c2ggc2NvcGVcblx0XHRyZXR1cm4gc2NvcGVcblxuXHQjIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cblxuXHRkZWZpbmUobmFtZTogc3RyaW5nKTogdm9pZFxuXG5cdFx0QHNEZWZpbmVkLmFkZCBuYW1lXG5cdFx0cmV0dXJuXG5cblx0IyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXG5cblx0dXNlKG5hbWU6IHN0cmluZyk6IHZvaWRcblxuXHRcdEBzVXNlZC5hZGQgbmFtZVxuXHRcdHJldHVyblxuXG5cdCMgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuXHQjIC0tLSBpcyBuYW1lIGRlZmluZWQgaW4gY3VycmVudCBmdW5jdGlvbiBvciBhbnkgYW5jZXN0b3JcblxuXHRpc0RlZmluZWQobmFtZTogc3RyaW5nKTogYm9vbGVhblxuXG5cdFx0aWYgQHNEZWZpbmVkLmhhcyBuYW1lXG5cdFx0XHRyZXR1cm4gdHJ1ZVxuXG5cdFx0aWYgZGVmaW5lZChAcGFyZW50KVxuXHRcdFx0cmV0dXJuIEBwYXJlbnQuaXNEZWZpbmVkIG5hbWVcblxuXHRcdHJldHVybiBmYWxzZVxuXG5cdCMgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxuXHQjIC0tLSBpcyBuYW1lIHVzZWQgaW4gdGhlIGN1cnJlbnQgc2NvcGUgb3IgaW4gY2hpbGQgc2NvcGVzXG5cblx0aXNVc2VkKG5hbWU6IHN0cmluZyk6IGJvb2xlYW5cblxuXHRcdGlmIEBzVXNlZC5oYXMgbmFtZVxuXHRcdFx0cmV0dXJuIHRydWVcblxuXHRcdGZvciBjaGlsZFNjb3BlIG9mIEBsQ2hpbGRyZW5cblx0XHRcdGlmIGNoaWxkU2NvcGUuaXNVc2VkIG5hbWVcblx0XHRcdFx0cmV0dXJuIHRydWVcblxuXHRcdHJldHVybiBmYWxzZVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgY2xhc3MgQ01haW5TY29wZSBleHRlbmRzIENTY29wZVxuXG5cdGNvbnN0cnVjdG9yKClcblxuXHRcdHN1cGVyKCdtYWluJywgW10pXG5cblx0IyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXG5cblx0bmV3U2NvcGUobmFtZTogc3RyaW5nPywgbEFyZ3M6IHN0cmluZ1tdKTogQ1Njb3BlXG5cblx0XHRyZXR1cm4gQG5ld0NoaWxkU2NvcGUobmFtZSwgbEFyZ3MpXG5cblx0IyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXG5cblx0ZW5kU2NvcGUoc2NvcGU6IENTY29wZSk6IENTY29wZT9cblxuXHRcdHJldHVybiBzY29wZS5wYXJlbnRcbiJdfQ==