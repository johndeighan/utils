"use strict";
// tokens.lib.civet

import {
	undef, defined, notdefined, hash, isEmpty, nonEmpty,
	} from './datatypes.lib.ts'
import {
	getOptions, allLinesInBlock, escapeStr,
	} from './llutils.lib.ts'
import {DBG, DBGVALUE} from './logger.lib.ts'
import {
	oneIndent, indentLevel, splitLine,
	} from './indent.lib.ts'
import {TextTable} from './text-table.lib.ts'

// ---------------------------------------------------------------------------
// ---------------------------------------------------------------------------
// --- Common token types:
//        'line', 'empty', 'indent', 'undent'

export type Token = {
	kind: string
	str: string
	name?: string
	value?: any
	}

// ---------------------------------------------------------------------------

export type TTokenGenerator = (
		line: string
		) => Generator<Token, void, void>

const identTokenGen: TTokenGenerator = function*(line: string) {
	yield {kind: 'line', str: line}
	return
}

export const allTokensIn = function*(
		iterable: Iterable<string>,
		gen: TTokenGenerator = identTokenGen,
		hOptions: hash={}
		): Generator<Token, void, void> {

	const {lTypes} = getOptions(hOptions, {
		lTypes: ['indent','undent']
		})
	let level = 0
	for (const str of iterable) {
		DBG(`LINE: '${escapeStr(str)}'`)
		if (isEmpty(str)) {
			if (lTypes.includes('empty')) {
				yield {kind: 'empty', str}
			}
		}
		else {
			// --- NOTE: If indent > 0, oneIndent will be set
			const [indent, line] = splitLine(str)
			if (lTypes.includes('indent') && (indent > level)) {
				level += 1
				yield {kind: 'indent', str: ''}
				while (indent > level) {
					level += 1
					yield {kind: 'indent', str: oneIndent || ''}
				}
			}
			if (lTypes.includes('undent') && (indent < level)) {
				level -= 1
				yield {kind: 'undent', str: oneIndent || ''}
				while (indent < level) {
					level -= 1
					yield {kind: 'undent', str: ''}
				}
			}
			for (const tok of gen(line)) {
				yield tok
			}
		}
	}
	if (lTypes.includes('undent')) {
		while (level > 0) {
			yield {kind: 'undent', str: ''}
			level -= 1
		}
	}
	return
}

// ---------------------------------------------------------------------------

export const allTokensInBlock = function*(
		block: string,
		gen: TTokenGenerator = identTokenGen
		): Generator<Token, void, void> {

	for (const tok of allTokensIn(allLinesInBlock(block), gen)) {
		yield tok
	}
	return
}

// ---------------------------------------------------------------------------

export const tokenTable = (
		lTokens: Iterable<Token>,
		title='Tokens'
		): string => {

	const table = new TextTable('l l')
	table.fullsep('=')
	table.title(title)
	table.fullsep('=')
	table.labels(['kind', 'str'])
	table.sep()
	for (const tok of lTokens) {
		table.data([tok.kind, tok.str])
	}
	table.fullsep('=')
	return table.asString()
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi90b2tlbnMubGliLmNpdmV0LnRzeCIsInNvdXJjZXMiOlsic3JjL2xpYi90b2tlbnMubGliLmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEsbUJBQWtCO0FBQ2xCLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUM7QUFDckQsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQjtBQUM1QixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLFVBQVUsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUN4QyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCO0FBQzFCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCO0FBQzdDLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQ25DLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUI7QUFDekIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUI7QUFDN0MsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUEsMEJBQXlCO0FBQ3pCLEFBQUEsNkNBQTRDO0FBQzVDLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDckIsQUFBQSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU07QUFDYixBQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTTtBQUNaLEFBQUEsQ0FB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USxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQ25DLEFBQUEsSUFBSSxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUE7QUFDMUIsQUFBQSxLQUFLLEtBQUssQyxFQUFHLENBQUMsQ0FBQztBQUNmLEFBQUEsS0FBSyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLEVBQUUsQztJQUFDLEM7R0FBQSxDQUFBO0FBQ2pELEFBQUEsR0FBRyxHQUFHLENBQUEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNuRCxBQUFBLElBQUksS0FBSyxDLEVBQUcsQ0FBQyxDQUFDO0FBQ2QsQUFBQSxJQUFJLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO0FBQ2hELEFBQUEsSUFBSSxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUE7QUFDMUIsQUFBQSxLQUFLLEtBQUssQyxFQUFHLENBQUMsQ0FBQztBQUNmLEFBQUEsS0FBSyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEM7SUFBQyxDO0dBQUEsQ0FBQTtBQUNwQyxBQUFBLEdBQUcsR0FBRyxDQUFDLENBQUEsTUFBQSxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDdkIsQUFBQSxJQUFJLEtBQUssQ0FBQyxHO0dBQUcsQztFQUFBLEM7Q0FBQSxDQUFBO0FBQ2IsQUFBQSxDQUFDLEdBQUcsQ0FBQSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUM3QixBQUFBLEVBQUUsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQSxDQUFBO0FBQ25CLEFBQUEsR0FBRyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDbEMsQUFBQSxHQUFHLEtBQUssQyxFQUFHLENBQUMsQztFQUFDLEM7Q0FBQSxDQUFBO0FBQ2IsQUFBQSxDQUFDLE07QUFBTSxDQUFBO0FBQ1AsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFpQixNQUFoQixnQkFBZ0IsQ0FBQyxDQUFFLENBR1EsUSxDQUhQLENBQUM7QUFDNUIsQUFBQSxFQUFFLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQTtBQUNmLEFBQUEsRUFBRSxHQUFHLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLGFBQWE7QUFDdEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFJLENBQUEsQ0FBQTtBQUNwQyxBQUFBO0FBQ0EsQUFBQSxDQUFDLEdBQUcsQ0FBQyxDQUFBLE1BQUEsR0FBRyxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ3BELEFBQUEsRUFBRSxLQUFLLENBQUMsRztDQUFHLENBQUE7QUFDWCxBQUFBLENBQUMsTTtBQUFNLENBQUE7QUFDUCxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQVcsTUFBVixVQUFVLENBQUMsQ0FBRSxDQUFDLENBQUM7QUFDdEIsQUFBQSxFQUFFLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUMxQixBQUFBLEVBQUUsS0FBSyxDQUFDLFFBQVE7QUFDaEIsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDZCxBQUFBO0FBQ0EsQUFBQSxDQUFNLE1BQUwsS0FBSyxDQUFDLENBQUUsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFBLEFBQUMsS0FBSyxDQUFBO0FBQzdCLEFBQUEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFBLEFBQUMsR0FBRyxDQUFBO0FBQ2xCLEFBQUEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFBLEFBQUMsS0FBSyxDQUFBO0FBQ2xCLEFBQUEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFBLEFBQUMsR0FBRyxDQUFBO0FBQ2xCLEFBQUEsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFBLEFBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUM3QixBQUFBLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ1osQUFBQSxDQUFDLEdBQUcsQ0FBQyxDQUFBLE1BQUEsR0FBRyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUEsQ0FBQSxDQUFBO0FBQ25CLEFBQUEsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFBLEFBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDO0NBQUEsQ0FBQTtBQUNoQyxBQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQSxBQUFDLEdBQUcsQ0FBQTtBQUNsQixBQUFBLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQztBQUFDLENBQUE7QUFDeEIiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgdG9rZW5zLmxpYi5jaXZldFxuXG5pbXBvcnQge1xuXHR1bmRlZiwgZGVmaW5lZCwgbm90ZGVmaW5lZCwgaGFzaCwgaXNFbXB0eSwgbm9uRW1wdHksXG5cdH0gZnJvbSAnLi9kYXRhdHlwZXMubGliLnRzJ1xuaW1wb3J0IHtcblx0Z2V0T3B0aW9ucywgYWxsTGluZXNJbkJsb2NrLCBlc2NhcGVTdHIsXG5cdH0gZnJvbSAnLi9sbHV0aWxzLmxpYi50cydcbmltcG9ydCB7REJHLCBEQkdWQUxVRX0gZnJvbSAnLi9sb2dnZXIubGliLnRzJ1xuaW1wb3J0IHtcblx0b25lSW5kZW50LCBpbmRlbnRMZXZlbCwgc3BsaXRMaW5lLFxuXHR9IGZyb20gJy4vaW5kZW50LmxpYi50cydcbmltcG9ydCB7VGV4dFRhYmxlfSBmcm9tICcuL3RleHQtdGFibGUubGliLnRzJ1xuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgLS0tIENvbW1vbiB0b2tlbiB0eXBlczpcbiMgICAgICAgICdsaW5lJywgJ2VtcHR5JywgJ2luZGVudCcsICd1bmRlbnQnXG5cbmV4cG9ydCB0eXBlIFRva2VuID0ge1xuXHRraW5kOiBzdHJpbmdcblx0c3RyOiBzdHJpbmdcblx0bmFtZT86IHN0cmluZ1xuXHR2YWx1ZT86IGFueVxuXHR9XG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCB0eXBlIFRUb2tlbkdlbmVyYXRvciA9IChcblx0XHRsaW5lOiBzdHJpbmdcblx0XHQpID0+IEdlbmVyYXRvcjxUb2tlbiwgdm9pZCwgdm9pZD5cblxuaWRlbnRUb2tlbkdlbjogVFRva2VuR2VuZXJhdG9yIDo9IChsaW5lOiBzdHJpbmcpIC0+XG5cdHlpZWxkIHtraW5kOiAnbGluZScsIHN0cjogbGluZX1cblx0cmV0dXJuXG5cbmV4cG9ydCBhbGxUb2tlbnNJbiA6PSAoXG5cdFx0aXRlcmFibGU6IEl0ZXJhYmxlPHN0cmluZz4sXG5cdFx0Z2VuOiBUVG9rZW5HZW5lcmF0b3IgPSBpZGVudFRva2VuR2VuXG5cdFx0aE9wdGlvbnM6IGhhc2g9e31cblx0XHQpOiBHZW5lcmF0b3I8VG9rZW4sIHZvaWQsIHZvaWQ+IC0+XG5cblx0e2xUeXBlc30gOj0gZ2V0T3B0aW9ucyBoT3B0aW9ucywge1xuXHRcdGxUeXBlczogWydpbmRlbnQnLCd1bmRlbnQnXVxuXHRcdH1cblx0bGV0IGxldmVsID0gMFxuXHRmb3Igc3RyIG9mIGl0ZXJhYmxlXG5cdFx0REJHIFwiTElORTogJyN7ZXNjYXBlU3RyKHN0cil9J1wiXG5cdFx0aWYgaXNFbXB0eShzdHIpXG5cdFx0XHRpZiBsVHlwZXMuaW5jbHVkZXMoJ2VtcHR5Jylcblx0XHRcdFx0eWllbGQge2tpbmQ6ICdlbXB0eScsIHN0cn1cblx0XHRlbHNlXG5cdFx0XHQjIC0tLSBOT1RFOiBJZiBpbmRlbnQgPiAwLCBvbmVJbmRlbnQgd2lsbCBiZSBzZXRcblx0XHRcdFtpbmRlbnQsIGxpbmVdIDo9IHNwbGl0TGluZShzdHIpXG5cdFx0XHRpZiBsVHlwZXMuaW5jbHVkZXMoJ2luZGVudCcpICYmIChpbmRlbnQgPiBsZXZlbClcblx0XHRcdFx0bGV2ZWwgKz0gMVxuXHRcdFx0XHR5aWVsZCB7a2luZDogJ2luZGVudCcsIHN0cjogJyd9XG5cdFx0XHRcdHdoaWxlIChpbmRlbnQgPiBsZXZlbClcblx0XHRcdFx0XHRsZXZlbCArPSAxXG5cdFx0XHRcdFx0eWllbGQge2tpbmQ6ICdpbmRlbnQnLCBzdHI6IG9uZUluZGVudCB8fCAnJ31cblx0XHRcdGlmIGxUeXBlcy5pbmNsdWRlcygndW5kZW50JykgJiYgKGluZGVudCA8IGxldmVsKVxuXHRcdFx0XHRsZXZlbCAtPSAxXG5cdFx0XHRcdHlpZWxkIHtraW5kOiAndW5kZW50Jywgc3RyOiBvbmVJbmRlbnQgfHwgJyd9XG5cdFx0XHRcdHdoaWxlIChpbmRlbnQgPCBsZXZlbClcblx0XHRcdFx0XHRsZXZlbCAtPSAxXG5cdFx0XHRcdFx0eWllbGQge2tpbmQ6ICd1bmRlbnQnLCBzdHI6ICcnfVxuXHRcdFx0Zm9yIHRvayBvZiBnZW4obGluZSlcblx0XHRcdFx0eWllbGQgdG9rXG5cdGlmIGxUeXBlcy5pbmNsdWRlcygndW5kZW50Jylcblx0XHR3aGlsZSAobGV2ZWwgPiAwKVxuXHRcdFx0eWllbGQge2tpbmQ6ICd1bmRlbnQnLCBzdHI6ICcnfVxuXHRcdFx0bGV2ZWwgLT0gMVxuXHRyZXR1cm5cblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGFsbFRva2Vuc0luQmxvY2sgOj0gKFxuXHRcdGJsb2NrOiBzdHJpbmdcblx0XHRnZW46IFRUb2tlbkdlbmVyYXRvciA9IGlkZW50VG9rZW5HZW5cblx0XHQpOiBHZW5lcmF0b3I8VG9rZW4sIHZvaWQsIHZvaWQ+IC0+XG5cblx0Zm9yIHRvayBvZiBhbGxUb2tlbnNJbihhbGxMaW5lc0luQmxvY2soYmxvY2spLCBnZW4pXG5cdFx0eWllbGQgdG9rXG5cdHJldHVyblxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgdG9rZW5UYWJsZSA6PSAoXG5cdFx0bFRva2VuczogSXRlcmFibGU8VG9rZW4+XG5cdFx0dGl0bGU9J1Rva2Vucydcblx0XHQpOiBzdHJpbmcgPT5cblxuXHR0YWJsZSA6PSBuZXcgVGV4dFRhYmxlICdsIGwnXG5cdHRhYmxlLmZ1bGxzZXAgJz0nXG5cdHRhYmxlLnRpdGxlIHRpdGxlXG5cdHRhYmxlLmZ1bGxzZXAgJz0nXG5cdHRhYmxlLmxhYmVscyBbJ2tpbmQnLCAnc3RyJ11cblx0dGFibGUuc2VwKClcblx0Zm9yIHRvayBvZiBsVG9rZW5zXG5cdFx0dGFibGUuZGF0YSBbdG9rLmtpbmQsIHRvay5zdHJdXG5cdHRhYmxlLmZ1bGxzZXAgJz0nXG5cdHJldHVybiB0YWJsZS5hc1N0cmluZygpXG4iXX0=