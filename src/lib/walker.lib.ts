"use strict";
// walker.lib.civet

import {
	undef, defined, notdefined, integer, TConstructor,
	isArray, isObject, isPrimitive, hash, croak, isEmpty,
	assertIsString, assertIsArray,
	} from 'datatypes'
import {extract} from 'llutils'
import {OL} from 'to-nice'
import {DBG} from 'logger'

// ---------------------------------------------------------------------------

export class Walker<T extends object = hash> {

	// --- Keep track of nodes visited to avoid infinite loops
	setVisited: WeakSet<T> = new WeakSet<T>()

	lNodeStack: T[] = []

	// ..........................................................

	get level() {

		return this.lNodeStack.length - 1
	}

	// ..........................................................

	parent(n: number = 1): T {

		if (n < 0) {
			croak(`Bad index: ${n}`)
		}
		const pos = this.lNodeStack.length - n - 1
		if (pos < 0) {
			croak(`Bad index: ${n}, stack has ${this.lNodeStack.length} items`)
		}
		return this.lNodeStack[pos]
	}

	// ..........................................................

	isNode(x: object): x is T {

		return true
	}

	// ..........................................................

	filter(node: T): boolean {

		// --- filter() is only called if isNode(node) is true
		return true
	}

	// ..........................................................

	extract(dspath: string): (unknown | undefined) {

		DBG(`dspath = '${dspath}'`)
		const lMatches = dspath.match(/^(\^*)(.*)$/)
		if (defined(lMatches)) {
			const [_, goUpStr, mainStr] = lMatches
			return extract(this.parent(goUpStr.length), mainStr)
		}
		else {
			croak(`Bad dspath: ${dspath}`)
		}
	}

	// ..........................................................

	getString(dspath: string): string {

		const str = this.extract(dspath)
		assertIsString(str)
		return str
	}

	// ..........................................................

	getArray(dspath: string): unknown[] {

		const lItems = this.extract(dspath)
		assertIsArray(lItems)
		return lItems
	}

	// ..........................................................
	// GENERATOR

	*walk(item: unknown): Generator<T, void, void> {

		if (isObject(item) && this.isNode(item)) {
			if (this.setVisited.has(item)) {
				return
			}
			DBG(`YIELD NODE: ${OL(item)}`)
			this.lNodeStack.push(item)
			yield item
			this.setVisited.add(item)
			for (const x of Object.values(item)) {
				yield* this.walk(x)
			}
			this.lNodeStack.pop()
		}
		else if (isArray(item)) {
			DBG("ARRAY")
			for (const x of item) {
				yield* this.walk(x)
			}
		}
		else if (isObject(item)) {
			DBG("OBJECT")
			for (const x of Object.values(item)) {
				yield* this.walk(x)
			}
		}
		return
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxqb2huZFxcdXRpbHNcXHNyY1xcbGliXFx3YWxrZXIubGliLmNpdmV0LnRzeCIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxqb2huZFxcdXRpbHNcXHNyY1xcbGliXFx3YWxrZXIubGliLmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEsbUJBQWtCO0FBQ2xCLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLENBQUM7QUFDbkQsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUM7QUFDdEQsQ0FBQyxjQUFjLENBQUMsQ0FBQyxhQUFhLENBQUM7QUFDL0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVc7QUFDbkIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQy9CLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUztBQUMxQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVE7QUFDMUIsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEMsQ0FBRSxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUE7QUFDNUMsQUFBQTtBQUNBLEFBQUEsQ0FBQywwREFBeUQ7QUFDMUQsQUFBQSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFD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QUFDLENBQUMsSSxDQUFDLElBQUksQ0FBQSxBQUFDLENBQUMsQztHQUFBLEM7RUFBQSxDQUFBO0FBQ2xCLEFBQUEsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFBLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDeEIsQUFBQSxHQUFHLEdBQUcsQ0FBQSxBQUFDLFFBQVEsQ0FBQTtBQUNmLEFBQUEsR0FBRyxHQUFHLENBQUMsQ0FBQSxNQUFBLENBQUMsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDL0IsQUFBQSxJQUFJLEtBQUssQ0FBQyxDQUFDLEksQ0FBQyxJQUFJLENBQUEsQUFBQyxDQUFDLEM7R0FBQSxDO0VBQUEsQ0FBQTtBQUNsQixBQUFBLEVBQUUsTTtDQUNGLEM7QUFBQSIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyB3YWxrZXIubGliLmNpdmV0XHJcblxyXG5pbXBvcnQge1xyXG5cdHVuZGVmLCBkZWZpbmVkLCBub3RkZWZpbmVkLCBpbnRlZ2VyLCBUQ29uc3RydWN0b3IsXHJcblx0aXNBcnJheSwgaXNPYmplY3QsIGlzUHJpbWl0aXZlLCBoYXNoLCBjcm9haywgaXNFbXB0eSxcclxuXHRhc3NlcnRJc1N0cmluZywgYXNzZXJ0SXNBcnJheSxcclxuXHR9IGZyb20gJ2RhdGF0eXBlcydcclxuaW1wb3J0IHtleHRyYWN0fSBmcm9tICdsbHV0aWxzJ1xyXG5pbXBvcnQge09MfSBmcm9tICd0by1uaWNlJ1xyXG5pbXBvcnQge0RCR30gZnJvbSAnbG9nZ2VyJ1xyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCBjbGFzcyBXYWxrZXI8VCBleHRlbmRzIG9iamVjdCA9IGhhc2g+XHJcblxyXG5cdCMgLS0tIEtlZXAgdHJhY2sgb2Ygbm9kZXMgdmlzaXRlZCB0byBhdm9pZCBpbmZpbml0ZSBsb29wc1xyXG5cdHNldFZpc2l0ZWQ6IFdlYWtTZXQ8VD4gPSBuZXcgV2Vha1NldDxUPigpXHJcblxyXG5cdGxOb2RlU3RhY2s6IFRbXSA9IFtdXHJcblxyXG5cdCMgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxyXG5cclxuXHRnZXQgbGV2ZWwoKVxyXG5cclxuXHRcdHJldHVybiBAbE5vZGVTdGFjay5sZW5ndGggLSAxXHJcblxyXG5cdCMgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxyXG5cclxuXHRwYXJlbnQobjogbnVtYmVyID0gMSk6IFRcclxuXHJcblx0XHRpZiAobiA8IDApXHJcblx0XHRcdGNyb2FrIFwiQmFkIGluZGV4OiAje259XCJcclxuXHRcdHBvcyA6PSBAbE5vZGVTdGFjay5sZW5ndGggLSBuIC0gMVxyXG5cdFx0aWYgKHBvcyA8IDApXHJcblx0XHRcdGNyb2FrIFwiQmFkIGluZGV4OiAje259LCBzdGFjayBoYXMgI3tAbE5vZGVTdGFjay5sZW5ndGh9IGl0ZW1zXCJcclxuXHRcdHJldHVybiBAbE5vZGVTdGFja1twb3NdXHJcblxyXG5cdCMgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlxyXG5cclxuXHRpc05vZGUoeDogb2JqZWN0KTogeCBpcyBUXHJcblxyXG5cdFx0cmV0dXJuIHRydWVcclxuXHJcblx0IyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXHJcblxyXG5cdGZpbHRlcihub2RlOiBUKTogYm9vbGVhblxyXG5cclxuXHRcdCMgLS0tIGZpbHRlcigpIGlzIG9ubHkgY2FsbGVkIGlmIGlzTm9kZShub2RlKSBpcyB0cnVlXHJcblx0XHRyZXR1cm4gdHJ1ZVxyXG5cclxuXHQjIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cclxuXHJcblx0ZXh0cmFjdChkc3BhdGg6IHN0cmluZyk6IHVua25vd24/XHJcblxyXG5cdFx0REJHIFwiZHNwYXRoID0gJyN7ZHNwYXRofSdcIlxyXG5cdFx0bE1hdGNoZXMgOj0gZHNwYXRoLm1hdGNoIC8vL15cclxuXHRcdFx0XHQoXFxeKilcclxuXHRcdFx0XHQoLiopXHJcblx0XHRcdFx0JC8vL1xyXG5cdFx0aWYgZGVmaW5lZChsTWF0Y2hlcylcclxuXHRcdFx0W18sIGdvVXBTdHIsIG1haW5TdHJdIDo9IGxNYXRjaGVzXHJcblx0XHRcdHJldHVybiBleHRyYWN0IEBwYXJlbnQoZ29VcFN0ci5sZW5ndGgpLCBtYWluU3RyXHJcblx0XHRlbHNlXHJcblx0XHRcdGNyb2FrIFwiQmFkIGRzcGF0aDogI3tkc3BhdGh9XCJcclxuXHJcblx0IyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXHJcblxyXG5cdGdldFN0cmluZyhkc3BhdGg6IHN0cmluZyk6IHN0cmluZ1xyXG5cclxuXHRcdHN0ciA6PSBAZXh0cmFjdCBkc3BhdGhcclxuXHRcdGFzc2VydElzU3RyaW5nIHN0clxyXG5cdFx0cmV0dXJuIHN0clxyXG5cclxuXHQjIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cclxuXHJcblx0Z2V0QXJyYXkoZHNwYXRoOiBzdHJpbmcpOiB1bmtub3duW11cclxuXHJcblx0XHRsSXRlbXMgOj0gQGV4dHJhY3QgZHNwYXRoXHJcblx0XHRhc3NlcnRJc0FycmF5IGxJdGVtc1xyXG5cdFx0cmV0dXJuIGxJdGVtc1xyXG5cclxuXHQjIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cclxuXHQjIEdFTkVSQVRPUlxyXG5cclxuXHR3YWxrKGl0ZW06IHVua25vd24pOiBHZW5lcmF0b3I8VCwgdm9pZCwgdm9pZD5cclxuXHJcblx0XHRpZiBpc09iamVjdChpdGVtKSAmJiBAaXNOb2RlKGl0ZW0pXHJcblx0XHRcdGlmIEBzZXRWaXNpdGVkLmhhcyBpdGVtXHJcblx0XHRcdFx0cmV0dXJuXHJcblx0XHRcdERCRyBcIllJRUxEIE5PREU6ICN7T0woaXRlbSl9XCJcclxuXHRcdFx0QGxOb2RlU3RhY2sucHVzaCBpdGVtXHJcblx0XHRcdHlpZWxkIGl0ZW1cclxuXHRcdFx0QHNldFZpc2l0ZWQuYWRkIGl0ZW1cclxuXHRcdFx0Zm9yIHggb2YgT2JqZWN0LnZhbHVlcyhpdGVtKVxyXG5cdFx0XHRcdHlpZWxkKiBAd2FsayB4XHJcblx0XHRcdEBsTm9kZVN0YWNrLnBvcCgpXHJcblx0XHRlbHNlIGlmIGlzQXJyYXkgaXRlbVxyXG5cdFx0XHREQkcgXCJBUlJBWVwiXHJcblx0XHRcdGZvciB4IG9mIGl0ZW1cclxuXHRcdFx0XHR5aWVsZCogQHdhbGsgeFxyXG5cdFx0ZWxzZSBpZiBpc09iamVjdChpdGVtKVxyXG5cdFx0XHREQkcgXCJPQkpFQ1RcIlxyXG5cdFx0XHRmb3IgeCBvZiBPYmplY3QudmFsdWVzKGl0ZW0pXHJcblx0XHRcdFx0eWllbGQqIEB3YWxrIHhcclxuXHRcdHJldHVybiJdfQ==