"use strict";
// pll.lib.civet

import {
	undef, defined, notdefined, hash, isEmpty, nonEmpty,
	} from './datatypes.lib.ts'
import {
	getOptions, allLinesInBlock, escapeStr,
	} from './llutils.lib.ts'
import {DBG, DBGVALUE} from './logger.lib.ts'
import {
	oneIndent, indentLevel, splitLine,
	} from './indent.lib.ts'
import {TextTable} from './text-table.lib.ts'

// ---------------------------------------------------------------------------
// ---------------------------------------------------------------------------
// --- Common token types:
//        'line', 'empty', 'indent', 'undent', 'eof'

export type TPLLToken = {
	kind: string
	str: string
	name?: string
	value?: any
	}

export const tkEOF = {kind: 'eof', str: ''}
export const tkIndent = {kind: 'indent', str: ''}
export const tkUndent = {kind: 'undent', str: ''}

// ---------------------------------------------------------------------------

export type TTokenGenerator = (
		line: string
		) => Generator<TPLLToken, void, void>

const identTokenGen: TTokenGenerator = function*(line: string) {
	yield {kind: 'line', str: line}
	return
}

export const allTokensIn = function*(
		iterable: Iterable<string>,
		gen: TTokenGenerator = identTokenGen,
		hOptions: hash={}
		): Generator<TPLLToken, void, void> {

	const {lTypes} = getOptions(hOptions, {
		lTypes: ['indent','undent']
		})
	let level = 0
	for (const str of iterable) {
		DBG(`LINE: '${escapeStr(str)}'`)
		if (isEmpty(str)) {
			if (lTypes.includes('empty')) {
				yield {kind: 'empty', str}
			}
		}
		else {
			// --- NOTE: If indent > 0, oneIndent will be set
			const [indent, line] = splitLine(str)
			if (lTypes.includes('indent') && (indent > level)) {
				level += 1
				yield tkIndent
				while (indent > level) {
					level += 1
					yield tkIndent
				}
			}
			if (lTypes.includes('undent') && (indent < level)) {
				level -= 1
				yield tkUndent
				while (indent < level) {
					level -= 1
					yield tkUndent
				}
			}
			for (const tok of gen(line)) {
				yield tok
			}
		}
	}
	if (lTypes.includes('undent')) {
		while (level > 0) {
			yield tkUndent
			level -= 1
		}
	}
	return
}

// ---------------------------------------------------------------------------

export const allTokensInBlock = function*(
		block: string,
		gen: TTokenGenerator = identTokenGen
		): Generator<TPLLToken, void, void> {

	for (const tok of allTokensIn(allLinesInBlock(block), gen)) {
		yield tok
	}
	return
}

// ---------------------------------------------------------------------------

export const tokenTable = (
		lTokens: Iterable<TPLLToken>,
		title='Tokens'
		): string => {

	const table = new TextTable('l l')
	table.fullsep('=')
	table.title(title)
	table.fullsep('=')
	table.labels(['kind', 'str'])
	table.sep()
	for (const tok of lTokens) {
		table.data([tok.kind, tok.str])
	}
	table.fullsep('=')
	return table.asString()
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9wbGwubGliLmNpdmV0LnRzeCIsInNvdXJjZXMiOlsic3JjL2xpYi9wbGwubGliLmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEsZ0JBQWU7QUFDZixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDO0FBQ3JELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBb0I7QUFDNUIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxTQUFTLENBQUM7QUFDeEMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQjtBQUMxQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQjtBQUM3QyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUNuQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCO0FBQ3pCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMscUJBQXFCO0FBQzdDLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBLDBCQUF5QjtBQUN6QixBQUFBLG9EQUFtRDtBQUNuRCxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3pCLEFBQUEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNO0FBQ2IsQUFBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU07QUFDWixBQUFBLENBQUMsSUFBSSxD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LEVBQUUsSUFBSSxDQUFBLENBQUE7QUFDTixBQUFBLEdBQUcsaURBQWdEO0FBQ25ELEFBQUEsR0FBaUIsTUFBZCxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDO0FBQ25DLEFBQUEsR0FBRyxHQUFHLENBQUEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNuRCxBQUFBLElBQUksS0FBSyxDLEVBQUcsQ0FBQyxDQUFDO0FBQ2QsQUFBQSxJQUFJLEtBQUssQ0FBQyxRQUFRO0FBQ2xCLEFBQUEsSUFBSSxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUE7QUFDMUIsQUFBQSxLQUFLLEtBQUssQyxFQUFHLENBQUMsQ0FBQztBQUNmLEFBQUEsS0FBSyxLQUFLLENBQUMsUTtJQUFRLEM7R0FBQSxDQUFBO0FBQ25CLEFBQUEsR0FBRyxHQUFHLENBQUEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNuRCxBQUFBLElBQUksS0FBSyxDLEVBQUcsQ0FBQyxDQUFDO0FBQ2QsQUFBQSxJQUFJLEtBQUssQ0FBQyxRQUFRO0FBQ2xCLEFBQUEsSUFBSSxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBLENBQUE7QUFDMUIsQUFBQSxLQUFLLEtBQUssQyxFQUFHLENBQUMsQ0FBQztBQUNmLEFBQUEsS0FBSyxLQUFLLENBQUMsUTtJQUFRLEM7R0FBQSxDQUFBO0FBQ25CLEFBQUEsR0FBRyxHQUFHLENBQUMsQ0FBQSxNQUFBLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUN2QixBQUFBLElBQUksS0FBSyxDQUFDLEc7R0FBRyxDO0VBQUEsQztDQUFBLENBQUE7QUFDYixBQUFBLENBQUMsR0FBRyxDQUFBLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQzdCLEFBQUEsRUFBRSxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUE7QUFDbkIsQUFBQSxHQUFHLEtBQUssQ0FBQyxRQUFRO0FBQ2pCLEFBQUEsR0FBRyxLQUFLLEMsRUFBRyxDQUFDLEM7RUFBQyxDO0NBQUEsQ0FBQTtBQUNiLEFBQUEsQ0FBQyxNO0FBQU0sQ0FBQTtBQUNQLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBaUIsTUFBaEIsZ0JBQWdCLENBQUMsQ0FBRSxDQUdZLFEsQ0FIWCxDQUFDO0FBQzVCLEFBQUEsRUFBRSxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUE7QUFDZixBQUFBLEVBQUUsR0FBRyxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxhQUFhO0FBQ3RDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBSSxDQUFBLENBQUE7QUFDeEMsQUFBQTtBQUNBLEFBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQSxNQUFBLEdBQUcsQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNwRCxBQUFBLEVBQUUsS0FBSyxDQUFDLEc7Q0FBRyxDQUFBO0FBQ1gsQUFBQSxDQUFDLE07QUFBTSxDQUFBO0FBQ1AsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFXLE1BQVYsVUFBVSxDQUFDLENBQUUsQ0FBQyxDQUFDO0FBQ3RCLEFBQUEsRUFBRSxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUE7QUFDOUIsQUFBQSxFQUFFLEtBQUssQ0FBQyxRQUFRO0FBQ2hCLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQSxDQUFBO0FBQ2QsQUFBQTtBQUNBLEFBQUEsQ0FBTSxNQUFMLEtBQUssQ0FBQyxDQUFFLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQSxBQUFDLEtBQUssQ0FBQTtBQUM3QixBQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQSxBQUFDLEdBQUcsQ0FBQTtBQUNsQixBQUFBLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQSxBQUFDLEtBQUssQ0FBQTtBQUNsQixBQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQSxBQUFDLEdBQUcsQ0FBQTtBQUNsQixBQUFBLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQSxBQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUE7QUFDN0IsQUFBQSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNaLEFBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQSxNQUFBLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFBLENBQUEsQ0FBQTtBQUNuQixBQUFBLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQSxBQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQztDQUFBLENBQUE7QUFDaEMsQUFBQSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUEsQUFBQyxHQUFHLENBQUE7QUFDbEIsQUFBQSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEM7QUFBQyxDQUFBO0FBQ3hCIiwibmFtZXMiOltdLCJzb3VyY2VzQ29udGVudCI6WyIjIHBsbC5saWIuY2l2ZXRcclxuXHJcbmltcG9ydCB7XHJcblx0dW5kZWYsIGRlZmluZWQsIG5vdGRlZmluZWQsIGhhc2gsIGlzRW1wdHksIG5vbkVtcHR5LFxyXG5cdH0gZnJvbSAnLi9kYXRhdHlwZXMubGliLnRzJ1xyXG5pbXBvcnQge1xyXG5cdGdldE9wdGlvbnMsIGFsbExpbmVzSW5CbG9jaywgZXNjYXBlU3RyLFxyXG5cdH0gZnJvbSAnLi9sbHV0aWxzLmxpYi50cydcclxuaW1wb3J0IHtEQkcsIERCR1ZBTFVFfSBmcm9tICcuL2xvZ2dlci5saWIudHMnXHJcbmltcG9ydCB7XHJcblx0b25lSW5kZW50LCBpbmRlbnRMZXZlbCwgc3BsaXRMaW5lLFxyXG5cdH0gZnJvbSAnLi9pbmRlbnQubGliLnRzJ1xyXG5pbXBvcnQge1RleHRUYWJsZX0gZnJvbSAnLi90ZXh0LXRhYmxlLmxpYi50cydcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiMgLS0tIENvbW1vbiB0b2tlbiB0eXBlczpcclxuIyAgICAgICAgJ2xpbmUnLCAnZW1wdHknLCAnaW5kZW50JywgJ3VuZGVudCcsICdlb2YnXHJcblxyXG5leHBvcnQgdHlwZSBUUExMVG9rZW4gPSB7XHJcblx0a2luZDogc3RyaW5nXHJcblx0c3RyOiBzdHJpbmdcclxuXHRuYW1lPzogc3RyaW5nXHJcblx0dmFsdWU/OiBhbnlcclxuXHR9XHJcblxyXG5leHBvcnQgdGtFT0YgOj0ge2tpbmQ6ICdlb2YnLCBzdHI6ICcnfVxyXG5leHBvcnQgdGtJbmRlbnQgOj0ge2tpbmQ6ICdpbmRlbnQnLCBzdHI6ICcnfVxyXG5leHBvcnQgdGtVbmRlbnQgOj0ge2tpbmQ6ICd1bmRlbnQnLCBzdHI6ICcnfVxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCB0eXBlIFRUb2tlbkdlbmVyYXRvciA9IChcclxuXHRcdGxpbmU6IHN0cmluZ1xyXG5cdFx0KSA9PiBHZW5lcmF0b3I8VFBMTFRva2VuLCB2b2lkLCB2b2lkPlxyXG5cclxuaWRlbnRUb2tlbkdlbjogVFRva2VuR2VuZXJhdG9yIDo9IChsaW5lOiBzdHJpbmcpIC0+XHJcblx0eWllbGQge2tpbmQ6ICdsaW5lJywgc3RyOiBsaW5lfVxyXG5cdHJldHVyblxyXG5cclxuZXhwb3J0IGFsbFRva2Vuc0luIDo9IChcclxuXHRcdGl0ZXJhYmxlOiBJdGVyYWJsZTxzdHJpbmc+LFxyXG5cdFx0Z2VuOiBUVG9rZW5HZW5lcmF0b3IgPSBpZGVudFRva2VuR2VuXHJcblx0XHRoT3B0aW9uczogaGFzaD17fVxyXG5cdFx0KTogR2VuZXJhdG9yPFRQTExUb2tlbiwgdm9pZCwgdm9pZD4gLT5cclxuXHJcblx0e2xUeXBlc30gOj0gZ2V0T3B0aW9ucyBoT3B0aW9ucywge1xyXG5cdFx0bFR5cGVzOiBbJ2luZGVudCcsJ3VuZGVudCddXHJcblx0XHR9XHJcblx0bGV0IGxldmVsID0gMFxyXG5cdGZvciBzdHIgb2YgaXRlcmFibGVcclxuXHRcdERCRyBcIkxJTkU6ICcje2VzY2FwZVN0cihzdHIpfSdcIlxyXG5cdFx0aWYgaXNFbXB0eShzdHIpXHJcblx0XHRcdGlmIGxUeXBlcy5pbmNsdWRlcygnZW1wdHknKVxyXG5cdFx0XHRcdHlpZWxkIHtraW5kOiAnZW1wdHknLCBzdHJ9XHJcblx0XHRlbHNlXHJcblx0XHRcdCMgLS0tIE5PVEU6IElmIGluZGVudCA+IDAsIG9uZUluZGVudCB3aWxsIGJlIHNldFxyXG5cdFx0XHRbaW5kZW50LCBsaW5lXSA6PSBzcGxpdExpbmUoc3RyKVxyXG5cdFx0XHRpZiBsVHlwZXMuaW5jbHVkZXMoJ2luZGVudCcpICYmIChpbmRlbnQgPiBsZXZlbClcclxuXHRcdFx0XHRsZXZlbCArPSAxXHJcblx0XHRcdFx0eWllbGQgdGtJbmRlbnRcclxuXHRcdFx0XHR3aGlsZSAoaW5kZW50ID4gbGV2ZWwpXHJcblx0XHRcdFx0XHRsZXZlbCArPSAxXHJcblx0XHRcdFx0XHR5aWVsZCB0a0luZGVudFxyXG5cdFx0XHRpZiBsVHlwZXMuaW5jbHVkZXMoJ3VuZGVudCcpICYmIChpbmRlbnQgPCBsZXZlbClcclxuXHRcdFx0XHRsZXZlbCAtPSAxXHJcblx0XHRcdFx0eWllbGQgdGtVbmRlbnRcclxuXHRcdFx0XHR3aGlsZSAoaW5kZW50IDwgbGV2ZWwpXHJcblx0XHRcdFx0XHRsZXZlbCAtPSAxXHJcblx0XHRcdFx0XHR5aWVsZCB0a1VuZGVudFxyXG5cdFx0XHRmb3IgdG9rIG9mIGdlbihsaW5lKVxyXG5cdFx0XHRcdHlpZWxkIHRva1xyXG5cdGlmIGxUeXBlcy5pbmNsdWRlcygndW5kZW50JylcclxuXHRcdHdoaWxlIChsZXZlbCA+IDApXHJcblx0XHRcdHlpZWxkIHRrVW5kZW50XHJcblx0XHRcdGxldmVsIC09IDFcclxuXHRyZXR1cm5cclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgYWxsVG9rZW5zSW5CbG9jayA6PSAoXHJcblx0XHRibG9jazogc3RyaW5nXHJcblx0XHRnZW46IFRUb2tlbkdlbmVyYXRvciA9IGlkZW50VG9rZW5HZW5cclxuXHRcdCk6IEdlbmVyYXRvcjxUUExMVG9rZW4sIHZvaWQsIHZvaWQ+IC0+XHJcblxyXG5cdGZvciB0b2sgb2YgYWxsVG9rZW5zSW4oYWxsTGluZXNJbkJsb2NrKGJsb2NrKSwgZ2VuKVxyXG5cdFx0eWllbGQgdG9rXHJcblx0cmV0dXJuXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IHRva2VuVGFibGUgOj0gKFxyXG5cdFx0bFRva2VuczogSXRlcmFibGU8VFBMTFRva2VuPlxyXG5cdFx0dGl0bGU9J1Rva2VucydcclxuXHRcdCk6IHN0cmluZyA9PlxyXG5cclxuXHR0YWJsZSA6PSBuZXcgVGV4dFRhYmxlICdsIGwnXHJcblx0dGFibGUuZnVsbHNlcCAnPSdcclxuXHR0YWJsZS50aXRsZSB0aXRsZVxyXG5cdHRhYmxlLmZ1bGxzZXAgJz0nXHJcblx0dGFibGUubGFiZWxzIFsna2luZCcsICdzdHInXVxyXG5cdHRhYmxlLnNlcCgpXHJcblx0Zm9yIHRvayBvZiBsVG9rZW5zXHJcblx0XHR0YWJsZS5kYXRhIFt0b2sua2luZCwgdG9rLnN0cl1cclxuXHR0YWJsZS5mdWxsc2VwICc9J1xyXG5cdHJldHVybiB0YWJsZS5hc1N0cmluZygpXHJcbiJdfQ==