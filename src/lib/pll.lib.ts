"use strict";
// pll.lib.civet

import {
	undef, defined, notdefined, hash, isEmpty, nonEmpty,
	} from 'datatypes'
import {
	getOptions, allLinesInBlock, escapeStr,
	} from 'llutils'
import {DBG, DBGVALUE} from 'logger'
import {
	oneIndent, indentLevel, splitLine,
	} from 'indent'
import {TextTable} from 'text-table'

// ---------------------------------------------------------------------------
// ---------------------------------------------------------------------------
// --- Common token types:
//        'line', 'empty', 'indent', 'undent', 'eof'

export type TPLLToken = {
	kind: string
	str: string
	name?: string
	value?: any
	}

export const tkEOF = {kind: 'eof', str: ''}
export const tkIndent = {kind: 'indent', str: ''}
export const tkUndent = {kind: 'undent', str: ''}

// ---------------------------------------------------------------------------

export type TTokenGenerator = (
		line: string
		) => Generator<TPLLToken, void, void>

const identTokenGen: TTokenGenerator = function*(line: string) {
	yield {kind: 'line', str: line}
	return
}

export const allTokensIn = function*(
		iterable: Iterable<string>,
		gen: TTokenGenerator = identTokenGen,
		hOptions: hash={}
		): Generator<TPLLToken, void, void> {

	type opt = {
		lTypes: string[]
		}
	const {lTypes} = getOptions<opt>(hOptions, {
		lTypes: ['indent','undent']
		})
	let level = 0
	for (const str of iterable) {
		DBG(`LINE: '${escapeStr(str)}'`)
		if (isEmpty(str)) {
			if (lTypes.includes('empty')) {
				yield {kind: 'empty', str}
			}
		}
		else {
			// --- NOTE: If indent > 0, oneIndent will be set
			const [indent, line] = splitLine(str)
			if (lTypes.includes('indent') && (indent > level)) {
				level += 1
				yield tkIndent
				while (indent > level) {
					level += 1
					yield tkIndent
				}
			}
			if (lTypes.includes('undent') && (indent < level)) {
				level -= 1
				yield tkUndent
				while (indent < level) {
					level -= 1
					yield tkUndent
				}
			}
			for (const tok of gen(line)) {
				yield tok
			}
		}
	}
	if (lTypes.includes('undent')) {
		while (level > 0) {
			yield tkUndent
			level -= 1
		}
	}
	return
}

// ---------------------------------------------------------------------------

export const allTokensInBlock = function*(
		block: string,
		gen: TTokenGenerator = identTokenGen
		): Generator<TPLLToken, void, void> {

	for (const tok of allTokensIn(allLinesInBlock(block), gen)) {
		yield tok
	}
	return
}

// ---------------------------------------------------------------------------

export const tokenTable = (
		lTokens: Iterable<TPLLToken>,
		title='Tokens'
		): string => {

	const table = new TextTable('l l')
	table.fullsep('=')
	table.title(title)
	table.fullsep('=')
	table.labels(['kind', 'str'])
	table.sep()
	for (const tok of lTokens) {
		table.data([tok.kind, tok.str])
	}
	table.fullsep('=')
	return table.asString()
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9wbGwubGliLmNpdmV0LnRzeCIsInNvdXJjZXMiOlsic3JjL2xpYi9wbGwubGliLmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEsZ0JBQWU7QUFDZixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDO0FBQ3JELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXO0FBQ25CLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsVUFBVSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQ3hDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQ2pCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUTtBQUNwQyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUNuQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUTtBQUNoQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVk7QUFDcEMsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUEsMEJBQXlCO0FBQ3pCLEFBQUEsb0RBQW1EO0FBQ25ELEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDekIsQUFBQSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU07QUFDYixBQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTTtBQUNaLEFBQUEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU07QUFDZCxBQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHO0FBQ1osQ0FBQyxDQUFDO0FBQ0YsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQU0sTUFBTCxLQUFLLENBQUMsQ0FBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQ3RDLEFBQUEsQUFBQSxNQUFNLENBQVMsTUFBUixRQUFRLENBQUMsQ0FBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQzVDLEFBQUEsQUFBQSxNQUFNLENBQVMsTUFBUixRQUFRLENBQUMsQ0FBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQzVDLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQy9CLEFBQUEsRUFBRSxJQUFJLENBQUMsQ0FBQyxNQUFNO0FBQ2QsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDdkMsQUFBQTtBQUNBLEFBQUEsQUFBOEIsTUFBOUIsYUFBYSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUUsQ0FBZ0IsUSxDQUFmLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFJLENBQUEsQ0FBQTtBQUNuRCxBQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ2hDLEFBQUEsQ0FBQyxNO0FBQU0sQ0FBQTtBQUNQLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFZLE1BQVgsV0FBVyxDQUFDLENBQUUsQ0FJaUIsUSxDQUpoQixDQUFDO0FBQ3ZCLEFBQUEsRUFBRSxRQUFRLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0IsQUFBQSxFQUFFLEdBQUcsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFBO0FBQ3RDLEFBQUEsRUFBRSxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ25CLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBSSxDQUFBLENBQUE7QUFDeEMsQUFBQTtBQUNBLEFBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2IsQUFBQSxFQUFFLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ2xCLEVBQUUsQ0FBQztBQUNILEFBQUEsQ0FBUyxNQUFSLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQSxBQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7QUFDeEMsQUFBQSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQztBQUM3QixFQUFFLENBQUMsQ0FBQTtBQUNILEFBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2QsQUFBQSxDQUFDLEdBQUcsQ0FBQyxDQUFBLE1BQUEsR0FBRyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUEsQ0FBQSxDQUFBO0FBQ3BCLEFBQUEsRUFBRSxHQUFHLENBQUEsQUFBQyxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDakMsQUFBQSxFQUFFLEdBQUcsQ0FBQSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ2pCLEFBQUEsR0FBRyxHQUFHLENBQUEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDOUIsQUFBQSxJQUFJLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQztHQUFDLEM7RUFBQSxDQUFBO0FBQzlCLEFBQUEsRUFBRSxJQUFJLENBQUEsQ0FBQTtBQUNOLEFBQUEsR0FBRyxpREFBZ0Q7QUFDbkQsQUFBQSxHQUFpQixNQUFkLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUM7QUFDbkMsQUFBQSxHQUFHLEdBQUcsQ0FBQSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ25ELEFBQUEsSUFBSSxLQUFLLEMsRUFBRyxDQUFDLENBQUM7QUFDZCxBQUFBLElBQUksS0FBSyxDQUFDLFFBQVE7QUFDbEIsQUFBQSxJQUFJLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQTtBQUMxQixBQUFBLEtBQUssS0FBSyxDLEVBQUcsQ0FBQyxDQUFDO0FBQ2YsQUFBQSxLQUFLLEtBQUssQ0FBQyxRO0lBQVEsQztHQUFBLENBQUE7QUFDbkIsQUFBQSxHQUFHLEdBQUcsQ0FBQSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ25ELEFBQUEsSUFBSSxLQUFLLEMsRUFBRyxDQUFDLENBQUM7QUFDZCxBQUFBLElBQUksS0FBSyxDQUFDLFFBQVE7QUFDbEIsQUFBQSxJQUFJLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQTtBQUMxQixBQUFBLEtBQUssS0FBSyxDLEVBQUcsQ0FBQyxDQUFDO0FBQ2YsQUFBQSxLQUFL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dXJjZXNDb250ZW50IjpbIiMgcGxsLmxpYi5jaXZldFxyXG5cclxuaW1wb3J0IHtcclxuXHR1bmRlZiwgZGVmaW5lZCwgbm90ZGVmaW5lZCwgaGFzaCwgaXNFbXB0eSwgbm9uRW1wdHksXHJcblx0fSBmcm9tICdkYXRhdHlwZXMnXHJcbmltcG9ydCB7XHJcblx0Z2V0T3B0aW9ucywgYWxsTGluZXNJbkJsb2NrLCBlc2NhcGVTdHIsXHJcblx0fSBmcm9tICdsbHV0aWxzJ1xyXG5pbXBvcnQge0RCRywgREJHVkFMVUV9IGZyb20gJ2xvZ2dlcidcclxuaW1wb3J0IHtcclxuXHRvbmVJbmRlbnQsIGluZGVudExldmVsLCBzcGxpdExpbmUsXHJcblx0fSBmcm9tICdpbmRlbnQnXHJcbmltcG9ydCB7VGV4dFRhYmxlfSBmcm9tICd0ZXh0LXRhYmxlJ1xyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuIyAtLS0gQ29tbW9uIHRva2VuIHR5cGVzOlxyXG4jICAgICAgICAnbGluZScsICdlbXB0eScsICdpbmRlbnQnLCAndW5kZW50JywgJ2VvZidcclxuXHJcbmV4cG9ydCB0eXBlIFRQTExUb2tlbiA9IHtcclxuXHRraW5kOiBzdHJpbmdcclxuXHRzdHI6IHN0cmluZ1xyXG5cdG5hbWU/OiBzdHJpbmdcclxuXHR2YWx1ZT86IGFueVxyXG5cdH1cclxuXHJcbmV4cG9ydCB0a0VPRiA6PSB7a2luZDogJ2VvZicsIHN0cjogJyd9XHJcbmV4cG9ydCB0a0luZGVudCA6PSB7a2luZDogJ2luZGVudCcsIHN0cjogJyd9XHJcbmV4cG9ydCB0a1VuZGVudCA6PSB7a2luZDogJ3VuZGVudCcsIHN0cjogJyd9XHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IHR5cGUgVFRva2VuR2VuZXJhdG9yID0gKFxyXG5cdFx0bGluZTogc3RyaW5nXHJcblx0XHQpID0+IEdlbmVyYXRvcjxUUExMVG9rZW4sIHZvaWQsIHZvaWQ+XHJcblxyXG5pZGVudFRva2VuR2VuOiBUVG9rZW5HZW5lcmF0b3IgOj0gKGxpbmU6IHN0cmluZykgLT5cclxuXHR5aWVsZCB7a2luZDogJ2xpbmUnLCBzdHI6IGxpbmV9XHJcblx0cmV0dXJuXHJcblxyXG5leHBvcnQgYWxsVG9rZW5zSW4gOj0gKFxyXG5cdFx0aXRlcmFibGU6IEl0ZXJhYmxlPHN0cmluZz4sXHJcblx0XHRnZW46IFRUb2tlbkdlbmVyYXRvciA9IGlkZW50VG9rZW5HZW5cclxuXHRcdGhPcHRpb25zOiBoYXNoPXt9XHJcblx0XHQpOiBHZW5lcmF0b3I8VFBMTFRva2VuLCB2b2lkLCB2b2lkPiAtPlxyXG5cclxuXHR0eXBlIG9wdCA9IHtcclxuXHRcdGxUeXBlczogc3RyaW5nW11cclxuXHRcdH1cclxuXHR7bFR5cGVzfSA6PSBnZXRPcHRpb25zPG9wdD4gaE9wdGlvbnMsIHtcclxuXHRcdGxUeXBlczogWydpbmRlbnQnLCd1bmRlbnQnXVxyXG5cdFx0fVxyXG5cdGxldCBsZXZlbCA9IDBcclxuXHRmb3Igc3RyIG9mIGl0ZXJhYmxlXHJcblx0XHREQkcgXCJMSU5FOiAnI3tlc2NhcGVTdHIoc3RyKX0nXCJcclxuXHRcdGlmIGlzRW1wdHkoc3RyKVxyXG5cdFx0XHRpZiBsVHlwZXMuaW5jbHVkZXMoJ2VtcHR5JylcclxuXHRcdFx0XHR5aWVsZCB7a2luZDogJ2VtcHR5Jywgc3RyfVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHQjIC0tLSBOT1RFOiBJZiBpbmRlbnQgPiAwLCBvbmVJbmRlbnQgd2lsbCBiZSBzZXRcclxuXHRcdFx0W2luZGVudCwgbGluZV0gOj0gc3BsaXRMaW5lKHN0cilcclxuXHRcdFx0aWYgbFR5cGVzLmluY2x1ZGVzKCdpbmRlbnQnKSAmJiAoaW5kZW50ID4gbGV2ZWwpXHJcblx0XHRcdFx0bGV2ZWwgKz0gMVxyXG5cdFx0XHRcdHlpZWxkIHRrSW5kZW50XHJcblx0XHRcdFx0d2hpbGUgKGluZGVudCA+IGxldmVsKVxyXG5cdFx0XHRcdFx0bGV2ZWwgKz0gMVxyXG5cdFx0XHRcdFx0eWllbGQgdGtJbmRlbnRcclxuXHRcdFx0aWYgbFR5cGVzLmluY2x1ZGVzKCd1bmRlbnQnKSAmJiAoaW5kZW50IDwgbGV2ZWwpXHJcblx0XHRcdFx0bGV2ZWwgLT0gMVxyXG5cdFx0XHRcdHlpZWxkIHRrVW5kZW50XHJcblx0XHRcdFx0d2hpbGUgKGluZGVudCA8IGxldmVsKVxyXG5cdFx0XHRcdFx0bGV2ZWwgLT0gMVxyXG5cdFx0XHRcdFx0eWllbGQgdGtVbmRlbnRcclxuXHRcdFx0Zm9yIHRvayBvZiBnZW4obGluZSlcclxuXHRcdFx0XHR5aWVsZCB0b2tcclxuXHRpZiBsVHlwZXMuaW5jbHVkZXMoJ3VuZGVudCcpXHJcblx0XHR3aGlsZSAobGV2ZWwgPiAwKVxyXG5cdFx0XHR5aWVsZCB0a1VuZGVudFxyXG5cdFx0XHRsZXZlbCAtPSAxXHJcblx0cmV0dXJuXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuZXhwb3J0IGFsbFRva2Vuc0luQmxvY2sgOj0gKFxyXG5cdFx0YmxvY2s6IHN0cmluZ1xyXG5cdFx0Z2VuOiBUVG9rZW5HZW5lcmF0b3IgPSBpZGVudFRva2VuR2VuXHJcblx0XHQpOiBHZW5lcmF0b3I8VFBMTFRva2VuLCB2b2lkLCB2b2lkPiAtPlxyXG5cclxuXHRmb3IgdG9rIG9mIGFsbFRva2Vuc0luKGFsbExpbmVzSW5CbG9jayhibG9jayksIGdlbilcclxuXHRcdHlpZWxkIHRva1xyXG5cdHJldHVyblxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCB0b2tlblRhYmxlIDo9IChcclxuXHRcdGxUb2tlbnM6IEl0ZXJhYmxlPFRQTExUb2tlbj5cclxuXHRcdHRpdGxlPSdUb2tlbnMnXHJcblx0XHQpOiBzdHJpbmcgPT5cclxuXHJcblx0dGFibGUgOj0gbmV3IFRleHRUYWJsZSAnbCBsJ1xyXG5cdHRhYmxlLmZ1bGxzZXAgJz0nXHJcblx0dGFibGUudGl0bGUgdGl0bGVcclxuXHR0YWJsZS5mdWxsc2VwICc9J1xyXG5cdHRhYmxlLmxhYmVscyBbJ2tpbmQnLCAnc3RyJ11cclxuXHR0YWJsZS5zZXAoKVxyXG5cdGZvciB0b2sgb2YgbFRva2Vuc1xyXG5cdFx0dGFibGUuZGF0YSBbdG9rLmtpbmQsIHRvay5zdHJdXHJcblx0dGFibGUuZnVsbHNlcCAnPSdcclxuXHRyZXR1cm4gdGFibGUuYXNTdHJpbmcoKVxyXG4iXX0=