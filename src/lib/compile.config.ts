"use strict";
// compile.config.civet - default compiler configuration

import {
	compile as compileSvelte,
	} from 'npm:svelte/compiler'

import {o} from './llutils.lib.ts'
import {
	LOG, LOGVALUE, DBG, DBGVALUE,
	} from './logger.lib.ts'
import {
	withExt, rmFile, slurp, barf, patchFirstLine,
	TPathInfo, parsePath,
	} from './fs.lib.ts'
import {
	cmdSucceeds, execCmdSync,
	} from './exec.lib.ts'
import {cielo2civetFile} from './cielo.lib.ts'
import {civet2tsFile} from './civet.lib.ts'
import {installCmd, runUnitTestsFor} from './compile.lib.ts'

// ---------------------------------------------------------------------------
// --- NOTES:
//        1. compiler doesn't need to check if the file exists
//        2. compiler doesn't need to check the file extension

export default new Object({

	hCompilers: {
		// --- keys are file extensions
		//     NOTE: compilers must be synchronous!!!

		'.svelte': {
			getOutPaths: (path: string) => [withExt(path, '.js')],
			tester: () => { return true },
			compiler: (path: string) => {
				const jsPath = withExt(path, '.js')
				rmFile(jsPath)
				const {js, warnings} = compileSvelte(slurp(path), {
					customElement: true,
					runes: true
					})
				const {code, map} = js
				barf(jsPath, code)
				return 'compiled'
			}
			},
		'.dot': {
			getOutPaths: (path: string) => [withExt(path, '.svg')],
			tester: () => cmdSucceeds('dot', ['--version'], o`quiet`),
			compiler: (path: string) => {
				const svgPath = withExt(path, '.svg')
				rmFile(svgPath)
				execCmdSync('dot', ['-Tsvg', path])
				return 'compiled'
			}
			},
		'.cielo': {
			// --- We produce an intermediate .civet file,
			//     but give it a purpose of 'temp'
			//     so it won't get compiled by the compile script
			getOutPaths: (path: string) => [withExt(path, '.ts')],
			tester: () => {
				// --- we need civet to be installed
				return cmdSucceeds('civet', ['--version'], o`quiet`)
			},
			compiler: (path: string) => {
				const {fileName} = parsePath(path)

				const civetPath = withExt(path, '.temp.civet')
				const civetName = withExt(fileName, '.temp.civet')
				const tsPath = withExt(path, '.ts')
				const tsName = withExt(fileName, '.ts')

				rmFile(civetPath)    // --- needed?
				rmFile(tsPath)       // --- needed?

				cielo2civetFile(path, civetPath)
				civet2tsFile(civetPath, tsPath)

				patchFirstLine(civetPath, fileName, civetName)
				patchFirstLine(tsPath, fileName, tsName)

				return 'compiled'
			}
			},
		'.civet': {
			getOutPaths: (path: string) => [withExt(path, '.ts')],
			tester: () => {
				return cmdSucceeds('civet', ['--version'], o`quiet`)
			},
			compiler: (path: string) => {
				const {purpose, fileName} = parsePath(path)
				if (defined(purpose) && ['temp','debug'].includes(purpose)) {
					return 'temp'
				}

				const tsPath = withExt(path, '.ts')
				const tsName = withExt(fileName, '.ts')

				civet2tsFile(path, tsPath)
				patchFirstLine(tsPath, fileName, tsName)
				return 'compiled'
			}
			}
		},

	hPostProcessors: {
		// --- Keys are a purpose

		'test': (path: string): void => {
			return
		},

		'lib': (path: string): void => {
			const {stub} = parsePath(path)
			if (defined(stub)) {
				for (const {success} of runUnitTestsFor(stub)) {
					if (!success) {
						WARN(`Unit test ${path} failed`)
					}
				}
			}
			return
		},

		'cmd': (path: string): void => {
			LOG(`- installing command ${path}`)
			installCmd(path)
			return
		}
		}
	})

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvam9obmQvdXRpbHMvc3JjL2xpYi9jb21waWxlLmNvbmZpZy5jaXZldC50c3giLCJzb3VyY2VzIjpbIkM6L1VzZXJzL2pvaG5kL3V0aWxzL3NyYy9saWIvY29tcGlsZS5jb25maWcuY2l2ZXQiXSwibWFwcGluZ3MiOiI7QUFBQSx3REFBdUQ7QUFDdkQsQUFBQTtBQUNBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDO0FBQzFCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUI7QUFDN0IsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCO0FBQ2xDLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDO0FBQzlCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUI7QUFDekIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUM7QUFDOUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUM7QUFDdEIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWE7QUFDckIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxXQUFXLENBQUMsQ0FBQyxXQUFXLENBQUM7QUFDMUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWU7QUFDdkIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0I7QUFDOUMsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0I7QUFD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LEdBQVMsTUFBTixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUUsQ0FBQyxTQUFTLENBQUEsQUFBQyxJQUFJLENBQUE7QUFDM0IsQUFBQSxHQUFHLEdBQUcsQ0FBQSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQSxDQUFBO0FBQ25CLEFBQUEsSUFBSSxHQUFHLENBQUMsQ0FBQSxNQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDMUMsQUFBQSxLQUFLLEdBQUcsQ0FBQSxDQUFJLE9BQU8sQ0FBQSxDQUFBLENBQUE7QUFDbkIsQUFBQSxNQUFNLElBQUksQ0FBQSxBQUFDLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQztLQUFBLEM7SUFBQSxDO0dBQUEsQ0FBQTtBQUNyQyxBQUFBLEdBQUcsTTtFQUFNLENBQUEsQ0FBQTtBQUNULEFBQUE7QUFDQSxBQUFBLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUNoQyxBQUFBLEdBQUcsR0FBRyxDQUFBLEFBQUMsQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFBO0FBQ3JDLEFBQUEsR0FBRyxVQUFVLENBQUEsQUFBQyxJQUFJLENBQUE7QUFDbEIsQUFBQSxHQUFHLE07RUFBTSxDQUFBO0FBQ1QsRUFBRSxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDRiIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyBjb21waWxlLmNvbmZpZy5jaXZldCAtIGRlZmF1bHQgY29tcGlsZXIgY29uZmlndXJhdGlvblxuXG5pbXBvcnQge1xuXHRjb21waWxlIGFzIGNvbXBpbGVTdmVsdGUsXG5cdH0gZnJvbSAnbnBtOnN2ZWx0ZS9jb21waWxlcidcblxuaW1wb3J0IHtvfSBmcm9tICcuL2xsdXRpbHMubGliLnRzJ1xuaW1wb3J0IHtcblx0TE9HLCBMT0dWQUxVRSwgREJHLCBEQkdWQUxVRSxcblx0fSBmcm9tICcuL2xvZ2dlci5saWIudHMnXG5pbXBvcnQge1xuXHR3aXRoRXh0LCBybUZpbGUsIHNsdXJwLCBiYXJmLCBwYXRjaEZpcnN0TGluZSxcblx0VFBhdGhJbmZvLCBwYXJzZVBhdGgsXG5cdH0gZnJvbSAnLi9mcy5saWIudHMnXG5pbXBvcnQge1xuXHRjbWRTdWNjZWVkcywgZXhlY0NtZFN5bmMsXG5cdH0gZnJvbSAnLi9leGVjLmxpYi50cydcbmltcG9ydCB7Y2llbG8yY2l2ZXRGaWxlfSBmcm9tICcuL2NpZWxvLmxpYi50cydcbmltcG9ydCB7Y2l2ZXQydHNGaWxlfSBmcm9tICcuL2NpdmV0LmxpYi50cydcbmltcG9ydCB7aW5zdGFsbENtZCwgcnVuVW5pdFRlc3RzRm9yfSBmcm9tICcuL2NvbXBpbGUubGliLnRzJ1xuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyAtLS0gTk9URVM6XG4jICAgICAgICAxLiBjb21waWxlciBkb2Vzbid0IG5lZWQgdG8gY2hlY2sgaWYgdGhlIGZpbGUgZXhpc3RzXG4jICAgICAgICAyLiBjb21waWxlciBkb2Vzbid0IG5lZWQgdG8gY2hlY2sgdGhlIGZpbGUgZXh0ZW5zaW9uXG5cbmV4cG9ydCBkZWZhdWx0IG5ldyBPYmplY3Qge1xuXG5cdGhDb21waWxlcnM6IHtcblx0XHQjIC0tLSBrZXlzIGFyZSBmaWxlIGV4dGVuc2lvbnNcblx0XHQjICAgICBOT1RFOiBjb21waWxlcnMgbXVzdCBiZSBzeW5jaHJvbm91cyEhIVxuXG5cdFx0Jy5zdmVsdGUnOiB7XG5cdFx0XHRnZXRPdXRQYXRoczogKHBhdGg6IHN0cmluZykgPT4gW3dpdGhFeHQocGF0aCwgJy5qcycpXVxuXHRcdFx0dGVzdGVyOiAoKSA9PiByZXR1cm4gdHJ1ZVxuXHRcdFx0Y29tcGlsZXI6IChwYXRoOiBzdHJpbmcpID0+XG5cdFx0XHRcdGpzUGF0aCA6PSB3aXRoRXh0KHBhdGgsICcuanMnKVxuXHRcdFx0XHRybUZpbGUganNQYXRoXG5cdFx0XHRcdHtqcywgd2FybmluZ3N9IDo9IGNvbXBpbGVTdmVsdGUgc2x1cnAocGF0aCksIHtcblx0XHRcdFx0XHRjdXN0b21FbGVtZW50OiB0cnVlXG5cdFx0XHRcdFx0cnVuZXM6IHRydWVcblx0XHRcdFx0XHR9XG5cdFx0XHRcdHtjb2RlLCBtYXB9IDo9IGpzXG5cdFx0XHRcdGJhcmYganNQYXRoLCBjb2RlXG5cdFx0XHRcdHJldHVybiAnY29tcGlsZWQnXG5cdFx0XHR9XG5cdFx0Jy5kb3QnOiB7XG5cdFx0XHRnZXRPdXRQYXRoczogKHBhdGg6IHN0cmluZykgPT4gW3dpdGhFeHQocGF0aCwgJy5zdmcnKV1cblx0XHRcdHRlc3RlcjogKCkgPT4gY21kU3VjY2VlZHMoJ2RvdCcsIFsnLS12ZXJzaW9uJ10sIG8ncXVpZXQnKVxuXHRcdFx0Y29tcGlsZXI6IChwYXRoOiBzdHJpbmcpID0+XG5cdFx0XHRcdHN2Z1BhdGggOj0gd2l0aEV4dChwYXRoLCAnLnN2ZycpXG5cdFx0XHRcdHJtRmlsZSBzdmdQYXRoXG5cdFx0XHRcdGV4ZWNDbWRTeW5jICdkb3QnLCBbJy1Uc3ZnJywgcGF0aF1cblx0XHRcdFx0cmV0dXJuICdjb21waWxlZCdcblx0XHRcdH1cblx0XHQnLmNpZWxvJzoge1xuXHRcdFx0IyAtLS0gV2UgcHJvZHVjZSBhbiBpbnRlcm1lZGlhdGUgLmNpdmV0IGZpbGUsXG5cdFx0XHQjICAgICBidXQgZ2l2ZSBpdCBhIHB1cnBvc2Ugb2YgJ3RlbXAnXG5cdFx0XHQjICAgICBzbyBpdCB3b24ndCBnZXQgY29tcGlsZWQgYnkgdGhlIGNvbXBpbGUgc2NyaXB0XG5cdFx0XHRnZXRPdXRQYXRoczogKHBhdGg6IHN0cmluZykgPT4gW3dpdGhFeHQocGF0aCwgJy50cycpXVxuXHRcdFx0dGVzdGVyOiAoKSA9PlxuXHRcdFx0XHQjIC0tLSB3ZSBuZWVkIGNpdmV0IHRvIGJlIGluc3RhbGxlZFxuXHRcdFx0XHRyZXR1cm4gY21kU3VjY2VlZHMoJ2NpdmV0JywgWyctLXZlcnNpb24nXSwgbydxdWlldCcpXG5cdFx0XHRjb21waWxlcjogKHBhdGg6IHN0cmluZykgPT5cblx0XHRcdFx0e2ZpbGVOYW1lfSA6PSBwYXJzZVBhdGggcGF0aFxuXG5cdFx0XHRcdGNpdmV0UGF0aCA6PSB3aXRoRXh0KHBhdGgsICcudGVtcC5jaXZldCcpXG5cdFx0XHRcdGNpdmV0TmFtZSA6PSB3aXRoRXh0KGZpbGVOYW1lLCAnLnRlbXAuY2l2ZXQnKVxuXHRcdFx0XHR0c1BhdGggOj0gd2l0aEV4dChwYXRoLCAnLnRzJylcblx0XHRcdFx0dHNOYW1lIDo9IHdpdGhFeHQoZmlsZU5hbWUsICcudHMnKVxuXG5cdFx0XHRcdHJtRmlsZSBjaXZldFBhdGggICAgIyAtLS0gbmVlZGVkP1xuXHRcdFx0XHRybUZpbGUgdHNQYXRoICAgICAgICMgLS0tIG5lZWRlZD9cblxuXHRcdFx0XHRjaWVsbzJjaXZldEZpbGUgcGF0aCwgY2l2ZXRQYXRoXG5cdFx0XHRcdGNpdmV0MnRzRmlsZSBjaXZldFBhdGgsIHRzUGF0aFxuXG5cdFx0XHRcdHBhdGNoRmlyc3RMaW5lIGNpdmV0UGF0aCwgZmlsZU5hbWUsIGNpdmV0TmFtZVxuXHRcdFx0XHRwYXRjaEZpcnN0TGluZSB0c1BhdGgsIGZpbGVOYW1lLCB0c05hbWVcblxuXHRcdFx0XHRyZXR1cm4gJ2NvbXBpbGVkJ1xuXHRcdFx0fVxuXHRcdCcuY2l2ZXQnOiB7XG5cdFx0XHRnZXRPdXRQYXRoczogKHBhdGg6IHN0cmluZykgPT4gW3dpdGhFeHQocGF0aCwgJy50cycpXVxuXHRcdFx0dGVzdGVyOiAoKSA9PlxuXHRcdFx0XHRyZXR1cm4gY21kU3VjY2VlZHMoJ2NpdmV0JywgWyctLXZlcnNpb24nXSwgbydxdWlldCcpXG5cdFx0XHRjb21waWxlcjogKHBhdGg6IHN0cmluZykgPT5cblx0XHRcdFx0e3B1cnBvc2UsIGZpbGVOYW1lfSA6PSBwYXJzZVBhdGggcGF0aFxuXHRcdFx0XHRpZiBkZWZpbmVkKHB1cnBvc2UpICYmIFsndGVtcCcsJ2RlYnVnJ10uaW5jbHVkZXMocHVycG9zZSlcblx0XHRcdFx0XHRyZXR1cm4gJ3RlbXAnXG5cblx0XHRcdFx0dHNQYXRoIDo9IHdpdGhFeHQocGF0aCwgJy50cycpXG5cdFx0XHRcdHRzTmFtZSA6PSB3aXRoRXh0KGZpbGVOYW1lLCAnLnRzJylcblxuXHRcdFx0XHRjaXZldDJ0c0ZpbGUgcGF0aCwgdHNQYXRoXG5cdFx0XHRcdHBhdGNoRmlyc3RMaW5lIHRzUGF0aCwgZmlsZU5hbWUsIHRzTmFtZVxuXHRcdFx0XHRyZXR1cm4gJ2NvbXBpbGVkJ1xuXHRcdFx0fVxuXHRcdH1cblxuXHRoUG9zdFByb2Nlc3NvcnM6IHtcblx0XHQjIC0tLSBLZXlzIGFyZSBhIHB1cnBvc2VcblxuXHRcdCd0ZXN0JzogKHBhdGg6IHN0cmluZyk6IHZvaWQgPT5cblx0XHRcdHJldHVyblxuXG5cdFx0J2xpYic6IChwYXRoOiBzdHJpbmcpOiB2b2lkID0+XG5cdFx0XHR7c3R1Yn0gOj0gcGFyc2VQYXRoIHBhdGhcblx0XHRcdGlmIGRlZmluZWQoc3R1Yilcblx0XHRcdFx0Zm9yIHtzdWNjZXNzfSBvZiBydW5Vbml0VGVzdHNGb3Ioc3R1Yilcblx0XHRcdFx0XHRpZiBub3Qgc3VjY2Vzc1xuXHRcdFx0XHRcdFx0V0FSTiBcIlVuaXQgdGVzdCAje3BhdGh9IGZhaWxlZFwiXG5cdFx0XHRyZXR1cm5cblxuXHRcdCdjbWQnOiAocGF0aDogc3RyaW5nKTogdm9pZCA9PlxuXHRcdFx0TE9HIFwiLSBpbnN0YWxsaW5nIGNvbW1hbmQgI3twYXRofVwiXG5cdFx0XHRpbnN0YWxsQ21kIHBhdGhcblx0XHRcdHJldHVyblxuXHRcdH1cblx0fVxuIl19