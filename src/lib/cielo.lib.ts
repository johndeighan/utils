"use strict";
// cielo.lib.civet

import {pathToFileURL} from "node:url"

import {
	undef, defined, notdefined, assert, croak, hash, isHash,
	} from 'datatypes'
import {pass, keys, require} from 'llutils'
import {OL, ML} from 'to-nice'
import {
	DBG, LOG, WARN, ERR, DBGVALUE, DBGLABELED,
	pushLogLevel, popLogLevel,
	} from 'logger'
import {
	isFile, fileExt, withExt, slurp, barf, barfTempFile,
	parsePath,
	} from 'fsys'
import {civet2ts, civet2tsFile} from 'civet'

// ---------------------------------------------------------------------------

/**
 * cielo2civet() - convert cielo code to civet code
 */

export const cielo2civet = (code: string): string => {

	return code
}

// ---------------------------------------------------------------------------

export const cielo2ts = (code: string): string => {

	return civet2ts(cielo2civet(code))
}

// ---------------------------------------------------------------------------

/**
 * cielo2civetFile(cieloPath, civetPath)
 *    - pre-process the .cielo file to .civet file
 */

export const cielo2civetFile = (
		cieloPath: string,
		civetPath: string = withExt(cieloPath, '.civet')
		): string => {

	assert(isFile(cieloPath), `No such file: ${OL(cieloPath)} (cielo2civet)`)
	assert((fileExt(cieloPath) === '.cielo'), `Not a cielo file: ${OL(cieloPath)}`)
	assert((fileExt(civetPath) === '.civet'), `Not a civet file: ${OL(civetPath)}`)
	const code = slurp(cieloPath)
	barf(civetPath, cielo2civet(code))
	assert(isFile(civetPath), `File not created: ${OL(civetPath)}`)
	return civetPath
}

// ---------------------------------------------------------------------------

/**
 * cielo2tsFile(cieloPath, tsPath)
 *    - pre-process the .cielo file to .ts file
 */

export const cielo2tsFile = (
		cieloPath: string,
		tsPath: string = withExt(cieloPath, '.ts')
		): string => {

	assert(isFile(cieloPath), `No such file: ${OL(cieloPath)} (cielo2ts)`)
	assert((fileExt(cieloPath) === '.cielo'), `Not a cielo file: ${OL(cieloPath)}`)
	assert((fileExt(tsPath) === '.ts'), `Not a ts file: ${OL(tsPath)}`)
	const code = slurp(cieloPath)
	barf(tsPath, cielo2ts(code))
	assert(isFile(tsPath), `File not created: ${OL(tsPath)}`)
	return tsPath
}

// ---------------------------------------------------------------------------

export const configFromFile = (orgPath: string): hash => {

	const {path, type, purpose, ext} = parsePath(orgPath)
	assert((type === 'file'), `Not a file: ${OL(path)}`)
	assert((purpose === 'config'), `Not a config file: ${OL(path)}`)
	DBGLABELED("GET CONFIG", `path = ${OL(path)}`)

	const srcPath = (ext === '.civet') ? civet2tsFile(path) : path
	assert((fileExt(srcPath) === '.ts'),
		`config not a .ts or .civet file: ${OL(path)}`)
	DBGVALUE('srcPath', srcPath)
	const url = pathToFileURL(srcPath)
	DBGVALUE('url', url)
	const hImported = require(srcPath)
	DBGVALUE('hImported', hImported)
	const hResult = hImported?.default || hImported
	DBGVALUE("hResult", hResult)
	assert(isHash(hResult),
			`Default import in ${OL(srcPath)} not a hash: ${ML(hResult)}`)
	return hResult
}

// ---------------------------------------------------------------------------

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxqb2huZFxcdXRpbHNcXHNyY1xcbGliXFxjaWVsby5saWIuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGpvaG5kXFx1dGlsc1xcc3JjXFxsaWJcXGNpZWxvLmxpYi5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLGtCQUFpQjtBQUNqQixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVTtBQUN0QyxBQUFBO0FBQ0EsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDO0FBQ1IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFDekQsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVc7QUFDbkIsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQzNDLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUztBQUM5QixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFVBQVUsQ0FBQztBQUMzQyxDQUFDLFlBQVksQ0FBQyxDQUFDLFdBQVcsQ0FBQztBQUMzQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUTtBQUNoQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFD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QUMsT0FBTyxDQUFBO0FBQzVCLEFBQUEsQ0FBSSxNQUFILEdBQUcsQ0FBQyxDQUFFLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQztBQUM5QixBQUFBLENBQUMsUUFBUSxDQUFBLEFBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFBO0FBQ3BCLEFBQUEsQ0FBVSxNQUFULFNBQVMsQ0FBQyxDQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQztBQUM5QixBQUFBLENBQUMsUUFBUSxDQUFBLEFBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFBO0FBQ2hDLEFBQUEsQ0FBUSxNQUFQLE9BQU8sQ0FBQyxDQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxTQUFTO0FBQzNDLEFBQUEsQ0FBQyxRQUFRLENBQUEsQUFBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUE7QUFDNUIsQUFBQSxDQUFDLE1BQU0sQ0FBQSxBQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUN4QixBQUFBLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDaEUsQUFBQSxDQUFDLE1BQU0sQ0FBQyxPO0FBQU8sQ0FBQTtBQUNmO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgY2llbG8ubGliLmNpdmV0XHJcblxyXG5pbXBvcnQge3BhdGhUb0ZpbGVVUkx9IGZyb20gXCJub2RlOnVybFwiXHJcblxyXG5pbXBvcnQge1xyXG5cdHVuZGVmLCBkZWZpbmVkLCBub3RkZWZpbmVkLCBhc3NlcnQsIGNyb2FrLCBoYXNoLCBpc0hhc2gsXHJcblx0fSBmcm9tICdkYXRhdHlwZXMnXHJcbmltcG9ydCB7cGFzcywga2V5cywgcmVxdWlyZX0gZnJvbSAnbGx1dGlscydcclxuaW1wb3J0IHtPTCwgTUx9IGZyb20gJ3RvLW5pY2UnXHJcbmltcG9ydCB7XHJcblx0REJHLCBMT0csIFdBUk4sIEVSUiwgREJHVkFMVUUsIERCR0xBQkVMRUQsXHJcblx0cHVzaExvZ0xldmVsLCBwb3BMb2dMZXZlbCxcclxuXHR9IGZyb20gJ2xvZ2dlcidcclxuaW1wb3J0IHtcclxuXHRpc0ZpbGUsIGZpbGVFeHQsIHdpdGhFeHQsIHNsdXJwLCBiYXJmLCBiYXJmVGVtcEZpbGUsXHJcblx0cGFyc2VQYXRoLFxyXG5cdH0gZnJvbSAnZnN5cydcclxuaW1wb3J0IHtjaXZldDJ0cywgY2l2ZXQydHNGaWxlfSBmcm9tICdjaXZldCdcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4vKipcclxuICogY2llbG8yY2l2ZXQoKSAtIGNvbnZlcnQgY2llbG8gY29kZSB0byBjaXZldCBjb2RlXHJcbiAqL1xyXG5cclxuZXhwb3J0IGNpZWxvMmNpdmV0IDo9IChjb2RlOiBzdHJpbmcpOiBzdHJpbmcgPT5cclxuXHJcblx0cmV0dXJuIGNvZGVcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgY2llbG8ydHMgOj0gKGNvZGU6IHN0cmluZyk6IHN0cmluZyA9PlxyXG5cclxuXHRyZXR1cm4gY2l2ZXQydHMoY2llbG8yY2l2ZXQoY29kZSkpXHJcblxyXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuLyoqXHJcbiAqIGNpZWxvMmNpdmV0RmlsZShjaWVsb1BhdGgsIGNpdmV0UGF0aClcclxuICogICAgLSBwcmUtcHJvY2VzcyB0aGUgLmNpZWxvIGZpbGUgdG8gLmNpdmV0IGZpbGVcclxuICovXHJcblxyXG5leHBvcnQgY2llbG8yY2l2ZXRGaWxlIDo9IChcclxuXHRcdGNpZWxvUGF0aDogc3RyaW5nXHJcblx0XHRjaXZldFBhdGg6IHN0cmluZyA9IHdpdGhFeHQoY2llbG9QYXRoLCAnLmNpdmV0JylcclxuXHRcdCk6IHN0cmluZyA9PlxyXG5cclxuXHRhc3NlcnQgaXNGaWxlKGNpZWxvUGF0aCksIFwiTm8gc3VjaCBmaWxlOiAje09MKGNpZWxvUGF0aCl9IChjaWVsbzJjaXZldClcIlxyXG5cdGFzc2VydCAoZmlsZUV4dChjaWVsb1BhdGgpID09ICcuY2llbG8nKSwgXCJOb3QgYSBjaWVsbyBmaWxlOiAje09MKGNpZWxvUGF0aCl9XCJcclxuXHRhc3NlcnQgKGZpbGVFeHQoY2l2ZXRQYXRoKSA9PSAnLmNpdmV0JyksIFwiTm90IGEgY2l2ZXQgZmlsZTogI3tPTChjaXZldFBhdGgpfVwiXHJcblx0Y29kZSA6PSBzbHVycCBjaWVsb1BhdGhcclxuXHRiYXJmIGNpdmV0UGF0aCwgY2llbG8yY2l2ZXQoY29kZSlcclxuXHRhc3NlcnQgaXNGaWxlKGNpdmV0UGF0aCksIFwiRmlsZSBub3QgY3JlYXRlZDogI3tPTChjaXZldFBhdGgpfVwiXHJcblx0cmV0dXJuIGNpdmV0UGF0aFxyXG5cclxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbi8qKlxyXG4gKiBjaWVsbzJ0c0ZpbGUoY2llbG9QYXRoLCB0c1BhdGgpXHJcbiAqICAgIC0gcHJlLXByb2Nlc3MgdGhlIC5jaWVsbyBmaWxlIHRvIC50cyBmaWxlXHJcbiAqL1xyXG5cclxuZXhwb3J0IGNpZWxvMnRzRmlsZSA6PSAoXHJcblx0XHRjaWVsb1BhdGg6IHN0cmluZ1xyXG5cdFx0dHNQYXRoOiBzdHJpbmcgPSB3aXRoRXh0KGNpZWxvUGF0aCwgJy50cycpXHJcblx0XHQpOiBzdHJpbmcgPT5cclxuXHJcblx0YXNzZXJ0IGlzRmlsZShjaWVsb1BhdGgpLCBcIk5vIHN1Y2ggZmlsZTogI3tPTChjaWVsb1BhdGgpfSAoY2llbG8ydHMpXCJcclxuXHRhc3NlcnQgKGZpbGVFeHQoY2llbG9QYXRoKSA9PSAnLmNpZWxvJyksIFwiTm90IGEgY2llbG8gZmlsZTogI3tPTChjaWVsb1BhdGgpfVwiXHJcblx0YXNzZXJ0IChmaWxlRXh0KHRzUGF0aCkgPT0gJy50cycpLCBcIk5vdCBhIHRzIGZpbGU6ICN7T0wodHNQYXRoKX1cIlxyXG5cdGNvZGUgOj0gc2x1cnAgY2llbG9QYXRoXHJcblx0YmFyZiB0c1BhdGgsIGNpZWxvMnRzKGNvZGUpXHJcblx0YXNzZXJ0IGlzRmlsZSh0c1BhdGgpLCBcIkZpbGUgbm90IGNyZWF0ZWQ6ICN7T0wodHNQYXRoKX1cIlxyXG5cdHJldHVybiB0c1BhdGhcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5leHBvcnQgY29uZmlnRnJvbUZpbGUgOj0gKG9yZ1BhdGg6IHN0cmluZyk6IGhhc2ggPT5cclxuXHJcblx0e3BhdGgsIHR5cGUsIHB1cnBvc2UsIGV4dH0gOj0gcGFyc2VQYXRoKG9yZ1BhdGgpXHJcblx0YXNzZXJ0ICh0eXBlID09ICdmaWxlJyksIFwiTm90IGEgZmlsZTogI3tPTChwYXRoKX1cIlxyXG5cdGFzc2VydCAocHVycG9zZSA9PSAnY29uZmlnJyksIFwiTm90IGEgY29uZmlnIGZpbGU6ICN7T0wocGF0aCl9XCJcclxuXHREQkdMQUJFTEVEIFwiR0VUIENPTkZJR1wiLCBcInBhdGggPSAje09MKHBhdGgpfVwiXHJcblxyXG5cdHNyY1BhdGggOj0gKGV4dCA9PSAnLmNpdmV0JykgPyBjaXZldDJ0c0ZpbGUocGF0aCkgOiBwYXRoXHJcblx0YXNzZXJ0IChmaWxlRXh0KHNyY1BhdGgpID09ICcudHMnKSxcclxuXHRcdFwiY29uZmlnIG5vdCBhIC50cyBvciAuY2l2ZXQgZmlsZTogI3tPTChwYXRoKX1cIlxyXG5cdERCR1ZBTFVFICdzcmNQYXRoJywgc3JjUGF0aFxyXG5cdHVybCA6PSBwYXRoVG9GaWxlVVJMKHNyY1BhdGgpXHJcblx0REJHVkFMVUUgJ3VybCcsIHVybFxyXG5cdGhJbXBvcnRlZCA6PSByZXF1aXJlKHNyY1BhdGgpXHJcblx0REJHVkFMVUUgJ2hJbXBvcnRlZCcsIGhJbXBvcnRlZFxyXG5cdGhSZXN1bHQgOj0gaEltcG9ydGVkPy5kZWZhdWx0IHx8IGhJbXBvcnRlZFxyXG5cdERCR1ZBTFVFIFwiaFJlc3VsdFwiLCBoUmVzdWx0XHJcblx0YXNzZXJ0IGlzSGFzaChoUmVzdWx0KSxcclxuXHRcdFx0XCJEZWZhdWx0IGltcG9ydCBpbiAje09MKHNyY1BhdGgpfSBub3QgYSBoYXNoOiAje01MKGhSZXN1bHQpfVwiXHJcblx0cmV0dXJuIGhSZXN1bHRcclxuXHJcbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiJdfQ==